(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function BE(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var lm={exports:{}},il={},um={exports:{}},le={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ro=Symbol.for("react.element"),jE=Symbol.for("react.portal"),GE=Symbol.for("react.fragment"),KE=Symbol.for("react.strict_mode"),VE=Symbol.for("react.profiler"),HE=Symbol.for("react.provider"),WE=Symbol.for("react.context"),zE=Symbol.for("react.forward_ref"),qE=Symbol.for("react.suspense"),YE=Symbol.for("react.memo"),QE=Symbol.for("react.lazy"),zh=Symbol.iterator;function XE(r){return r===null||typeof r!="object"?null:(r=zh&&r[zh]||r["@@iterator"],typeof r=="function"?r:null)}var cm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dm=Object.assign,hm={};function Gn(r,e,t){this.props=r,this.context=e,this.refs=hm,this.updater=t||cm}Gn.prototype.isReactComponent={};Gn.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};Gn.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function fm(){}fm.prototype=Gn.prototype;function pd(r,e,t){this.props=r,this.context=e,this.refs=hm,this.updater=t||cm}var md=pd.prototype=new fm;md.constructor=pd;dm(md,Gn.prototype);md.isPureReactComponent=!0;var qh=Array.isArray,gm=Object.prototype.hasOwnProperty,yd={current:null},pm={key:!0,ref:!0,__self:!0,__source:!0};function mm(r,e,t){var s,n={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)gm.call(e,s)&&!pm.hasOwnProperty(s)&&(n[s]=e[s]);var a=arguments.length-2;if(a===1)n.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];n.children=l}if(r&&r.defaultProps)for(s in a=r.defaultProps,a)n[s]===void 0&&(n[s]=a[s]);return{$$typeof:ro,type:r,key:i,ref:o,props:n,_owner:yd.current}}function JE(r,e){return{$$typeof:ro,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function vd(r){return typeof r=="object"&&r!==null&&r.$$typeof===ro}function ZE(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var Yh=/\/+/g;function Ol(r,e){return typeof r=="object"&&r!==null&&r.key!=null?ZE(""+r.key):e.toString(36)}function Xo(r,e,t,s,n){var i=typeof r;(i==="undefined"||i==="boolean")&&(r=null);var o=!1;if(r===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(r.$$typeof){case ro:case jE:o=!0}}if(o)return o=r,n=n(o),r=s===""?"."+Ol(o,0):s,qh(n)?(t="",r!=null&&(t=r.replace(Yh,"$&/")+"/"),Xo(n,e,t,"",function(u){return u})):n!=null&&(vd(n)&&(n=JE(n,t+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Yh,"$&/")+"/")+r)),e.push(n)),1;if(o=0,s=s===""?".":s+":",qh(r))for(var a=0;a<r.length;a++){i=r[a];var l=s+Ol(i,a);o+=Xo(i,e,t,l,n)}else if(l=XE(r),typeof l=="function")for(r=l.call(r),a=0;!(i=r.next()).done;)i=i.value,l=s+Ol(i,a++),o+=Xo(i,e,t,l,n);else if(i==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function go(r,e,t){if(r==null)return r;var s=[],n=0;return Xo(r,s,"","",function(i){return e.call(t,i,n++)}),s}function eS(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var ct={current:null},Jo={transition:null},tS={ReactCurrentDispatcher:ct,ReactCurrentBatchConfig:Jo,ReactCurrentOwner:yd};function ym(){throw Error("act(...) is not supported in production builds of React.")}le.Children={map:go,forEach:function(r,e,t){go(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return go(r,function(){e++}),e},toArray:function(r){return go(r,function(e){return e})||[]},only:function(r){if(!vd(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};le.Component=Gn;le.Fragment=GE;le.Profiler=VE;le.PureComponent=pd;le.StrictMode=KE;le.Suspense=qE;le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tS;le.act=ym;le.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var s=dm({},r.props),n=r.key,i=r.ref,o=r._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=yd.current),e.key!==void 0&&(n=""+e.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(l in e)gm.call(e,l)&&!pm.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];s.children=a}return{$$typeof:ro,type:r.type,key:n,ref:i,props:s,_owner:o}};le.createContext=function(r){return r={$$typeof:WE,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:HE,_context:r},r.Consumer=r};le.createElement=mm;le.createFactory=function(r){var e=mm.bind(null,r);return e.type=r,e};le.createRef=function(){return{current:null}};le.forwardRef=function(r){return{$$typeof:zE,render:r}};le.isValidElement=vd;le.lazy=function(r){return{$$typeof:QE,_payload:{_status:-1,_result:r},_init:eS}};le.memo=function(r,e){return{$$typeof:YE,type:r,compare:e===void 0?null:e}};le.startTransition=function(r){var e=Jo.transition;Jo.transition={};try{r()}finally{Jo.transition=e}};le.unstable_act=ym;le.useCallback=function(r,e){return ct.current.useCallback(r,e)};le.useContext=function(r){return ct.current.useContext(r)};le.useDebugValue=function(){};le.useDeferredValue=function(r){return ct.current.useDeferredValue(r)};le.useEffect=function(r,e){return ct.current.useEffect(r,e)};le.useId=function(){return ct.current.useId()};le.useImperativeHandle=function(r,e,t){return ct.current.useImperativeHandle(r,e,t)};le.useInsertionEffect=function(r,e){return ct.current.useInsertionEffect(r,e)};le.useLayoutEffect=function(r,e){return ct.current.useLayoutEffect(r,e)};le.useMemo=function(r,e){return ct.current.useMemo(r,e)};le.useReducer=function(r,e,t){return ct.current.useReducer(r,e,t)};le.useRef=function(r){return ct.current.useRef(r)};le.useState=function(r){return ct.current.useState(r)};le.useSyncExternalStore=function(r,e,t){return ct.current.useSyncExternalStore(r,e,t)};le.useTransition=function(){return ct.current.useTransition()};le.version="18.3.1";um.exports=le;var Ce=um.exports;const rS=BE(Ce);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sS=Ce,nS=Symbol.for("react.element"),iS=Symbol.for("react.fragment"),oS=Object.prototype.hasOwnProperty,aS=sS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lS={key:!0,ref:!0,__self:!0,__source:!0};function vm(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)oS.call(e,s)&&!lS.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:nS,type:r,key:i,ref:o,props:n,_owner:aS.current}}il.Fragment=iS;il.jsx=vm;il.jsxs=vm;lm.exports=il;var Q=lm.exports,Gu={},Em={exports:{}},Dt={},Sm={exports:{}},Tm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(k,N){var B=k.length;k.push(N);e:for(;0<B;){var O=B-1>>>1,F=k[O];if(0<n(F,N))k[O]=N,k[B]=F,B=O;else break e}}function t(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var N=k[0],B=k.pop();if(B!==N){k[0]=B;e:for(var O=0,F=k.length,Z=F>>>1;O<Z;){var se=2*(O+1)-1,te=k[se],ne=se+1,Pe=k[ne];if(0>n(te,B))ne<F&&0>n(Pe,te)?(k[O]=Pe,k[ne]=B,O=ne):(k[O]=te,k[se]=B,O=se);else if(ne<F&&0>n(Pe,B))k[O]=Pe,k[ne]=B,O=ne;else break e}}return N}function n(k,N){var B=k.sortIndex-N.sortIndex;return B!==0?B:k.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,h=3,g=!1,f=!1,p=!1,m=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(k){for(var N=t(u);N!==null;){if(N.callback===null)s(u);else if(N.startTime<=k)s(u),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(u)}}function T(k){if(p=!1,E(k),!f)if(t(l)!==null)f=!0,M(_);else{var N=t(u);N!==null&&H(T,N.startTime-k)}}function _(k,N){f=!1,p&&(p=!1,y(A),A=-1),g=!0;var B=h;try{for(E(N),d=t(l);d!==null&&(!(d.expirationTime>N)||k&&!P());){var O=d.callback;if(typeof O=="function"){d.callback=null,h=d.priorityLevel;var F=O(d.expirationTime<=N);N=r.unstable_now(),typeof F=="function"?d.callback=F:d===t(l)&&s(l),E(N)}else s(l);d=t(l)}if(d!==null)var Z=!0;else{var se=t(u);se!==null&&H(T,se.startTime-N),Z=!1}return Z}finally{d=null,h=B,g=!1}}var x=!1,w=null,A=-1,I=5,R=-1;function P(){return!(r.unstable_now()-R<I)}function $(){if(w!==null){var k=r.unstable_now();R=k;var N=!0;try{N=w(!0,k)}finally{N?j():(x=!1,w=null)}}else x=!1}var j;if(typeof v=="function")j=function(){v($)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,V=K.port2;K.port1.onmessage=$,j=function(){V.postMessage(null)}}else j=function(){m($,0)};function M(k){w=k,x||(x=!0,j())}function H(k,N){A=m(function(){k(r.unstable_now())},N)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){f||g||(f=!0,M(_))},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return h},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(k){switch(h){case 1:case 2:case 3:var N=3;break;default:N=h}var B=h;h=N;try{return k()}finally{h=B}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,N){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var B=h;h=k;try{return N()}finally{h=B}},r.unstable_scheduleCallback=function(k,N,B){var O=r.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?O+B:O):B=O,k){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=B+F,k={id:c++,callback:N,priorityLevel:k,startTime:B,expirationTime:F,sortIndex:-1},B>O?(k.sortIndex=B,e(u,k),t(l)===null&&k===t(u)&&(p?(y(A),A=-1):p=!0,H(T,B-O))):(k.sortIndex=F,e(l,k),f||g||(f=!0,M(_))),k},r.unstable_shouldYield=P,r.unstable_wrapCallback=function(k){var N=h;return function(){var B=h;h=N;try{return k.apply(this,arguments)}finally{h=B}}}})(Tm);Sm.exports=Tm;var uS=Sm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cS=Ce,Pt=uS;function U(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _m=new Set,Ri={};function js(r,e){Pn(r,e),Pn(r+"Capture",e)}function Pn(r,e){for(Ri[r]=e,r=0;r<e.length;r++)_m.add(e[r])}var Cr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ku=Object.prototype.hasOwnProperty,dS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qh={},Xh={};function hS(r){return Ku.call(Xh,r)?!0:Ku.call(Qh,r)?!1:dS.test(r)?Xh[r]=!0:(Qh[r]=!0,!1)}function fS(r,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function gS(r,e,t,s){if(e===null||typeof e>"u"||fS(r,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function dt(r,e,t,s,n,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=n,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var et={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){et[r]=new dt(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];et[e]=new dt(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){et[r]=new dt(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){et[r]=new dt(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){et[r]=new dt(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){et[r]=new dt(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){et[r]=new dt(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){et[r]=new dt(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){et[r]=new dt(r,5,!1,r.toLowerCase(),null,!1,!1)});var Ed=/[\-:]([a-z])/g;function Sd(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(Ed,Sd);et[e]=new dt(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(Ed,Sd);et[e]=new dt(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(Ed,Sd);et[e]=new dt(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){et[r]=new dt(r,1,!1,r.toLowerCase(),null,!1,!1)});et.xlinkHref=new dt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){et[r]=new dt(r,1,!1,r.toLowerCase(),null,!0,!0)});function Td(r,e,t,s){var n=et.hasOwnProperty(e)?et[e]:null;(n!==null?n.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gS(e,t,n,s)&&(t=null),s||n===null?hS(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):n.mustUseProperty?r[n.propertyName]=t===null?n.type===3?!1:"":t:(e=n.attributeName,s=n.attributeNamespace,t===null?r.removeAttribute(e):(n=n.type,t=n===3||n===4&&t===!0?"":""+t,s?r.setAttributeNS(s,e,t):r.setAttribute(e,t))))}var Nr=cS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,po=Symbol.for("react.element"),an=Symbol.for("react.portal"),ln=Symbol.for("react.fragment"),_d=Symbol.for("react.strict_mode"),Vu=Symbol.for("react.profiler"),wm=Symbol.for("react.provider"),xm=Symbol.for("react.context"),wd=Symbol.for("react.forward_ref"),Hu=Symbol.for("react.suspense"),Wu=Symbol.for("react.suspense_list"),xd=Symbol.for("react.memo"),Br=Symbol.for("react.lazy"),Am=Symbol.for("react.offscreen"),Jh=Symbol.iterator;function Qn(r){return r===null||typeof r!="object"?null:(r=Jh&&r[Jh]||r["@@iterator"],typeof r=="function"?r:null)}var Ie=Object.assign,Nl;function oi(r){if(Nl===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Nl=e&&e[1]||""}return`
`+Nl+r}var Fl=!1;function Ml(r,e){if(!r||Fl)return"";Fl=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var s=u}Reflect.construct(r,[],e)}else{try{e.call()}catch(u){s=u}r.call(e.prototype)}else{try{throw Error()}catch(u){s=u}r()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var n=u.stack.split(`
`),i=s.stack.split(`
`),o=n.length-1,a=i.length-1;1<=o&&0<=a&&n[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==i[a]){var l=`
`+n[o].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=o&&0<=a);break}}}finally{Fl=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?oi(r):""}function pS(r){switch(r.tag){case 5:return oi(r.type);case 16:return oi("Lazy");case 13:return oi("Suspense");case 19:return oi("SuspenseList");case 0:case 2:case 15:return r=Ml(r.type,!1),r;case 11:return r=Ml(r.type.render,!1),r;case 1:return r=Ml(r.type,!0),r;default:return""}}function zu(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case ln:return"Fragment";case an:return"Portal";case Vu:return"Profiler";case _d:return"StrictMode";case Hu:return"Suspense";case Wu:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case xm:return(r.displayName||"Context")+".Consumer";case wm:return(r._context.displayName||"Context")+".Provider";case wd:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case xd:return e=r.displayName||null,e!==null?e:zu(r.type)||"Memo";case Br:e=r._payload,r=r._init;try{return zu(r(e))}catch{}}return null}function mS(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zu(e);case 8:return e===_d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function is(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Rm(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yS(r){var e=Rm(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),s=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var n=t.get,i=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function mo(r){r._valueTracker||(r._valueTracker=yS(r))}function Im(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return r&&(s=Rm(r)?r.checked?"true":"false":r.value),r=s,r!==t?(e.setValue(r),!0):!1}function Sa(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function qu(r,e){var t=e.checked;return Ie({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function Zh(r,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=is(e.value!=null?e.value:t),r._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bm(r,e){e=e.checked,e!=null&&Td(r,"checked",e,!1)}function Yu(r,e){bm(r,e);var t=is(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(s==="submit"||s==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?Qu(r,e.type,t):e.hasOwnProperty("defaultValue")&&Qu(r,e.type,is(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function ef(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function Qu(r,e,t){(e!=="number"||Sa(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var ai=Array.isArray;function Tn(r,e,t,s){if(r=r.options,e){e={};for(var n=0;n<t.length;n++)e["$"+t[n]]=!0;for(t=0;t<r.length;t++)n=e.hasOwnProperty("$"+r[t].value),r[t].selected!==n&&(r[t].selected=n),n&&s&&(r[t].defaultSelected=!0)}else{for(t=""+is(t),e=null,n=0;n<r.length;n++){if(r[n].value===t){r[n].selected=!0,s&&(r[n].defaultSelected=!0);return}e!==null||r[n].disabled||(e=r[n])}e!==null&&(e.selected=!0)}}function Xu(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return Ie({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function tf(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(U(92));if(ai(t)){if(1<t.length)throw Error(U(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:is(t)}}function Lm(r,e){var t=is(e.value),s=is(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),s!=null&&(r.defaultValue=""+s)}function rf(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function km(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ju(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?km(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var yo,Cm=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,n){MSApp.execUnsafeLocalFunction(function(){return r(e,t,s,n)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(yo=yo||document.createElement("div"),yo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yo.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function Ii(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var hi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vS=["Webkit","ms","Moz","O"];Object.keys(hi).forEach(function(r){vS.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),hi[e]=hi[r]})});function Pm(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||hi.hasOwnProperty(r)&&hi[r]?(""+e).trim():e+"px"}function Dm(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,n=Pm(t,e[t],s);t==="float"&&(t="cssFloat"),s?r.setProperty(t,n):r[t]=n}}var ES=Ie({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zu(r,e){if(e){if(ES[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function ec(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tc=null;function Ad(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var rc=null,_n=null,wn=null;function sf(r){if(r=io(r)){if(typeof rc!="function")throw Error(U(280));var e=r.stateNode;e&&(e=cl(e),rc(r.stateNode,r.type,e))}}function Om(r){_n?wn?wn.push(r):wn=[r]:_n=r}function Nm(){if(_n){var r=_n,e=wn;if(wn=_n=null,sf(r),e)for(r=0;r<e.length;r++)sf(e[r])}}function Fm(r,e){return r(e)}function Mm(){}var Ul=!1;function Um(r,e,t){if(Ul)return r(e,t);Ul=!0;try{return Fm(r,e,t)}finally{Ul=!1,(_n!==null||wn!==null)&&(Mm(),Nm())}}function bi(r,e){var t=r.stateNode;if(t===null)return null;var s=cl(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(r=r.type,s=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!s;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(U(231,e,typeof t));return t}var sc=!1;if(Cr)try{var Xn={};Object.defineProperty(Xn,"passive",{get:function(){sc=!0}}),window.addEventListener("test",Xn,Xn),window.removeEventListener("test",Xn,Xn)}catch{sc=!1}function SS(r,e,t,s,n,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var fi=!1,Ta=null,_a=!1,nc=null,TS={onError:function(r){fi=!0,Ta=r}};function _S(r,e,t,s,n,i,o,a,l){fi=!1,Ta=null,SS.apply(TS,arguments)}function wS(r,e,t,s,n,i,o,a,l){if(_S.apply(this,arguments),fi){if(fi){var u=Ta;fi=!1,Ta=null}else throw Error(U(198));_a||(_a=!0,nc=u)}}function Gs(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function $m(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function nf(r){if(Gs(r)!==r)throw Error(U(188))}function xS(r){var e=r.alternate;if(!e){if(e=Gs(r),e===null)throw Error(U(188));return e!==r?null:r}for(var t=r,s=e;;){var n=t.return;if(n===null)break;var i=n.alternate;if(i===null){if(s=n.return,s!==null){t=s;continue}break}if(n.child===i.child){for(i=n.child;i;){if(i===t)return nf(n),r;if(i===s)return nf(n),e;i=i.sibling}throw Error(U(188))}if(t.return!==s.return)t=n,s=i;else{for(var o=!1,a=n.child;a;){if(a===t){o=!0,t=n,s=i;break}if(a===s){o=!0,s=n,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,s=n;break}if(a===s){o=!0,s=i,t=n;break}a=a.sibling}if(!o)throw Error(U(189))}}if(t.alternate!==s)throw Error(U(190))}if(t.tag!==3)throw Error(U(188));return t.stateNode.current===t?r:e}function Bm(r){return r=xS(r),r!==null?jm(r):null}function jm(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=jm(r);if(e!==null)return e;r=r.sibling}return null}var Gm=Pt.unstable_scheduleCallback,of=Pt.unstable_cancelCallback,AS=Pt.unstable_shouldYield,RS=Pt.unstable_requestPaint,De=Pt.unstable_now,IS=Pt.unstable_getCurrentPriorityLevel,Rd=Pt.unstable_ImmediatePriority,Km=Pt.unstable_UserBlockingPriority,wa=Pt.unstable_NormalPriority,bS=Pt.unstable_LowPriority,Vm=Pt.unstable_IdlePriority,ol=null,yr=null;function LS(r){if(yr&&typeof yr.onCommitFiberRoot=="function")try{yr.onCommitFiberRoot(ol,r,void 0,(r.current.flags&128)===128)}catch{}}var rr=Math.clz32?Math.clz32:PS,kS=Math.log,CS=Math.LN2;function PS(r){return r>>>=0,r===0?32:31-(kS(r)/CS|0)|0}var vo=64,Eo=4194304;function li(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function xa(r,e){var t=r.pendingLanes;if(t===0)return 0;var s=0,n=r.suspendedLanes,i=r.pingedLanes,o=t&268435455;if(o!==0){var a=o&~n;a!==0?s=li(a):(i&=o,i!==0&&(s=li(i)))}else o=t&~n,o!==0?s=li(o):i!==0&&(s=li(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&n)&&(n=s&-s,i=e&-e,n>=i||n===16&&(i&4194240)!==0))return e;if(s&4&&(s|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=s;0<e;)t=31-rr(e),n=1<<t,s|=r[t],e&=~n;return s}function DS(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OS(r,e){for(var t=r.suspendedLanes,s=r.pingedLanes,n=r.expirationTimes,i=r.pendingLanes;0<i;){var o=31-rr(i),a=1<<o,l=n[o];l===-1?(!(a&t)||a&s)&&(n[o]=DS(a,e)):l<=e&&(r.expiredLanes|=a),i&=~a}}function ic(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function Hm(){var r=vo;return vo<<=1,!(vo&4194240)&&(vo=64),r}function $l(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function so(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-rr(e),r[e]=t}function NS(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var s=r.eventTimes;for(r=r.expirationTimes;0<t;){var n=31-rr(t),i=1<<n;e[n]=0,s[n]=-1,r[n]=-1,t&=~i}}function Id(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var s=31-rr(t),n=1<<s;n&e|r[s]&e&&(r[s]|=e),t&=~n}}var fe=0;function Wm(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var zm,bd,qm,Ym,Qm,oc=!1,So=[],Qr=null,Xr=null,Jr=null,Li=new Map,ki=new Map,Hr=[],FS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function af(r,e){switch(r){case"focusin":case"focusout":Qr=null;break;case"dragenter":case"dragleave":Xr=null;break;case"mouseover":case"mouseout":Jr=null;break;case"pointerover":case"pointerout":Li.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ki.delete(e.pointerId)}}function Jn(r,e,t,s,n,i){return r===null||r.nativeEvent!==i?(r={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:i,targetContainers:[n]},e!==null&&(e=io(e),e!==null&&bd(e)),r):(r.eventSystemFlags|=s,e=r.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),r)}function MS(r,e,t,s,n){switch(e){case"focusin":return Qr=Jn(Qr,r,e,t,s,n),!0;case"dragenter":return Xr=Jn(Xr,r,e,t,s,n),!0;case"mouseover":return Jr=Jn(Jr,r,e,t,s,n),!0;case"pointerover":var i=n.pointerId;return Li.set(i,Jn(Li.get(i)||null,r,e,t,s,n)),!0;case"gotpointercapture":return i=n.pointerId,ki.set(i,Jn(ki.get(i)||null,r,e,t,s,n)),!0}return!1}function Xm(r){var e=As(r.target);if(e!==null){var t=Gs(e);if(t!==null){if(e=t.tag,e===13){if(e=$m(t),e!==null){r.blockedOn=e,Qm(r.priority,function(){qm(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Zo(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=ac(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var s=new t.constructor(t.type,t);tc=s,t.target.dispatchEvent(s),tc=null}else return e=io(t),e!==null&&bd(e),r.blockedOn=t,!1;e.shift()}return!0}function lf(r,e,t){Zo(r)&&t.delete(e)}function US(){oc=!1,Qr!==null&&Zo(Qr)&&(Qr=null),Xr!==null&&Zo(Xr)&&(Xr=null),Jr!==null&&Zo(Jr)&&(Jr=null),Li.forEach(lf),ki.forEach(lf)}function Zn(r,e){r.blockedOn===e&&(r.blockedOn=null,oc||(oc=!0,Pt.unstable_scheduleCallback(Pt.unstable_NormalPriority,US)))}function Ci(r){function e(n){return Zn(n,r)}if(0<So.length){Zn(So[0],r);for(var t=1;t<So.length;t++){var s=So[t];s.blockedOn===r&&(s.blockedOn=null)}}for(Qr!==null&&Zn(Qr,r),Xr!==null&&Zn(Xr,r),Jr!==null&&Zn(Jr,r),Li.forEach(e),ki.forEach(e),t=0;t<Hr.length;t++)s=Hr[t],s.blockedOn===r&&(s.blockedOn=null);for(;0<Hr.length&&(t=Hr[0],t.blockedOn===null);)Xm(t),t.blockedOn===null&&Hr.shift()}var xn=Nr.ReactCurrentBatchConfig,Aa=!0;function $S(r,e,t,s){var n=fe,i=xn.transition;xn.transition=null;try{fe=1,Ld(r,e,t,s)}finally{fe=n,xn.transition=i}}function BS(r,e,t,s){var n=fe,i=xn.transition;xn.transition=null;try{fe=4,Ld(r,e,t,s)}finally{fe=n,xn.transition=i}}function Ld(r,e,t,s){if(Aa){var n=ac(r,e,t,s);if(n===null)Yl(r,e,s,Ra,t),af(r,s);else if(MS(n,r,e,t,s))s.stopPropagation();else if(af(r,s),e&4&&-1<FS.indexOf(r)){for(;n!==null;){var i=io(n);if(i!==null&&zm(i),i=ac(r,e,t,s),i===null&&Yl(r,e,s,Ra,t),i===n)break;n=i}n!==null&&s.stopPropagation()}else Yl(r,e,s,null,t)}}var Ra=null;function ac(r,e,t,s){if(Ra=null,r=Ad(s),r=As(r),r!==null)if(e=Gs(r),e===null)r=null;else if(t=e.tag,t===13){if(r=$m(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return Ra=r,null}function Jm(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(IS()){case Rd:return 1;case Km:return 4;case wa:case bS:return 16;case Vm:return 536870912;default:return 16}default:return 16}}var qr=null,kd=null,ea=null;function Zm(){if(ea)return ea;var r,e=kd,t=e.length,s,n="value"in qr?qr.value:qr.textContent,i=n.length;for(r=0;r<t&&e[r]===n[r];r++);var o=t-r;for(s=1;s<=o&&e[t-s]===n[i-s];s++);return ea=n.slice(r,1<s?1-s:void 0)}function ta(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function To(){return!0}function uf(){return!1}function Ot(r){function e(t,s,n,i,o){this._reactName=t,this._targetInst=n,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(t=r[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?To:uf,this.isPropagationStopped=uf,this}return Ie(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=To)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=To)},persist:function(){},isPersistent:To}),e}var Kn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cd=Ot(Kn),no=Ie({},Kn,{view:0,detail:0}),jS=Ot(no),Bl,jl,ei,al=Ie({},no,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pd,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ei&&(ei&&r.type==="mousemove"?(Bl=r.screenX-ei.screenX,jl=r.screenY-ei.screenY):jl=Bl=0,ei=r),Bl)},movementY:function(r){return"movementY"in r?r.movementY:jl}}),cf=Ot(al),GS=Ie({},al,{dataTransfer:0}),KS=Ot(GS),VS=Ie({},no,{relatedTarget:0}),Gl=Ot(VS),HS=Ie({},Kn,{animationName:0,elapsedTime:0,pseudoElement:0}),WS=Ot(HS),zS=Ie({},Kn,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),qS=Ot(zS),YS=Ie({},Kn,{data:0}),df=Ot(YS),QS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},XS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},JS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZS(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=JS[r])?!!e[r]:!1}function Pd(){return ZS}var eT=Ie({},no,{key:function(r){if(r.key){var e=QS[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=ta(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?XS[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pd,charCode:function(r){return r.type==="keypress"?ta(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ta(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),tT=Ot(eT),rT=Ie({},al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hf=Ot(rT),sT=Ie({},no,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pd}),nT=Ot(sT),iT=Ie({},Kn,{propertyName:0,elapsedTime:0,pseudoElement:0}),oT=Ot(iT),aT=Ie({},al,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),lT=Ot(aT),uT=[9,13,27,32],Dd=Cr&&"CompositionEvent"in window,gi=null;Cr&&"documentMode"in document&&(gi=document.documentMode);var cT=Cr&&"TextEvent"in window&&!gi,e0=Cr&&(!Dd||gi&&8<gi&&11>=gi),ff=" ",gf=!1;function t0(r,e){switch(r){case"keyup":return uT.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function r0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var un=!1;function dT(r,e){switch(r){case"compositionend":return r0(e);case"keypress":return e.which!==32?null:(gf=!0,ff);case"textInput":return r=e.data,r===ff&&gf?null:r;default:return null}}function hT(r,e){if(un)return r==="compositionend"||!Dd&&t0(r,e)?(r=Zm(),ea=kd=qr=null,un=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return e0&&e.locale!=="ko"?null:e.data;default:return null}}var fT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pf(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!fT[r.type]:e==="textarea"}function s0(r,e,t,s){Om(s),e=Ia(e,"onChange"),0<e.length&&(t=new Cd("onChange","change",null,t,s),r.push({event:t,listeners:e}))}var pi=null,Pi=null;function gT(r){g0(r,0)}function ll(r){var e=hn(r);if(Im(e))return r}function pT(r,e){if(r==="change")return e}var n0=!1;if(Cr){var Kl;if(Cr){var Vl="oninput"in document;if(!Vl){var mf=document.createElement("div");mf.setAttribute("oninput","return;"),Vl=typeof mf.oninput=="function"}Kl=Vl}else Kl=!1;n0=Kl&&(!document.documentMode||9<document.documentMode)}function yf(){pi&&(pi.detachEvent("onpropertychange",i0),Pi=pi=null)}function i0(r){if(r.propertyName==="value"&&ll(Pi)){var e=[];s0(e,Pi,r,Ad(r)),Um(gT,e)}}function mT(r,e,t){r==="focusin"?(yf(),pi=e,Pi=t,pi.attachEvent("onpropertychange",i0)):r==="focusout"&&yf()}function yT(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ll(Pi)}function vT(r,e){if(r==="click")return ll(e)}function ET(r,e){if(r==="input"||r==="change")return ll(e)}function ST(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var nr=typeof Object.is=="function"?Object.is:ST;function Di(r,e){if(nr(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var n=t[s];if(!Ku.call(e,n)||!nr(r[n],e[n]))return!1}return!0}function vf(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Ef(r,e){var t=vf(r);r=0;for(var s;t;){if(t.nodeType===3){if(s=r+t.textContent.length,r<=e&&s>=e)return{node:t,offset:e-r};r=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=vf(t)}}function o0(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?o0(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function a0(){for(var r=window,e=Sa();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=Sa(r.document)}return e}function Od(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function TT(r){var e=a0(),t=r.focusedElem,s=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&o0(t.ownerDocument.documentElement,t)){if(s!==null&&Od(t)){if(e=s.start,r=s.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var n=t.textContent.length,i=Math.min(s.start,n);s=s.end===void 0?i:Math.min(s.end,n),!r.extend&&i>s&&(n=s,s=i,i=n),n=Ef(t,i);var o=Ef(t,s);n&&o&&(r.rangeCount!==1||r.anchorNode!==n.node||r.anchorOffset!==n.offset||r.focusNode!==o.node||r.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),r.removeAllRanges(),i>s?(r.addRange(e),r.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var _T=Cr&&"documentMode"in document&&11>=document.documentMode,cn=null,lc=null,mi=null,uc=!1;function Sf(r,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;uc||cn==null||cn!==Sa(s)||(s=cn,"selectionStart"in s&&Od(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),mi&&Di(mi,s)||(mi=s,s=Ia(lc,"onSelect"),0<s.length&&(e=new Cd("onSelect","select",null,e,t),r.push({event:e,listeners:s}),e.target=cn)))}function _o(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var dn={animationend:_o("Animation","AnimationEnd"),animationiteration:_o("Animation","AnimationIteration"),animationstart:_o("Animation","AnimationStart"),transitionend:_o("Transition","TransitionEnd")},Hl={},l0={};Cr&&(l0=document.createElement("div").style,"AnimationEvent"in window||(delete dn.animationend.animation,delete dn.animationiteration.animation,delete dn.animationstart.animation),"TransitionEvent"in window||delete dn.transitionend.transition);function ul(r){if(Hl[r])return Hl[r];if(!dn[r])return r;var e=dn[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in l0)return Hl[r]=e[t];return r}var u0=ul("animationend"),c0=ul("animationiteration"),d0=ul("animationstart"),h0=ul("transitionend"),f0=new Map,Tf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function us(r,e){f0.set(r,e),js(e,[r])}for(var Wl=0;Wl<Tf.length;Wl++){var zl=Tf[Wl],wT=zl.toLowerCase(),xT=zl[0].toUpperCase()+zl.slice(1);us(wT,"on"+xT)}us(u0,"onAnimationEnd");us(c0,"onAnimationIteration");us(d0,"onAnimationStart");us("dblclick","onDoubleClick");us("focusin","onFocus");us("focusout","onBlur");us(h0,"onTransitionEnd");Pn("onMouseEnter",["mouseout","mouseover"]);Pn("onMouseLeave",["mouseout","mouseover"]);Pn("onPointerEnter",["pointerout","pointerover"]);Pn("onPointerLeave",["pointerout","pointerover"]);js("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));js("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));js("onBeforeInput",["compositionend","keypress","textInput","paste"]);js("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));js("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));js("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ui="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AT=new Set("cancel close invalid load scroll toggle".split(" ").concat(ui));function _f(r,e,t){var s=r.type||"unknown-event";r.currentTarget=t,wS(s,e,void 0,r),r.currentTarget=null}function g0(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var s=r[t],n=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&n.isPropagationStopped())break e;_f(n,a,u),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&n.isPropagationStopped())break e;_f(n,a,u),i=l}}}if(_a)throw r=nc,_a=!1,nc=null,r}function Ee(r,e){var t=e[gc];t===void 0&&(t=e[gc]=new Set);var s=r+"__bubble";t.has(s)||(p0(e,r,2,!1),t.add(s))}function ql(r,e,t){var s=0;e&&(s|=4),p0(t,r,s,e)}var wo="_reactListening"+Math.random().toString(36).slice(2);function Oi(r){if(!r[wo]){r[wo]=!0,_m.forEach(function(t){t!=="selectionchange"&&(AT.has(t)||ql(t,!1,r),ql(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[wo]||(e[wo]=!0,ql("selectionchange",!1,e))}}function p0(r,e,t,s){switch(Jm(e)){case 1:var n=$S;break;case 4:n=BS;break;default:n=Ld}t=n.bind(null,e,t,r),n=void 0,!sc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),s?n!==void 0?r.addEventListener(e,t,{capture:!0,passive:n}):r.addEventListener(e,t,!0):n!==void 0?r.addEventListener(e,t,{passive:n}):r.addEventListener(e,t,!1)}function Yl(r,e,t,s,n){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=As(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}Um(function(){var u=i,c=Ad(t),d=[];e:{var h=f0.get(r);if(h!==void 0){var g=Cd,f=r;switch(r){case"keypress":if(ta(t)===0)break e;case"keydown":case"keyup":g=tT;break;case"focusin":f="focus",g=Gl;break;case"focusout":f="blur",g=Gl;break;case"beforeblur":case"afterblur":g=Gl;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=cf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=KS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=nT;break;case u0:case c0:case d0:g=WS;break;case h0:g=oT;break;case"scroll":g=jS;break;case"wheel":g=lT;break;case"copy":case"cut":case"paste":g=qS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=hf}var p=(e&4)!==0,m=!p&&r==="scroll",y=p?h!==null?h+"Capture":null:h;p=[];for(var v=u,E;v!==null;){E=v;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,y!==null&&(T=bi(v,y),T!=null&&p.push(Ni(v,T,E)))),m)break;v=v.return}0<p.length&&(h=new g(h,f,null,t,c),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=r==="mouseover"||r==="pointerover",g=r==="mouseout"||r==="pointerout",h&&t!==tc&&(f=t.relatedTarget||t.fromElement)&&(As(f)||f[Pr]))break e;if((g||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,g?(f=t.relatedTarget||t.toElement,g=u,f=f?As(f):null,f!==null&&(m=Gs(f),f!==m||f.tag!==5&&f.tag!==6)&&(f=null)):(g=null,f=u),g!==f)){if(p=cf,T="onMouseLeave",y="onMouseEnter",v="mouse",(r==="pointerout"||r==="pointerover")&&(p=hf,T="onPointerLeave",y="onPointerEnter",v="pointer"),m=g==null?h:hn(g),E=f==null?h:hn(f),h=new p(T,v+"leave",g,t,c),h.target=m,h.relatedTarget=E,T=null,As(c)===u&&(p=new p(y,v+"enter",f,t,c),p.target=E,p.relatedTarget=m,T=p),m=T,g&&f)t:{for(p=g,y=f,v=0,E=p;E;E=Vs(E))v++;for(E=0,T=y;T;T=Vs(T))E++;for(;0<v-E;)p=Vs(p),v--;for(;0<E-v;)y=Vs(y),E--;for(;v--;){if(p===y||y!==null&&p===y.alternate)break t;p=Vs(p),y=Vs(y)}p=null}else p=null;g!==null&&wf(d,h,g,p,!1),f!==null&&m!==null&&wf(d,m,f,p,!0)}}e:{if(h=u?hn(u):window,g=h.nodeName&&h.nodeName.toLowerCase(),g==="select"||g==="input"&&h.type==="file")var _=pT;else if(pf(h))if(n0)_=ET;else{_=yT;var x=mT}else(g=h.nodeName)&&g.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(_=vT);if(_&&(_=_(r,u))){s0(d,_,t,c);break e}x&&x(r,h,u),r==="focusout"&&(x=h._wrapperState)&&x.controlled&&h.type==="number"&&Qu(h,"number",h.value)}switch(x=u?hn(u):window,r){case"focusin":(pf(x)||x.contentEditable==="true")&&(cn=x,lc=u,mi=null);break;case"focusout":mi=lc=cn=null;break;case"mousedown":uc=!0;break;case"contextmenu":case"mouseup":case"dragend":uc=!1,Sf(d,t,c);break;case"selectionchange":if(_T)break;case"keydown":case"keyup":Sf(d,t,c)}var w;if(Dd)e:{switch(r){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else un?t0(r,t)&&(A="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(A="onCompositionStart");A&&(e0&&t.locale!=="ko"&&(un||A!=="onCompositionStart"?A==="onCompositionEnd"&&un&&(w=Zm()):(qr=c,kd="value"in qr?qr.value:qr.textContent,un=!0)),x=Ia(u,A),0<x.length&&(A=new df(A,r,null,t,c),d.push({event:A,listeners:x}),w?A.data=w:(w=r0(t),w!==null&&(A.data=w)))),(w=cT?dT(r,t):hT(r,t))&&(u=Ia(u,"onBeforeInput"),0<u.length&&(c=new df("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=w))}g0(d,e)})}function Ni(r,e,t){return{instance:r,listener:e,currentTarget:t}}function Ia(r,e){for(var t=e+"Capture",s=[];r!==null;){var n=r,i=n.stateNode;n.tag===5&&i!==null&&(n=i,i=bi(r,t),i!=null&&s.unshift(Ni(r,i,n)),i=bi(r,e),i!=null&&s.push(Ni(r,i,n))),r=r.return}return s}function Vs(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function wf(r,e,t,s,n){for(var i=e._reactName,o=[];t!==null&&t!==s;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&u!==null&&(a=u,n?(l=bi(t,i),l!=null&&o.unshift(Ni(t,l,a))):n||(l=bi(t,i),l!=null&&o.push(Ni(t,l,a)))),t=t.return}o.length!==0&&r.push({event:e,listeners:o})}var RT=/\r\n?/g,IT=/\u0000|\uFFFD/g;function xf(r){return(typeof r=="string"?r:""+r).replace(RT,`
`).replace(IT,"")}function xo(r,e,t){if(e=xf(e),xf(r)!==e&&t)throw Error(U(425))}function ba(){}var cc=null,dc=null;function hc(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fc=typeof setTimeout=="function"?setTimeout:void 0,bT=typeof clearTimeout=="function"?clearTimeout:void 0,Af=typeof Promise=="function"?Promise:void 0,LT=typeof queueMicrotask=="function"?queueMicrotask:typeof Af<"u"?function(r){return Af.resolve(null).then(r).catch(kT)}:fc;function kT(r){setTimeout(function(){throw r})}function Ql(r,e){var t=e,s=0;do{var n=t.nextSibling;if(r.removeChild(t),n&&n.nodeType===8)if(t=n.data,t==="/$"){if(s===0){r.removeChild(n),Ci(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=n}while(t);Ci(e)}function Zr(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function Rf(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Vn=Math.random().toString(36).slice(2),gr="__reactFiber$"+Vn,Fi="__reactProps$"+Vn,Pr="__reactContainer$"+Vn,gc="__reactEvents$"+Vn,CT="__reactListeners$"+Vn,PT="__reactHandles$"+Vn;function As(r){var e=r[gr];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Pr]||t[gr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=Rf(r);r!==null;){if(t=r[gr])return t;r=Rf(r)}return e}r=t,t=r.parentNode}return null}function io(r){return r=r[gr]||r[Pr],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function hn(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(U(33))}function cl(r){return r[Fi]||null}var pc=[],fn=-1;function cs(r){return{current:r}}function Se(r){0>fn||(r.current=pc[fn],pc[fn]=null,fn--)}function ve(r,e){fn++,pc[fn]=r.current,r.current=e}var os={},ot=cs(os),mt=cs(!1),Os=os;function Dn(r,e){var t=r.type.contextTypes;if(!t)return os;var s=r.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var n={},i;for(i in t)n[i]=e[i];return s&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=n),n}function yt(r){return r=r.childContextTypes,r!=null}function La(){Se(mt),Se(ot)}function If(r,e,t){if(ot.current!==os)throw Error(U(168));ve(ot,e),ve(mt,t)}function m0(r,e,t){var s=r.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var n in s)if(!(n in e))throw Error(U(108,mS(r)||"Unknown",n));return Ie({},t,s)}function ka(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||os,Os=ot.current,ve(ot,r),ve(mt,mt.current),!0}function bf(r,e,t){var s=r.stateNode;if(!s)throw Error(U(169));t?(r=m0(r,e,Os),s.__reactInternalMemoizedMergedChildContext=r,Se(mt),Se(ot),ve(ot,r)):Se(mt),ve(mt,t)}var Ir=null,dl=!1,Xl=!1;function y0(r){Ir===null?Ir=[r]:Ir.push(r)}function DT(r){dl=!0,y0(r)}function ds(){if(!Xl&&Ir!==null){Xl=!0;var r=0,e=fe;try{var t=Ir;for(fe=1;r<t.length;r++){var s=t[r];do s=s(!0);while(s!==null)}Ir=null,dl=!1}catch(n){throw Ir!==null&&(Ir=Ir.slice(r+1)),Gm(Rd,ds),n}finally{fe=e,Xl=!1}}return null}var gn=[],pn=0,Ca=null,Pa=0,Mt=[],Ut=0,Ns=null,br=1,Lr="";function Es(r,e){gn[pn++]=Pa,gn[pn++]=Ca,Ca=r,Pa=e}function v0(r,e,t){Mt[Ut++]=br,Mt[Ut++]=Lr,Mt[Ut++]=Ns,Ns=r;var s=br;r=Lr;var n=32-rr(s)-1;s&=~(1<<n),t+=1;var i=32-rr(e)+n;if(30<i){var o=n-n%5;i=(s&(1<<o)-1).toString(32),s>>=o,n-=o,br=1<<32-rr(e)+n|t<<n|s,Lr=i+r}else br=1<<i|t<<n|s,Lr=r}function Nd(r){r.return!==null&&(Es(r,1),v0(r,1,0))}function Fd(r){for(;r===Ca;)Ca=gn[--pn],gn[pn]=null,Pa=gn[--pn],gn[pn]=null;for(;r===Ns;)Ns=Mt[--Ut],Mt[Ut]=null,Lr=Mt[--Ut],Mt[Ut]=null,br=Mt[--Ut],Mt[Ut]=null}var kt=null,Lt=null,Te=!1,er=null;function E0(r,e){var t=$t(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function Lf(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,kt=r,Lt=Zr(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,kt=r,Lt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ns!==null?{id:br,overflow:Lr}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=$t(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,kt=r,Lt=null,!0):!1;default:return!1}}function mc(r){return(r.mode&1)!==0&&(r.flags&128)===0}function yc(r){if(Te){var e=Lt;if(e){var t=e;if(!Lf(r,e)){if(mc(r))throw Error(U(418));e=Zr(t.nextSibling);var s=kt;e&&Lf(r,e)?E0(s,t):(r.flags=r.flags&-4097|2,Te=!1,kt=r)}}else{if(mc(r))throw Error(U(418));r.flags=r.flags&-4097|2,Te=!1,kt=r}}}function kf(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;kt=r}function Ao(r){if(r!==kt)return!1;if(!Te)return kf(r),Te=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!hc(r.type,r.memoizedProps)),e&&(e=Lt)){if(mc(r))throw S0(),Error(U(418));for(;e;)E0(r,e),e=Zr(e.nextSibling)}if(kf(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(U(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Lt=Zr(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Lt=null}}else Lt=kt?Zr(r.stateNode.nextSibling):null;return!0}function S0(){for(var r=Lt;r;)r=Zr(r.nextSibling)}function On(){Lt=kt=null,Te=!1}function Md(r){er===null?er=[r]:er.push(r)}var OT=Nr.ReactCurrentBatchConfig;function ti(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(U(309));var s=t.stateNode}if(!s)throw Error(U(147,r));var n=s,i=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=n.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof r!="string")throw Error(U(284));if(!t._owner)throw Error(U(290,r))}return r}function Ro(r,e){throw r=Object.prototype.toString.call(e),Error(U(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function Cf(r){var e=r._init;return e(r._payload)}function T0(r){function e(y,v){if(r){var E=y.deletions;E===null?(y.deletions=[v],y.flags|=16):E.push(v)}}function t(y,v){if(!r)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function s(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function n(y,v){return y=ss(y,v),y.index=0,y.sibling=null,y}function i(y,v,E){return y.index=E,r?(E=y.alternate,E!==null?(E=E.index,E<v?(y.flags|=2,v):E):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return r&&y.alternate===null&&(y.flags|=2),y}function a(y,v,E,T){return v===null||v.tag!==6?(v=nu(E,y.mode,T),v.return=y,v):(v=n(v,E),v.return=y,v)}function l(y,v,E,T){var _=E.type;return _===ln?c(y,v,E.props.children,T,E.key):v!==null&&(v.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Br&&Cf(_)===v.type)?(T=n(v,E.props),T.ref=ti(y,v,E),T.return=y,T):(T=la(E.type,E.key,E.props,null,y.mode,T),T.ref=ti(y,v,E),T.return=y,T)}function u(y,v,E,T){return v===null||v.tag!==4||v.stateNode.containerInfo!==E.containerInfo||v.stateNode.implementation!==E.implementation?(v=iu(E,y.mode,T),v.return=y,v):(v=n(v,E.children||[]),v.return=y,v)}function c(y,v,E,T,_){return v===null||v.tag!==7?(v=Cs(E,y.mode,T,_),v.return=y,v):(v=n(v,E),v.return=y,v)}function d(y,v,E){if(typeof v=="string"&&v!==""||typeof v=="number")return v=nu(""+v,y.mode,E),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case po:return E=la(v.type,v.key,v.props,null,y.mode,E),E.ref=ti(y,null,v),E.return=y,E;case an:return v=iu(v,y.mode,E),v.return=y,v;case Br:var T=v._init;return d(y,T(v._payload),E)}if(ai(v)||Qn(v))return v=Cs(v,y.mode,E,null),v.return=y,v;Ro(y,v)}return null}function h(y,v,E,T){var _=v!==null?v.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return _!==null?null:a(y,v,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case po:return E.key===_?l(y,v,E,T):null;case an:return E.key===_?u(y,v,E,T):null;case Br:return _=E._init,h(y,v,_(E._payload),T)}if(ai(E)||Qn(E))return _!==null?null:c(y,v,E,T,null);Ro(y,E)}return null}function g(y,v,E,T,_){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(E)||null,a(v,y,""+T,_);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case po:return y=y.get(T.key===null?E:T.key)||null,l(v,y,T,_);case an:return y=y.get(T.key===null?E:T.key)||null,u(v,y,T,_);case Br:var x=T._init;return g(y,v,E,x(T._payload),_)}if(ai(T)||Qn(T))return y=y.get(E)||null,c(v,y,T,_,null);Ro(v,T)}return null}function f(y,v,E,T){for(var _=null,x=null,w=v,A=v=0,I=null;w!==null&&A<E.length;A++){w.index>A?(I=w,w=null):I=w.sibling;var R=h(y,w,E[A],T);if(R===null){w===null&&(w=I);break}r&&w&&R.alternate===null&&e(y,w),v=i(R,v,A),x===null?_=R:x.sibling=R,x=R,w=I}if(A===E.length)return t(y,w),Te&&Es(y,A),_;if(w===null){for(;A<E.length;A++)w=d(y,E[A],T),w!==null&&(v=i(w,v,A),x===null?_=w:x.sibling=w,x=w);return Te&&Es(y,A),_}for(w=s(y,w);A<E.length;A++)I=g(w,y,A,E[A],T),I!==null&&(r&&I.alternate!==null&&w.delete(I.key===null?A:I.key),v=i(I,v,A),x===null?_=I:x.sibling=I,x=I);return r&&w.forEach(function(P){return e(y,P)}),Te&&Es(y,A),_}function p(y,v,E,T){var _=Qn(E);if(typeof _!="function")throw Error(U(150));if(E=_.call(E),E==null)throw Error(U(151));for(var x=_=null,w=v,A=v=0,I=null,R=E.next();w!==null&&!R.done;A++,R=E.next()){w.index>A?(I=w,w=null):I=w.sibling;var P=h(y,w,R.value,T);if(P===null){w===null&&(w=I);break}r&&w&&P.alternate===null&&e(y,w),v=i(P,v,A),x===null?_=P:x.sibling=P,x=P,w=I}if(R.done)return t(y,w),Te&&Es(y,A),_;if(w===null){for(;!R.done;A++,R=E.next())R=d(y,R.value,T),R!==null&&(v=i(R,v,A),x===null?_=R:x.sibling=R,x=R);return Te&&Es(y,A),_}for(w=s(y,w);!R.done;A++,R=E.next())R=g(w,y,A,R.value,T),R!==null&&(r&&R.alternate!==null&&w.delete(R.key===null?A:R.key),v=i(R,v,A),x===null?_=R:x.sibling=R,x=R);return r&&w.forEach(function($){return e(y,$)}),Te&&Es(y,A),_}function m(y,v,E,T){if(typeof E=="object"&&E!==null&&E.type===ln&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case po:e:{for(var _=E.key,x=v;x!==null;){if(x.key===_){if(_=E.type,_===ln){if(x.tag===7){t(y,x.sibling),v=n(x,E.props.children),v.return=y,y=v;break e}}else if(x.elementType===_||typeof _=="object"&&_!==null&&_.$$typeof===Br&&Cf(_)===x.type){t(y,x.sibling),v=n(x,E.props),v.ref=ti(y,x,E),v.return=y,y=v;break e}t(y,x);break}else e(y,x);x=x.sibling}E.type===ln?(v=Cs(E.props.children,y.mode,T,E.key),v.return=y,y=v):(T=la(E.type,E.key,E.props,null,y.mode,T),T.ref=ti(y,v,E),T.return=y,y=T)}return o(y);case an:e:{for(x=E.key;v!==null;){if(v.key===x)if(v.tag===4&&v.stateNode.containerInfo===E.containerInfo&&v.stateNode.implementation===E.implementation){t(y,v.sibling),v=n(v,E.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=iu(E,y.mode,T),v.return=y,y=v}return o(y);case Br:return x=E._init,m(y,v,x(E._payload),T)}if(ai(E))return f(y,v,E,T);if(Qn(E))return p(y,v,E,T);Ro(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,v!==null&&v.tag===6?(t(y,v.sibling),v=n(v,E),v.return=y,y=v):(t(y,v),v=nu(E,y.mode,T),v.return=y,y=v),o(y)):t(y,v)}return m}var Nn=T0(!0),_0=T0(!1),Da=cs(null),Oa=null,mn=null,Ud=null;function $d(){Ud=mn=Oa=null}function Bd(r){var e=Da.current;Se(Da),r._currentValue=e}function vc(r,e,t){for(;r!==null;){var s=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),r===t)break;r=r.return}}function An(r,e){Oa=r,Ud=mn=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(gt=!0),r.firstContext=null)}function jt(r){var e=r._currentValue;if(Ud!==r)if(r={context:r,memoizedValue:e,next:null},mn===null){if(Oa===null)throw Error(U(308));mn=r,Oa.dependencies={lanes:0,firstContext:r}}else mn=mn.next=r;return e}var Rs=null;function jd(r){Rs===null?Rs=[r]:Rs.push(r)}function w0(r,e,t,s){var n=e.interleaved;return n===null?(t.next=t,jd(e)):(t.next=n.next,n.next=t),e.interleaved=t,Dr(r,s)}function Dr(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var jr=!1;function Gd(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function x0(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function kr(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function es(r,e,t){var s=r.updateQueue;if(s===null)return null;if(s=s.shared,ue&2){var n=s.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),s.pending=e,Dr(r,t)}return n=s.interleaved,n===null?(e.next=e,jd(s)):(e.next=n.next,n.next=e),s.interleaved=e,Dr(r,t)}function ra(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=r.pendingLanes,t|=s,e.lanes=t,Id(r,t)}}function Pf(r,e){var t=r.updateQueue,s=r.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var n=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?n=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?n=i=e:i=i.next=e}else n=i=e;t={baseState:s.baseState,firstBaseUpdate:n,lastBaseUpdate:i,shared:s.shared,effects:s.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function Na(r,e,t,s){var n=r.updateQueue;jr=!1;var i=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var c=r.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=n.baseState;o=0,c=u=l=null,a=i;do{var h=a.lane,g=a.eventTime;if((s&h)===h){c!==null&&(c=c.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=r,p=a;switch(h=e,g=t,p.tag){case 1:if(f=p.payload,typeof f=="function"){d=f.call(g,d,h);break e}d=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=p.payload,h=typeof f=="function"?f.call(g,d,h):f,h==null)break e;d=Ie({},d,h);break e;case 2:jr=!0}}a.callback!==null&&a.lane!==0&&(r.flags|=64,h=n.effects,h===null?n.effects=[a]:h.push(a))}else g={eventTime:g,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=g,l=d):c=c.next=g,o|=h;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;h=a,a=h.next,h.next=null,n.lastBaseUpdate=h,n.shared.pending=null}}while(!0);if(c===null&&(l=d),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=c,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else i===null&&(n.shared.lanes=0);Ms|=o,r.lanes=o,r.memoizedState=d}}function Df(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var s=r[e],n=s.callback;if(n!==null){if(s.callback=null,s=t,typeof n!="function")throw Error(U(191,n));n.call(s)}}}var oo={},vr=cs(oo),Mi=cs(oo),Ui=cs(oo);function Is(r){if(r===oo)throw Error(U(174));return r}function Kd(r,e){switch(ve(Ui,e),ve(Mi,r),ve(vr,oo),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ju(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=Ju(e,r)}Se(vr),ve(vr,e)}function Fn(){Se(vr),Se(Mi),Se(Ui)}function A0(r){Is(Ui.current);var e=Is(vr.current),t=Ju(e,r.type);e!==t&&(ve(Mi,r),ve(vr,t))}function Vd(r){Mi.current===r&&(Se(vr),Se(Mi))}var xe=cs(0);function Fa(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Jl=[];function Hd(){for(var r=0;r<Jl.length;r++)Jl[r]._workInProgressVersionPrimary=null;Jl.length=0}var sa=Nr.ReactCurrentDispatcher,Zl=Nr.ReactCurrentBatchConfig,Fs=0,Re=null,Be=null,Ve=null,Ma=!1,yi=!1,$i=0,NT=0;function rt(){throw Error(U(321))}function Wd(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!nr(r[t],e[t]))return!1;return!0}function zd(r,e,t,s,n,i){if(Fs=i,Re=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sa.current=r===null||r.memoizedState===null?$T:BT,r=t(s,n),yi){i=0;do{if(yi=!1,$i=0,25<=i)throw Error(U(301));i+=1,Ve=Be=null,e.updateQueue=null,sa.current=jT,r=t(s,n)}while(yi)}if(sa.current=Ua,e=Be!==null&&Be.next!==null,Fs=0,Ve=Be=Re=null,Ma=!1,e)throw Error(U(300));return r}function qd(){var r=$i!==0;return $i=0,r}function dr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ve===null?Re.memoizedState=Ve=r:Ve=Ve.next=r,Ve}function Gt(){if(Be===null){var r=Re.alternate;r=r!==null?r.memoizedState:null}else r=Be.next;var e=Ve===null?Re.memoizedState:Ve.next;if(e!==null)Ve=e,Be=r;else{if(r===null)throw Error(U(310));Be=r,r={memoizedState:Be.memoizedState,baseState:Be.baseState,baseQueue:Be.baseQueue,queue:Be.queue,next:null},Ve===null?Re.memoizedState=Ve=r:Ve=Ve.next=r}return Ve}function Bi(r,e){return typeof e=="function"?e(r):e}function eu(r){var e=Gt(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=r;var s=Be,n=s.baseQueue,i=t.pending;if(i!==null){if(n!==null){var o=n.next;n.next=i.next,i.next=o}s.baseQueue=n=i,t.pending=null}if(n!==null){i=n.next,s=s.baseState;var a=o=null,l=null,u=i;do{var c=u.lane;if((Fs&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:r(s,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=s):l=l.next=d,Re.lanes|=c,Ms|=c}u=u.next}while(u!==null&&u!==i);l===null?o=s:l.next=a,nr(s,e.memoizedState)||(gt=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,t.lastRenderedState=s}if(r=t.interleaved,r!==null){n=r;do i=n.lane,Re.lanes|=i,Ms|=i,n=n.next;while(n!==r)}else n===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function tu(r){var e=Gt(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=r;var s=t.dispatch,n=t.pending,i=e.memoizedState;if(n!==null){t.pending=null;var o=n=n.next;do i=r(i,o.action),o=o.next;while(o!==n);nr(i,e.memoizedState)||(gt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,s]}function R0(){}function I0(r,e){var t=Re,s=Gt(),n=e(),i=!nr(s.memoizedState,n);if(i&&(s.memoizedState=n,gt=!0),s=s.queue,Yd(k0.bind(null,t,s,r),[r]),s.getSnapshot!==e||i||Ve!==null&&Ve.memoizedState.tag&1){if(t.flags|=2048,ji(9,L0.bind(null,t,s,n,e),void 0,null),He===null)throw Error(U(349));Fs&30||b0(t,e,n)}return n}function b0(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Re.updateQueue,e===null?(e={lastEffect:null,stores:null},Re.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function L0(r,e,t,s){e.value=t,e.getSnapshot=s,C0(e)&&P0(r)}function k0(r,e,t){return t(function(){C0(e)&&P0(r)})}function C0(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!nr(r,t)}catch{return!0}}function P0(r){var e=Dr(r,1);e!==null&&sr(e,r,1,-1)}function Of(r){var e=dr();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bi,lastRenderedState:r},e.queue=r,r=r.dispatch=UT.bind(null,Re,r),[e.memoizedState,r]}function ji(r,e,t,s){return r={tag:r,create:e,destroy:t,deps:s,next:null},e=Re.updateQueue,e===null?(e={lastEffect:null,stores:null},Re.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(s=t.next,t.next=r,r.next=s,e.lastEffect=r)),r}function D0(){return Gt().memoizedState}function na(r,e,t,s){var n=dr();Re.flags|=r,n.memoizedState=ji(1|e,t,void 0,s===void 0?null:s)}function hl(r,e,t,s){var n=Gt();s=s===void 0?null:s;var i=void 0;if(Be!==null){var o=Be.memoizedState;if(i=o.destroy,s!==null&&Wd(s,o.deps)){n.memoizedState=ji(e,t,i,s);return}}Re.flags|=r,n.memoizedState=ji(1|e,t,i,s)}function Nf(r,e){return na(8390656,8,r,e)}function Yd(r,e){return hl(2048,8,r,e)}function O0(r,e){return hl(4,2,r,e)}function N0(r,e){return hl(4,4,r,e)}function F0(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function M0(r,e,t){return t=t!=null?t.concat([r]):null,hl(4,4,F0.bind(null,e,r),t)}function Qd(){}function U0(r,e){var t=Gt();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Wd(e,s[1])?s[0]:(t.memoizedState=[r,e],r)}function $0(r,e){var t=Gt();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Wd(e,s[1])?s[0]:(r=r(),t.memoizedState=[r,e],r)}function B0(r,e,t){return Fs&21?(nr(t,e)||(t=Hm(),Re.lanes|=t,Ms|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,gt=!0),r.memoizedState=t)}function FT(r,e){var t=fe;fe=t!==0&&4>t?t:4,r(!0);var s=Zl.transition;Zl.transition={};try{r(!1),e()}finally{fe=t,Zl.transition=s}}function j0(){return Gt().memoizedState}function MT(r,e,t){var s=rs(r);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},G0(r))K0(e,t);else if(t=w0(r,e,t,s),t!==null){var n=ut();sr(t,r,s,n),V0(t,e,s)}}function UT(r,e,t){var s=rs(r),n={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(G0(r))K0(e,n);else{var i=r.alternate;if(r.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(n.hasEagerState=!0,n.eagerState=a,nr(a,o)){var l=e.interleaved;l===null?(n.next=n,jd(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}t=w0(r,e,n,s),t!==null&&(n=ut(),sr(t,r,s,n),V0(t,e,s))}}function G0(r){var e=r.alternate;return r===Re||e!==null&&e===Re}function K0(r,e){yi=Ma=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function V0(r,e,t){if(t&4194240){var s=e.lanes;s&=r.pendingLanes,t|=s,e.lanes=t,Id(r,t)}}var Ua={readContext:jt,useCallback:rt,useContext:rt,useEffect:rt,useImperativeHandle:rt,useInsertionEffect:rt,useLayoutEffect:rt,useMemo:rt,useReducer:rt,useRef:rt,useState:rt,useDebugValue:rt,useDeferredValue:rt,useTransition:rt,useMutableSource:rt,useSyncExternalStore:rt,useId:rt,unstable_isNewReconciler:!1},$T={readContext:jt,useCallback:function(r,e){return dr().memoizedState=[r,e===void 0?null:e],r},useContext:jt,useEffect:Nf,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,na(4194308,4,F0.bind(null,e,r),t)},useLayoutEffect:function(r,e){return na(4194308,4,r,e)},useInsertionEffect:function(r,e){return na(4,2,r,e)},useMemo:function(r,e){var t=dr();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var s=dr();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},s.queue=r,r=r.dispatch=MT.bind(null,Re,r),[s.memoizedState,r]},useRef:function(r){var e=dr();return r={current:r},e.memoizedState=r},useState:Of,useDebugValue:Qd,useDeferredValue:function(r){return dr().memoizedState=r},useTransition:function(){var r=Of(!1),e=r[0];return r=FT.bind(null,r[1]),dr().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var s=Re,n=dr();if(Te){if(t===void 0)throw Error(U(407));t=t()}else{if(t=e(),He===null)throw Error(U(349));Fs&30||b0(s,e,t)}n.memoizedState=t;var i={value:t,getSnapshot:e};return n.queue=i,Nf(k0.bind(null,s,i,r),[r]),s.flags|=2048,ji(9,L0.bind(null,s,i,t,e),void 0,null),t},useId:function(){var r=dr(),e=He.identifierPrefix;if(Te){var t=Lr,s=br;t=(s&~(1<<32-rr(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=$i++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=NT++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},BT={readContext:jt,useCallback:U0,useContext:jt,useEffect:Yd,useImperativeHandle:M0,useInsertionEffect:O0,useLayoutEffect:N0,useMemo:$0,useReducer:eu,useRef:D0,useState:function(){return eu(Bi)},useDebugValue:Qd,useDeferredValue:function(r){var e=Gt();return B0(e,Be.memoizedState,r)},useTransition:function(){var r=eu(Bi)[0],e=Gt().memoizedState;return[r,e]},useMutableSource:R0,useSyncExternalStore:I0,useId:j0,unstable_isNewReconciler:!1},jT={readContext:jt,useCallback:U0,useContext:jt,useEffect:Yd,useImperativeHandle:M0,useInsertionEffect:O0,useLayoutEffect:N0,useMemo:$0,useReducer:tu,useRef:D0,useState:function(){return tu(Bi)},useDebugValue:Qd,useDeferredValue:function(r){var e=Gt();return Be===null?e.memoizedState=r:B0(e,Be.memoizedState,r)},useTransition:function(){var r=tu(Bi)[0],e=Gt().memoizedState;return[r,e]},useMutableSource:R0,useSyncExternalStore:I0,useId:j0,unstable_isNewReconciler:!1};function Qt(r,e){if(r&&r.defaultProps){e=Ie({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function Ec(r,e,t,s){e=r.memoizedState,t=t(s,e),t=t==null?e:Ie({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var fl={isMounted:function(r){return(r=r._reactInternals)?Gs(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var s=ut(),n=rs(r),i=kr(s,n);i.payload=e,t!=null&&(i.callback=t),e=es(r,i,n),e!==null&&(sr(e,r,n,s),ra(e,r,n))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var s=ut(),n=rs(r),i=kr(s,n);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=es(r,i,n),e!==null&&(sr(e,r,n,s),ra(e,r,n))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=ut(),s=rs(r),n=kr(t,s);n.tag=2,e!=null&&(n.callback=e),e=es(r,n,s),e!==null&&(sr(e,r,s,t),ra(e,r,s))}};function Ff(r,e,t,s,n,i,o){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Di(t,s)||!Di(n,i):!0}function H0(r,e,t){var s=!1,n=os,i=e.contextType;return typeof i=="object"&&i!==null?i=jt(i):(n=yt(e)?Os:ot.current,s=e.contextTypes,i=(s=s!=null)?Dn(r,n):os),e=new e(t,i),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fl,r.stateNode=e,e._reactInternals=r,s&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=n,r.__reactInternalMemoizedMaskedChildContext=i),e}function Mf(r,e,t,s){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==r&&fl.enqueueReplaceState(e,e.state,null)}function Sc(r,e,t,s){var n=r.stateNode;n.props=t,n.state=r.memoizedState,n.refs={},Gd(r);var i=e.contextType;typeof i=="object"&&i!==null?n.context=jt(i):(i=yt(e)?Os:ot.current,n.context=Dn(r,i)),n.state=r.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ec(r,e,i,t),n.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&fl.enqueueReplaceState(n,n.state,null),Na(r,t,n,s),n.state=r.memoizedState),typeof n.componentDidMount=="function"&&(r.flags|=4194308)}function Mn(r,e){try{var t="",s=e;do t+=pS(s),s=s.return;while(s);var n=t}catch(i){n=`
Error generating stack: `+i.message+`
`+i.stack}return{value:r,source:e,stack:n,digest:null}}function ru(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function Tc(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var GT=typeof WeakMap=="function"?WeakMap:Map;function W0(r,e,t){t=kr(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){Ba||(Ba=!0,Cc=s),Tc(r,e)},t}function z0(r,e,t){t=kr(-1,t),t.tag=3;var s=r.type.getDerivedStateFromError;if(typeof s=="function"){var n=e.value;t.payload=function(){return s(n)},t.callback=function(){Tc(r,e)}}var i=r.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){Tc(r,e),typeof s!="function"&&(ts===null?ts=new Set([this]):ts.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Uf(r,e,t){var s=r.pingCache;if(s===null){s=r.pingCache=new GT;var n=new Set;s.set(e,n)}else n=s.get(e),n===void 0&&(n=new Set,s.set(e,n));n.has(t)||(n.add(t),r=r_.bind(null,r,e,t),e.then(r,r))}function $f(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function Bf(r,e,t,s,n){return r.mode&1?(r.flags|=65536,r.lanes=n,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=kr(-1,1),e.tag=2,es(t,e,1))),t.lanes|=1),r)}var KT=Nr.ReactCurrentOwner,gt=!1;function at(r,e,t,s){e.child=r===null?_0(e,null,t,s):Nn(e,r.child,t,s)}function jf(r,e,t,s,n){t=t.render;var i=e.ref;return An(e,n),s=zd(r,e,t,s,i,n),t=qd(),r!==null&&!gt?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~n,Or(r,e,n)):(Te&&t&&Nd(e),e.flags|=1,at(r,e,s,n),e.child)}function Gf(r,e,t,s,n){if(r===null){var i=t.type;return typeof i=="function"&&!nh(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,q0(r,e,i,s,n)):(r=la(t.type,null,s,e,e.mode,n),r.ref=e.ref,r.return=e,e.child=r)}if(i=r.child,!(r.lanes&n)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Di,t(o,s)&&r.ref===e.ref)return Or(r,e,n)}return e.flags|=1,r=ss(i,s),r.ref=e.ref,r.return=e,e.child=r}function q0(r,e,t,s,n){if(r!==null){var i=r.memoizedProps;if(Di(i,s)&&r.ref===e.ref)if(gt=!1,e.pendingProps=s=i,(r.lanes&n)!==0)r.flags&131072&&(gt=!0);else return e.lanes=r.lanes,Or(r,e,n)}return _c(r,e,t,s,n)}function Y0(r,e,t){var s=e.pendingProps,n=s.children,i=r!==null?r.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ve(vn,At),At|=t;else{if(!(t&1073741824))return r=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,ve(vn,At),At|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:t,ve(vn,At),At|=s}else i!==null?(s=i.baseLanes|t,e.memoizedState=null):s=t,ve(vn,At),At|=s;return at(r,e,n,t),e.child}function Q0(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function _c(r,e,t,s,n){var i=yt(t)?Os:ot.current;return i=Dn(e,i),An(e,n),t=zd(r,e,t,s,i,n),s=qd(),r!==null&&!gt?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~n,Or(r,e,n)):(Te&&s&&Nd(e),e.flags|=1,at(r,e,t,n),e.child)}function Kf(r,e,t,s,n){if(yt(t)){var i=!0;ka(e)}else i=!1;if(An(e,n),e.stateNode===null)ia(r,e),H0(e,t,s),Sc(e,t,s,n),s=!0;else if(r===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=jt(u):(u=yt(t)?Os:ot.current,u=Dn(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==u)&&Mf(e,o,s,u),jr=!1;var h=e.memoizedState;o.state=h,Na(e,s,o,n),l=e.memoizedState,a!==s||h!==l||mt.current||jr?(typeof c=="function"&&(Ec(e,t,c,s),l=e.memoizedState),(a=jr||Ff(e,t,a,s,h,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=u,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,x0(r,e),a=e.memoizedProps,u=e.type===e.elementType?a:Qt(e.type,a),o.props=u,d=e.pendingProps,h=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=jt(l):(l=yt(t)?Os:ot.current,l=Dn(e,l));var g=t.getDerivedStateFromProps;(c=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Mf(e,o,s,l),jr=!1,h=e.memoizedState,o.state=h,Na(e,s,o,n);var f=e.memoizedState;a!==d||h!==f||mt.current||jr?(typeof g=="function"&&(Ec(e,t,g,s),f=e.memoizedState),(u=jr||Ff(e,t,u,s,h,f,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,f,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,f,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=f),o.props=s,o.state=f,o.context=l,s=u):(typeof o.componentDidUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&h===r.memoizedState||(e.flags|=1024),s=!1)}return wc(r,e,t,s,i,n)}function wc(r,e,t,s,n,i){Q0(r,e);var o=(e.flags&128)!==0;if(!s&&!o)return n&&bf(e,t,!1),Or(r,e,i);s=e.stateNode,KT.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,r!==null&&o?(e.child=Nn(e,r.child,null,i),e.child=Nn(e,null,a,i)):at(r,e,a,i),e.memoizedState=s.state,n&&bf(e,t,!0),e.child}function X0(r){var e=r.stateNode;e.pendingContext?If(r,e.pendingContext,e.pendingContext!==e.context):e.context&&If(r,e.context,!1),Kd(r,e.containerInfo)}function Vf(r,e,t,s,n){return On(),Md(n),e.flags|=256,at(r,e,t,s),e.child}var xc={dehydrated:null,treeContext:null,retryLane:0};function Ac(r){return{baseLanes:r,cachePool:null,transitions:null}}function J0(r,e,t){var s=e.pendingProps,n=xe.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=r!==null&&r.memoizedState===null?!1:(n&2)!==0),a?(i=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(n|=1),ve(xe,n&1),r===null)return yc(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,r=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=ml(o,s,0,null),r=Cs(r,s,t,null),i.return=e,r.return=e,i.sibling=r,e.child=i,e.child.memoizedState=Ac(t),e.memoizedState=xc,r):Xd(e,o));if(n=r.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return VT(r,e,o,s,a,n,t);if(i){i=s.fallback,o=e.mode,n=r.child,a=n.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==n?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=ss(n,l),s.subtreeFlags=n.subtreeFlags&14680064),a!==null?i=ss(a,i):(i=Cs(i,o,t,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=r.child.memoizedState,o=o===null?Ac(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=r.childLanes&~t,e.memoizedState=xc,s}return i=r.child,r=i.sibling,s=ss(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=s,e.memoizedState=null,s}function Xd(r,e){return e=ml({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function Io(r,e,t,s){return s!==null&&Md(s),Nn(e,r.child,null,t),r=Xd(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function VT(r,e,t,s,n,i,o){if(t)return e.flags&256?(e.flags&=-257,s=ru(Error(U(422))),Io(r,e,o,s)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(i=s.fallback,n=e.mode,s=ml({mode:"visible",children:s.children},n,0,null),i=Cs(i,n,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&Nn(e,r.child,null,o),e.child.memoizedState=Ac(o),e.memoizedState=xc,i);if(!(e.mode&1))return Io(r,e,o,null);if(n.data==="$!"){if(s=n.nextSibling&&n.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(U(419)),s=ru(i,s,void 0),Io(r,e,o,s)}if(a=(o&r.childLanes)!==0,gt||a){if(s=He,s!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(s.suspendedLanes|o)?0:n,n!==0&&n!==i.retryLane&&(i.retryLane=n,Dr(r,n),sr(s,r,n,-1))}return sh(),s=ru(Error(U(421))),Io(r,e,o,s)}return n.data==="$?"?(e.flags|=128,e.child=r.child,e=s_.bind(null,r),n._reactRetry=e,null):(r=i.treeContext,Lt=Zr(n.nextSibling),kt=e,Te=!0,er=null,r!==null&&(Mt[Ut++]=br,Mt[Ut++]=Lr,Mt[Ut++]=Ns,br=r.id,Lr=r.overflow,Ns=e),e=Xd(e,s.children),e.flags|=4096,e)}function Hf(r,e,t){r.lanes|=e;var s=r.alternate;s!==null&&(s.lanes|=e),vc(r.return,e,t)}function su(r,e,t,s,n){var i=r.memoizedState;i===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:n}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=t,i.tailMode=n)}function Z0(r,e,t){var s=e.pendingProps,n=s.revealOrder,i=s.tail;if(at(r,e,s.children,t),s=xe.current,s&2)s=s&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Hf(r,t,e);else if(r.tag===19)Hf(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}s&=1}if(ve(xe,s),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(t=e.child,n=null;t!==null;)r=t.alternate,r!==null&&Fa(r)===null&&(n=t),t=t.sibling;t=n,t===null?(n=e.child,e.child=null):(n=t.sibling,t.sibling=null),su(e,!1,n,t,i);break;case"backwards":for(t=null,n=e.child,e.child=null;n!==null;){if(r=n.alternate,r!==null&&Fa(r)===null){e.child=n;break}r=n.sibling,n.sibling=t,t=n,n=r}su(e,!0,t,null,i);break;case"together":su(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ia(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function Or(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),Ms|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(U(153));if(e.child!==null){for(r=e.child,t=ss(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=ss(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function HT(r,e,t){switch(e.tag){case 3:X0(e),On();break;case 5:A0(e);break;case 1:yt(e.type)&&ka(e);break;case 4:Kd(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,n=e.memoizedProps.value;ve(Da,s._currentValue),s._currentValue=n;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(ve(xe,xe.current&1),e.flags|=128,null):t&e.child.childLanes?J0(r,e,t):(ve(xe,xe.current&1),r=Or(r,e,t),r!==null?r.sibling:null);ve(xe,xe.current&1);break;case 19:if(s=(t&e.childLanes)!==0,r.flags&128){if(s)return Z0(r,e,t);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),ve(xe,xe.current),s)break;return null;case 22:case 23:return e.lanes=0,Y0(r,e,t)}return Or(r,e,t)}var ey,Rc,ty,ry;ey=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Rc=function(){};ty=function(r,e,t,s){var n=r.memoizedProps;if(n!==s){r=e.stateNode,Is(vr.current);var i=null;switch(t){case"input":n=qu(r,n),s=qu(r,s),i=[];break;case"select":n=Ie({},n,{value:void 0}),s=Ie({},s,{value:void 0}),i=[];break;case"textarea":n=Xu(r,n),s=Xu(r,s),i=[];break;default:typeof n.onClick!="function"&&typeof s.onClick=="function"&&(r.onclick=ba)}Zu(t,s);var o;t=null;for(u in n)if(!s.hasOwnProperty(u)&&n.hasOwnProperty(u)&&n[u]!=null)if(u==="style"){var a=n[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ri.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in s){var l=s[u];if(a=n!=null?n[u]:void 0,s.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ri.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ee("scroll",r),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};ry=function(r,e,t,s){t!==s&&(e.flags|=4)};function ri(r,e){if(!Te)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:s.sibling=null}}function st(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,s=0;if(e)for(var n=r.child;n!==null;)t|=n.lanes|n.childLanes,s|=n.subtreeFlags&14680064,s|=n.flags&14680064,n.return=r,n=n.sibling;else for(n=r.child;n!==null;)t|=n.lanes|n.childLanes,s|=n.subtreeFlags,s|=n.flags,n.return=r,n=n.sibling;return r.subtreeFlags|=s,r.childLanes=t,e}function WT(r,e,t){var s=e.pendingProps;switch(Fd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return st(e),null;case 1:return yt(e.type)&&La(),st(e),null;case 3:return s=e.stateNode,Fn(),Se(mt),Se(ot),Hd(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(r===null||r.child===null)&&(Ao(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,er!==null&&(Oc(er),er=null))),Rc(r,e),st(e),null;case 5:Vd(e);var n=Is(Ui.current);if(t=e.type,r!==null&&e.stateNode!=null)ty(r,e,t,s,n),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(U(166));return st(e),null}if(r=Is(vr.current),Ao(e)){s=e.stateNode,t=e.type;var i=e.memoizedProps;switch(s[gr]=e,s[Fi]=i,r=(e.mode&1)!==0,t){case"dialog":Ee("cancel",s),Ee("close",s);break;case"iframe":case"object":case"embed":Ee("load",s);break;case"video":case"audio":for(n=0;n<ui.length;n++)Ee(ui[n],s);break;case"source":Ee("error",s);break;case"img":case"image":case"link":Ee("error",s),Ee("load",s);break;case"details":Ee("toggle",s);break;case"input":Zh(s,i),Ee("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},Ee("invalid",s);break;case"textarea":tf(s,i),Ee("invalid",s)}Zu(t,i),n=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&xo(s.textContent,a,r),n=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&xo(s.textContent,a,r),n=["children",""+a]):Ri.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ee("scroll",s)}switch(t){case"input":mo(s),ef(s,i,!0);break;case"textarea":mo(s),rf(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=ba)}s=n,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=km(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=o.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof s.is=="string"?r=o.createElement(t,{is:s.is}):(r=o.createElement(t),t==="select"&&(o=r,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):r=o.createElementNS(r,t),r[gr]=e,r[Fi]=s,ey(r,e,!1,!1),e.stateNode=r;e:{switch(o=ec(t,s),t){case"dialog":Ee("cancel",r),Ee("close",r),n=s;break;case"iframe":case"object":case"embed":Ee("load",r),n=s;break;case"video":case"audio":for(n=0;n<ui.length;n++)Ee(ui[n],r);n=s;break;case"source":Ee("error",r),n=s;break;case"img":case"image":case"link":Ee("error",r),Ee("load",r),n=s;break;case"details":Ee("toggle",r),n=s;break;case"input":Zh(r,s),n=qu(r,s),Ee("invalid",r);break;case"option":n=s;break;case"select":r._wrapperState={wasMultiple:!!s.multiple},n=Ie({},s,{value:void 0}),Ee("invalid",r);break;case"textarea":tf(r,s),n=Xu(r,s),Ee("invalid",r);break;default:n=s}Zu(t,n),a=n;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Dm(r,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Cm(r,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ii(r,l):typeof l=="number"&&Ii(r,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ri.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ee("scroll",r):l!=null&&Td(r,i,l,o))}switch(t){case"input":mo(r),ef(r,s,!1);break;case"textarea":mo(r),rf(r);break;case"option":s.value!=null&&r.setAttribute("value",""+is(s.value));break;case"select":r.multiple=!!s.multiple,i=s.value,i!=null?Tn(r,!!s.multiple,i,!1):s.defaultValue!=null&&Tn(r,!!s.multiple,s.defaultValue,!0);break;default:typeof n.onClick=="function"&&(r.onclick=ba)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return st(e),null;case 6:if(r&&e.stateNode!=null)ry(r,e,r.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(U(166));if(t=Is(Ui.current),Is(vr.current),Ao(e)){if(s=e.stateNode,t=e.memoizedProps,s[gr]=e,(i=s.nodeValue!==t)&&(r=kt,r!==null))switch(r.tag){case 3:xo(s.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&xo(s.nodeValue,t,(r.mode&1)!==0)}i&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[gr]=e,e.stateNode=s}return st(e),null;case 13:if(Se(xe),s=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Te&&Lt!==null&&e.mode&1&&!(e.flags&128))S0(),On(),e.flags|=98560,i=!1;else if(i=Ao(e),s!==null&&s.dehydrated!==null){if(r===null){if(!i)throw Error(U(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));i[gr]=e}else On(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;st(e),i=!1}else er!==null&&(Oc(er),er=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(r!==null&&r.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(r===null||xe.current&1?Ge===0&&(Ge=3):sh())),e.updateQueue!==null&&(e.flags|=4),st(e),null);case 4:return Fn(),Rc(r,e),r===null&&Oi(e.stateNode.containerInfo),st(e),null;case 10:return Bd(e.type._context),st(e),null;case 17:return yt(e.type)&&La(),st(e),null;case 19:if(Se(xe),i=e.memoizedState,i===null)return st(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)ri(i,!1);else{if(Ge!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(o=Fa(r),o!==null){for(e.flags|=128,ri(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)i=t,r=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,r=o.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return ve(xe,xe.current&1|2),e.child}r=r.sibling}i.tail!==null&&De()>Un&&(e.flags|=128,s=!0,ri(i,!1),e.lanes=4194304)}else{if(!s)if(r=Fa(o),r!==null){if(e.flags|=128,s=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),ri(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Te)return st(e),null}else 2*De()-i.renderingStartTime>Un&&t!==1073741824&&(e.flags|=128,s=!0,ri(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=De(),e.sibling=null,t=xe.current,ve(xe,s?t&1|2:t&1),e):(st(e),null);case 22:case 23:return rh(),s=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?At&1073741824&&(st(e),e.subtreeFlags&6&&(e.flags|=8192)):st(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function zT(r,e){switch(Fd(e),e.tag){case 1:return yt(e.type)&&La(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return Fn(),Se(mt),Se(ot),Hd(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Vd(e),null;case 13:if(Se(xe),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(U(340));On()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Se(xe),null;case 4:return Fn(),null;case 10:return Bd(e.type._context),null;case 22:case 23:return rh(),null;case 24:return null;default:return null}}var bo=!1,nt=!1,qT=typeof WeakSet=="function"?WeakSet:Set,z=null;function yn(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){ke(r,e,s)}else t.current=null}function Ic(r,e,t){try{t()}catch(s){ke(r,e,s)}}var Wf=!1;function YT(r,e){if(cc=Aa,r=a0(),Od(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var n=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=r,h=null;t:for(;;){for(var g;d!==t||n!==0&&d.nodeType!==3||(a=o+n),d!==i||s!==0&&d.nodeType!==3||(l=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(g=d.firstChild)!==null;)h=d,d=g;for(;;){if(d===r)break t;if(h===t&&++u===n&&(a=o),h===i&&++c===s&&(l=o),(g=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=g}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(dc={focusedElem:r,selectionRange:t},Aa=!1,z=e;z!==null;)if(e=z,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,z=r;else for(;z!==null;){e=z;try{var f=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var p=f.memoizedProps,m=f.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?p:Qt(e.type,p),m);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(T){ke(e,e.return,T)}if(r=e.sibling,r!==null){r.return=e.return,z=r;break}z=e.return}return f=Wf,Wf=!1,f}function vi(r,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var n=s=s.next;do{if((n.tag&r)===r){var i=n.destroy;n.destroy=void 0,i!==void 0&&Ic(e,t,i)}n=n.next}while(n!==s)}}function gl(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function bc(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function sy(r){var e=r.alternate;e!==null&&(r.alternate=null,sy(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[gr],delete e[Fi],delete e[gc],delete e[CT],delete e[PT])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function ny(r){return r.tag===5||r.tag===3||r.tag===4}function zf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ny(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Lc(r,e,t){var s=r.tag;if(s===5||s===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ba));else if(s!==4&&(r=r.child,r!==null))for(Lc(r,e,t),r=r.sibling;r!==null;)Lc(r,e,t),r=r.sibling}function kc(r,e,t){var s=r.tag;if(s===5||s===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(s!==4&&(r=r.child,r!==null))for(kc(r,e,t),r=r.sibling;r!==null;)kc(r,e,t),r=r.sibling}var Ye=null,Jt=!1;function Mr(r,e,t){for(t=t.child;t!==null;)iy(r,e,t),t=t.sibling}function iy(r,e,t){if(yr&&typeof yr.onCommitFiberUnmount=="function")try{yr.onCommitFiberUnmount(ol,t)}catch{}switch(t.tag){case 5:nt||yn(t,e);case 6:var s=Ye,n=Jt;Ye=null,Mr(r,e,t),Ye=s,Jt=n,Ye!==null&&(Jt?(r=Ye,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):Ye.removeChild(t.stateNode));break;case 18:Ye!==null&&(Jt?(r=Ye,t=t.stateNode,r.nodeType===8?Ql(r.parentNode,t):r.nodeType===1&&Ql(r,t),Ci(r)):Ql(Ye,t.stateNode));break;case 4:s=Ye,n=Jt,Ye=t.stateNode.containerInfo,Jt=!0,Mr(r,e,t),Ye=s,Jt=n;break;case 0:case 11:case 14:case 15:if(!nt&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){n=s=s.next;do{var i=n,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Ic(t,e,o),n=n.next}while(n!==s)}Mr(r,e,t);break;case 1:if(!nt&&(yn(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(a){ke(t,e,a)}Mr(r,e,t);break;case 21:Mr(r,e,t);break;case 22:t.mode&1?(nt=(s=nt)||t.memoizedState!==null,Mr(r,e,t),nt=s):Mr(r,e,t);break;default:Mr(r,e,t)}}function qf(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new qT),e.forEach(function(s){var n=n_.bind(null,r,s);t.has(s)||(t.add(s),s.then(n,n))})}}function Wt(r,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var n=t[s];try{var i=r,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ye=a.stateNode,Jt=!1;break e;case 3:Ye=a.stateNode.containerInfo,Jt=!0;break e;case 4:Ye=a.stateNode.containerInfo,Jt=!0;break e}a=a.return}if(Ye===null)throw Error(U(160));iy(i,o,n),Ye=null,Jt=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(u){ke(n,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oy(e,r),e=e.sibling}function oy(r,e){var t=r.alternate,s=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Wt(e,r),ar(r),s&4){try{vi(3,r,r.return),gl(3,r)}catch(p){ke(r,r.return,p)}try{vi(5,r,r.return)}catch(p){ke(r,r.return,p)}}break;case 1:Wt(e,r),ar(r),s&512&&t!==null&&yn(t,t.return);break;case 5:if(Wt(e,r),ar(r),s&512&&t!==null&&yn(t,t.return),r.flags&32){var n=r.stateNode;try{Ii(n,"")}catch(p){ke(r,r.return,p)}}if(s&4&&(n=r.stateNode,n!=null)){var i=r.memoizedProps,o=t!==null?t.memoizedProps:i,a=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&bm(n,i),ec(a,o);var u=ec(a,i);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?Dm(n,d):c==="dangerouslySetInnerHTML"?Cm(n,d):c==="children"?Ii(n,d):Td(n,c,d,u)}switch(a){case"input":Yu(n,i);break;case"textarea":Lm(n,i);break;case"select":var h=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?Tn(n,!!i.multiple,g,!1):h!==!!i.multiple&&(i.defaultValue!=null?Tn(n,!!i.multiple,i.defaultValue,!0):Tn(n,!!i.multiple,i.multiple?[]:"",!1))}n[Fi]=i}catch(p){ke(r,r.return,p)}}break;case 6:if(Wt(e,r),ar(r),s&4){if(r.stateNode===null)throw Error(U(162));n=r.stateNode,i=r.memoizedProps;try{n.nodeValue=i}catch(p){ke(r,r.return,p)}}break;case 3:if(Wt(e,r),ar(r),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Ci(e.containerInfo)}catch(p){ke(r,r.return,p)}break;case 4:Wt(e,r),ar(r);break;case 13:Wt(e,r),ar(r),n=r.child,n.flags&8192&&(i=n.memoizedState!==null,n.stateNode.isHidden=i,!i||n.alternate!==null&&n.alternate.memoizedState!==null||(eh=De())),s&4&&qf(r);break;case 22:if(c=t!==null&&t.memoizedState!==null,r.mode&1?(nt=(u=nt)||c,Wt(e,r),nt=u):Wt(e,r),ar(r),s&8192){if(u=r.memoizedState!==null,(r.stateNode.isHidden=u)&&!c&&r.mode&1)for(z=r,c=r.child;c!==null;){for(d=z=c;z!==null;){switch(h=z,g=h.child,h.tag){case 0:case 11:case 14:case 15:vi(4,h,h.return);break;case 1:yn(h,h.return);var f=h.stateNode;if(typeof f.componentWillUnmount=="function"){s=h,t=h.return;try{e=s,f.props=e.memoizedProps,f.state=e.memoizedState,f.componentWillUnmount()}catch(p){ke(s,t,p)}}break;case 5:yn(h,h.return);break;case 22:if(h.memoizedState!==null){Qf(d);continue}}g!==null?(g.return=h,z=g):Qf(d)}c=c.sibling}e:for(c=null,d=r;;){if(d.tag===5){if(c===null){c=d;try{n=d.stateNode,u?(i=n.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Pm("display",o))}catch(p){ke(r,r.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){ke(r,r.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Wt(e,r),ar(r),s&4&&qf(r);break;case 21:break;default:Wt(e,r),ar(r)}}function ar(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(ny(t)){var s=t;break e}t=t.return}throw Error(U(160))}switch(s.tag){case 5:var n=s.stateNode;s.flags&32&&(Ii(n,""),s.flags&=-33);var i=zf(r);kc(r,i,n);break;case 3:case 4:var o=s.stateNode.containerInfo,a=zf(r);Lc(r,a,o);break;default:throw Error(U(161))}}catch(l){ke(r,r.return,l)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function QT(r,e,t){z=r,ay(r)}function ay(r,e,t){for(var s=(r.mode&1)!==0;z!==null;){var n=z,i=n.child;if(n.tag===22&&s){var o=n.memoizedState!==null||bo;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||nt;a=bo;var u=nt;if(bo=o,(nt=l)&&!u)for(z=n;z!==null;)o=z,l=o.child,o.tag===22&&o.memoizedState!==null?Xf(n):l!==null?(l.return=o,z=l):Xf(n);for(;i!==null;)z=i,ay(i),i=i.sibling;z=n,bo=a,nt=u}Yf(r)}else n.subtreeFlags&8772&&i!==null?(i.return=n,z=i):Yf(r)}}function Yf(r){for(;z!==null;){var e=z;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:nt||gl(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!nt)if(t===null)s.componentDidMount();else{var n=e.elementType===e.type?t.memoizedProps:Qt(e.type,t.memoizedProps);s.componentDidUpdate(n,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Df(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Df(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Ci(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}nt||e.flags&512&&bc(e)}catch(h){ke(e,e.return,h)}}if(e===r){z=null;break}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}}function Qf(r){for(;z!==null;){var e=z;if(e===r){z=null;break}var t=e.sibling;if(t!==null){t.return=e.return,z=t;break}z=e.return}}function Xf(r){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{gl(4,e)}catch(l){ke(e,t,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var n=e.return;try{s.componentDidMount()}catch(l){ke(e,n,l)}}var i=e.return;try{bc(e)}catch(l){ke(e,i,l)}break;case 5:var o=e.return;try{bc(e)}catch(l){ke(e,o,l)}}}catch(l){ke(e,e.return,l)}if(e===r){z=null;break}var a=e.sibling;if(a!==null){a.return=e.return,z=a;break}z=e.return}}var XT=Math.ceil,$a=Nr.ReactCurrentDispatcher,Jd=Nr.ReactCurrentOwner,Bt=Nr.ReactCurrentBatchConfig,ue=0,He=null,Me=null,Ze=0,At=0,vn=cs(0),Ge=0,Gi=null,Ms=0,pl=0,Zd=0,Ei=null,ft=null,eh=0,Un=1/0,wr=null,Ba=!1,Cc=null,ts=null,Lo=!1,Yr=null,ja=0,Si=0,Pc=null,oa=-1,aa=0;function ut(){return ue&6?De():oa!==-1?oa:oa=De()}function rs(r){return r.mode&1?ue&2&&Ze!==0?Ze&-Ze:OT.transition!==null?(aa===0&&(aa=Hm()),aa):(r=fe,r!==0||(r=window.event,r=r===void 0?16:Jm(r.type)),r):1}function sr(r,e,t,s){if(50<Si)throw Si=0,Pc=null,Error(U(185));so(r,t,s),(!(ue&2)||r!==He)&&(r===He&&(!(ue&2)&&(pl|=t),Ge===4&&Wr(r,Ze)),vt(r,s),t===1&&ue===0&&!(e.mode&1)&&(Un=De()+500,dl&&ds()))}function vt(r,e){var t=r.callbackNode;OS(r,e);var s=xa(r,r===He?Ze:0);if(s===0)t!==null&&of(t),r.callbackNode=null,r.callbackPriority=0;else if(e=s&-s,r.callbackPriority!==e){if(t!=null&&of(t),e===1)r.tag===0?DT(Jf.bind(null,r)):y0(Jf.bind(null,r)),LT(function(){!(ue&6)&&ds()}),t=null;else{switch(Wm(s)){case 1:t=Rd;break;case 4:t=Km;break;case 16:t=wa;break;case 536870912:t=Vm;break;default:t=wa}t=py(t,ly.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function ly(r,e){if(oa=-1,aa=0,ue&6)throw Error(U(327));var t=r.callbackNode;if(Rn()&&r.callbackNode!==t)return null;var s=xa(r,r===He?Ze:0);if(s===0)return null;if(s&30||s&r.expiredLanes||e)e=Ga(r,s);else{e=s;var n=ue;ue|=2;var i=cy();(He!==r||Ze!==e)&&(wr=null,Un=De()+500,ks(r,e));do try{e_();break}catch(a){uy(r,a)}while(!0);$d(),$a.current=i,ue=n,Me!==null?e=0:(He=null,Ze=0,e=Ge)}if(e!==0){if(e===2&&(n=ic(r),n!==0&&(s=n,e=Dc(r,n))),e===1)throw t=Gi,ks(r,0),Wr(r,s),vt(r,De()),t;if(e===6)Wr(r,s);else{if(n=r.current.alternate,!(s&30)&&!JT(n)&&(e=Ga(r,s),e===2&&(i=ic(r),i!==0&&(s=i,e=Dc(r,i))),e===1))throw t=Gi,ks(r,0),Wr(r,s),vt(r,De()),t;switch(r.finishedWork=n,r.finishedLanes=s,e){case 0:case 1:throw Error(U(345));case 2:Ss(r,ft,wr);break;case 3:if(Wr(r,s),(s&130023424)===s&&(e=eh+500-De(),10<e)){if(xa(r,0)!==0)break;if(n=r.suspendedLanes,(n&s)!==s){ut(),r.pingedLanes|=r.suspendedLanes&n;break}r.timeoutHandle=fc(Ss.bind(null,r,ft,wr),e);break}Ss(r,ft,wr);break;case 4:if(Wr(r,s),(s&4194240)===s)break;for(e=r.eventTimes,n=-1;0<s;){var o=31-rr(s);i=1<<o,o=e[o],o>n&&(n=o),s&=~i}if(s=n,s=De()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*XT(s/1960))-s,10<s){r.timeoutHandle=fc(Ss.bind(null,r,ft,wr),s);break}Ss(r,ft,wr);break;case 5:Ss(r,ft,wr);break;default:throw Error(U(329))}}}return vt(r,De()),r.callbackNode===t?ly.bind(null,r):null}function Dc(r,e){var t=Ei;return r.current.memoizedState.isDehydrated&&(ks(r,e).flags|=256),r=Ga(r,e),r!==2&&(e=ft,ft=t,e!==null&&Oc(e)),r}function Oc(r){ft===null?ft=r:ft.push.apply(ft,r)}function JT(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var n=t[s],i=n.getSnapshot;n=n.value;try{if(!nr(i(),n))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wr(r,e){for(e&=~Zd,e&=~pl,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-rr(e),s=1<<t;r[t]=-1,e&=~s}}function Jf(r){if(ue&6)throw Error(U(327));Rn();var e=xa(r,0);if(!(e&1))return vt(r,De()),null;var t=Ga(r,e);if(r.tag!==0&&t===2){var s=ic(r);s!==0&&(e=s,t=Dc(r,s))}if(t===1)throw t=Gi,ks(r,0),Wr(r,e),vt(r,De()),t;if(t===6)throw Error(U(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,Ss(r,ft,wr),vt(r,De()),null}function th(r,e){var t=ue;ue|=1;try{return r(e)}finally{ue=t,ue===0&&(Un=De()+500,dl&&ds())}}function Us(r){Yr!==null&&Yr.tag===0&&!(ue&6)&&Rn();var e=ue;ue|=1;var t=Bt.transition,s=fe;try{if(Bt.transition=null,fe=1,r)return r()}finally{fe=s,Bt.transition=t,ue=e,!(ue&6)&&ds()}}function rh(){At=vn.current,Se(vn)}function ks(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,bT(t)),Me!==null)for(t=Me.return;t!==null;){var s=t;switch(Fd(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&La();break;case 3:Fn(),Se(mt),Se(ot),Hd();break;case 5:Vd(s);break;case 4:Fn();break;case 13:Se(xe);break;case 19:Se(xe);break;case 10:Bd(s.type._context);break;case 22:case 23:rh()}t=t.return}if(He=r,Me=r=ss(r.current,null),Ze=At=e,Ge=0,Gi=null,Zd=pl=Ms=0,ft=Ei=null,Rs!==null){for(e=0;e<Rs.length;e++)if(t=Rs[e],s=t.interleaved,s!==null){t.interleaved=null;var n=s.next,i=t.pending;if(i!==null){var o=i.next;i.next=n,s.next=o}t.pending=s}Rs=null}return r}function uy(r,e){do{var t=Me;try{if($d(),sa.current=Ua,Ma){for(var s=Re.memoizedState;s!==null;){var n=s.queue;n!==null&&(n.pending=null),s=s.next}Ma=!1}if(Fs=0,Ve=Be=Re=null,yi=!1,$i=0,Jd.current=null,t===null||t.return===null){Ge=1,Gi=e,Me=null;break}e:{var i=r,o=t.return,a=t,l=e;if(e=Ze,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var g=$f(o);if(g!==null){g.flags&=-257,Bf(g,o,a,i,e),g.mode&1&&Uf(i,u,e),e=g,l=u;var f=e.updateQueue;if(f===null){var p=new Set;p.add(l),e.updateQueue=p}else f.add(l);break e}else{if(!(e&1)){Uf(i,u,e),sh();break e}l=Error(U(426))}}else if(Te&&a.mode&1){var m=$f(o);if(m!==null){!(m.flags&65536)&&(m.flags|=256),Bf(m,o,a,i,e),Md(Mn(l,a));break e}}i=l=Mn(l,a),Ge!==4&&(Ge=2),Ei===null?Ei=[i]:Ei.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=W0(i,l,e);Pf(i,y);break e;case 1:a=l;var v=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof v.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ts===null||!ts.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=z0(i,a,e);Pf(i,T);break e}}i=i.return}while(i!==null)}hy(t)}catch(_){e=_,Me===t&&t!==null&&(Me=t=t.return);continue}break}while(!0)}function cy(){var r=$a.current;return $a.current=Ua,r===null?Ua:r}function sh(){(Ge===0||Ge===3||Ge===2)&&(Ge=4),He===null||!(Ms&268435455)&&!(pl&268435455)||Wr(He,Ze)}function Ga(r,e){var t=ue;ue|=2;var s=cy();(He!==r||Ze!==e)&&(wr=null,ks(r,e));do try{ZT();break}catch(n){uy(r,n)}while(!0);if($d(),ue=t,$a.current=s,Me!==null)throw Error(U(261));return He=null,Ze=0,Ge}function ZT(){for(;Me!==null;)dy(Me)}function e_(){for(;Me!==null&&!AS();)dy(Me)}function dy(r){var e=gy(r.alternate,r,At);r.memoizedProps=r.pendingProps,e===null?hy(r):Me=e,Jd.current=null}function hy(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=zT(t,e),t!==null){t.flags&=32767,Me=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Ge=6,Me=null;return}}else if(t=WT(t,e,At),t!==null){Me=t;return}if(e=e.sibling,e!==null){Me=e;return}Me=e=r}while(e!==null);Ge===0&&(Ge=5)}function Ss(r,e,t){var s=fe,n=Bt.transition;try{Bt.transition=null,fe=1,t_(r,e,t,s)}finally{Bt.transition=n,fe=s}return null}function t_(r,e,t,s){do Rn();while(Yr!==null);if(ue&6)throw Error(U(327));t=r.finishedWork;var n=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(U(177));r.callbackNode=null,r.callbackPriority=0;var i=t.lanes|t.childLanes;if(NS(r,i),r===He&&(Me=He=null,Ze=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Lo||(Lo=!0,py(wa,function(){return Rn(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Bt.transition,Bt.transition=null;var o=fe;fe=1;var a=ue;ue|=4,Jd.current=null,YT(r,t),oy(t,r),TT(dc),Aa=!!cc,dc=cc=null,r.current=t,QT(t),RS(),ue=a,fe=o,Bt.transition=i}else r.current=t;if(Lo&&(Lo=!1,Yr=r,ja=n),i=r.pendingLanes,i===0&&(ts=null),LS(t.stateNode),vt(r,De()),e!==null)for(s=r.onRecoverableError,t=0;t<e.length;t++)n=e[t],s(n.value,{componentStack:n.stack,digest:n.digest});if(Ba)throw Ba=!1,r=Cc,Cc=null,r;return ja&1&&r.tag!==0&&Rn(),i=r.pendingLanes,i&1?r===Pc?Si++:(Si=0,Pc=r):Si=0,ds(),null}function Rn(){if(Yr!==null){var r=Wm(ja),e=Bt.transition,t=fe;try{if(Bt.transition=null,fe=16>r?16:r,Yr===null)var s=!1;else{if(r=Yr,Yr=null,ja=0,ue&6)throw Error(U(331));var n=ue;for(ue|=4,z=r.current;z!==null;){var i=z,o=i.child;if(z.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(z=u;z!==null;){var c=z;switch(c.tag){case 0:case 11:case 15:vi(8,c,i)}var d=c.child;if(d!==null)d.return=c,z=d;else for(;z!==null;){c=z;var h=c.sibling,g=c.return;if(sy(c),c===u){z=null;break}if(h!==null){h.return=g,z=h;break}z=g}}}var f=i.alternate;if(f!==null){var p=f.child;if(p!==null){f.child=null;do{var m=p.sibling;p.sibling=null,p=m}while(p!==null)}}z=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,z=o;else e:for(;z!==null;){if(i=z,i.flags&2048)switch(i.tag){case 0:case 11:case 15:vi(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,z=y;break e}z=i.return}}var v=r.current;for(z=v;z!==null;){o=z;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,z=E;else e:for(o=v;z!==null;){if(a=z,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:gl(9,a)}}catch(_){ke(a,a.return,_)}if(a===o){z=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,z=T;break e}z=a.return}}if(ue=n,ds(),yr&&typeof yr.onPostCommitFiberRoot=="function")try{yr.onPostCommitFiberRoot(ol,r)}catch{}s=!0}return s}finally{fe=t,Bt.transition=e}}return!1}function Zf(r,e,t){e=Mn(t,e),e=W0(r,e,1),r=es(r,e,1),e=ut(),r!==null&&(so(r,1,e),vt(r,e))}function ke(r,e,t){if(r.tag===3)Zf(r,r,t);else for(;e!==null;){if(e.tag===3){Zf(e,r,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ts===null||!ts.has(s))){r=Mn(t,r),r=z0(e,r,1),e=es(e,r,1),r=ut(),e!==null&&(so(e,1,r),vt(e,r));break}}e=e.return}}function r_(r,e,t){var s=r.pingCache;s!==null&&s.delete(e),e=ut(),r.pingedLanes|=r.suspendedLanes&t,He===r&&(Ze&t)===t&&(Ge===4||Ge===3&&(Ze&130023424)===Ze&&500>De()-eh?ks(r,0):Zd|=t),vt(r,e)}function fy(r,e){e===0&&(r.mode&1?(e=Eo,Eo<<=1,!(Eo&130023424)&&(Eo=4194304)):e=1);var t=ut();r=Dr(r,e),r!==null&&(so(r,e,t),vt(r,t))}function s_(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),fy(r,t)}function n_(r,e){var t=0;switch(r.tag){case 13:var s=r.stateNode,n=r.memoizedState;n!==null&&(t=n.retryLane);break;case 19:s=r.stateNode;break;default:throw Error(U(314))}s!==null&&s.delete(e),fy(r,t)}var gy;gy=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||mt.current)gt=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return gt=!1,HT(r,e,t);gt=!!(r.flags&131072)}else gt=!1,Te&&e.flags&1048576&&v0(e,Pa,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;ia(r,e),r=e.pendingProps;var n=Dn(e,ot.current);An(e,t),n=zd(null,e,s,r,n,t);var i=qd();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,yt(s)?(i=!0,ka(e)):i=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Gd(e),n.updater=fl,e.stateNode=n,n._reactInternals=e,Sc(e,s,r,t),e=wc(null,e,s,!0,i,t)):(e.tag=0,Te&&i&&Nd(e),at(null,e,n,t),e=e.child),e;case 16:s=e.elementType;e:{switch(ia(r,e),r=e.pendingProps,n=s._init,s=n(s._payload),e.type=s,n=e.tag=o_(s),r=Qt(s,r),n){case 0:e=_c(null,e,s,r,t);break e;case 1:e=Kf(null,e,s,r,t);break e;case 11:e=jf(null,e,s,r,t);break e;case 14:e=Gf(null,e,s,Qt(s.type,r),t);break e}throw Error(U(306,s,""))}return e;case 0:return s=e.type,n=e.pendingProps,n=e.elementType===s?n:Qt(s,n),_c(r,e,s,n,t);case 1:return s=e.type,n=e.pendingProps,n=e.elementType===s?n:Qt(s,n),Kf(r,e,s,n,t);case 3:e:{if(X0(e),r===null)throw Error(U(387));s=e.pendingProps,i=e.memoizedState,n=i.element,x0(r,e),Na(e,s,null,t);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){n=Mn(Error(U(423)),e),e=Vf(r,e,s,t,n);break e}else if(s!==n){n=Mn(Error(U(424)),e),e=Vf(r,e,s,t,n);break e}else for(Lt=Zr(e.stateNode.containerInfo.firstChild),kt=e,Te=!0,er=null,t=_0(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(On(),s===n){e=Or(r,e,t);break e}at(r,e,s,t)}e=e.child}return e;case 5:return A0(e),r===null&&yc(e),s=e.type,n=e.pendingProps,i=r!==null?r.memoizedProps:null,o=n.children,hc(s,n)?o=null:i!==null&&hc(s,i)&&(e.flags|=32),Q0(r,e),at(r,e,o,t),e.child;case 6:return r===null&&yc(e),null;case 13:return J0(r,e,t);case 4:return Kd(e,e.stateNode.containerInfo),s=e.pendingProps,r===null?e.child=Nn(e,null,s,t):at(r,e,s,t),e.child;case 11:return s=e.type,n=e.pendingProps,n=e.elementType===s?n:Qt(s,n),jf(r,e,s,n,t);case 7:return at(r,e,e.pendingProps,t),e.child;case 8:return at(r,e,e.pendingProps.children,t),e.child;case 12:return at(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,n=e.pendingProps,i=e.memoizedProps,o=n.value,ve(Da,s._currentValue),s._currentValue=o,i!==null)if(nr(i.value,o)){if(i.children===n.children&&!mt.current){e=Or(r,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=kr(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),vc(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(U(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),vc(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}at(r,e,n.children,t),e=e.child}return e;case 9:return n=e.type,s=e.pendingProps.children,An(e,t),n=jt(n),s=s(n),e.flags|=1,at(r,e,s,t),e.child;case 14:return s=e.type,n=Qt(s,e.pendingProps),n=Qt(s.type,n),Gf(r,e,s,n,t);case 15:return q0(r,e,e.type,e.pendingProps,t);case 17:return s=e.type,n=e.pendingProps,n=e.elementType===s?n:Qt(s,n),ia(r,e),e.tag=1,yt(s)?(r=!0,ka(e)):r=!1,An(e,t),H0(e,s,n),Sc(e,s,n,t),wc(null,e,s,!0,r,t);case 19:return Z0(r,e,t);case 22:return Y0(r,e,t)}throw Error(U(156,e.tag))};function py(r,e){return Gm(r,e)}function i_(r,e,t,s){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function $t(r,e,t,s){return new i_(r,e,t,s)}function nh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function o_(r){if(typeof r=="function")return nh(r)?1:0;if(r!=null){if(r=r.$$typeof,r===wd)return 11;if(r===xd)return 14}return 2}function ss(r,e){var t=r.alternate;return t===null?(t=$t(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function la(r,e,t,s,n,i){var o=2;if(s=r,typeof r=="function")nh(r)&&(o=1);else if(typeof r=="string")o=5;else e:switch(r){case ln:return Cs(t.children,n,i,e);case _d:o=8,n|=8;break;case Vu:return r=$t(12,t,e,n|2),r.elementType=Vu,r.lanes=i,r;case Hu:return r=$t(13,t,e,n),r.elementType=Hu,r.lanes=i,r;case Wu:return r=$t(19,t,e,n),r.elementType=Wu,r.lanes=i,r;case Am:return ml(t,n,i,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case wm:o=10;break e;case xm:o=9;break e;case wd:o=11;break e;case xd:o=14;break e;case Br:o=16,s=null;break e}throw Error(U(130,r==null?r:typeof r,""))}return e=$t(o,t,e,n),e.elementType=r,e.type=s,e.lanes=i,e}function Cs(r,e,t,s){return r=$t(7,r,s,e),r.lanes=t,r}function ml(r,e,t,s){return r=$t(22,r,s,e),r.elementType=Am,r.lanes=t,r.stateNode={isHidden:!1},r}function nu(r,e,t){return r=$t(6,r,null,e),r.lanes=t,r}function iu(r,e,t){return e=$t(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function a_(r,e,t,s,n){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$l(0),this.expirationTimes=$l(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$l(0),this.identifierPrefix=s,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function ih(r,e,t,s,n,i,o,a,l){return r=new a_(r,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=$t(3,null,null,e),r.current=i,i.stateNode=r,i.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gd(i),r}function l_(r,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:an,key:s==null?null:""+s,children:r,containerInfo:e,implementation:t}}function my(r){if(!r)return os;r=r._reactInternals;e:{if(Gs(r)!==r||r.tag!==1)throw Error(U(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(yt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(r.tag===1){var t=r.type;if(yt(t))return m0(r,t,e)}return e}function yy(r,e,t,s,n,i,o,a,l){return r=ih(t,s,!0,r,n,i,o,a,l),r.context=my(null),t=r.current,s=ut(),n=rs(t),i=kr(s,n),i.callback=e??null,es(t,i,n),r.current.lanes=n,so(r,n,s),vt(r,s),r}function yl(r,e,t,s){var n=e.current,i=ut(),o=rs(n);return t=my(t),e.context===null?e.context=t:e.pendingContext=t,e=kr(i,o),e.payload={element:r},s=s===void 0?null:s,s!==null&&(e.callback=s),r=es(n,e,o),r!==null&&(sr(r,n,o,i),ra(r,n,o)),o}function Ka(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function eg(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function oh(r,e){eg(r,e),(r=r.alternate)&&eg(r,e)}function u_(){return null}var vy=typeof reportError=="function"?reportError:function(r){console.error(r)};function ah(r){this._internalRoot=r}vl.prototype.render=ah.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(U(409));yl(r,e,null,null)};vl.prototype.unmount=ah.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;Us(function(){yl(null,r,null,null)}),e[Pr]=null}};function vl(r){this._internalRoot=r}vl.prototype.unstable_scheduleHydration=function(r){if(r){var e=Ym();r={blockedOn:null,target:r,priority:e};for(var t=0;t<Hr.length&&e!==0&&e<Hr[t].priority;t++);Hr.splice(t,0,r),t===0&&Xm(r)}};function lh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function El(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function tg(){}function c_(r,e,t,s,n){if(n){if(typeof s=="function"){var i=s;s=function(){var u=Ka(o);i.call(u)}}var o=yy(e,s,r,0,null,!1,!1,"",tg);return r._reactRootContainer=o,r[Pr]=o.current,Oi(r.nodeType===8?r.parentNode:r),Us(),o}for(;n=r.lastChild;)r.removeChild(n);if(typeof s=="function"){var a=s;s=function(){var u=Ka(l);a.call(u)}}var l=ih(r,0,!1,null,null,!1,!1,"",tg);return r._reactRootContainer=l,r[Pr]=l.current,Oi(r.nodeType===8?r.parentNode:r),Us(function(){yl(e,l,t,s)}),l}function Sl(r,e,t,s,n){var i=t._reactRootContainer;if(i){var o=i;if(typeof n=="function"){var a=n;n=function(){var l=Ka(o);a.call(l)}}yl(e,o,r,n)}else o=c_(t,e,r,n,s);return Ka(o)}zm=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=li(e.pendingLanes);t!==0&&(Id(e,t|1),vt(e,De()),!(ue&6)&&(Un=De()+500,ds()))}break;case 13:Us(function(){var s=Dr(r,1);if(s!==null){var n=ut();sr(s,r,1,n)}}),oh(r,1)}};bd=function(r){if(r.tag===13){var e=Dr(r,134217728);if(e!==null){var t=ut();sr(e,r,134217728,t)}oh(r,134217728)}};qm=function(r){if(r.tag===13){var e=rs(r),t=Dr(r,e);if(t!==null){var s=ut();sr(t,r,e,s)}oh(r,e)}};Ym=function(){return fe};Qm=function(r,e){var t=fe;try{return fe=r,e()}finally{fe=t}};rc=function(r,e,t){switch(e){case"input":if(Yu(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==r&&s.form===r.form){var n=cl(s);if(!n)throw Error(U(90));Im(s),Yu(s,n)}}}break;case"textarea":Lm(r,t);break;case"select":e=t.value,e!=null&&Tn(r,!!t.multiple,e,!1)}};Fm=th;Mm=Us;var d_={usingClientEntryPoint:!1,Events:[io,hn,cl,Om,Nm,th]},si={findFiberByHostInstance:As,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},h_={bundleType:si.bundleType,version:si.version,rendererPackageName:si.rendererPackageName,rendererConfig:si.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Nr.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=Bm(r),r===null?null:r.stateNode},findFiberByHostInstance:si.findFiberByHostInstance||u_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ko=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ko.isDisabled&&ko.supportsFiber)try{ol=ko.inject(h_),yr=ko}catch{}}Dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d_;Dt.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!lh(e))throw Error(U(200));return l_(r,e,null,t)};Dt.createRoot=function(r,e){if(!lh(r))throw Error(U(299));var t=!1,s="",n=vy;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=ih(r,1,!1,null,null,t,!1,s,n),r[Pr]=e.current,Oi(r.nodeType===8?r.parentNode:r),new ah(e)};Dt.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(U(188)):(r=Object.keys(r).join(","),Error(U(268,r)));return r=Bm(e),r=r===null?null:r.stateNode,r};Dt.flushSync=function(r){return Us(r)};Dt.hydrate=function(r,e,t){if(!El(e))throw Error(U(200));return Sl(null,r,e,!0,t)};Dt.hydrateRoot=function(r,e,t){if(!lh(r))throw Error(U(405));var s=t!=null&&t.hydratedSources||null,n=!1,i="",o=vy;if(t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=yy(e,null,r,1,t??null,n,!1,i,o),r[Pr]=e.current,Oi(r),s)for(r=0;r<s.length;r++)t=s[r],n=t._getVersion,n=n(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n);return new vl(e)};Dt.render=function(r,e,t){if(!El(e))throw Error(U(200));return Sl(null,r,e,!1,t)};Dt.unmountComponentAtNode=function(r){if(!El(r))throw Error(U(40));return r._reactRootContainer?(Us(function(){Sl(null,null,r,!1,function(){r._reactRootContainer=null,r[Pr]=null})}),!0):!1};Dt.unstable_batchedUpdates=th;Dt.unstable_renderSubtreeIntoContainer=function(r,e,t,s){if(!El(t))throw Error(U(200));if(r==null||r._reactInternals===void 0)throw Error(U(38));return Sl(r,e,t,!1,s)};Dt.version="18.3.1-next-f1338f8080-20240426";function Ey(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ey)}catch(r){console.error(r)}}Ey(),Em.exports=Dt;var f_=Em.exports,rg=f_;Gu.createRoot=rg.createRoot,Gu.hydrateRoot=rg.hydrateRoot;function Sy(r,e){return function(){return r.apply(e,arguments)}}const{toString:g_}=Object.prototype,{getPrototypeOf:uh}=Object,{iterator:Tl,toStringTag:Ty}=Symbol,_l=(r=>e=>{const t=g_.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ir=r=>(r=r.toLowerCase(),e=>_l(e)===r),wl=r=>e=>typeof e===r,{isArray:Hn}=Array,$n=wl("undefined");function ao(r){return r!==null&&!$n(r)&&r.constructor!==null&&!$n(r.constructor)&&Et(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const _y=ir("ArrayBuffer");function p_(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&_y(r.buffer),e}const m_=wl("string"),Et=wl("function"),wy=wl("number"),lo=r=>r!==null&&typeof r=="object",y_=r=>r===!0||r===!1,ua=r=>{if(_l(r)!=="object")return!1;const e=uh(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Ty in r)&&!(Tl in r)},v_=r=>{if(!lo(r)||ao(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},E_=ir("Date"),S_=ir("File"),T_=ir("Blob"),__=ir("FileList"),w_=r=>lo(r)&&Et(r.pipe),x_=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||Et(r.append)&&((e=_l(r))==="formdata"||e==="object"&&Et(r.toString)&&r.toString()==="[object FormData]"))},A_=ir("URLSearchParams"),[R_,I_,b_,L_]=["ReadableStream","Request","Response","Headers"].map(ir),k_=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function uo(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let s,n;if(typeof r!="object"&&(r=[r]),Hn(r))for(s=0,n=r.length;s<n;s++)e.call(null,r[s],s,r);else{if(ao(r))return;const i=t?Object.getOwnPropertyNames(r):Object.keys(r),o=i.length;let a;for(s=0;s<o;s++)a=i[s],e.call(null,r[a],a,r)}}function xy(r,e){if(ao(r))return null;e=e.toLowerCase();const t=Object.keys(r);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const bs=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ay=r=>!$n(r)&&r!==bs;function Nc(){const{caseless:r,skipUndefined:e}=Ay(this)&&this||{},t={},s=(n,i)=>{const o=r&&xy(t,i)||i;ua(t[o])&&ua(n)?t[o]=Nc(t[o],n):ua(n)?t[o]=Nc({},n):Hn(n)?t[o]=n.slice():(!e||!$n(n))&&(t[o]=n)};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&uo(arguments[n],s);return t}const C_=(r,e,t,{allOwnKeys:s}={})=>(uo(e,(n,i)=>{t&&Et(n)?r[i]=Sy(n,t):r[i]=n},{allOwnKeys:s}),r),P_=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),D_=(r,e,t,s)=>{r.prototype=Object.create(e.prototype,s),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},O_=(r,e,t,s)=>{let n,i,o;const a={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),i=n.length;i-- >0;)o=n[i],(!s||s(o,r,e))&&!a[o]&&(e[o]=r[o],a[o]=!0);r=t!==!1&&uh(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},N_=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const s=r.indexOf(e,t);return s!==-1&&s===t},F_=r=>{if(!r)return null;if(Hn(r))return r;let e=r.length;if(!wy(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},M_=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&uh(Uint8Array)),U_=(r,e)=>{const s=(r&&r[Tl]).call(r);let n;for(;(n=s.next())&&!n.done;){const i=n.value;e.call(r,i[0],i[1])}},$_=(r,e)=>{let t;const s=[];for(;(t=r.exec(e))!==null;)s.push(t);return s},B_=ir("HTMLFormElement"),j_=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),sg=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),G_=ir("RegExp"),Ry=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),s={};uo(t,(n,i)=>{let o;(o=e(n,i,r))!==!1&&(s[i]=o||n)}),Object.defineProperties(r,s)},K_=r=>{Ry(r,(e,t)=>{if(Et(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=r[t];if(Et(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},V_=(r,e)=>{const t={},s=n=>{n.forEach(i=>{t[i]=!0})};return Hn(r)?s(r):s(String(r).split(e)),t},H_=()=>{},W_=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function z_(r){return!!(r&&Et(r.append)&&r[Ty]==="FormData"&&r[Tl])}const q_=r=>{const e=new Array(10),t=(s,n)=>{if(lo(s)){if(e.indexOf(s)>=0)return;if(ao(s))return s;if(!("toJSON"in s)){e[n]=s;const i=Hn(s)?[]:{};return uo(s,(o,a)=>{const l=t(o,n+1);!$n(l)&&(i[a]=l)}),e[n]=void 0,i}}return s};return t(r,0)},Y_=ir("AsyncFunction"),Q_=r=>r&&(lo(r)||Et(r))&&Et(r.then)&&Et(r.catch),Iy=((r,e)=>r?setImmediate:e?((t,s)=>(bs.addEventListener("message",({source:n,data:i})=>{n===bs&&i===t&&s.length&&s.shift()()},!1),n=>{s.push(n),bs.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Et(bs.postMessage)),X_=typeof queueMicrotask<"u"?queueMicrotask.bind(bs):typeof process<"u"&&process.nextTick||Iy,J_=r=>r!=null&&Et(r[Tl]),C={isArray:Hn,isArrayBuffer:_y,isBuffer:ao,isFormData:x_,isArrayBufferView:p_,isString:m_,isNumber:wy,isBoolean:y_,isObject:lo,isPlainObject:ua,isEmptyObject:v_,isReadableStream:R_,isRequest:I_,isResponse:b_,isHeaders:L_,isUndefined:$n,isDate:E_,isFile:S_,isBlob:T_,isRegExp:G_,isFunction:Et,isStream:w_,isURLSearchParams:A_,isTypedArray:M_,isFileList:__,forEach:uo,merge:Nc,extend:C_,trim:k_,stripBOM:P_,inherits:D_,toFlatObject:O_,kindOf:_l,kindOfTest:ir,endsWith:N_,toArray:F_,forEachEntry:U_,matchAll:$_,isHTMLForm:B_,hasOwnProperty:sg,hasOwnProp:sg,reduceDescriptors:Ry,freezeMethods:K_,toObjectSet:V_,toCamelCase:j_,noop:H_,toFiniteNumber:W_,findKey:xy,global:bs,isContextDefined:Ay,isSpecCompliantForm:z_,toJSONObject:q_,isAsyncFn:Y_,isThenable:Q_,setImmediate:Iy,asap:X_,isIterable:J_};function ie(r,e,t,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}C.inherits(ie,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const by=ie.prototype,Ly={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Ly[r]={value:r}});Object.defineProperties(ie,Ly);Object.defineProperty(by,"isAxiosError",{value:!0});ie.from=(r,e,t,s,n,i)=>{const o=Object.create(by);C.toFlatObject(r,o,function(c){return c!==Error.prototype},u=>u!=="isAxiosError");const a=r&&r.message?r.message:"Error",l=e==null&&r?r.code:e;return ie.call(o,a,l,t,s,n),r&&o.cause==null&&Object.defineProperty(o,"cause",{value:r,configurable:!0}),o.name=r&&r.name||"Error",i&&Object.assign(o,i),o};const Z_=null;function Fc(r){return C.isPlainObject(r)||C.isArray(r)}function ky(r){return C.endsWith(r,"[]")?r.slice(0,-2):r}function ng(r,e,t){return r?r.concat(e).map(function(n,i){return n=ky(n),!t&&i?"["+n+"]":n}).join(t?".":""):e}function ew(r){return C.isArray(r)&&!r.some(Fc)}const tw=C.toFlatObject(C,{},null,function(e){return/^is[A-Z]/.test(e)});function xl(r,e,t){if(!C.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=C.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,m){return!C.isUndefined(m[p])});const s=t.metaTokens,n=t.visitor||c,i=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(e);if(!C.isFunction(n))throw new TypeError("visitor must be a function");function u(f){if(f===null)return"";if(C.isDate(f))return f.toISOString();if(C.isBoolean(f))return f.toString();if(!l&&C.isBlob(f))throw new ie("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(f)||C.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function c(f,p,m){let y=f;if(f&&!m&&typeof f=="object"){if(C.endsWith(p,"{}"))p=s?p:p.slice(0,-2),f=JSON.stringify(f);else if(C.isArray(f)&&ew(f)||(C.isFileList(f)||C.endsWith(p,"[]"))&&(y=C.toArray(f)))return p=ky(p),y.forEach(function(E,T){!(C.isUndefined(E)||E===null)&&e.append(o===!0?ng([p],T,i):o===null?p:p+"[]",u(E))}),!1}return Fc(f)?!0:(e.append(ng(m,p,i),u(f)),!1)}const d=[],h=Object.assign(tw,{defaultVisitor:c,convertValue:u,isVisitable:Fc});function g(f,p){if(!C.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+p.join("."));d.push(f),C.forEach(f,function(y,v){(!(C.isUndefined(y)||y===null)&&n.call(e,y,C.isString(v)?v.trim():v,p,h))===!0&&g(y,p?p.concat(v):[v])}),d.pop()}}if(!C.isObject(r))throw new TypeError("data must be an object");return g(r),e}function ig(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function ch(r,e){this._pairs=[],r&&xl(r,this,e)}const Cy=ch.prototype;Cy.append=function(e,t){this._pairs.push([e,t])};Cy.toString=function(e){const t=e?function(s){return e.call(this,s,ig)}:ig;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function rw(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Py(r,e,t){if(!e)return r;const s=t&&t.encode||rw;C.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let i;if(n?i=n(e,t):i=C.isURLSearchParams(e)?e.toString():new ch(e,t).toString(s),i){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+i}return r}class og{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){C.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Dy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sw=typeof URLSearchParams<"u"?URLSearchParams:ch,nw=typeof FormData<"u"?FormData:null,iw=typeof Blob<"u"?Blob:null,ow={isBrowser:!0,classes:{URLSearchParams:sw,FormData:nw,Blob:iw},protocols:["http","https","file","blob","url","data"]},dh=typeof window<"u"&&typeof document<"u",Mc=typeof navigator=="object"&&navigator||void 0,aw=dh&&(!Mc||["ReactNative","NativeScript","NS"].indexOf(Mc.product)<0),lw=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uw=dh&&window.location.href||"http://localhost",cw=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dh,hasStandardBrowserEnv:aw,hasStandardBrowserWebWorkerEnv:lw,navigator:Mc,origin:uw},Symbol.toStringTag,{value:"Module"})),it={...cw,...ow};function dw(r,e){return xl(r,new it.classes.URLSearchParams,{visitor:function(t,s,n,i){return it.isNode&&C.isBuffer(t)?(this.append(s,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function hw(r){return C.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function fw(r){const e={},t=Object.keys(r);let s;const n=t.length;let i;for(s=0;s<n;s++)i=t[s],e[i]=r[i];return e}function Oy(r){function e(t,s,n,i){let o=t[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=i>=t.length;return o=!o&&C.isArray(n)?n.length:o,l?(C.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!a):((!n[o]||!C.isObject(n[o]))&&(n[o]=[]),e(t,s,n[o],i)&&C.isArray(n[o])&&(n[o]=fw(n[o])),!a)}if(C.isFormData(r)&&C.isFunction(r.entries)){const t={};return C.forEachEntry(r,(s,n)=>{e(hw(s),n,t,0)}),t}return null}function gw(r,e,t){if(C.isString(r))try{return(e||JSON.parse)(r),C.trim(r)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(r)}const co={transitional:Dy,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,i=C.isObject(e);if(i&&C.isHTMLForm(e)&&(e=new FormData(e)),C.isFormData(e))return n?JSON.stringify(Oy(e)):e;if(C.isArrayBuffer(e)||C.isBuffer(e)||C.isStream(e)||C.isFile(e)||C.isBlob(e)||C.isReadableStream(e))return e;if(C.isArrayBufferView(e))return e.buffer;if(C.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return dw(e,this.formSerializer).toString();if((a=C.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return xl(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),gw(e)):e}],transformResponse:[function(e){const t=this.transitional||co.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(C.isResponse(e)||C.isReadableStream(e))return e;if(e&&C.isString(e)&&(s&&!this.responseType||n)){const o=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?ie.from(a,ie.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:it.classes.FormData,Blob:it.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],r=>{co.headers[r]={}});const pw=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mw=r=>{const e={};let t,s,n;return r&&r.split(`
`).forEach(function(o){n=o.indexOf(":"),t=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!t||e[t]&&pw[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},ag=Symbol("internals");function ni(r){return r&&String(r).trim().toLowerCase()}function ca(r){return r===!1||r==null?r:C.isArray(r)?r.map(ca):String(r)}function yw(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(r);)e[s[1]]=s[2];return e}const vw=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function ou(r,e,t,s,n){if(C.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!C.isString(e)){if(C.isString(s))return e.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(e)}}function Ew(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Sw(r,e){const t=C.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(r,s+t,{value:function(n,i,o){return this[s].call(this,e,n,i,o)},configurable:!0})})}let St=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function i(a,l,u){const c=ni(l);if(!c)throw new Error("header name must be a non-empty string");const d=C.findKey(n,c);(!d||n[d]===void 0||u===!0||u===void 0&&n[d]!==!1)&&(n[d||l]=ca(a))}const o=(a,l)=>C.forEach(a,(u,c)=>i(u,c,l));if(C.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(C.isString(e)&&(e=e.trim())&&!vw(e))o(mw(e),t);else if(C.isObject(e)&&C.isIterable(e)){let a={},l,u;for(const c of e){if(!C.isArray(c))throw TypeError("Object iterator must return a key-value pair");a[u=c[0]]=(l=a[u])?C.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}o(a,t)}else e!=null&&i(t,e,s);return this}get(e,t){if(e=ni(e),e){const s=C.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return yw(n);if(C.isFunction(t))return t.call(this,n,s);if(C.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ni(e),e){const s=C.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||ou(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function i(o){if(o=ni(o),o){const a=C.findKey(s,o);a&&(!t||ou(s,s[a],a,t))&&(delete s[a],n=!0)}}return C.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const i=t[s];(!e||ou(this,this[i],i,e,!0))&&(delete this[i],n=!0)}return n}normalize(e){const t=this,s={};return C.forEach(this,(n,i)=>{const o=C.findKey(s,i);if(o){t[o]=ca(n),delete t[i];return}const a=e?Ew(i):String(i).trim();a!==i&&delete t[i],t[a]=ca(n),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return C.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&C.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[ag]=this[ag]={accessors:{}}).accessors,n=this.prototype;function i(o){const a=ni(o);s[a]||(Sw(n,o),s[a]=!0)}return C.isArray(e)?e.forEach(i):i(e),this}};St.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(St.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(s){this[t]=s}}});C.freezeMethods(St);function au(r,e){const t=this||co,s=e||t,n=St.from(s.headers);let i=s.data;return C.forEach(r,function(a){i=a.call(t,i,n.normalize(),e?e.status:void 0)}),n.normalize(),i}function Ny(r){return!!(r&&r.__CANCEL__)}function Wn(r,e,t){ie.call(this,r??"canceled",ie.ERR_CANCELED,e,t),this.name="CanceledError"}C.inherits(Wn,ie,{__CANCEL__:!0});function Fy(r,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?r(t):e(new ie("Request failed with status code "+t.status,[ie.ERR_BAD_REQUEST,ie.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Tw(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function _w(r,e){r=r||10;const t=new Array(r),s=new Array(r);let n=0,i=0,o;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=s[i];o||(o=u),t[n]=l,s[n]=u;let d=i,h=0;for(;d!==n;)h+=t[d++],d=d%r;if(n=(n+1)%r,n===i&&(i=(i+1)%r),u-o<e)return;const g=c&&u-c;return g?Math.round(h*1e3/g):void 0}}function ww(r,e){let t=0,s=1e3/e,n,i;const o=(u,c=Date.now())=>{t=c,n=null,i&&(clearTimeout(i),i=null),r(...u)};return[(...u)=>{const c=Date.now(),d=c-t;d>=s?o(u,c):(n=u,i||(i=setTimeout(()=>{i=null,o(n)},s-d)))},()=>n&&o(n)]}const Va=(r,e,t=3)=>{let s=0;const n=_w(50,250);return ww(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,l=o-s,u=n(l),c=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:u||void 0,estimated:u&&a&&c?(a-o)/u:void 0,event:i,lengthComputable:a!=null,[e?"download":"upload"]:!0};r(d)},t)},lg=(r,e)=>{const t=r!=null;return[s=>e[0]({lengthComputable:t,total:r,loaded:s}),e[1]]},ug=r=>(...e)=>C.asap(()=>r(...e)),xw=it.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,it.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(it.origin),it.navigator&&/(msie|trident)/i.test(it.navigator.userAgent)):()=>!0,Aw=it.hasStandardBrowserEnv?{write(r,e,t,s,n,i,o){if(typeof document>"u")return;const a=[`${r}=${encodeURIComponent(e)}`];C.isNumber(t)&&a.push(`expires=${new Date(t).toUTCString()}`),C.isString(s)&&a.push(`path=${s}`),C.isString(n)&&a.push(`domain=${n}`),i===!0&&a.push("secure"),C.isString(o)&&a.push(`SameSite=${o}`),document.cookie=a.join("; ")},read(r){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+r+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(r){this.write(r,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Rw(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Iw(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function My(r,e,t){let s=!Rw(e);return r&&(s||t==!1)?Iw(r,e):e}const cg=r=>r instanceof St?{...r}:r;function $s(r,e){e=e||{};const t={};function s(u,c,d,h){return C.isPlainObject(u)&&C.isPlainObject(c)?C.merge.call({caseless:h},u,c):C.isPlainObject(c)?C.merge({},c):C.isArray(c)?c.slice():c}function n(u,c,d,h){if(C.isUndefined(c)){if(!C.isUndefined(u))return s(void 0,u,d,h)}else return s(u,c,d,h)}function i(u,c){if(!C.isUndefined(c))return s(void 0,c)}function o(u,c){if(C.isUndefined(c)){if(!C.isUndefined(u))return s(void 0,u)}else return s(void 0,c)}function a(u,c,d){if(d in e)return s(u,c);if(d in r)return s(void 0,u)}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,c,d)=>n(cg(u),cg(c),d,!0)};return C.forEach(Object.keys({...r,...e}),function(c){const d=l[c]||n,h=d(r[c],e[c],c);C.isUndefined(h)&&d!==a||(t[c]=h)}),t}const Uy=r=>{const e=$s({},r);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:i,headers:o,auth:a}=e;if(e.headers=o=St.from(o),e.url=Py(My(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),C.isFormData(t)){if(it.hasStandardBrowserEnv||it.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(C.isFunction(t.getHeaders)){const l=t.getHeaders(),u=["content-type","content-length"];Object.entries(l).forEach(([c,d])=>{u.includes(c.toLowerCase())&&o.set(c,d)})}}if(it.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(e)),s||s!==!1&&xw(e.url))){const l=n&&i&&Aw.read(i);l&&o.set(n,l)}return e},bw=typeof XMLHttpRequest<"u",Lw=bw&&function(r){return new Promise(function(t,s){const n=Uy(r);let i=n.data;const o=St.from(n.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:u}=n,c,d,h,g,f;function p(){g&&g(),f&&f(),n.cancelToken&&n.cancelToken.unsubscribe(c),n.signal&&n.signal.removeEventListener("abort",c)}let m=new XMLHttpRequest;m.open(n.method.toUpperCase(),n.url,!0),m.timeout=n.timeout;function y(){if(!m)return;const E=St.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders()),_={data:!a||a==="text"||a==="json"?m.responseText:m.response,status:m.status,statusText:m.statusText,headers:E,config:r,request:m};Fy(function(w){t(w),p()},function(w){s(w),p()},_),m=null}"onloadend"in m?m.onloadend=y:m.onreadystatechange=function(){!m||m.readyState!==4||m.status===0&&!(m.responseURL&&m.responseURL.indexOf("file:")===0)||setTimeout(y)},m.onabort=function(){m&&(s(new ie("Request aborted",ie.ECONNABORTED,r,m)),m=null)},m.onerror=function(T){const _=T&&T.message?T.message:"Network Error",x=new ie(_,ie.ERR_NETWORK,r,m);x.event=T||null,s(x),m=null},m.ontimeout=function(){let T=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const _=n.transitional||Dy;n.timeoutErrorMessage&&(T=n.timeoutErrorMessage),s(new ie(T,_.clarifyTimeoutError?ie.ETIMEDOUT:ie.ECONNABORTED,r,m)),m=null},i===void 0&&o.setContentType(null),"setRequestHeader"in m&&C.forEach(o.toJSON(),function(T,_){m.setRequestHeader(_,T)}),C.isUndefined(n.withCredentials)||(m.withCredentials=!!n.withCredentials),a&&a!=="json"&&(m.responseType=n.responseType),u&&([h,f]=Va(u,!0),m.addEventListener("progress",h)),l&&m.upload&&([d,g]=Va(l),m.upload.addEventListener("progress",d),m.upload.addEventListener("loadend",g)),(n.cancelToken||n.signal)&&(c=E=>{m&&(s(!E||E.type?new Wn(null,r,m):E),m.abort(),m=null)},n.cancelToken&&n.cancelToken.subscribe(c),n.signal&&(n.signal.aborted?c():n.signal.addEventListener("abort",c)));const v=Tw(n.url);if(v&&it.protocols.indexOf(v)===-1){s(new ie("Unsupported protocol "+v+":",ie.ERR_BAD_REQUEST,r));return}m.send(i||null)})},kw=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let s=new AbortController,n;const i=function(u){if(!n){n=!0,a();const c=u instanceof Error?u:this.reason;s.abort(c instanceof ie?c:new Wn(c instanceof Error?c.message:c))}};let o=e&&setTimeout(()=>{o=null,i(new ie(`timeout ${e} of ms exceeded`,ie.ETIMEDOUT))},e);const a=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(u=>{u.unsubscribe?u.unsubscribe(i):u.removeEventListener("abort",i)}),r=null)};r.forEach(u=>u.addEventListener("abort",i));const{signal:l}=s;return l.unsubscribe=()=>C.asap(a),l}},Cw=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let s=0,n;for(;s<t;)n=s+e,yield r.slice(s,n),s=n},Pw=async function*(r,e){for await(const t of Dw(r))yield*Cw(t,e)},Dw=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},dg=(r,e,t,s)=>{const n=Pw(r,e);let i=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await n.next();if(u){a(),l.close();return}let d=c.byteLength;if(t){let h=i+=d;t(h)}l.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(l){return a(l),n.return()}},{highWaterMark:2})},hg=64*1024,{isFunction:Co}=C,Ow=(({Request:r,Response:e})=>({Request:r,Response:e}))(C.global),{ReadableStream:fg,TextEncoder:gg}=C.global,pg=(r,...e)=>{try{return!!r(...e)}catch{return!1}},Nw=r=>{r=C.merge.call({skipUndefined:!0},Ow,r);const{fetch:e,Request:t,Response:s}=r,n=e?Co(e):typeof fetch=="function",i=Co(t),o=Co(s);if(!n)return!1;const a=n&&Co(fg),l=n&&(typeof gg=="function"?(f=>p=>f.encode(p))(new gg):async f=>new Uint8Array(await new t(f).arrayBuffer())),u=i&&a&&pg(()=>{let f=!1;const p=new t(it.origin,{body:new fg,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!p}),c=o&&a&&pg(()=>C.isReadableStream(new s("").body)),d={stream:c&&(f=>f.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!d[f]&&(d[f]=(p,m)=>{let y=p&&p[f];if(y)return y.call(p);throw new ie(`Response type '${f}' is not supported`,ie.ERR_NOT_SUPPORT,m)})});const h=async f=>{if(f==null)return 0;if(C.isBlob(f))return f.size;if(C.isSpecCompliantForm(f))return(await new t(it.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(C.isArrayBufferView(f)||C.isArrayBuffer(f))return f.byteLength;if(C.isURLSearchParams(f)&&(f=f+""),C.isString(f))return(await l(f)).byteLength},g=async(f,p)=>{const m=C.toFiniteNumber(f.getContentLength());return m??h(p)};return async f=>{let{url:p,method:m,data:y,signal:v,cancelToken:E,timeout:T,onDownloadProgress:_,onUploadProgress:x,responseType:w,headers:A,withCredentials:I="same-origin",fetchOptions:R}=Uy(f),P=e||fetch;w=w?(w+"").toLowerCase():"text";let $=kw([v,E&&E.toAbortSignal()],T),j=null;const K=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let V;try{if(x&&u&&m!=="get"&&m!=="head"&&(V=await g(A,y))!==0){let O=new t(p,{method:"POST",body:y,duplex:"half"}),F;if(C.isFormData(y)&&(F=O.headers.get("content-type"))&&A.setContentType(F),O.body){const[Z,se]=lg(V,Va(ug(x)));y=dg(O.body,hg,Z,se)}}C.isString(I)||(I=I?"include":"omit");const M=i&&"credentials"in t.prototype,H={...R,signal:$,method:m.toUpperCase(),headers:A.normalize().toJSON(),body:y,duplex:"half",credentials:M?I:void 0};j=i&&new t(p,H);let k=await(i?P(j,R):P(p,H));const N=c&&(w==="stream"||w==="response");if(c&&(_||N&&K)){const O={};["status","statusText","headers"].forEach(te=>{O[te]=k[te]});const F=C.toFiniteNumber(k.headers.get("content-length")),[Z,se]=_&&lg(F,Va(ug(_),!0))||[];k=new s(dg(k.body,hg,Z,()=>{se&&se(),K&&K()}),O)}w=w||"text";let B=await d[C.findKey(d,w)||"text"](k,f);return!N&&K&&K(),await new Promise((O,F)=>{Fy(O,F,{data:B,headers:St.from(k.headers),status:k.status,statusText:k.statusText,config:f,request:j})})}catch(M){throw K&&K(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new ie("Network Error",ie.ERR_NETWORK,f,j),{cause:M.cause||M}):ie.from(M,M&&M.code,f,j)}}},Fw=new Map,$y=r=>{let e=r&&r.env||{};const{fetch:t,Request:s,Response:n}=e,i=[s,n,t];let o=i.length,a=o,l,u,c=Fw;for(;a--;)l=i[a],u=c.get(l),u===void 0&&c.set(l,u=a?new Map:Nw(e)),c=u;return u};$y();const hh={http:Z_,xhr:Lw,fetch:{get:$y}};C.forEach(hh,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const mg=r=>`- ${r}`,Mw=r=>C.isFunction(r)||r===null||r===!1;function Uw(r,e){r=C.isArray(r)?r:[r];const{length:t}=r;let s,n;const i={};for(let o=0;o<t;o++){s=r[o];let a;if(n=s,!Mw(s)&&(n=hh[(a=String(s)).toLowerCase()],n===void 0))throw new ie(`Unknown adapter '${a}'`);if(n&&(C.isFunction(n)||(n=n.get(e))))break;i[a||"#"+o]=n}if(!n){const o=Object.entries(i).map(([l,u])=>`adapter ${l} `+(u===!1?"is not supported by the environment":"is not available in the build"));let a=t?o.length>1?`since :
`+o.map(mg).join(`
`):" "+mg(o[0]):"as no adapter specified";throw new ie("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n}const By={getAdapter:Uw,adapters:hh};function lu(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Wn(null,r)}function yg(r){return lu(r),r.headers=St.from(r.headers),r.data=au.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),By.getAdapter(r.adapter||co.adapter,r)(r).then(function(s){return lu(r),s.data=au.call(r,r.transformResponse,s),s.headers=St.from(s.headers),s},function(s){return Ny(s)||(lu(r),s&&s.response&&(s.response.data=au.call(r,r.transformResponse,s.response),s.response.headers=St.from(s.response.headers))),Promise.reject(s)})}const jy="1.13.2",Al={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Al[r]=function(s){return typeof s===r||"a"+(e<1?"n ":" ")+r}});const vg={};Al.transitional=function(e,t,s){function n(i,o){return"[Axios v"+jy+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,a)=>{if(e===!1)throw new ie(n(o," has been removed"+(t?" in "+t:"")),ie.ERR_DEPRECATED);return t&&!vg[o]&&(vg[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,o,a):!0}};Al.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function $w(r,e,t){if(typeof r!="object")throw new ie("options must be an object",ie.ERR_BAD_OPTION_VALUE);const s=Object.keys(r);let n=s.length;for(;n-- >0;){const i=s[n],o=e[i];if(o){const a=r[i],l=a===void 0||o(a,i,r);if(l!==!0)throw new ie("option "+i+" must be "+l,ie.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ie("Unknown option "+i,ie.ERR_BAD_OPTION)}}const da={assertOptions:$w,validators:Al},lr=da.validators;let Ps=class{constructor(e){this.defaults=e||{},this.interceptors={request:new og,response:new og}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=$s(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:i}=t;s!==void 0&&da.assertOptions(s,{silentJSONParsing:lr.transitional(lr.boolean),forcedJSONParsing:lr.transitional(lr.boolean),clarifyTimeoutError:lr.transitional(lr.boolean)},!1),n!=null&&(C.isFunction(n)?t.paramsSerializer={serialize:n}:da.assertOptions(n,{encode:lr.function,serialize:lr.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),da.assertOptions(t,{baseUrl:lr.spelling("baseURL"),withXsrfToken:lr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&C.merge(i.common,i[t.method]);i&&C.forEach(["delete","get","head","post","put","patch","common"],f=>{delete i[f]}),t.headers=St.concat(o,i);const a=[];let l=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(t)===!1||(l=l&&p.synchronous,a.unshift(p.fulfilled,p.rejected))});const u=[];this.interceptors.response.forEach(function(p){u.push(p.fulfilled,p.rejected)});let c,d=0,h;if(!l){const f=[yg.bind(this),void 0];for(f.unshift(...a),f.push(...u),h=f.length,c=Promise.resolve(t);d<h;)c=c.then(f[d++],f[d++]);return c}h=a.length;let g=t;for(;d<h;){const f=a[d++],p=a[d++];try{g=f(g)}catch(m){p.call(this,m);break}}try{c=yg.call(this,g)}catch(f){return Promise.reject(f)}for(d=0,h=u.length;d<h;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=$s(this.defaults,e);const t=My(e.baseURL,e.url,e.allowAbsoluteUrls);return Py(t,e.params,e.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(e){Ps.prototype[e]=function(t,s){return this.request($s(s||{},{method:e,url:t,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(e){function t(s){return function(i,o,a){return this.request($s(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}Ps.prototype[e]=t(),Ps.prototype[e+"Form"]=t(!0)});let Bw=class Gy{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const s=this;this.promise.then(n=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](n);s._listeners=null}),this.promise.then=n=>{let i;const o=new Promise(a=>{s.subscribe(a),i=a}).then(n);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,a){s.reason||(s.reason=new Wn(i,o,a),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Gy(function(n){e=n}),cancel:e}}};function jw(r){return function(t){return r.apply(null,t)}}function Gw(r){return C.isObject(r)&&r.isAxiosError===!0}const Uc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Uc).forEach(([r,e])=>{Uc[e]=r});function Ky(r){const e=new Ps(r),t=Sy(Ps.prototype.request,e);return C.extend(t,Ps.prototype,e,{allOwnKeys:!0}),C.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return Ky($s(r,n))},t}const Ne=Ky(co);Ne.Axios=Ps;Ne.CanceledError=Wn;Ne.CancelToken=Bw;Ne.isCancel=Ny;Ne.VERSION=jy;Ne.toFormData=xl;Ne.AxiosError=ie;Ne.Cancel=Ne.CanceledError;Ne.all=function(e){return Promise.all(e)};Ne.spread=jw;Ne.isAxiosError=Gw;Ne.mergeConfig=$s;Ne.AxiosHeaders=St;Ne.formToJSON=r=>Oy(C.isHTMLForm(r)?new FormData(r):r);Ne.getAdapter=By.getAdapter;Ne.HttpStatusCode=Uc;Ne.default=Ne;const{Axios:UC,AxiosError:$C,CanceledError:BC,isCancel:jC,CancelToken:GC,VERSION:KC,all:VC,Cancel:HC,isAxiosError:WC,spread:zC,toFormData:qC,AxiosHeaders:YC,HttpStatusCode:QC,formToJSON:XC,getAdapter:JC,mergeConfig:ZC}=Ne;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kw={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vw=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),zn=(r,e)=>{const t=Ce.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:a="",children:l,...u},c)=>Ce.createElement("svg",{ref:c,...Kw,width:n,height:n,stroke:s,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${Vw(r)}`,a].join(" "),...u},[...e.map(([d,h])=>Ce.createElement(d,h)),...Array.isArray(l)?l:[l]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hw=zn("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ww=zn("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zw=zn("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qw=zn("FileVideo",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=zn("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=zn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Rl(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t}function Qw(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(c){try{u(s.next(c))}catch(d){o(d)}}function l(c){try{u(s.throw(c))}catch(d){o(d)}}function u(c){c.done?i(c.value):n(c.value).then(a,l)}u((s=s.apply(r,e||[])).next())})}const Xw=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class fh extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Jw extends fh{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Sg extends fh{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Tg extends fh{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var $c;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})($c||($c={}));class Zw{constructor(e,{headers:t={},customFetch:s,region:n=$c.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Xw(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Qw(this,arguments,void 0,function*(t,s={}){var n;let i,o;try{const{headers:a,method:l,body:u,signal:c,timeout:d}=s;let h={},{region:g}=s;g||(g=this.region);const f=new URL(`${this.url}/${t}`);g&&g!=="any"&&(h["x-region"]=g,f.searchParams.set("forceFunctionRegion",g));let p;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",p=u):typeof u=="string"?(h["Content-Type"]="text/plain",p=u):typeof FormData<"u"&&u instanceof FormData?p=u:(h["Content-Type"]="application/json",p=JSON.stringify(u)):u&&typeof u!="string"&&!(typeof Blob<"u"&&u instanceof Blob)&&!(u instanceof ArrayBuffer)&&!(typeof FormData<"u"&&u instanceof FormData)?p=JSON.stringify(u):p=u;let m=c;d&&(o=new AbortController,i=setTimeout(()=>o.abort(),d),c?(m=o.signal,c.addEventListener("abort",()=>o.abort())):m=o.signal);const y=yield this.fetch(f.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:p,signal:m}).catch(_=>{throw new Jw(_)}),v=y.headers.get("x-relay-error");if(v&&v==="true")throw new Sg(y);if(!y.ok)throw new Tg(y);let E=((n=y.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),T;return E==="application/json"?T=yield y.json():E==="application/octet-stream"||E==="application/pdf"?T=yield y.blob():E==="text/event-stream"?T=y:E==="multipart/form-data"?T=yield y.formData():T=yield y.text(),{data:T,error:null,response:y}}catch(a){return{data:null,error:a,response:a instanceof Tg||a instanceof Sg?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var ex=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}},tx=class{constructor(r){var e,t;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(e=r.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=r.signal,this.isMaybeSingle=(t=r.isMaybeSingle)!==null&&t!==void 0?t:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,e){return this.headers=new Headers(this.headers),this.headers.set(r,e),this}then(r,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,c=i.statusText;if(i.ok){var d,h;if(t.method!=="HEAD"){var g;const y=await i.text();y===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((g=t.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?a=y:a=JSON.parse(y))}const p=(d=t.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),m=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");p&&m&&m.length>1&&(l=parseInt(m[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,c="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var f;const p=await i.text();try{o=JSON.parse(p),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,c="OK")}catch{i.status===404&&p===""?(u=204,c="No Content"):o={message:p}}if(o&&t.isMaybeSingle&&(!(o==null||(f=o.details)===null||f===void 0)&&f.includes("0 rows"))&&(o=null,u=200,c="OK"),o&&t.shouldThrowOnError)throw new ex(o)}return{error:o,data:a,count:l,status:u,statusText:c}});return this.shouldThrowOnError||(n=n.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,c,d,h;const f=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",p=(c=l==null?void 0:l.code)!==null&&c!==void 0?c:"";a=`${(d=i==null?void 0:i.name)!==null&&d!==void 0?d:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${f}`,p&&(a+=` (${p})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var g;a=(g=i==null?void 0:i.stack)!==null&&g!==void 0?g:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),n.then(r,e)}returns(){return this}overrideTypes(){return this}},rx=class extends tx{select(r){let e=!1;const t=(r??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${r}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){const s=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(s,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"offset":`${s}.offset`,i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${r}`),this.url.searchParams.set(i,`${e-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[r?"analyze":null,e?"verbose":null,t?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};const _g=new RegExp("[,()]");var rn=class extends rx{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}regexMatch(r,e){return this.url.searchParams.append(r,`match.${e}`),this}regexIMatch(r,e){return this.url.searchParams.append(r,`imatch.${e}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}isDistinct(r,e){return this.url.searchParams.append(r,`isdistinct.${e}`),this}in(r,e){const t=Array.from(new Set(e)).map(s=>typeof s=="string"&&_g.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}notIn(r,e){const t=Array.from(new Set(e)).map(s=>typeof s=="string"&&_g.test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(r,`not.in.(${t})`),this}contains(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return typeof e=="string"?this.url.searchParams.append(r,`ov.${e}`):this.url.searchParams.append(r,`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const i=t===void 0?"":`(${t})`;return this.url.searchParams.append(r,`${n}fts${i}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){const s=t?`${t}.or`:"or";return this.url.searchParams.append(s,`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}},sx=class{constructor(r,{headers:e={},schema:t,fetch:s}){this.url=r,this.headers=new Headers(e),this.schema=t,this.fetch=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(r,e){const{head:t=!1,count:s}=e??{},n=t?"HEAD":"GET";let i=!1;const o=(r??"*").split("").map(u=>/\s/.test(u)&&!i?"":(u==='"'&&(i=!i),u)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),s&&l.append("Prefer",`count=${s}`),new rn({method:n,url:a,headers:l,schema:this.schema,fetch:this.fetch})}insert(r,{count:e,defaultToNull:t=!0}={}){var s;const n="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),t||o.append("Prefer","missing=default"),Array.isArray(r)){const a=r.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);i.searchParams.set("columns",l.join(","))}}return new rn({method:n,url:i,headers:o,schema:this.schema,body:r,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:s,defaultToNull:n=!0}={}){var i;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),s&&l.append("Prefer",`count=${s}`),n||l.append("Prefer","missing=default"),Array.isArray(r)){const u=r.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(u.length>0){const c=[...new Set(u)].map(d=>`"${d}"`);a.searchParams.set("columns",c.join(","))}}return new rn({method:o,url:a,headers:l,schema:this.schema,body:r,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(r,{count:e}={}){var t;const s="PATCH",{url:n,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new rn({method:s,url:n,headers:i,schema:this.schema,body:r,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:r}={}){var e;const t="DELETE",{url:s,headers:n}=this.cloneRequestState();return r&&n.append("Prefer",`count=${r}`),new rn({method:t,url:s,headers:n,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},nx=class Vy{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=n}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new sx(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Vy(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;const c=g=>g!==null&&typeof g=="object"&&(!Array.isArray(g)||g.some(c)),d=s&&Object.values(t).some(c);d?(a="POST",u=t):s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([g,f])=>f!==void 0).map(([g,f])=>[g,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([g,f])=>{l.searchParams.append(g,f)})):(a="POST",u=t);const h=new Headers(this.headers);return d?h.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&h.set("Prefer",`count=${i}`),new rn({method:a,url:l,headers:h,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class ix{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const s=t.versions;if(s&&s.node){const n=s.node,i=parseInt(n.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ox="2.90.1",ax=`realtime-js/${ox}`,Hy="1.0.0",lx="2.0.0",wg=Hy,Bc=1e4,ux=1e3,cx=100;var Gr;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Gr||(Gr={}));var Ue;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ue||(Ue={}));var Zt;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Zt||(Zt={}));var jc;(function(r){r.websocket="websocket"})(jc||(jc={}));var ws;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ws||(ws={}));class dx{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let s=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(s))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;const n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,n)}_encodeJsonUserBroadcastPush(e){var t,s;const n=(s=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&s!==void 0?s:{},o=new TextEncoder().encode(JSON.stringify(n)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,s){var n,i;const o=e.topic,a=(n=e.ref)!==null&&n!==void 0?n:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(c).length===0?"":JSON.stringify(c);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+d.length,g=new ArrayBuffer(this.HEADER_LENGTH+h);let f=new DataView(g),p=0;f.setUint8(p++,this.KINDS.userBroadcastPush),f.setUint8(p++,l.length),f.setUint8(p++,a.length),f.setUint8(p++,o.length),f.setUint8(p++,u.length),f.setUint8(p++,d.length),f.setUint8(p++,t),Array.from(l,y=>f.setUint8(p++,y.charCodeAt(0))),Array.from(a,y=>f.setUint8(p++,y.charCodeAt(0))),Array.from(o,y=>f.setUint8(p++,y.charCodeAt(0))),Array.from(u,y=>f.setUint8(p++,y.charCodeAt(0))),Array.from(d,y=>f.setUint8(p++,y.charCodeAt(0)));var m=new Uint8Array(g.byteLength+s.byteLength);return m.set(new Uint8Array(g),0),m.set(new Uint8Array(s),g.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e)){let s=this._binaryDecode(e);return t(s)}if(typeof e=="string"){const s=JSON.parse(e),[n,i,o,a,l]=s;return t({join_ref:n,ref:i,topic:o,event:a,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),s=t.getUint8(0),n=new TextDecoder;switch(s){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,n)}}_decodeUserBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2),o=t.getUint8(3),a=t.getUint8(4);let l=this.HEADER_LENGTH+4;const u=s.decode(e.slice(l,l+n));l=l+n;const c=s.decode(e.slice(l,l+i));l=l+i;const d=s.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),g=a===this.JSON_ENCODING?JSON.parse(s.decode(h)):h,f={type:this.BROADCAST_EVENT,event:c,payload:g};return o>0&&(f.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([s])=>t.includes(s)))}}class Wy{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ye;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(ye||(ye={}));const xg=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=hx(o,r,e,n),i),{}):{}},hx=(r,e,t,s)=>{const n=e.find(a=>a.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?zy(i,o):Gc(o)},zy=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return mx(e,t)}switch(r){case ye.bool:return fx(e);case ye.float4:case ye.float8:case ye.int2:case ye.int4:case ye.int8:case ye.numeric:case ye.oid:return gx(e);case ye.json:case ye.jsonb:return px(e);case ye.timestamp:return yx(e);case ye.abstime:case ye.date:case ye.daterange:case ye.int4range:case ye.int8range:case ye.money:case ye.reltime:case ye.text:case ye.time:case ye.timestamptz:case ye.timetz:case ye.tsrange:case ye.tstzrange:return Gc(e);default:return Gc(e)}},Gc=r=>r,fx=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},gx=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},px=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{return r}return r},mx=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>zy(e,a))}return r},yx=r=>typeof r=="string"?r.replace(" ","T"):r,qy=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class uu{constructor(e,t,s={},n=Bc){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ag;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ag||(Ag={}));class Ti{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ti.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=Ti.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ti.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const d=i[u];if(d){const h=c.map(m=>m.presence_ref),g=d.map(m=>m.presence_ref),f=c.filter(m=>g.indexOf(m.presence_ref)<0),p=d.filter(m=>h.indexOf(m.presence_ref)<0);f.length>0&&(a[u]=f),p.length>0&&(l[u]=p)}else a[u]=c}),this.syncDiff(i,{joins:a,leaves:l},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var u;const c=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),c.length>0){const d=e[a].map(g=>g.presence_ref),h=c.filter(g=>d.indexOf(g.presence_ref)<0);e[a].unshift(...h)}s(a,c,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const c=l.map(d=>d.presence_ref);u=u.filter(d=>c.indexOf(d.presence_ref)<0),e[a]=u,n(a,u,l),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Rg;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Rg||(Rg={}));var _i;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(_i||(_i={}));var xr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(xr||(xr={}));class En{constructor(e,t={config:{}},s){var n,i;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Ue.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new uu(this,Zt.join,this.params,this.timeout),this.rejoinTimer=new Wy(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ue.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ue.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ue.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ue.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ue.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Zt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new Ti(this),this.broadcastEndpointURL=qy(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(n=this.params.config)===null||n===void 0?void 0:n.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Ue.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(g=>g.filter))!==null&&n!==void 0?n:[],c=!!this.bindings[_i.PRESENCE]&&this.bindings[_i.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(g=>e==null?void 0:e(xr.CHANNEL_ERROR,g)),this._onClose(()=>e==null?void 0:e(xr.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var f;if(this.socket._isManualToken()||this.socket.setAuth(),g===void 0){e==null||e(xr.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,m=(f=p==null?void 0:p.length)!==null&&f!==void 0?f:0,y=[];for(let v=0;v<m;v++){const E=p[v],{filter:{event:T,schema:_,table:x,filter:w}}=E,A=g&&g[v];if(A&&A.event===T&&En.isFilterValueEqual(A.schema,_)&&En.isFilterValueEqual(A.table,x)&&En.isFilterValueEqual(A.filter,w))y.push(Object.assign(Object.assign({},E),{id:A.id}));else{this.unsubscribe(),this.state=Ue.errored,e==null||e(xr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(xr.SUBSCRIBED);return}}).receive("error",g=>{this.state=Ue.errored,e==null||e(xr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(xr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Ue.joined&&e===_i.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var n;if(t==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ue.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Zt.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(n=>{s=new uu(this,Zt.leave,{},e),s.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ue.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new uu(this,e,t,s);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>cx){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=Zt;if(s&&[a,l,u,c].indexOf(o)>=0&&s!==this._joinRef())return;let h=this._onMessage(o,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(g=>{var f,p,m;return((f=g.filter)===null||f===void 0?void 0:f.event)==="*"||((m=(p=g.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(g=>g.callback(h,s)):(i=this.bindings[o])===null||i===void 0||i.filter(g=>{var f,p,m,y,v,E,T,_;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const x=g.id,w=(f=g.filter)===null||f===void 0?void 0:f.event;return x&&((p=t.ids)===null||p===void 0?void 0:p.includes(x))&&(w==="*"||(w==null?void 0:w.toLocaleLowerCase())===((m=t.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))&&(!(!((y=g.filter)===null||y===void 0)&&y.table)||g.filter.table===((v=t.data)===null||v===void 0?void 0:v.table))}else{const x=(T=(E=g==null?void 0:g.filter)===null||E===void 0?void 0:E.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return x==="*"||x===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof h=="object"&&"ids"in h){const f=h.data,{schema:p,table:m,commit_timestamp:y,type:v,errors:E}=f;h=Object.assign(Object.assign({},{schema:p,table:m,commit_timestamp:y,eventType:v,new:{},old:{},errors:E}),this._getPayloadRecords(f))}g.callback(h,s)})}_isClosed(){return this.state===Ue.closed}_isJoined(){return this.state===Ue.joined}_isJoining(){return this.state===Ue.joining}_isLeaving(){return this.state===Ue.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&En.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Zt.close,{},e)}_onError(e){this._on(Zt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ue.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=xg(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=xg(e.columns,e.old_record)),t}}const cu=()=>{},Po={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},vx=[1e3,2e3,5e3,1e4],Ex=1e4,Sx=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Tx{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bc,this.transport=null,this.heartbeatIntervalMs=Po.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=cu,this.ref=0,this.reconnectTimer=null,this.vsn=wg,this.logger=cu,this.conn=null,this.sendBuffer=[],this.serializer=new dx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=n=>n?(...i)=>n(...i):(...i)=>fetch(...i),!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${jc.websocket}`,this.httpEndpoint=qy(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ix.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Gr.connecting:return ws.Connecting;case Gr.open:return ws.Open;case Gr.closing:return ws.Closing;default:return ws.Closed}}isConnected(){return this.connectionState()===ws.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,n=this.getChannels().find(i=>i.topic===s);if(n)return n;{const i=new En(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ux,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Po.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const u=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",u)}catch(c){this.log("error","error in heartbeat callback",c)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:s,event:n,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${s} ${n} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(s)).forEach(u=>u._trigger(n,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Gr.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Gr.open||this.conn.readyState===Gr.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Zt.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Sx],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,s=!1;if(e)t=e,s=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(n){this.log("error","Error fetching access token from callback",n),t=this.accessTokenValue}else t=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:ax};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(Zt.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Wy(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Po.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,n,i,o,a,l,u,c,d,h,g;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:Bc,this.heartbeatIntervalMs=(n=e==null?void 0:e.heartbeatIntervalMs)!==null&&n!==void 0?n:Po.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:cu,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:wg,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:f=>vx[f-1]||Ex,this.vsn){case Hy:this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(f,p)=>p(JSON.stringify(f)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(f,p)=>p(JSON.parse(f));break;case lx:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Ki=class extends Error{constructor(r,e){var t;super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function _x(r,e,t){const s=new URL(e,r);if(t)for(const[n,i]of Object.entries(t))i!==void 0&&s.searchParams.set(n,i);return s.toString()}async function wx(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function xx(r){const e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:s,query:n,body:i,headers:o}){const a=_x(r.baseUrl,s,n),l=await wx(r.auth),u=await e(a,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),c=await u.text(),d=(u.headers.get("content-type")||"").includes("application/json"),h=d&&c?JSON.parse(c):c;if(!u.ok){const g=d?h:void 0,f=g==null?void 0:g.error;throw new Ki((f==null?void 0:f.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:f==null?void 0:f.type,icebergCode:f==null?void 0:f.code,details:g})}return{status:u.status,headers:u.headers,data:h}}}}function Do(r){return r.join("")}var Ax=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){const e=r?{parent:Do(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(s=>({namespace:s}))}async createNamespace(r,e){const t={namespace:r.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Do(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Do(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Do(r.namespace)}`}),!0}catch(e){if(e instanceof Ki&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof Ki&&t.status===409)return;throw t}}};function Hs(r){return r.join("")}var Rx=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(r){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Hs(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof Ki&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof Ki&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},Ix=class{constructor(r){var s;let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);const t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=xx({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=(s=r.accessDelegation)==null?void 0:s.join(","),this.namespaceOps=new Ax(this.client,e),this.tableOps=new Rx(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},Il=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function we(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var bx=class extends Il{constructor(r,e,t){super(r),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Kc=class extends Il{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}};const gh=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Lx=()=>Response,Vc=r=>{if(Array.isArray(r))return r.map(t=>Vc(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Vc(s)}),e},kx=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Cx=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);function Vi(r){"@babel/helpers - typeof";return Vi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vi(r)}function Px(r,e){if(Vi(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(Vi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Dx(r){var e=Px(r,"string");return Vi(e)=="symbol"?e:e+""}function Ox(r,e,t){return(e=Dx(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ig(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,s)}return t}function J(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ig(Object(t),!0).forEach(function(s){Ox(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ig(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}const du=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},Nx=async(r,e,t)=>{r instanceof await Lx()&&!(t!=null&&t.noResolveJson)?r.json().then(s=>{const n=r.status||500,i=(s==null?void 0:s.statusCode)||n+"";e(new bx(du(s),n,i))}).catch(s=>{e(new Kc(du(s),s))}):e(new Kc(du(r),r))},Fx=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!s?n:(kx(s)?(n.headers=J({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,e!=null&&e.duplex&&(n.duplex=e.duplex),J(J({},n),t))};async function ho(r,e,t,s,n,i){return new Promise((o,a)=>{r(t,Fx(e,s,n,i)).then(l=>{if(!l.ok)throw l;return s!=null&&s.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Nx(l,a,s))})}async function Hi(r,e,t,s){return ho(r,"GET",e,t,s)}async function Xt(r,e,t,s,n){return ho(r,"POST",e,s,n,t)}async function Hc(r,e,t,s,n){return ho(r,"PUT",e,s,n,t)}async function Mx(r,e,t,s){return ho(r,"HEAD",e,J(J({},t),{},{noResolveJson:!0}),s)}async function ph(r,e,t,s,n){return ho(r,"DELETE",e,s,n,t)}var Ux=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e}then(r,e){return this.execute().then(r,e)}async execute(){var r=this;try{return{data:(await r.downloadFn()).body,error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(we(e))return{data:null,error:e};throw e}}};let Yy;Yy=Symbol.toStringTag;var $x=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e,this[Yy]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ux(this.downloadFn,this.shouldThrowOnError)}then(r,e){return this.getPromise().then(r,e)}catch(r){return this.getPromise().catch(r)}finally(r){return this.getPromise().finally(r)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var r=this;try{return{data:await(await r.downloadFn()).blob(),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(we(e))return{data:null,error:e};throw e}}};const Bx={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},bg={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var jx=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1,this.url=r,this.headers=e,this.bucketId=t,this.fetch=gh(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(r,e,t,s){var n=this;try{let i;const o=J(J({},bg),s);let a=J(J({},n.headers),r==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",n.encodeMetadata(l)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(l))):(i=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=n.toBase64(n.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),s!=null&&s.headers&&(a=J(J({},a),s.headers));const u=n._removeEmptyFolders(e),c=n._getFinalPath(u),d=await(r=="PUT"?Hc:Xt)(n.fetch,`${n.url}/object/${c}`,i,J({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(we(i))return{data:null,error:i};throw i}}async upload(r,e,t){return this.uploadOrUpdate("POST",r,e,t)}async uploadToSignedUrl(r,e,t,s){var n=this;const i=n._removeEmptyFolders(r),o=n._getFinalPath(i),a=new URL(n.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=J({upsert:bg.upsert},s),c=J(J({},n.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",u.cacheControl)):(l=t,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType),{data:{path:i,fullPath:(await Hc(n.fetch,a.toString(),l,{headers:c})).Key},error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(we(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(r,e){var t=this;try{let s=t._getFinalPath(r);const n=J({},t.headers);e!=null&&e.upsert&&(n["x-upsert"]="true");const i=await Xt(t.fetch,`${t.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(t.url+i.url),a=o.searchParams.get("token");if(!a)throw new Il("No token returned by API");return{data:{signedUrl:o.toString(),path:r,token:a},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(we(s))return{data:null,error:s};throw s}}async update(r,e,t){return this.uploadOrUpdate("PUT",r,e,t)}async move(r,e,t){var s=this;try{return{data:await Xt(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:s.headers}),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(we(n))return{data:null,error:n};throw n}}async copy(r,e,t){var s=this;try{return{data:{path:(await Xt(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:s.headers})).Key},error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(we(n))return{data:null,error:n};throw n}}async createSignedUrl(r,e,t){var s=this;try{let n=s._getFinalPath(r),i=await Xt(s.fetch,`${s.url}/object/sign/${n}`,J({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:s.headers});const o=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return i={signedUrl:encodeURI(`${s.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(we(n))return{data:null,error:n};throw n}}async createSignedUrls(r,e,t){var s=this;try{const n=await Xt(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:e,paths:r},{headers:s.headers}),i=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{data:n.map(o=>J(J({},o),{},{signedUrl:o.signedURL?encodeURI(`${s.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(we(n))return{data:null,error:n};throw n}}download(r,e){const t=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),n=s?`?${s}`:"",i=this._getFinalPath(r),o=()=>Hi(this.fetch,`${this.url}/${t}/${i}${n}`,{headers:this.headers,noResolveJson:!0});return new $x(o,this.shouldThrowOnError)}async info(r){var e=this;const t=e._getFinalPath(r);try{return{data:Vc(await Hi(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(we(s))return{data:null,error:s};throw s}}async exists(r){var e=this;const t=e._getFinalPath(r);try{return await Mx(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(we(s)&&s instanceof Kc){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}}getPublicUrl(r,e){const t=this._getFinalPath(r),s=[],n=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&s.push(o);let a=s.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${t}${a}`)}}}async remove(r){var e=this;try{return{data:await ph(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async list(r,e,t){var s=this;try{const n=J(J(J({},Bx),e),{},{prefix:r||""});return{data:await Xt(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},t),error:null}}catch(n){if(s.shouldThrowOnError)throw n;if(we(n))return{data:null,error:n};throw n}}async listV2(r,e){var t=this;try{const s=J({},r);return{data:await Xt(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,s,{headers:t.headers},e),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(we(s))return{data:null,error:s};throw s}}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}};const Qy="2.90.1",Xy={"X-Client-Info":`storage-js/${Qy}`};var Gx=class{constructor(r,e={},t,s){this.shouldThrowOnError=!1;const n=new URL(r);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=J(J({},Xy),e),this.fetch=gh(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(r){var e=this;try{const t=e.listBucketOptionsToQueryString(r);return{data:await Hi(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await Hi(e.fetch,`${e.url}/bucket/${r}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async createBucket(r,e={public:!1}){var t=this;try{return{data:await Xt(t.fetch,`${t.url}/bucket`,{id:r,name:r,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(we(s))return{data:null,error:s};throw s}}async updateBucket(r,e){var t=this;try{return{data:await Hc(t.fetch,`${t.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(we(s))return{data:null,error:s};throw s}}async emptyBucket(r){var e=this;try{return{data:await Xt(e.fetch,`${e.url}/bucket/${r}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await ph(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(r){const e={};return r&&("limit"in r&&(e.limit=String(r.limit)),"offset"in r&&(e.offset=String(r.offset)),r.search&&(e.search=r.search),r.sortColumn&&(e.sortColumn=r.sortColumn),r.sortOrder&&(e.sortOrder=r.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Kx=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=J(J({},Xy),e),this.fetch=gh(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await Xt(e.fetch,`${e.url}/bucket`,{name:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async listBuckets(r){var e=this;try{const t=new URLSearchParams;(r==null?void 0:r.limit)!==void 0&&t.set("limit",r.limit.toString()),(r==null?void 0:r.offset)!==void 0&&t.set("offset",r.offset.toString()),r!=null&&r.sortColumn&&t.set("sortColumn",r.sortColumn),r!=null&&r.sortOrder&&t.set("sortOrder",r.sortOrder),r!=null&&r.search&&t.set("search",r.search);const s=t.toString(),n=s?`${e.url}/bucket?${s}`:`${e.url}/bucket`;return{data:await Hi(e.fetch,n,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await ph(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(we(t))return{data:null,error:t};throw t}}from(r){var e=this;if(!Cx(r))throw new Il("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new Ix({baseUrl:this.url,catalogName:r,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(t,{get(n,i){const o=n[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(n,a),error:null}}catch(l){if(s)throw l;return{data:null,error:l}}}}})}};const mh={"X-Client-Info":`storage-js/${Qy}`,"Content-Type":"application/json"};var Jy=class extends Error{constructor(r){super(r),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function It(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var hu=class extends Jy{constructor(r,e,t){super(r),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Vx=class extends Jy{constructor(r,e){super(r),this.name="StorageVectorsUnknownError",this.originalError=e}};const yh=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),Hx=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Lg=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Wx=async(r,e,t)=>{if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const s=r.status||500,n=r;if(typeof n.json=="function")n.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||s+"";e(new hu(Lg(i),s,o))}).catch(()=>{const i=s+"";e(new hu(n.statusText||`HTTP ${s} error`,s,i))});else{const i=s+"";e(new hu(n.statusText||`HTTP ${s} error`,s,i))}}else e(new Vx(Lg(r),r))},zx=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return s?(Hx(s)?(n.headers=J({"Content-Type":"application/json"},e==null?void 0:e.headers),n.body=JSON.stringify(s)):n.body=s,J(J({},n),t)):n};async function qx(r,e,t,s,n,i){return new Promise((o,a)=>{r(t,zx(e,s,n,i)).then(l=>{if(!l.ok)throw l;if(s!=null&&s.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>Wx(l,a,s))})}async function bt(r,e,t,s,n){return qx(r,"POST",e,s,n,t)}var Yx=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=J(J({},mh),e),this.fetch=yh(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/CreateIndex`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async getIndex(r,e){var t=this;try{return{data:await bt(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(It(s))return{data:null,error:s};throw s}}async listIndexes(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/ListIndexes`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async deleteIndex(r,e){var t=this;try{return{data:await bt(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(It(s))return{data:null,error:s};throw s}}},Qx=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=J(J({},mh),e),this.fetch=yh(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(r){var e=this;try{if(r.vectors.length<1||r.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await bt(e.fetch,`${e.url}/PutVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async getVectors(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/GetVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async listVectors(r){var e=this;try{if(r.segmentCount!==void 0){if(r.segmentCount<1||r.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(r.segmentIndex!==void 0&&(r.segmentIndex<0||r.segmentIndex>=r.segmentCount))throw new Error(`segmentIndex must be between 0 and ${r.segmentCount-1}`)}return{data:await bt(e.fetch,`${e.url}/ListVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async queryVectors(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/QueryVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async deleteVectors(r){var e=this;try{if(r.keys.length<1||r.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await bt(e.fetch,`${e.url}/DeleteVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}},Xx=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=J(J({},mh),e),this.fetch=yh(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async listBuckets(r={}){var e=this;try{return{data:await bt(e.fetch,`${e.url}/ListVectorBuckets`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await bt(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(It(t))return{data:null,error:t};throw t}}},Jx=class extends Xx{constructor(r,e={}){super(r,e.headers||{},e.fetch)}from(r){return new Zx(this.url,this.headers,r,this.fetch)}async createBucket(r){var e=()=>super.createBucket,t=this;return e().call(t,r)}async getBucket(r){var e=()=>super.getBucket,t=this;return e().call(t,r)}async listBuckets(r={}){var e=()=>super.listBuckets,t=this;return e().call(t,r)}async deleteBucket(r){var e=()=>super.deleteBucket,t=this;return e().call(t,r)}},Zx=class extends Yx{constructor(r,e,t,s){super(r,e,s),this.vectorBucketName=t}async createIndex(r){var e=()=>super.createIndex,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(r={}){var e=()=>super.listIndexes,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(r){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,r)}async deleteIndex(r){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,r)}index(r){return new eA(this.url,this.headers,this.vectorBucketName,r,this.fetch)}},eA=class extends Qx{constructor(r,e,t,s,n){super(r,e,n),this.vectorBucketName=t,this.indexName=s}async putVectors(r){var e=()=>super.putVectors,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(r){var e=()=>super.getVectors,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(r={}){var e=()=>super.listVectors,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(r){var e=()=>super.queryVectors,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(r){var e=()=>super.deleteVectors,t=this;return e().call(t,J(J({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},tA=class extends Gx{constructor(r,e={},t,s){super(r,e,t,s)}from(r){return new jx(this.url,this.headers,r,this.fetch)}get vectors(){return new Jx(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Kx(this.url+"/iceberg",this.headers,this.fetch)}};const Zy="2.90.1",sn=30*1e3,Wc=3,fu=Wc*sn,rA="http://localhost:9999",sA="supabase.auth.token",nA={"X-Client-Info":`gotrue-js/${Zy}`},zc="X-Supabase-Api-Version",ev={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},iA=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,oA=10*60*1e3;class Wi extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Y(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class aA extends Wi{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function lA(r){return Y(r)&&r.name==="AuthApiError"}class xs extends Wi{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Fr extends Wi{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class Tt extends Fr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function uA(r){return Y(r)&&r.name==="AuthSessionMissingError"}class Ws extends Fr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Oo extends Fr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class No extends Fr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function cA(r){return Y(r)&&r.name==="AuthImplicitGrantRedirectError"}class kg extends Fr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class dA extends Fr{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class qc extends Fr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function gu(r){return Y(r)&&r.name==="AuthRetryableFetchError"}class Cg extends Fr{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Yc extends Fr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ha="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Pg=` 	
\r=`.split(""),hA=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Pg.length;e+=1)r[Pg[e].charCodeAt(0)]=-2;for(let e=0;e<Ha.length;e+=1)r[Ha[e].charCodeAt(0)]=e;return r})();function Dg(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ha[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(Ha[s]),e.queuedBits-=6}}function tv(r,e,t){const s=hA[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Og(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{pA(o,s,t)};for(let o=0;o<r.length;o+=1)tv(r.charCodeAt(o),n,i);return e.join("")}function fA(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function gA(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}fA(s,e)}}function pA(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function In(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)tv(r.charCodeAt(n),t,s);return new Uint8Array(e)}function mA(r){const e=[];return gA(r,t=>e.push(t)),new Uint8Array(e)}function Ls(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};return r.forEach(n=>Dg(n,t,s)),Dg(null,t,s),e.join("")}function yA(r){return Math.round(Date.now()/1e3)+r}function vA(){return Symbol("auth-callback")}const qe=()=>typeof window<"u"&&typeof document<"u",ps={tested:!1,writable:!1},rv=()=>{if(!qe())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ps.tested)return ps.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ps.tested=!0,ps.writable=!0}catch{ps.tested=!0,ps.writable=!1}return ps.writable};function EA(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const sv=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),SA=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",nn=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ms=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ze=async(r,e)=>{await r.removeItem(e)};class bl{constructor(){this.promise=new bl.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}bl.promiseConstructor=Promise;function pu(r){const e=r.split(".");if(e.length!==3)throw new Yc("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!iA.test(e[s]))throw new Yc("JWT not in base64url format");return{header:JSON.parse(Og(e[0])),payload:JSON.parse(Og(e[1])),signature:In(e[2]),raw:{header:e[0],payload:e[1]}}}async function TA(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function _A(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function wA(r){return("0"+r.toString(16)).substr(-2)}function xA(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,wA).join("")}async function AA(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function RA(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await AA(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function zs(r,e,t=!1){const s=xA();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await nn(r,`${e}-code-verifier`,n);const i=await RA(s);return[i,s===i?"plain":"s256"]}const IA=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function bA(r){const e=r.headers.get(zc);if(!e||!e.match(IA))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function LA(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function kA(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const CA=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function qs(r){if(!CA.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function mu(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function PA(r,e){return new Proxy(r,{get:(t,s,n)=>{if(s==="__isInsecureUserWarningProxy")return!0;if(typeof s=="symbol"){const i=s.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,s,n)}return!e.value&&typeof s=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,s,n)}})}function Ng(r){return JSON.parse(JSON.stringify(r))}const Ts=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),DA=[502,503,504];async function Fg(r){var e;if(!SA(r))throw new qc(Ts(r),0);if(DA.includes(r.status))throw new qc(Ts(r),r.status);let t;try{t=await r.json()}catch(i){throw new xs(Ts(i),i)}let s;const n=bA(r);if(n&&n.getTime()>=ev["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Cg(Ts(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Tt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Cg(Ts(t),r.status,t.weak_password.reasons);throw new aA(Ts(t),r.status||500,s)}const OA=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function X(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[zc]||(i[zc]=ev["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await NA(r,e,t+a,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function NA(r,e,t,s,n,i){const o=OA(e,s,n,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new qc(Ts(l),0)}if(a.ok||await Fg(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(l){await Fg(l)}}function qt(r){var e;let t=null;UA(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=yA(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Mg(r){const e=qt(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function zr(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function FA(r){return{data:r,error:null}}function MA(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=Rl(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Ug(r){return r}function UA(r){return r.access_token&&r.refresh_token&&r.expires_in}const yu=["global","local","others"];class $A{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=sv(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=yu[0]){if(yu.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${yu.join(", ")}`);try{return await X(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Y(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await X(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:zr})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Rl(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await X(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:MA,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Y(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await X(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:zr})}catch(t){if(Y(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},c=await X(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ug});if(c.error)throw c.error;const d=await c.json(),h=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(f.split(";")[1].split("=")[1]);u[`${m}Page`]=p}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(Y(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){qs(e);try{return await X(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:zr})}catch(t){if(Y(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){qs(e);try{return await X(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:zr})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){qs(e);try{return await X(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:zr})}catch(s){if(Y(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){qs(e.userId);try{const{data:t,error:s}=await X(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _deleteFactor(e){qs(e.userId),qs(e.id);try{return{data:await X(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,s,n,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},c=await X(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Ug});if(c.error)throw c.error;const d=await c.json(),h=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(f.split(";")[1].split("=")[1]);u[`${m}Page`]=p}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(Y(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await X(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await X(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await X(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Y(s))return{data:null,error:s};throw s}}async _deleteOAuthClient(e){try{return await X(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Y(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await X(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Y(t))return{data:null,error:t};throw t}}}function $g(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const Ys={debug:!!(globalThis&&rv()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nv extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class BA extends nv{}async function jA(r,e,t){Ys.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Ys.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){Ys.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{Ys.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw Ys.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new BA(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Ys.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function GA(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function iv(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function KA(r){return parseInt(r,16)}function VA(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,s=>s.toString(16).padStart(2,"0")).join("")}function HA(r){var e;const{chainId:t,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:c,uri:d,version:h}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const g=iv(r.address),f=c?`${c}://${s}`:s,p=r.statement?`${r.statement}
`:"",m=`${f} wants you to sign in with your Ethereum account:
${g}

${p}`;let y=`URI: ${d}
Version: ${h}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(n&&(y+=`
Expiration Time: ${n.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),u){let v=`
Resources:`;for(const E of u){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);v+=`
- ${E}`}y+=v}return`${m}
${y}`}class Fe extends Error{constructor({message:e,code:t,cause:s,name:n}){var i;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=(i=n??(s instanceof Error?s.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class Wa extends Fe{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function WA({error:r,options:e}){var t,s,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Fe({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Fe({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Fe({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Fe({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new Fe({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new Fe({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Fe({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new Fe({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const o=window.location.hostname;if(ov(o)){if(i.rp.id!==o)return new Fe({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Fe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Fe({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new Fe({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Fe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function zA({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Fe({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new Fe({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const s=window.location.hostname;if(ov(s)){if(t.rpId!==s)return new Fe({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Fe({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new Fe({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Fe({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class qA{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const YA=new qA;function QA(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:s}=r,n=Rl(r,["challenge","user","excludeCredentials"]),i=In(e).buffer,o=Object.assign(Object.assign({},t),{id:In(t.id).buffer}),a=Object.assign(Object.assign({},n),{challenge:i,user:o});if(s&&s.length>0){a.excludeCredentials=new Array(s.length);for(let l=0;l<s.length;l++){const u=s[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:In(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function XA(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,s=Rl(r,["challenge","allowCredentials"]),n=In(e).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const a=t[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:In(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function JA(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:Ls(new Uint8Array(r.response.attestationObject)),clientDataJSON:Ls(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ZA(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,s=r.getClientExtensionResults(),n=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:Ls(new Uint8Array(n.authenticatorData)),clientDataJSON:Ls(new Uint8Array(n.clientDataJSON)),signature:Ls(new Uint8Array(n.signature)),userHandle:n.userHandle?Ls(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ov(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Bg(){var r,e;return!!(qe()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function eR(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Wa("Browser returned unexpected credential type",e)}:{data:null,error:new Wa("Empty credential response",e)}}catch(e){return{data:null,error:WA({error:e,options:r})}}}async function tR(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Wa("Browser returned unexpected credential type",e)}:{data:null,error:new Wa("Empty credential response",e)}}catch(e){return{data:null,error:zA({error:e,options:r})}}}const rR={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},sR={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function za(...r){const e=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),t=n=>n instanceof ArrayBuffer||ArrayBuffer.isView(n),s={};for(const n of r)if(n)for(const i in n){const o=n[i];if(o!==void 0)if(Array.isArray(o))s[i]=o;else if(t(o))s[i]=o;else if(e(o)){const a=s[i];e(a)?s[i]=za(a,o):s[i]=za(o)}else s[i]=o}return s}function nR(r,e){return za(rR,r,e||{})}function iR(r,e){return za(sR,r,e||{})}class oR{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:n},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:a};const l=n??YA.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${s}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=nR(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:c,error:d}=await eR({publicKey:u,signal:l});return c?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}case"request":{const u=iR(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:c,error:d}=await tR(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return c?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}}}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new xs("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Wi("rpId is required for WebAuthn authentication")};try{if(!Bg())return{data:null,error:new xs("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:n},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:s,credential_response:l.credential_response}})}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new xs("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:s=typeof window<"u"?[window.location.origin]:void 0,signal:n}={}},i){if(!t)return{data:null,error:new Wi("rpId is required for WebAuthn registration")};try{if(!Bg())return{data:null,error:new xs("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(c=>{var d;return(d=c.data)===null||d===void 0?void 0:d.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(c=>c?this.client.mfa.unenroll({factorId:c==null?void 0:c.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:n},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return Y(o)?{data:null,error:o}:{data:null,error:new xs("Unexpected error in register",o)}}}}GA();const aR={url:rA,storageKey:sA,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:nA,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function jg(r,e,t){return await t()}const Qs={};class zi{get jwks(){var e,t;return(t=(e=Qs[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Qs[this.storageKey]=Object.assign(Object.assign({},Qs[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Qs[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Qs[this.storageKey]=Object.assign(Object.assign({},Qs[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},aR),e);if(this.storageKey=i.storageKey,this.instanceID=(t=zi.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,zi.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&qe()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new $A({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=sv(i.fetch),this.lock=i.lock||jg,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&qe()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=jA:this.lock=jg,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new oR(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:rv()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$g(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=$g(this.memoryStorage)),qe()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Zy}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},s="none";if(qe()&&(t=EA(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),qe()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),cA(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Y(t)?this._returnResult({error:t}):this._returnResult({error:new xs("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:qt}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(Y(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:c,password:d,options:h}=e;let g=null,f=null;this.flowType==="pkce"&&([g,f]=await zs(this.storage,this.storageKey)),i=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:c,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:g,code_challenge_method:f},xform:qt})}else if("phone"in e){const{phone:c,password:d,options:h}=e;i=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(n=h==null?void 0:h.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:qt})}else throw new Oo("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await ze(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Mg})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Mg})}else throw new Oo("You must provide either an email or phone number and a password");const{data:s,error:n}=t;if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!s||!s.session||!s.user){const i=new Ws;return this._returnResult({data:{user:null,session:null},error:i})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(Y(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,n,i,o,a,l,u,c,d,h;let g,f;if("message"in e)g=e.message,f=e.signature;else{const{chain:p,wallet:m,statement:y,options:v}=e;let E;if(qe())if(typeof m=="object")E=m;else{const I=window;if("ethereum"in I&&typeof I.ethereum=="object"&&"request"in I.ethereum&&typeof I.ethereum.request=="function")E=I.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=m}const T=new URL((t=v==null?void 0:v.url)!==null&&t!==void 0?t:window.location.href),_=await E.request({method:"eth_requestAccounts"}).then(I=>I).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!_||_.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const x=iv(_[0]);let w=(s=v==null?void 0:v.signInWithEthereum)===null||s===void 0?void 0:s.chainId;if(!w){const I=await E.request({method:"eth_chainId"});w=KA(I)}const A={domain:T.host,address:x,statement:y,uri:T.href,version:"1",chainId:w,nonce:(n=v==null?void 0:v.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(o=(i=v==null?void 0:v.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=v==null?void 0:v.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v==null?void 0:v.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=v==null?void 0:v.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(c=v==null?void 0:v.signInWithEthereum)===null||c===void 0?void 0:c.resources};g=HA(A),f=await E.request({method:"personal_sign",params:[VA(g),x]})}try{const{data:p,error:m}=await X(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:f},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:qt});if(m)throw m;if(!p||!p.session||!p.user){const y=new Ws;return this._returnResult({data:{user:null,session:null},error:y})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:m})}catch(p){if(Y(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,s,n,i,o,a,l,u,c,d,h,g;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:m,wallet:y,statement:v,options:E}=e;let T;if(qe())if(typeof y=="object")T=y;else{const x=window;if("solana"in x&&typeof x.solana=="object"&&("signIn"in x.solana&&typeof x.solana.signIn=="function"||"signMessage"in x.solana&&typeof x.solana.signMessage=="function"))T=x.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(E!=null&&E.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=y}const _=new URL((t=E==null?void 0:E.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in T&&T.signIn){const x=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E==null?void 0:E.signInWithSolana),{version:"1",domain:_.host,uri:_.href}),v?{statement:v}:null));let w;if(Array.isArray(x)&&x[0]&&typeof x[0]=="object")w=x[0];else if(x&&typeof x=="object"&&"signedMessage"in x&&"signature"in x)w=x;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in w&&"signature"in w&&(typeof w.signedMessage=="string"||w.signedMessage instanceof Uint8Array)&&w.signature instanceof Uint8Array)f=typeof w.signedMessage=="string"?w.signedMessage:new TextDecoder().decode(w.signedMessage),p=w.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${_.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${_.href}`,`Issued At: ${(n=(s=E==null?void 0:E.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=E==null?void 0:E.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((o=E==null?void 0:E.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((a=E==null?void 0:E.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((l=E==null?void 0:E.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((u=E==null?void 0:E.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((d=(c=E==null?void 0:E.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||d===void 0)&&d.length?["Resources",...E.signInWithSolana.resources.map(w=>`- ${w}`)]:[]].join(`
`);const x=await T.signMessage(new TextEncoder().encode(f),"utf8");if(!x||!(x instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=x}}try{const{data:m,error:y}=await X(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Ls(p)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:qt});if(y)throw y;if(!m||!m.session||!m.user){const v=new Ws;return this._returnResult({data:{user:null,session:null},error:v})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:y})}catch(m){if(Y(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const t=await ms(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{if(!s&&this.flowType==="pkce")throw new dA;const{data:i,error:o}=await X(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:qt});if(await ze(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new Ws;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:qt}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const c=new Ws;return this._returnResult({data:{user:null,session:null},error:c})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(t){if(Y(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await zs(this.storage,this.storageKey));const{error:d}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:c}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:c})}throw new Oo("You must provide either an email or phone number.")}catch(a){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await X(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:qt});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(n){if(Y(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithSSO(e){var t,s,n,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await zs(this.storage,this.storageKey));const u=await X(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:FA});return!((i=u.data)===null||i===void 0)&&i.url&&qe()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Tt;const{error:n}=await X(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:n})})}catch(e){if(Y(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await X(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await X(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Oo("You must provide either an email or phone number and a type")}catch(t){if(Y(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ms(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<fu:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const o=await ms(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=mu()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=PA(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:zr}):await this._useSession(async t=>{var s,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Tt}:await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:zr})})}catch(t){if(Y(t))return uA(t)&&(await this._removeSession(),await ze(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new Tt;const o=n.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await zs(this.storage,this.storageKey));const{data:u,error:c}=await X(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:zr});if(c)throw c;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(s){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(s))return this._returnResult({data:{user:null},error:s});throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Tt;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=pu(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(Y(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Tt;const{data:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):n?this._returnResult({data:{user:n.user,session:n},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Y(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!qe())throw new No("No browser detected.");if(e.error||e.error_description||e.error_code)throw new No(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new kg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new No("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new kg("No code detected.");const{data:v,error:E}=await this._exchangeCodeForSession(e.code);if(E)throw E;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new No("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(a);let h=c+d;l&&(h=parseInt(l));const g=h-c;g*1e3<=sn&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${d}s`);const f=h-d;c-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,c):c-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,c);const{data:p,error:m}=await this._getUser(i);if(m)throw m;const y={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:d,expires_at:h,refresh_token:o,token_type:u,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:y,redirectType:e.type},error:null})}catch(s){if(Y(s))return this._returnResult({data:{session:null,redirectType:null},error:s});throw s}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ms(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({error:i});const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(lA(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await ze(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=vA(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await zs(this.storage,this.storageKey,!0));try{return await X(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,l,u,c;const{data:d,error:h}=i;if(h)throw h;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await X(this.fetch,"GET",g,{headers:this.headers,jwt:(c=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(n)throw n;return qe()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),this._returnResult({data:{provider:e.provider,url:s==null?void 0:s.url},error:null})}catch(s){if(Y(s))return this._returnResult({data:{provider:e.provider,url:null},error:s});throw s}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{const{error:n,data:{session:i}}=t;if(n)throw n;const{options:o,provider:a,token:l,access_token:u,nonce:c}=e,d=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(s=i==null?void 0:i.access_token)!==null&&s!==void 0?s:void 0,body:{provider:a,id_token:l,access_token:u,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qt}),{data:h,error:g}=d;return g?this._returnResult({data:{user:null,session:null},error:g}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Ws}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:g}))}catch(n){if(await ze(this.storage,`${this.storageKey}-code-verifier`),Y(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await X(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await _A(async n=>(n>0&&await TA(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await X(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qt})),(n,i)=>{const o=200*Math.pow(2,n);return i&&gu(i)&&Date.now()+o-s<sn})}catch(s){if(this._debug(t,"error",s),Y(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),qe()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await ms(this.storage,this.storageKey);if(n&&this.userStorage){let o=await ms(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await nn(this.userStorage,this.storageKey+"-user",o)),n.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:mu()}else if(n&&!n.user&&!n.user){const o=await ms(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(n.user=o.user,await ze(this.storage,this.storageKey+"-user"),await nn(this.storage,this.storageKey,n)):n.user=mu()}if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const i=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<fu;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${fu}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),gu(o)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(n.access_token);!a&&(o!=null&&o.user)?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(s,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Tt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new bl;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new Tt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),Y(i)){const o={data:null,error:i};return gu(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ze(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await nn(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const i=Ng(n);await nn(this.storage,this.storageKey,i)}else{const n=Ng(t);await nn(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ze(this.storage,this.storageKey),await ze(this.storage,this.storageKey+"-code-verifier"),await ze(this.storage,this.storageKey+"-user"),this.userStorage&&await ze(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qe()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),sn);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/sn);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${sn}ms, refresh threshold is ${Wc} ticks`),n<=Wc&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof nv)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qe()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await zs(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?this._returnResult({data:null,error:i}):await X(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await X(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((n=l==null?void 0:l.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?JA(e.webauthn.credential_response):ZA(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const o=await X(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:QA(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:XA(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])n.all.push(i),i.status==="verified"&&n[i.factor_type].push(i);return{data:n,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:s},error:n}=await this.getSession();if(n)return this._returnResult({data:null,error:n});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=pu(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=s.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?await X(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Tt})})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Tt});const o=await X(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qe()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(Y(s))return this._returnResult({data:null,error:s});throw s}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{const{data:{session:n},error:i}=s;if(i)return this._returnResult({data:null,error:i});if(!n)return this._returnResult({data:null,error:new Tt});const o=await X(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:n.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&qe()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(s){if(Y(s))return this._returnResult({data:null,error:s});throw s}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await X(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:n=>({data:n,error:null})}):this._returnResult({data:null,error:new Tt})})}catch(e){if(Y(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;return n?this._returnResult({data:null,error:n}):s?(await X(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Tt})})}catch(t){if(Y(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(a=>a.kid===e);if(s)return s;const n=Date.now();if(s=this.jwks.keys.find(a=>a.kid===e),s&&this.jwks_cached_at+oA>n)return s;const{data:i,error:o}=await X(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,s=i.keys.find(a=>a.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:g,error:f}=await this.getSession();if(f||!g.session)return this._returnResult({data:null,error:f});s=g.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:l}}=pu(s);t!=null&&t.allowExpired||LA(i.exp);const u=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:i,header:n,signature:o},error:null}}const c=kA(n.alg),d=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,o,mA(`${a}.${l}`)))throw new Yc("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(Y(s))return this._returnResult({data:null,error:s});throw s}}}zi.nextInstanceID={};const lR=zi,uR="2.90.1";let ci="";typeof Deno<"u"?ci="deno":typeof document<"u"?ci="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ci="react-native":ci="node";const cR={"X-Client-Info":`supabase-js-${ci}/${uR}`},dR={headers:cR},hR={schema:"public"},fR={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},gR={};function qi(r){"@babel/helpers - typeof";return qi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qi(r)}function pR(r,e){if(qi(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(qi(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function mR(r){var e=pR(r,"string");return qi(e)=="symbol"?e:e+""}function yR(r,e,t){return(e=mR(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Gg(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,s)}return t}function Le(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Gg(Object(t),!0).forEach(function(s){yR(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Gg(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}const vR=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),ER=()=>Headers,SR=(r,e,t)=>{const s=vR(t),n=ER();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:r;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),s(i,Le(Le({},o),{},{headers:u}))}};function TR(r){return r.endsWith("/")?r:r+"/"}function _R(r,e){var t,s;const{db:n,auth:i,realtime:o,global:a}=r,{db:l,auth:u,realtime:c,global:d}=e,h={db:Le(Le({},l),n),auth:Le(Le({},u),i),realtime:Le(Le({},c),o),storage:{},global:Le(Le(Le({},d),a),{},{headers:Le(Le({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:async()=>""};return r.accessToken?h.accessToken=r.accessToken:delete h.accessToken,h}function wR(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(TR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var xR=class extends lR{constructor(r){super(r)}},AR=class{constructor(r,e,t){var s,n;this.supabaseUrl=r,this.supabaseKey=e;const i=wR(r);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:hR,realtime:gR,auth:Le(Le({},fR),{},{storageKey:o}),global:dR},l=_R(t??{},a);if(this.storageKey=(s=l.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=l.global.headers)!==null&&n!==void 0?n:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(c,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=SR(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Le({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(c=>this.realtime.setAuth(c)).catch(c=>console.warn("Failed to set initial Realtime auth token:",c)),this.rest=new nx(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new tA(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Zw(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var r=this,e,t;if(r.accessToken)return await r.accessToken();const{data:s}=await r.auth.getSession();return(e=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:n,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},c,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xR({url:this.authUrl.href,headers:Le(Le({},h),c),storageKey:i,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:s,userStorage:n,flowType:o,lock:a,debug:l,throwOnError:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new Tx(this.realtimeUrl.href,Le(Le({},r),{},{params:Le(Le({},{apikey:this.supabaseKey}),r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,e)=>{this._handleTokenChanged(r,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(r,e,t){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const RR=(r,e,t)=>new AR(r,e,t);function IR(){if(typeof window<"u")return!1;const r=globalThis.process;if(!r)return!1;const e=r.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}IR()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const bR="https://kdhrgvvfnoncbnffrnca.supabase.co",LR="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtkaHJndnZmbm9uY2JuZmZybmNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MzI2MzAsImV4cCI6MjA4NDQwODYzMH0.PYRnFdE-4n2TP7Bn1-2Q36fcaZae52xN9k45jCnY2mQ",Kg=RR(bR,LR),G=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},kR=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=CR},CR=Number.MAX_SAFE_INTEGER||9007199254740991;let q=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),L=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),S=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var ae={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},W={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Xs{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class PR{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Xs(e),this.fast_=new Xs(t),this.defaultTTFB_=n,this.ttfb_=new Xs(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:i}=this;s.halfLife!==e&&(this.slow_=new Xs(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Xs(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Xs(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,i=s/n;this.fast_.sample(n,i),this.slow_.sample(n,i)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function DR(r,e,t){return(e=NR(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ge(){return ge=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},ge.apply(null,arguments)}function Vg(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,s)}return t}function de(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Vg(Object(t),!0).forEach(function(s){DR(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Vg(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function OR(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function NR(r){var e=OR(r,"string");return typeof e=="symbol"?e:e+""}class Vt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Kr,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Kr=function(){},FR={trace:Kr,debug:Kr,log:Kr,warn:Kr,info:Kr,error:Kr};function Qc(){return ge({},FR)}function MR(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):Kr}function Hg(r,e,t){return e[r]?e[r].bind(e):MR(r,t)}const Xc=Qc();function UR(r,e,t){const s=Qc();if(typeof console=="object"&&r===!0||typeof r=="object"){const n=["debug","log","info","warn","error"];n.forEach(i=>{s[i]=Hg(i,r,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Qc()}n.forEach(i=>{Xc[i]=Hg(i,r)})}else ge(Xc,s);return s}const he=Xc;function as(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function $R(r){return typeof self<"u"&&r===self.ManagedMediaSource}function av(r,e){const t=Object.keys(r),s=Object.keys(e),n=t.length,i=s.length;return!n||!i||n===i&&!t.some(o=>s.indexOf(o)===-1)}function Ct(r,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(r);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=r.length;let s,n,i,o="",a=0;for(;a<t;){if(s=r[a++],s===0&&e)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:n=r[a++],o+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=r[a++],i=r[a++],o+=String.fromCharCode((s&15)<<12|(n&63)<<6|(i&63)<<0);break}}return o}function Xe(r){let e="";for(let t=0;t<r.length;t++){let s=r[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function lv(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function BR(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var vu={exports:{}},Wg;function jR(){return Wg||(Wg=1,function(r,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var h=a.parseURL(u);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return c.alwaysNormalize?(h.path=a.normalizePath(h.path),a.buildURLFromParts(h)):u;var g=a.parseURL(l);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var f=n.exec(g.path);g.netLoc=f[1],g.path=f[2]}g.netLoc&&!g.path&&(g.path="/");var p={scheme:g.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(p.netLoc=g.netLoc,h.path[0]!=="/"))if(!h.path)p.path=g.path,h.params||(p.params=g.params,h.query||(p.query=g.query));else{var m=g.path,y=m.substring(0,m.lastIndexOf("/")+1)+h.path;p.path=a.normalizePath(y)}return p.path===null&&(p.path=c.alwaysNormalize?a.normalizePath(h.path):h.path),a.buildURLFromParts(p)},parseURL:function(l){var u=s.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=a})()}(vu)),vu.exports}var vh=jR();class Eh{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var pe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class uv{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,KR(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[pe.AUDIO]:null,[pe.VIDEO]:null,[pe.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Eh),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=vh.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[pe.AUDIO]=null,e[pe.VIDEO]=null,e[pe.AUDIOVIDEO]=null}}function Oe(r){return r.sn!=="initSegment"}class Eu extends uv{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(G(e)&&G(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const n=this._decryptdata=t[s[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=G(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),n=s.length;if(n>1||n===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!G(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Oe(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const n=t[e];n&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,i,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:i,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,n),l.endDTS=Math.max(l.endDTS,i)}}class GR extends uv{constructor(e,t,s,n,i){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function cv(r,e){const t=Object.getPrototypeOf(r);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||cv(t,e)}}function KR(r,e){const t=cv(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const zg=Math.pow(2,32)-1,VR=[].push,dv={video:1,audio:2,id3:3,text:4};function $e(r){return String.fromCharCode.apply(null,r)}function hv(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function ee(r,e){const t=fv(r,e);return t<0?4294967296+t:t}function qg(r,e){let t=ee(r,e);return t*=Math.pow(2,32),t+=ee(r,e+4),t}function fv(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function HR(r){const e=r.byteLength;for(let t=0;t<e;){const s=ee(r,t);if(s>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=s>1?t+s:e}return!1}function oe(r,e){const t=[];if(!e.length)return t;const s=r.byteLength;for(let n=0;n<s;){const i=ee(r,n),o=$e(r.subarray(n+4,n+8)),a=i>1?n+i:s;if(o===e[0])if(e.length===1)t.push(r.subarray(n+8,a));else{const l=oe(r.subarray(n+8,a),e.slice(1));l.length&&VR.apply(t,l)}n=a}return t}function WR(r){const e=[],t=r[0];let s=8;const n=ee(r,s);s+=4;let i=0,o=0;t===0?(i=ee(r,s),o=ee(r,s+4),s+=8):(i=qg(r,s),o=qg(r,s+8),s+=16),s+=2;let a=r.length+o;const l=hv(r,s);s+=2;for(let u=0;u<l;u++){let c=s;const d=ee(r,c);c+=4;const h=d&2147483647;if((d&2147483648)>>>31===1)return he.warn("SIDX has hierarchical references (not supported)"),null;const f=ee(r,c);c+=4,e.push({referenceSize:h,subsegmentDuration:f,info:{duration:f/n,start:a,end:a+h-1}}),a+=h,c+=4,s=c}return{earliestPresentationTime:i,timescale:n,version:t,referencesCount:l,references:e}}function gv(r){const e=[],t=oe(r,["moov","trak"]);for(let n=0;n<t.length;n++){const i=t[n],o=oe(i,["tkhd"])[0];if(o){let a=o[0];const l=ee(o,a===0?12:20),u=oe(i,["mdia","mdhd"])[0];if(u){a=u[0];const c=ee(u,a===0?12:20),d=oe(i,["mdia","hdlr"])[0];if(d){const h=$e(d.subarray(8,12)),g={soun:pe.AUDIO,vide:pe.VIDEO}[h],f=oe(i,["mdia","minf","stbl","stsd"])[0],p=zR(f);g?(e[l]={timescale:c,type:g,stsd:p},e[g]=de({timescale:c,id:l},p)):e[l]={timescale:c,type:h,stsd:p}}}}}return oe(r,["moov","mvex","trex"]).forEach(n=>{const i=ee(n,4),o=e[i];o&&(o.default={duration:ee(n,12),flags:ee(n,20)})}),e}function zR(r){const e=r.subarray(8),t=e.subarray(86),s=$e(e.subarray(4,8));let n=s,i;const o=s==="enca"||s==="encv";if(o){const u=oe(e,[s])[0].subarray(s==="enca"?28:78);oe(u,["sinf"]).forEach(d=>{const h=oe(d,["schm"])[0];if(h){const g=$e(h.subarray(4,8));if(g==="cbcs"||g==="cenc"){const f=oe(d,["frma"])[0];f&&(n=$e(f))}}})}const a=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const l=oe(t,["avcC"])[0];l&&l.length>3&&(n+="."+Mo(l[1])+Mo(l[2])+Mo(l[3]),i=Fo(a==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=oe(e,[s])[0],u=oe(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Su(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Su(u,c);const h=u[c++];if(h===64)n+="."+Mo(h);else break;if(c+=12,u[c++]!==5)break;c=Su(u,c);const g=u[c++];let f=(g&248)>>3;f===31&&(f+=1+((g&7)<<3)+((u[c]&224)>>5)),n+="."+f}break}case"hvc1":case"hev1":{const l=oe(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,h=ee(l,2),g=(u&32)>>5?"H":"L",f=l[12],p=l.subarray(6,12);n+="."+c+d,n+="."+qR(h).toString(16).toUpperCase(),n+="."+g+f;let m="";for(let y=p.length;y--;){const v=p[y];(v||m)&&(m="."+v.toString(16).toUpperCase()+m)}n+=m}i=Fo(a=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=Fo(n,t)||n;break}case"vp09":{const l=oe(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;n+="."+hr(u)+"."+hr(c)+"."+hr(d)}break}case"av01":{const l=oe(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",h=(l[2]&64)>>6,g=(l[2]&32)>>5,f=u===2&&h?g?12:10:h?10:8,p=(l[2]&16)>>4,m=(l[2]&8)>>3,y=(l[2]&4)>>2,v=l[2]&3;n+="."+u+"."+hr(c)+d+"."+hr(f)+"."+p+"."+m+y+v+"."+hr(1)+"."+hr(1)+"."+hr(1)+"."+0,i=Fo("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:i}}function Fo(r,e){const t=oe(e,["dvvC"]),s=t.length?t[0]:oe(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,i=s[2]<<5&32|s[3]>>3&31;return r+"."+hr(n)+"."+hr(i)}}function qR(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function Su(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function Mo(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function hr(r){return(r<10?"0":"")+r}function YR(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&pv(r,(s,n)=>{const i=s.subarray(8,24);i.some(o=>o!==0)||(he.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${Xe(i)} -> ${Xe(t)}`),s.set(t,8))})}function QR(r){const e=[];return pv(r,t=>e.push(t.subarray(8,24))),e}function pv(r,e){oe(r,["moov","trak"]).forEach(s=>{const n=oe(s,["mdia","minf","stbl","stsd"])[0];if(!n)return;const i=n.subarray(8);let o=oe(i,["enca"]);const a=o.length>0;a||(o=oe(i,["encv"])),o.forEach(l=>{const u=a?l.subarray(28):l.subarray(78);oe(u,["sinf"]).forEach(d=>{const h=mv(d);h&&e(h,a)})})})}function mv(r){const e=oe(r,["schm"])[0];if(e){const t=$e(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=oe(r,["schi","tenc"])[0];if(s)return s}}}function XR(r,e,t){const s={},n=oe(r,["moof","traf"]);for(let i=0;i<n.length;i++){const o=n[i],a=oe(o,["tfhd"])[0],l=ee(a,4),u=e[l];if(!u)continue;s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=s[l],d=oe(o,["tfdt"])[0];if(d){const E=d[0];let T=ee(d,4);E===1&&(T===zg?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=zg+1,T+=ee(d,8))),G(T)&&(!G(c.start)||T<c.start)&&(c.start=T)}const h=u.default,g=ee(a,0)|(h==null?void 0:h.flags);let f=(h==null?void 0:h.duration)||0;g&8&&(g&2?f=ee(a,12):f=ee(a,8));const p=oe(o,["trun"]);let m=c.start||0,y=0,v=f;for(let E=0;E<p.length;E++){const T=p[E],_=ee(T,4),x=c.sampleCount;c.sampleCount+=_;const w=T[3]&1,A=T[3]&4,I=T[2]&1,R=T[2]&2,P=T[2]&4,$=T[2]&8;let j=8,K=_;for(w&&(j+=4),A&&_&&(!(T[j+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=x),j+=4,I?(v=ee(T,j),j+=4):v=f,R&&(j+=4),$&&(j+=4),m+=v,y+=v,K--);K--;)I?(v=ee(T,j),j+=4):v=f,R&&(j+=4),P&&(T[j+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(K+1),c.keyFrameStart=m),j+=4),$&&(j+=4),m+=v,y+=v;!y&&f&&(y+=f*_)}c.duration+=y}if(!Object.keys(s).some(i=>s[i].duration)){let i=1/0,o=0;const a=oe(r,["sidx"]);for(let l=0;l<a.length;l++){const u=WR(a[l]);if(u!=null&&u.references){i=Math.min(i,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,h)=>d+h.info.duration||0,0);o=Math.max(o,c+u.earliestPresentationTime/u.timescale)}}o&&G(o)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=o*s[l].timescale-s[l].start)})}return s}function JR(r){const e={valid:null,remainder:null},t=oe(r,["moof"]);if(t.length<2)return e.remainder=r,e;const s=t[t.length-1];return e.valid=r.slice(0,s.byteOffset-8),e.remainder=r.slice(s.byteOffset-8),e}function Kt(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Yg(r,e){const t=[],s=e.samples,n=e.timescale,i=e.id;let o=!1;return oe(s,["moof"]).map(l=>{const u=l.byteOffset-8;oe(l,["traf"]).map(d=>{const h=oe(d,["tfdt"]).map(g=>{const f=g[0];let p=ee(g,4);return f===1&&(p*=Math.pow(2,32),p+=ee(g,8)),p/n})[0];return h!==void 0&&(r=h),oe(d,["tfhd"]).map(g=>{const f=ee(g,4),p=ee(g,0)&16777215,m=(p&1)!==0,y=(p&2)!==0,v=(p&8)!==0;let E=0;const T=(p&16)!==0;let _=0;const x=(p&32)!==0;let w=8;f===i&&(m&&(w+=8),y&&(w+=4),v&&(E=ee(g,w),w+=4),T&&(_=ee(g,w),w+=4),x&&(w+=4),e.type==="video"&&(o=Ll(e.codec)),oe(d,["trun"]).map(A=>{const I=A[0],R=ee(A,0)&16777215,P=(R&1)!==0;let $=0;const j=(R&4)!==0,K=(R&256)!==0;let V=0;const M=(R&512)!==0;let H=0;const k=(R&1024)!==0,N=(R&2048)!==0;let B=0;const O=ee(A,4);let F=8;P&&($=ee(A,F),F+=4),j&&(F+=4);let Z=$+u;for(let se=0;se<O;se++){if(K?(V=ee(A,F),F+=4):V=E,M?(H=ee(A,F),F+=4):H=_,k&&(F+=4),N&&(I===0?B=ee(A,F):B=fv(A,F),F+=4),e.type===pe.VIDEO){let te=0;for(;te<H;){const ne=ee(s,Z);if(Z+=4,ZR(o,s[Z])){const Pe=s.subarray(Z,Z+ne);Sh(Pe,o?2:1,r+B/n,t)}Z+=ne,te+=ne+4}}r+=V/n}}))})})}),t}function Ll(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function ZR(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Sh(r,e,t,s){const n=yv(r);let i=0;i+=e;let o=0,a=0,l=0;for(;i<n.length;){o=0;do{if(i>=n.length)break;l=n[i++],o+=l}while(l===255);a=0;do{if(i>=n.length)break;l=n[i++],a+=l}while(l===255);const u=n.length-i;let c=i;if(a<u)i+=a;else if(a>u){he.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(n[c++]===181){const h=hv(n,c);if(c+=2,h===49){const g=ee(n,c);if(c+=4,g===1195456820){const f=n[c++];if(f===3){const p=n[c++],m=31&p,y=64&p,v=y?2+m*3:0,E=new Uint8Array(v);if(y){E[0]=p;for(let T=1;T<v;T++)E[T]=n[c++]}s.push({type:f,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let f=0;f<16;f++){const p=n[c++].toString(16);d.push(p.length==1?"0"+p:p),(f===3||f===5||f===7||f===9)&&d.push("-")}const h=a-16,g=new Uint8Array(h);for(let f=0;f<h;f++)g[f]=n[c++];s.push({payloadType:o,pts:t,uuid:d.join(""),userData:Ct(g),userDataBytes:g})}}}function yv(r){const e=r.byteLength,t=[];let s=1;for(;s<e-2;)r[s]===0&&r[s+1]===0&&r[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return r;const n=e-t.length,i=new Uint8Array(n);let o=0;for(s=0;s<n;o++,s++)o===t[0]&&(o++,t.shift()),i[s]=r[o];return i}function eI(r){const e=r[0];let t="",s="",n=0,i=0,o=0,a=0,l=0,u=0;if(e===0){for(;$e(r.subarray(u,u+1))!=="\0";)t+=$e(r.subarray(u,u+1)),u+=1;for(t+=$e(r.subarray(u,u+1)),u+=1;$e(r.subarray(u,u+1))!=="\0";)s+=$e(r.subarray(u,u+1)),u+=1;s+=$e(r.subarray(u,u+1)),u+=1,n=ee(r,12),i=ee(r,16),a=ee(r,20),l=ee(r,24),u=28}else if(e===1){u+=4,n=ee(r,u),u+=4;const d=ee(r,u);u+=4;const h=ee(r,u);for(u+=4,o=2**32*d+h,kR(o)||(o=Number.MAX_SAFE_INTEGER,he.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=ee(r,u),u+=4,l=ee(r,u),u+=4;$e(r.subarray(u,u+1))!=="\0";)t+=$e(r.subarray(u,u+1)),u+=1;for(t+=$e(r.subarray(u,u+1)),u+=1;$e(r.subarray(u,u+1))!=="\0";)s+=$e(r.subarray(u,u+1)),u+=1;s+=$e(r.subarray(u,u+1)),u+=1}const c=r.subarray(u,r.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:o,presentationTimeDelta:i,eventDuration:a,id:l,payload:c}}function tI(r,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const i=new Uint8Array(s);for(i[0]=s>>24&255,i[1]=s>>16&255,i[2]=s>>8&255,i[3]=s&255,i.set(r,4),n=0,s=8;n<t;n++)i.set(e[n],s),s+=e[n].byteLength;return i}function rI(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let i;s>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const o=new Uint8Array(4);return t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),tI([112,115,115,104],new Uint8Array([s,0,0,0]),r,i,n,o,t)}function sI(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let s=0;for(;s+32<t;){const n=new DataView(r,s),i=nI(n);e.push(i),s+=i.size}}return e}function nI(r){const e=r.getUint32(0),t=r.byteOffset,s=r.byteLength;if(s<e)return{offset:t,size:s};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const i=r.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const o=r.buffer,a=Xe(new Uint8Array(o,t+12,16));let l=null,u=null,c=0;if(i===0)c=28;else{const h=r.getUint32(28);if(!h||s<32+h*16)return{offset:t,size:e};l=[];for(let g=0;g<h;g++)l.push(new Uint8Array(o,t+32+g*16,16));c=32+h*16}if(!c)return{offset:t,size:e};const d=r.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(o,t+c+4,d),{version:i,systemId:a,kids:l,data:u,offset:t,size:e})}const vv=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Bn={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Th(r,e){const t=Bn[e];return!!t&&!!t[r.slice(0,4)]}function Yi(r,e,t=!0){return!r.split(",").some(s=>!_h(s,e,t))}function _h(r,e,t=!0){var s;const n=as(t);return(s=n==null?void 0:n.isTypeSupported(Qi(r,e)))!=null?s:!1}function Qi(r,e){return`${e}/mp4;codecs=${r}`}function Qg(r){if(r){const e=r.substring(0,4);return Bn.video[e]}return 2}function qa(r){const e=vv();return r.split(",").reduce((t,s)=>{const i=e&&Ll(s)?9:Bn.video[s];return i?(i*2+t)/(t?3:2):(Bn.audio[s]+t)/(t?2:1)},0)}const Tu={};function iI(r,e=!0){if(Tu[r])return Tu[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let n=0;n<t.length;n++){var s;if(_h(t[n],"audio",e))return Tu[r]=t[n],t[n];if(t[n]==="mp3"&&(s=as(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return r}const oI=/flac|opus|mp4a\.40\.34/i;function Ya(r,e=!0){return r.replace(oI,t=>iI(t.toLowerCase(),e))}function aI(r,e){const t=[];if(r){const s=r.split(",");for(let n=0;n<s.length;n++)Th(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function ha(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(Xg(r,"audio")||Xg(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let s=t.length;s--;)if(t[s].substring(0,4)===r.substring(0,4))return t[s]}return t[0]}}return e||r}function Xg(r,e){return Th(r,e)&&_h(r,e)}function lI(r){const e=r.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function uI(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return r}function Jg(r){const e=as(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Jc(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const cI={supported:!0,powerEfficient:!0,smooth:!0},dI={supported:!1,smooth:!1,powerEfficient:!1},Ev={supported:!0,configurations:[],decodingInfoResults:[cI]};function Sv(r,e){return{supported:!1,configurations:e,decodingInfoResults:[dI],error:r}}function hI(r,e,t,s,n,i){const o=r.videoCodec,a=r.audioCodec?r.audioGroups:null,l=i==null?void 0:i.audioCodec,u=i==null?void 0:i.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(a!=null&&a.length)try{a.length===1&&a[0]?d=e.groups[a[0]].channels:d=a.reduce((h,g)=>{if(g){const f=e.groups[g];if(!f)throw new Error(`Audio track group ${g} not found`);Object.keys(f.channels).forEach(p=>{h[p]=(h[p]||0)+f.channels[p]})}return h},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(h=>Ll(h))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(s,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(n,8e6))||!!d&&G(c)&&Object.keys(d).some(h=>parseInt(h)>c)}function Tv(r,e,t,s={}){const n=r.videoCodec;if(!n&&!r.audioCodec||!t)return Promise.resolve(Ev);const i=[],o=fI(r),a=o.length,l=gI(r,e,a>0),u=l.length;for(let c=a||1*u||1;c--;){const d={type:"media-source"};if(a&&(d.video=o[c%a]),u){d.audio=l[c%u];const h=d.audio.bitrate;d.video&&h&&(d.video.bitrate-=h)}i.push(d)}if(n){const c=navigator.userAgent;if(n.split(",").some(d=>Ll(d))&&vv())return Promise.resolve(Sv(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),i))}return Promise.all(i.map(c=>{const d=mI(c);return s[d]||(s[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:i,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:i,decodingInfoResults:[],error:c}))}function fI(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),s=_v(r),n=r.width||640,i=r.height||480,o=r.frameRate||30,a=r.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:Qi(uI(l),"video"),width:n,height:i,bitrate:s,framerate:o};return a!=="sdr"&&(u.transferFunction=a),u}):[]}function gI(r,e,t){var s;const n=(s=r.audioCodec)==null?void 0:s.split(","),i=_v(r);return n&&r.audioGroups?r.audioGroups.reduce((o,a)=>{var l;const u=a?(l=e.groups[a])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===a){const h=parseFloat(d.channels||"");n.forEach(g=>{const f={contentType:Qi(g,"audio"),bitrate:t?pI(g,i):i};h&&(f.channels=""+h),c.push(f)})}return c},o):o},[]):[]}function pI(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function _v(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function mI(r){let e="";const{audio:t,video:s}=r;if(s){const n=Jc(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=Jc(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const Zc=["NONE","TYPE-0","TYPE-1",null];function yI(r){return Zc.indexOf(r)>-1}const Qa=["SDR","PQ","HLG"];function vI(r){return!!r&&Qa.indexOf(r)>-1}var fa={No:"",Yes:"YES",v2:"v2"};function Zg(r){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=r,n=s<e/2;return e&&n?t?fa.v2:fa.Yes:fa.No}class ep{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Xi{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return tp(this._audioGroups,e)}hasSubtitleGroup(e){return tp(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function tp(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function EI(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function SI(r,e){let t=!1,s=[];if(r&&(t=r!=="SDR",s=[r]),e){s=e.allowedVideoRanges||Qa.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&EI(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const TI=r=>{const e=new WeakSet;return(t,s)=>{if(r&&(s=r(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},me=(r,e)=>JSON.stringify(r,TI(e));function _I(r,e,t,s,n){const i=Object.keys(r),o=s==null?void 0:s.channels,a=s==null?void 0:s.audioCodec,l=n==null?void 0:n.videoCodec,u=o&&parseInt(o)===2;let c=!1,d=!1,h=1/0,g=1/0,f=1/0,p=1/0,m=0,y=[];const{preferHDR:v,allowedVideoRanges:E}=SI(e,n);for(let A=i.length;A--;){const I=r[i[A]];c||(c=I.channels[2]>0),h=Math.min(h,I.minHeight),g=Math.min(g,I.minFramerate),f=Math.min(f,I.minBitrate),E.filter(P=>I.videoRanges[P]>0).length>0&&(d=!0)}h=G(h)?h:0,g=G(g)?g:0;const T=Math.max(1080,h),_=Math.max(30,g);f=G(f)?f:t,t=Math.max(f,t),d||(e=void 0);const x=i.length>1;return{codecSet:i.reduce((A,I)=>{const R=r[I];if(I===A)return A;if(y=d?E.filter(P=>R.videoRanges[P]>0):[],x){if(R.minBitrate>t)return ur(I,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),A;if(!R.hasDefaultAudio)return ur(I,"no renditions with default or auto-select sound found"),A;if(a&&I.indexOf(a.substring(0,4))%5!==0)return ur(I,`audio codec preference "${a}" not found`),A;if(o&&!u){if(!R.channels[o])return ur(I,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),A}else if((!a||u)&&c&&R.channels[2]===0)return ur(I,"no renditions with stereo sound found"),A;if(R.minHeight>T)return ur(I,`min resolution of ${R.minHeight} > maximum of ${T}`),A;if(R.minFramerate>_)return ur(I,`min framerate of ${R.minFramerate} > maximum of ${_}`),A;if(!y.some(P=>R.videoRanges[P]>0))return ur(I,`no variants with VIDEO-RANGE of ${me(y)} found`),A;if(l&&I.indexOf(l.substring(0,4))%5!==0)return ur(I,`video codec preference "${l}" not found`),A;if(R.maxScore<m)return ur(I,`max score of ${R.maxScore} < selected max of ${m}`),A}return A&&(qa(I)>=qa(A)||R.fragmentError>r[A].fragmentError)?A:(p=R.minIndex,m=R.maxScore,I)},void 0),videoRanges:y,preferHDR:v,minFramerate:g,minBitrate:f,minIndex:p}}function ur(r,e){he.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function wv(r){return r.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function wI(r,e,t,s){return r.slice(t,s+1).reduce((n,i,o)=>{if(!i.codecSet)return n;const a=i.audioGroups;let l=n[i.codecSet];l||(n[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const u=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,o),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,a&&a.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(h=>{l.channels[h]=(l.channels[h]||0)+d.channels[h]}))}),n},{})}function rp(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:i}=r;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:i}}function pr(r,e,t){if("attrs"in r){const s=e.indexOf(r);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(Ds(r,n,t))return s}return-1}function Ds(r,e,t){const{groupId:s,name:n,lang:i,assocLang:o,default:a}=r,l=r.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(i===void 0||xI(i,e.lang))&&(i===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in r)||AI(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function xI(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function AI(r,e=""){const t=r.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function _s(r,e){const{audioCodec:t,channels:s}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function RI(r,e,t,s,n){const i=e[s],a=e.reduce((h,g,f)=>{const p=g.uri;return(h[p]||(h[p]=[])).push(f),h},{})[i.uri];a.length>1&&(s=Math.max.apply(Math,a));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=sp(e,s,h=>{if(h.videoRange!==l||h.frameRate!==u||h.codecSet.substring(0,4)!==c)return!1;const g=h.audioGroups,f=t.filter(p=>!g||g.indexOf(p.groupId)!==-1);return pr(r,f,n)>-1});return d>-1?d:sp(e,s,h=>{const g=h.audioGroups,f=t.filter(p=>!g||g.indexOf(p.groupId)!==-1);return pr(r,f,n)>-1})}function sp(r,e,t){for(let s=e;s>-1;s--)if(t(r[s]))return s;for(let s=e+1;s<r.length;s++)if(t(r[s]))return s;return-1}function Xa(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class II extends Vt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:i,hls:o}=this,{autoLevelEnabled:a,media:l}=o;if(!n||!l)return;const u=performance.now(),c=i?i.stats:n.stats,d=i?i.duration:n.duration,h=u-c.loading.start,g=o.minAutoLevel,f=n.level,p=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||f<=g){this.clearTimer(),this._nextAutoLevel=-1;return}if(!a)return;const m=p>-1&&p!==f,y=!!t||m;if(!y&&(l.paused||!l.playbackRate||!l.readyState))return;const v=o.mainForwardBufferInfo;if(!y&&v===null)return;const E=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(h<=Math.max(E,1e3*(d/(T*2))))return;const _=v?v.len/T:0,x=c.loading.first?c.loading.first-c.loading.start:-1,w=c.loaded&&x>-1,A=this.getBwEstimate(),I=o.levels,R=I[f],P=Math.max(c.loaded,Math.round(d*(n.bitrate||R.averageBitrate)/8));let $=w?h-x:h;$<1&&w&&($=Math.min(h,c.loaded*8/A));const j=w?c.loaded*1e3/$:0,K=E/1e3,V=j?(P-c.loaded)/j:P*8/A+K;if(V<=_)return;const M=j?j*8:A,H=((s=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,k=this.hls.config.abrBandWidthUpFactor;let N=Number.POSITIVE_INFINITY,B;for(B=f-1;B>g;B--){const se=I[B].maxBitrate,te=!I[B].details||H;if(N=this.getTimeToLoadFrag(K,M,d*se,te),N<Math.min(_,d+K))break}if(N>=V||N>d*10)return;w?this.bwEstimator.sample(h-Math.min(E,x),c.loaded):this.bwEstimator.sampleTTFB(h);const O=I[B].maxBitrate;this.getBwEstimate()*k>O&&this.resetEstimator(O);const F=this.findBestLevel(O,g,B,0,_,1,1);F>-1&&(B=F),this.warn(`Fragment ${n.sn}${i?" part "+i.index:""} of level ${f} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${_.toFixed(3)} s
      Estimated load time for current fragment: ${V.toFixed(3)} s
      Estimated load time for down switch fragment: ${N.toFixed(3)} s
      TTFB estimate: ${x|0} ms
      Current BW estimate: ${G(A)?A|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${B} @ ${O|0} bps`),o.nextLoadLevel=o.nextAutoLevel=B,this.clearTimer();const Z=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===B&&B>0){const se=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${B>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${se.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,B>g){let te=this.findBestLevel(this.hls.levels[g].bitrate,g,B,0,se,1,1);te===-1&&(te=g),this.hls.nextLoadLevel=this.hls.nextAutoLevel=te,this.resetEstimator(this.hls.levels[te].bitrate)}}};m||V>N*2?Z():this.timer=self.setInterval(Z,N*1e3),o.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:i,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new PR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case L.BUFFER_ADD_CODEC_ERROR:case L.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case L.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:i}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const o=performance.now(),a=i?i.stats:s.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,n){const i=e+s/t,o=n?e+this.lastLevelLoadSec:0;return i+o}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,i=n.end-n.first;G(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===W.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=s?s.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+n.loaded,l=(o.loaded?o.loaded.duration:0)+i;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const i={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(S.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,i=n!=null&&n.stats.loaded?n.stats:s.stats;if(i.aborted||this.ignoreFragment(s))return;const o=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,i.loaded),i.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==W.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(s,t,e,0,n,1,1);if(i>-1)return i;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,i)&&o[e].loadError<=o[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:i,minAutoLevel:o}=s,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){const m=this.findBestLevel(l,o,n,u,0,c,d);if(m>=0)return this.rebufferNotice=-1,m}let h=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const m=this.bitrateTestDelay;m&&(h=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-m,this.info(`bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),c=d=1)}const g=this.findBestLevel(l,o,n,u,h,c,d);if(this.rebufferNotice!==g&&(this.rebufferNotice=g,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${g}`)),g>-1)return g;const f=s.levels[o],p=s.loadLevelObj;return p&&(f==null?void 0:f.bitrate)<p.bitrate?o:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,i,o,a){var l;const u=n+i,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:h,partCurrent:g}=this,{levels:f,allAudioTracks:p,loadLevel:m,config:y}=this.hls;if(f.length===1)return 0;const v=f[d],E=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=m===-1||c===-1;let _,x="SDR",w=(v==null?void 0:v.frameRate)||0;const{audioPreference:A,videoPreference:I}=y,R=this.audioTracksByGroup||(this.audioTracksByGroup=wv(p));let P=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const M=this.codecTiers||(this.codecTiers=wI(f,R,t,s)),H=_I(M,x,e,A,I),{codecSet:k,videoRanges:N,minFramerate:B,minBitrate:O,minIndex:F,preferHDR:Z}=H;P=F,_=k,x=Z?N[N.length-1]:N[0],w=B,e=Math.max(e,O),this.log(`picked start tier ${me(H)}`)}else _=v==null?void 0:v.codecSet,x=v==null?void 0:v.videoRange;const $=g?g.duration:h?h.duration:0,j=this.bwEstimator.getEstimateTTFB()/1e3,K=[];for(let M=s;M>=t;M--){var V;const H=f[M],k=M>d;if(!H)continue;if(y.useMediaCapabilities&&!H.supportedResult&&!H.supportedPromise){const te=navigator.mediaCapabilities;typeof(te==null?void 0:te.decodingInfo)=="function"&&hI(H,R,x,w,e,A)?(H.supportedPromise=Tv(H,R,te,this.supportedCache),H.supportedPromise.then(ne=>{if(!this.hls)return;H.supportedResult=ne;const Pe=this.hls.levels,We=Pe.indexOf(H);ne.error?this.warn(`MediaCapabilities decodingInfo error: "${ne.error}" for level ${We} ${me(ne)}`):ne.supported?ne.decodingInfoResults.some(Nt=>Nt.smooth===!1||Nt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${We} not smooth or powerEfficient: ${me(ne)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${We} ${me(ne)}`),We>-1&&Pe.length>1&&(this.log(`Removing unsupported level ${We}`),this.hls.removeLevel(We),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ne=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ne}`)})):H.supportedResult=Ev}if((_&&H.codecSet!==_||x&&H.videoRange!==x||k&&w>H.frameRate||!k&&w>0&&w<H.frameRate||(V=H.supportedResult)!=null&&(V=V.decodingInfoResults)!=null&&V.some(te=>te.smooth===!1))&&(!T||M!==P)){K.push(M);continue}const N=H.details,B=(g?N==null?void 0:N.partTarget:N==null?void 0:N.averagetargetduration)||$;let O;k?O=a*e:O=o*e;const F=$&&n>=$*2&&i===0?H.averageBitrate:H.maxBitrate,Z=this.getTimeToLoadFrag(j,O,F*B,N===void 0);if(O>=F&&(M===c||H.loadError===0&&H.fragmentError===0)&&(Z<=j||!G(Z)||E&&!this.bitrateTestDelay||Z<u)){const te=this.forcedAutoLevel;return M!==m&&(te===-1||te!==m)&&(K.length&&this.trace(`Skipped level(s) ${K.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${f[K[0]].codecs}" ${f[K[0]].videoRange}; not compatible with "${_}" ${x}`),this.info(`switch candidate:${d}->${M} adjustedbw(${Math.round(O)})-bitrate=${Math.round(O-F)} ttfb:${j.toFixed(1)} avgDuration:${B.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${Z.toFixed(1)} firstSelection:${T} codecSet:${H.codecSet} videoRange:${H.videoRange} hls.loadLevel:${m}`)),T&&(this.firstSelection=M),M}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const xv={search:function(r,e){let t=0,s=r.length-1,n=null,i=null;for(;t<=s;){n=(t+s)/2|0,i=r[n];const o=e(i);if(o>0)t=n+1;else if(o<0)s=n-1;else return i}return null}};function bI(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!G(e))return null;const s=r[0].programDateTime;if(e<(s||0))return null;const n=r[r.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let i=0;i<r.length;++i){const o=r[i];if(kI(e,t,o))return o}return null}function Bs(r,e,t=0,s=0,n=.005){let i=null;if(r){i=e[1+r.sn-e[0].sn]||null;const a=r.endDTS-t;a>0&&a<15e-7&&(t+=15e-7),i&&r.level!==i.level&&i.end<=r.end&&(i=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!r||r.level===i.level)&&np(t,s,i)===0||LI(i,r,Math.min(n,s))))return i;const o=xv.search(e,np.bind(null,t,s));return o&&(o!==r||!i)?o:i}function LI(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,i)=>(i[0]==="INF"&&(n+=parseFloat(i[1])),n),t);return r.start<=s}return!1}function np(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=r?1:t.start-s>r&&t.start?-1:0}function kI(r,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>r}function Av(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let s=r.fragments;const{fragmentHint:n}=r;n&&(s=s.concat(n));let i;return xv.search(s,o=>o.cc<e?1:o.cc>e?-1:(i=o,o.end<=t?1:o.start>t?-1:0)),i||null}return null}function Ja(r){switch(r.details){case L.FRAG_LOAD_TIMEOUT:case L.KEY_LOAD_TIMEOUT:case L.LEVEL_LOAD_TIMEOUT:case L.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Rv(r){return r.details.startsWith("key")}function Iv(r){return Rv(r)&&!!r.frag&&!r.frag.decryptdata}function ip(r,e){const t=Ja(e);return r.default[`${t?"timeout":"error"}Retry`]}function wh(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function op(r){return de(de({},r),{errorRetry:null,timeoutRetry:null})}function Za(r,e,t,s){if(!r)return!1;const n=s==null?void 0:s.code,i=e<r.maxNumRetry&&(CI(n)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,s,i):i}function CI(r){return ed(r)||!!r&&(r<400||r>499)}function ed(r){return r===0&&navigator.onLine===!1}var Qe={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},wt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class PI extends Vt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===W.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(o=>n.indexOf(o.groupId)>=0).some(o=>{var a;return(a=o.details)==null?void 0:a.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,i=t.context;switch(t.details){case L.FRAG_LOAD_ERROR:case L.FRAG_LOAD_TIMEOUT:case L.KEY_LOAD_ERROR:case L.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case L.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=bn();return}case L.FRAG_GAP:case L.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Qe.SendAlternateToPenaltyBox;return}case L.LEVEL_EMPTY_ERROR:case L.LEVEL_PARSING_ERROR:{var o;const l=t.parent===W.MAIN?t.level:n.loadLevel;t.details===L.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(o=o.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case L.LEVEL_LOAD_ERROR:case L.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case L.AUDIO_TRACK_LOAD_ERROR:case L.AUDIO_TRACK_LOAD_TIMEOUT:case L.SUBTITLE_LOAD_ERROR:case L.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=n.loadLevelObj;if(l&&(i.type===ae.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===ae.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=Qe.SendAlternateToPenaltyBox,t.errorAction.flags=wt.MoveAllAlternatesMatchingHost;return}}return;case L.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Qe.SendAlternateToPenaltyBox,flags:wt.MoveAllAlternatesMatchingHDCP};return;case L.KEY_SYSTEM_SESSION_UPDATE_FAILED:case L.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case L.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Qe.SendAlternateToPenaltyBox,flags:wt.MoveAllAlternatesMatchingKey};return;case L.BUFFER_ADD_CODEC_ERROR:case L.REMUX_ALLOC_ERROR:case L.BUFFER_APPEND_ERROR:if(!t.errorAction){var a;t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:n.loadLevel)}return;case L.INTERNAL_EXCEPTION:case L.BUFFER_APPENDING_ERROR:case L.BUFFER_FULL_ERROR:case L.LEVEL_SWITCH_ERROR:case L.BUFFER_STALLED_ERROR:case L.BUFFER_SEEK_OVER_HOLE:case L.BUFFER_NUDGE_ON_STALL:t.errorAction=bn();return}t.type===q.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=bn())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=ip(s.config.playlistLoadPolicy,e),i=this.playlistError++;if(Za(n,i,Ja(e),e.response))return{action:Qe.RetryRequest,flags:wt.None,retryConfig:n,retryCount:i};const a=this.getLevelSwitchAction(e,t);return n&&(a.retryConfig=n,a.retryCount=i),a}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:i,keyLoadPolicy:o}=t.config,a=ip(Rv(e)?o:i,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(n&&(e.details!==L.FRAG_GAP&&n.fragmentError++,!Iv(e)&&Za(a,l,Ja(e),e.response)))return{action:Qe.RetryRequest,flags:wt.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,s);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var i,o;const u=e.details;n.loadError++,u===L.BUFFER_APPEND_ERROR&&n.fragmentError++;let c=-1;const{levels:d,loadLevel:h,minAutoLevel:g,maxAutoLevel:f}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const p=(i=e.frag)==null?void 0:i.type,y=(p===W.AUDIO&&u===L.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===L.BUFFER_ADD_CODEC_ERROR||u===L.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:x})=>n.audioCodec!==x),E=e.sourceBufferName==="video"&&(u===L.BUFFER_ADD_CODEC_ERROR||u===L.BUFFER_APPEND_ERROR)&&d.some(({codecSet:x,audioCodec:w})=>n.codecSet!==x&&n.audioCodec===w),{type:T,groupId:_}=(o=e.context)!=null?o:{};for(let x=d.length;x--;){const w=(x+h)%d.length;if(w!==h&&w>=g&&w<=f&&d[w].loadError===0){var a,l;const A=d[w];if(u===L.FRAG_GAP&&p===W.MAIN&&e.frag){const I=d[w].details;if(I){const R=Bs(e.frag,I.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else{if(T===ae.AUDIO_TRACK&&A.hasAudioGroup(_)||T===ae.SUBTITLE_TRACK&&A.hasSubtitleGroup(_))continue;if(p===W.AUDIO&&(a=n.audioGroups)!=null&&a.some(I=>A.hasAudioGroup(I))||p===W.SUBTITLE&&(l=n.subtitleGroups)!=null&&l.some(I=>A.hasSubtitleGroup(I))||y&&n.audioCodec===A.audioCodec||E&&n.codecSet===A.codecSet||!y&&n.codecSet!==A.codecSet)continue}c=w;break}}if(c>-1&&s.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Qe.SendAlternateToPenaltyBox,flags:wt.None,nextAutoLevel:c}}return{action:Qe.SendAlternateToPenaltyBox,flags:wt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Qe.DoNothing:break;case Qe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==L.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n}=s,i=s.nextAutoLevel;switch(n){case wt.None:this.switchLevel(e,i);break;case wt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(s.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=Zc[Zc.indexOf(c)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case wt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let h=c;h--;)if(this.variantHasKey(u[h],l)){var o,a;this.log(`Banned key found in level ${h} (${u[h].bitrate}bps) or audio group "${(o=u[h].audioGroups)==null?void 0:o.join(",")}" (${(a=e.frag)==null?void 0:a.type} fragment) ${Xe(l.keyId||[])}`),u[h].fragmentError++,u[h].loadError++,this.log(`Removing level ${h} with key error (${e.error})`),this.hls.removeLevel(h)}const d=e.frag;if(this.hls.levels.length<c)s.resolved=!0;else if(d&&d.type!==W.MAIN){const h=d.decryptdata;h&&!l.matches(h)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===L.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Jc(e.mimeType),n=this.hls.levels;for(let i=n.length;i--;)n[i][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${i} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(i))}}}function bn(r){const e={action:Qe.DoNothing,flags:wt.None};return r&&(e.resolved=!0),e}var je={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class DI{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const i=s[n];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,i=Object.keys(n);for(let o=i.length;o--;){const a=n[i[o]];if((a==null?void 0:a.body.type)===t&&(!s||a.buffered)){const l=a.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,n,i){this.timeRanges&&(this.timeRanges[e]=t);const o=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l||o>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===s&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=Js(s),i=this.fragments[n];if(!i||i.buffered&&s.gap)return;const o=!s.relurl;Object.keys(t).forEach(a=>{const l=s.elementaryStreams[a];if(!l)return;const u=t[a],c=o||l.partial===!0;i.range[a]=this.getBufferedTimes(s,e.part,c,u)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,s),Uo(i)||this.removeParts(s.sn-1,s.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=ap(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=Js(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,s,n){const i={time:[],partial:s},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<n.length;c++){const d=n.start(c)-this.bufferPadding,h=n.end(c)+this.bufferPadding;if(u>=d&&l<=h){i.time.push({startPTS:Math.max(o,n.start(c)),endPTS:Math.min(a,n.end(c))});break}else if(o<h&&a>d){const g=Math.max(o,n.start(c)),f=Math.min(a,n.end(c));f>g&&(i.partial=!0,i.time.push({startPTS:g,endPTS:f}))}else if(a<=d)break}return i}getPartialFragment(e){let t=null,s,n,i,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&Uo(c)&&(n=c.body.start-a,i=c.body.end+a,e>=n&&e<=i&&(s=Math.min(e-n,i-e),o<=s&&(t=c.body,o=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Uo(t))}getState(e){const t=Js(e),s=this.fragments[t];return s?s.buffered?Uo(s)?je.PARTIAL:je.OK:je.APPENDING:je.NOT_LOADED}isTimeBuffered(e,t,s){let n,i;for(let o=0;o<s.length;o++){if(n=s.start(o)-this.bufferPadding,i=s.end(o)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,i=Js(s);this.fragments[i]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:i,type:o}=t;if(s.sn==="initSegment")return;const a=s.type;if(n){let u=this.activePartLists[a];u||(this.activePartLists[a]=u=[]),u.push(n)}this.timeRanges=i;const l=i[o];this.detectEvictedFragments(o,l,a,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Js(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const i=t[s[n]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==s||n&&!l.gap||l.start<t&&l.end>e&&(a.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Js(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=ap(s,i=>i.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Uo(r){var e,t,s;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(s=r.range.audiovideo)!=null&&s.partial)}function Js(r){return`${r.type}_${r.level}_${r.sn}`}function ap(r,e){return r.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var ls={cbc:0,ctr:1};class OI{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case ls.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ls.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function NI(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class FI{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],i=s[1],o=s[2],a=s[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],h=l[3],g=new Uint32Array(256);let f=0,p=0,m=0;for(m=0;m<256;m++)m<128?g[m]=m<<1:g[m]=m<<1^283;for(m=0;m<256;m++){let y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^y&255^99,e[f]=y,t[y]=f;const v=g[f],E=g[v],T=g[E];let _=g[y]*257^y*16843008;n[f]=_<<24|_>>>8,i[f]=_<<16|_>>>16,o[f]=_<<8|_>>>24,a[f]=_,_=T*16843009^E*65537^v*257^f*16843008,u[y]=_<<24|_>>>8,c[y]=_<<16|_>>>16,d[y]=_<<8|_>>>24,h[y]=_,f?(f=v^g[g[g[T^v]]],p^=g[g[p]]):f=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const o=this.ksRows=(i+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,h=this.rcon,g=this.invSubMix,f=g[0],p=g[1],m=g[2],y=g[3];let v,E;for(a=0;a<o;a++){if(a<i){v=u[a]=t[a];continue}E=v,a%i===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=h[a/i|0]<<24):i>6&&a%i===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[a]=v=(u[a-i]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=u[a]:E=u[a-4],l<4||a<=4?c[l]=E:c[l]=f[d[E>>>24]]^p[d[E>>>16&255]]^m[d[E>>>8&255]]^y[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,i=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],h=this.uint8ArrayToUint32Array_(s);let g=h[0],f=h[1],p=h[2],m=h[3];const y=new Int32Array(e),v=new Int32Array(y.length);let E,T,_,x,w,A,I,R,P,$,j,K,V,M;const H=this.networkToHostOrderSwap;for(;t<y.length;){for(P=H(y[t]),$=H(y[t+1]),j=H(y[t+2]),K=H(y[t+3]),w=P^i[0],A=K^i[1],I=j^i[2],R=$^i[3],V=4,M=1;M<n;M++)E=l[w>>>24]^u[A>>16&255]^c[I>>8&255]^d[R&255]^i[V],T=l[A>>>24]^u[I>>16&255]^c[R>>8&255]^d[w&255]^i[V+1],_=l[I>>>24]^u[R>>16&255]^c[w>>8&255]^d[A&255]^i[V+2],x=l[R>>>24]^u[w>>16&255]^c[A>>8&255]^d[I&255]^i[V+3],w=E,A=T,I=_,R=x,V=V+4;E=o[w>>>24]<<24^o[A>>16&255]<<16^o[I>>8&255]<<8^o[R&255]^i[V],T=o[A>>>24]<<24^o[I>>16&255]<<16^o[R>>8&255]<<8^o[w&255]^i[V+1],_=o[I>>>24]<<24^o[R>>16&255]<<16^o[w>>8&255]<<8^o[A&255]^i[V+2],x=o[R>>>24]<<24^o[w>>16&255]<<16^o[A>>8&255]<<8^o[I&255]^i[V+3],v[t]=H(E^g),v[t+1]=H(x^f),v[t+2]=H(_^p),v[t+3]=H(T^m),g=P,f=$,p=j,m=K,t=t+4}return v.buffer}}class MI{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=UI(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function UI(r){switch(r){case ls.cbc:return"AES-CBC";case ls.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const $I=16;class xh{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?NI(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((i,o)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,s,n);const l=this.flush();l?i(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:i,currentResult:o,remainderData:a}=this;if(n!==ls.cbc||t.byteLength!==16)return he.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Kt(a,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(s=i);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new FI),u.expandKey(t);const c=o;return this.currentResult=u.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new MI(this.subtle,t,n)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new OI(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(he.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%$I;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(he.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const lp=Math.pow(2,17);class BI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Ar({type:q.NETWORK_ERROR,details:L.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(f=>f[0]==="GAP")){l(cp(e));return}else e.gap=!1;const u=this.loader=i?new i(n):new o(n),c=up(e);e.loader=u;const d=op(n.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:lp};e.stats=u.stats;const g={onSuccess:(f,p,m,y)=>{this.resetLoader(e,u);let v=f.data;m.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),a({frag:e,part:null,payload:v,networkDetails:y})},onError:(f,p,m,y)=>{this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:de({url:s,data:void 0},f),error:new Error(`HTTP Error ${f.code} ${f.text}`),networkDetails:m,stats:y}))},onAbort:(f,p,m)=>{this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:m,stats:f}))},onTimeout:(f,p,m)=>{this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:m,stats:f}))}};t&&(g.onProgress=(f,p,m,y)=>t({frag:e,part:null,payload:m,networkDetails:y})),u.load(c,h,g)})}loadPart(e,t,s){this.abort();const n=this.config,i=n.fLoader,o=n.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(cp(e,t));return}const u=this.loader=i?new i(n):new o(n),c=up(e,t);e.loader=u;const d=op(n.fragLoadPolicy.default),h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:lp};t.stats=u.stats,u.load(c,h,{onSuccess:(g,f,p,m)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:g.data,networkDetails:m};s(y),a(y)},onError:(g,f,p,m)=>{this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:de({url:c.url,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:p,stats:m}))},onAbort:(g,f,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:g}))},onTimeout:(g,f,p)=>{this.resetLoader(e,u),l(new Ar({type:q.NETWORK_ERROR,details:L.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:p,stats:g}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,i=n.total;if(s.loaded+=n.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(s.loaded/i),l),d=(l-u)*Math.round(s.loaded/u);s.total=s.loaded+d}else s.total=Math.max(s.loaded,s.total);const o=s.loading,a=n.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function up(r,e=null){const t=e||r,s={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(G(n)&&G(i)){var o;let a=n,l=i;if(r.sn==="initSegment"&&jI((o=r.decryptdata)==null?void 0:o.method)){const u=i-n;u%16&&(l=i+(16-u%16)),n!==0&&(s.resetIV=!0,a=n-16)}s.rangeStart=a,s.rangeEnd=l}return s}function cp(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),s={type:q.MEDIA_ERROR,details:L.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(s.part=e),(e||r).stats.aborted=!0,new Ar(s)}function jI(r){return r==="AES-128"||r==="AES-256"}class Ar extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class bv extends Vt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Ah{constructor(e,t,s,n=0,i=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=$o(),this.buffering={audio:$o(),video:$o(),audiovideo:$o()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=i,this.partial=o}}function $o(){return{start:0,executeStart:0,executeEnd:0,end:0}}const dp={length:0,start:()=>0,end:()=>0};class re{static isBuffered(e,t){if(e){const s=re.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=re.getBuffered(e);return re.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=re.bufferedRanges(e);if(n.length)return re.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let n=-1,i=[];if(s)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(n=c);const d=i.length;if(d){const h=i[d-1].end;e[c].start-h<s?e[c].end>h&&(i[d-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let o=0,a,l=t,u=t;for(let c=0;c<i.length;c++){const d=i[c].start,h=i[c].end;if(n===-1&&t>=d&&t<=h&&(n=c),t+s>=d&&t<h)l=d,u=h,o=u-t;else if(t+s<d){a=d;break}}return{len:o,start:l||0,end:u||0,nextStart:a,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||dp}catch(t){return he.log("failed to get media.buffered",t),dp}}}const Lv=/\{\$([a-zA-Z0-9-_]+)\}/g;function hp(r){return Lv.test(r)}function td(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(Lv,s=>{const n=s.substring(2,s.length-1),i=t==null?void 0:t[n];return i===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):i})}return e}function fp(r,e,t){let s=r.variableList;s||(r.variableList=s={});let n,i;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))i=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,i=e.VALUE;n in s?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=i||""}function GI(r,e,t){const s=e.IMPORT;if(t&&s in t){let n=r.variableList;n||(r.variableList=n={}),n[s]=t[s]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const KI=/^(\d+)x(\d+)$/,gp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class _e{constructor(e,t){typeof e=="string"&&(e=_e.parseAttrList(e,t)),ge(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,i)=>(n[i.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=KI.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={},i='"';for(gp.lastIndex=0;(s=gp.exec(e))!==null;){const o=s[1].trim();let a=s[2];const l=a.indexOf(i)===0&&a.lastIndexOf(i)===a.length-1;let u=!1;if(l)a=a.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))a=td(t,a);else if(!u&&!l)switch(o){case"CLOSED-CAPTIONS":if(a==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":he.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=a}return n}}const VI="com.apple.hls.interstitial";function HI(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function WI(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class kv{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:s,t){const i=t.attr;for(const o in i)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==i[o]){he.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=ge(new _e({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);G(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(he.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(G(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===VI}get isValid(){return!!this.id&&!this._badValueForSameId&&G(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const zI=10;class qI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?G(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||zI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function el(r,e){return r.length===e.length?!r.some((t,s)=>t!==e[s]):!1}function pp(r,e){return!r&&!e?!0:!r||!e?!1:el(r,e)}function Ln(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Rh(r){switch(r){case"AES-128":case"AES-256":return ls.cbc;case"AES-256-CTR":return ls.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function Ih(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function rd(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function YI(r){const e=rd(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Cv(r){const e=function(s,n,i){const o=s[n];s[n]=s[i],s[i]=o};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function Pv(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const i=n[0]==="base64",o=n[1];i?(s.splice(-1,1),t=Ih(o)):t=YI(o)}}return t}const tl=typeof self<"u"?self:void 0;var Ae={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Je={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ga(r){switch(r){case Je.FAIRPLAY:return Ae.FAIRPLAY;case Je.PLAYREADY:return Ae.PLAYREADY;case Je.WIDEVINE:return Ae.WIDEVINE;case Je.CLEARKEY:return Ae.CLEARKEY}}function _u(r){switch(r){case Ae.FAIRPLAY:return Je.FAIRPLAY;case Ae.PLAYREADY:return Je.PLAYREADY;case Ae.WIDEVINE:return Je.WIDEVINE;case Ae.CLEARKEY:return Je.CLEARKEY}}function di(r){const{drmSystems:e,widevineLicenseUrl:t}=r,s=e?[Ae.FAIRPLAY,Ae.WIDEVINE,Ae.PLAYREADY,Ae.CLEARKEY].filter(n=>!!e[n]):[];return!s[Ae.WIDEVINE]&&t&&s.push(Ae.WIDEVINE),s}const Dv=function(r){return tl!=null&&(r=tl.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function QI(r,e,t,s){let n;switch(r){case Ae.FAIRPLAY:n=["cenc","sinf"];break;case Ae.WIDEVINE:case Ae.PLAYREADY:n=["cenc"];break;case Ae.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return XI(n,e,t,s)}function XI(r,e,t,s){return[{initDataTypes:r,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function JI(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function Ov(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=Ih(a).subarray(0,16);return Cv(l),l}}return null}let Zs={};class ns{static clearKeyUriToKeyIdMap(){Zs={}}static setKeyIdForUri(e,t){Zs[e]=t}static addKeyIdForUri(e){const t=Object.keys(Zs).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),Zs[e]=s,s}constructor(e,t,s,n=[1],i=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ln(e),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(lv(o)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&el(e.keyFormatVersions,this.keyFormatVersions)&&pp(e.iv,this.iv)&&pp(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ln(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Je.FAIRPLAY:case Je.WIDEVINE:case Je.PLAYREADY:case Je.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ln(this.method)){let i=this.iv;return i||(typeof e!="number"&&(he.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=eb(e)),new ns(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Zs[this.uri];if(i&&!el(this.keyId,i)&&ns.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=Pv(this.uri);if(s)switch(this.keyFormat){case Je.WIDEVINE:if(this.pssh=s,!this.keyId){const i=sI(s.buffer);if(i.length){var n;const o=i[0];this.keyId=(n=o.kids)!=null&&n.length?o.kids[0]:null}}this.keyId||(this.keyId=mp(t));break;case Je.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=rI(i,null,s),this.keyId=Ov(s);break}default:{let i=s.subarray(0,16);if(i.length!==16){const o=new Uint8Array(16);o.set(i,16-i.length),i=o}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=ZI(t),i||(i=mp(t),i||(i=Zs[this.uri])),i&&(this.keyId=i,ns.setKeyIdForUri(this.uri,i))}return this}}function ZI(r){const e=r==null?void 0:r[Je.WIDEVINE];return e?e.keyId:null}function mp(r){const e=r==null?void 0:r[Je.PLAYREADY];if(e){const t=Pv(e.uri);if(t)return Ov(t)}return null}function eb(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const yp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vp=/#EXT-X-MEDIA:(.*)/g,tb=/^#EXT(?:INF|-X-TARGETDURATION):/m,wu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),rb=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class mr{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return vh.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return tb.test(e)}static parseMasterPlaylist(e,t){const s=hp(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},i=[];if(yp.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let o;for(;(o=yp.exec(e))!=null;)if(o[1]){var a;const u=new _e(o[1],n),c=td(n,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:mr.resolve(c,t)},h=u.decimalResolution("RESOLUTION");h&&(d.width=h.width,d.height=h.height),Tp(u.CODECS,d);const g=u["SUPPLEMENTAL-CODECS"];g&&(d.supplemental={},Tp(g,d.supplemental)),(a=d.unknownCodecs)!=null&&a.length||i.push(d),n.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new _e(c,n),h=d["DATA-ID"];h&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[h]=d);break}case"SESSION-KEY":{const d=Ep(c,t,n);d.encrypted&&d.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(d)):he.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new _e(c,n);fp(n,d,t)}break}case"CONTENT-STEERING":{const d=new _e(c,n);n.contentSteering={uri:mr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Sp(c);break}}}const l=i.length>0&&i.length<n.levels.length;return n.levels=l?i:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const i={},o=s.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(vp.lastIndex=0;(n=vp.exec(e))!==null;){const u=new _e(n[1],s),c=u.TYPE;if(c){const d=a[c],h=i[c]||[];i[c]=h;const g=u.LANGUAGE,f=u["ASSOC-LANGUAGE"],p=u.CHANNELS,m=u.CHARACTERISTICS,y=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||g||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:g,url:u.URI?mr.resolve(u.URI,t):""};if(f&&(v.assocLang=f),p&&(v.channels=p),m&&(v.characteristics=m),y&&(v.instreamId=y),d!=null&&d.length){const E=mr.findGroup(d,v.groupId)||d[0];_p(v,E,"audioCodec"),_p(v,E,"textCodec")}h.push(v)}}return i}static parseLevelPlaylist(e,t,s,n,i,o){var a;const l={url:t},u=new qI(t),c=u.fragments,d=[];let h=null,g=0,f=0,p=0,m=0,y=0,v=null,E=new Eu(n,l),T,_,x,w=-1,A=!1,I=null,R;if(wu.lastIndex=0,u.m3u8=e,u.hasVariableRefs=hp(e),((a=wu.exec(e))==null?void 0:a[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(T=wu.exec(e))!==null;){A&&(A=!1,E=new Eu(n,l),E.playlistOffset=p,E.setStart(p),E.sn=g,E.cc=m,y&&(E.bitrate=y),E.level=s,h&&(E.initSegment=h,h.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null),I&&(E.setByteRange(I),I=null)));const K=T[1];if(K){E.duration=parseFloat(K);const V=(" "+T[2]).slice(1);E.title=V||null,E.tagList.push(V?["INF",K,V]:["INF",K])}else if(T[3]){if(G(E.duration)){E.playlistOffset=p,E.setStart(p),x&&xp(E,x,u),E.sn=g,E.level=s,E.cc=m,c.push(E);const V=(" "+T[3]).slice(1);E.relurl=td(u,V),sd(E,v,d),v=E,p+=E.duration,g++,f=0,A=!0}}else{if(T=T[0].match(rb),!T){he.warn("No matches on slow regex match for level playlist!");continue}for(_=1;_<T.length&&T[_]===void 0;_++);const V=(" "+T[_]).slice(1),M=(" "+T[_+1]).slice(1),H=T[_+2]?(" "+T[_+2]).slice(1):null;switch(V){case"BYTERANGE":v?E.setByteRange(M,v):E.setByteRange(M);break;case"PROGRAM-DATE-TIME":E.rawProgramDateTime=M,E.tagList.push(["PROGRAM-DATE-TIME",M]),w===-1&&(w=c.length);break;case"PLAYLIST-TYPE":u.type&&Tr(u,V,T),u.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Tr(u,V,T):c.length>0&&Ap(u,V,T),g=u.startSN=parseInt(M);break;case"SKIP":{u.skippedSegments&&Tr(u,V,T);const k=new _e(M,u),N=k.decimalInteger("SKIPPED-SEGMENTS");if(G(N)){u.skippedSegments+=N;for(let O=N;O--;)c.push(null);g+=N}const B=k.enumeratedString("RECENTLY-REMOVED-DATERANGES");B&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(B.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Tr(u,V,T),u.targetduration=Math.max(parseInt(M),1);break;case"VERSION":u.version!==null&&Tr(u,V,T),u.version=parseInt(M);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Tr(u,V,T),u.live=!1;break;case"#":(M||H)&&E.tagList.push(H?[M,H]:[M]);break;case"DISCONTINUITY":m++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([V]);break;case"BITRATE":E.tagList.push([V,M]),y=parseInt(M)*1e3,G(y)?E.bitrate=y:y=0;break;case"DATERANGE":{const k=new _e(M,u),N=new kv(k,u.dateRanges[k.ID],u.dateRangeTagCount);u.dateRangeTagCount++,N.isValid||u.skippedSegments?u.dateRanges[N.id]=N:he.warn(`Ignoring invalid DATERANGE tag: "${M}"`),E.tagList.push(["EXT-X-DATERANGE",M]);break}case"DEFINE":{{const k=new _e(M,u);"IMPORT"in k?GI(u,k,o):fp(u,k,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Tr(u,V,T):c.length>0&&Ap(u,V,T),u.startCC=m=parseInt(M);break;case"KEY":{const k=Ep(M,t,u);if(k.isSupported()){if(k.method==="NONE"){x=void 0;break}x||(x={});const N=x[k.keyFormat];N!=null&&N.matches(k)||(N&&(x=ge({},x)),x[k.keyFormat]=k)}else he.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${M}"`);break}case"START":u.startTimeOffset=Sp(M);break;case"MAP":{const k=new _e(M,u);if(E.duration){const N=new Eu(n,l);wp(N,k,s,x),h=N,E.initSegment=h,h.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=h.rawProgramDateTime)}else{const N=E.byteRangeEndOffset;if(N){const B=E.byteRangeStartOffset;I=`${N-B}@${B}`}else I=null;wp(E,k,s,x),h=E,A=!0}h.cc=m;break}case"SERVER-CONTROL":{R&&Tr(u,V,T),R=new _e(M),u.canBlockReload=R.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=R.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&R.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=R.optionalFloat("PART-HOLD-BACK",0),u.holdBack=R.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Tr(u,V,T);const k=new _e(M);u.partTarget=k.decimalFloatingPoint("PART-TARGET");break}case"PART":{let k=u.partList;k||(k=u.partList=[]);const N=f>0?k[k.length-1]:void 0,B=f++,O=new _e(M,u),F=new GR(O,E,l,B,N);k.push(F),E.duration+=F.duration;break}case"PRELOAD-HINT":{const k=new _e(M,u);u.preloadHint=k;break}case"RENDITION-REPORT":{const k=new _e(M,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(k);break}default:he.warn(`line parsed but not handled: ${T}`);break}}}v&&!v.relurl?(c.pop(),p-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(sd(E,v,d),E.cc=m,u.fragmentHint=E,x&&xp(E,x,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const P=c.length,$=c[0],j=c[P-1];if(p+=u.skippedSegments*u.targetduration,p>0&&P&&j){u.averagetargetduration=p/P;const K=j.sn;u.endSN=K!=="initSegment"?K:0,u.live||(j.endList=!0),w>0&&(nb(c,w),$&&d.unshift($))}return u.fragmentHint&&(p+=u.fragmentHint.duration),u.totalduration=p,d.length&&u.dateRangeTagCount&&$&&Nv(d,u),u.endCC=m,u}}function Nv(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const a=e.fragments[e.fragments.length-1];r.push(a),t++}else return;const s=r[t-1],n=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let a=i.length;a--;){const l=e.dateRanges[i[a]],u=l.startDate.getTime();l.tagAnchor=s.ref;for(let c=t;c--;){var o;if(((o=r[c])==null?void 0:o.sn)<e.startSN)break;const d=sb(e,u,r,c,n);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function sb(r,e,t,s,n){const i=t[s];if(i){const a=i.programDateTime;if(e>=a||s===0){var o;const l=(((o=t[s+1])==null?void 0:o.start)||n)-i.start;if(e<=a+l*1e3){const u=t[s].sn-r.startSN;if(u<0)return-1;const c=r.fragments;if(c.length>t.length){const h=(t[s+1]||c[c.length-1]).sn-r.startSN;for(let g=h;g>u;g--){const f=c[g].programDateTime;if(e>=f&&e<f+c[g].duration*1e3)return g}}return u}}}return-1}function Ep(r,e,t){var s,n;const i=new _e(r,t),o=(s=i.METHOD)!=null?s:"",a=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(n=i.KEYFORMAT)!=null?n:"identity";a&&i.IV&&!l&&he.error(`Invalid IV: ${i.IV}`);const d=a?mr.resolve(a,e):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ns(o,d,c,h,l,i.KEYID)}function Sp(r){const t=new _e(r).decimalFloatingPoint("TIME-OFFSET");return G(t)?t:null}function Tp(r,e){let t=(r||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(i=>Th(i,s));n.length&&(e[`${s}Codec`]=n.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>n.indexOf(i)===-1))}),e.unknownCodecs=t}function _p(r,e,t){const s=e[t];s&&(r[t]=s)}function nb(r,e){let t=r[e];for(let s=e;s--;){const n=r[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function sd(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function wp(r,e,t,s){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",s&&(r.levelkeys=s),r.initSegment=null}function xp(r,e,t){r.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(r)}function Tr(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Ap(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function xu(r,e){const t=e.startPTS;if(G(t)){let s=0,n;e.sn>r.sn?(s=t-r.start,n=r):(s=r.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function Fv(r,e,t,s,n,i,o){s-t<=0&&(o.warn("Fragment should have a positive duration",e),s=t+e.duration,i=n+e.duration);let l=t,u=s;const c=e.startPTS,d=e.endPTS;if(G(c)){const y=Math.abs(c-t);r&&y>r.totalduration?o.warn(`media timestamps and playlist times differ by ${y}s for level ${e.level} ${r.url}`):G(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,l=Math.max(t,c),t=Math.min(t,c),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,u=Math.min(s,d),s=Math.max(s,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const h=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=n,e.endPTS=s,e.minEndPTS=u,e.endDTS=i;const g=e.sn;if(!r||g<r.startSN||g>r.endSN)return 0;let f;const p=g-r.startSN,m=r.fragments;for(m[p]=e,f=p;f>0;f--)xu(m[f],m[f-1]);for(f=p;f<m.length-1;f++)xu(m[f],m[f+1]);return r.fragmentHint&&xu(m[m.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,h}function ib(r,e,t){if(r===e)return;let s=null;const n=r.fragments;for(let c=n.length-1;c>=0;c--){const d=n[c].initSegment;if(d){s=d;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i;lb(r,e,(c,d,h,g)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const f=c.cc-d.cc;for(let p=h;p<g.length;p++)g[p].cc+=f;e.endCC=g[g.length-1].cc}G(c.startPTS)&&G(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,s=c.initSegment)});const o=e.fragments,a=e.fragmentHint?o.concat(e.fragmentHint):o;if(s&&a.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=s)==null?void 0:d.relurl))&&(c.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=o.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)o.shift();e.startSN=o[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=ob(r.dateRanges,e,t));const c=r.fragments.filter(d=>d.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<a.length;d++)a[d].programDateTime===null&&sd(a[d],a[d-1],c);Nv(c,e)}e.endCC=o[o.length-1].cc}if(!e.startCC){var l;const c=$v(r,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:o[0].cc}ab(r.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),i?Fv(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):Mv(r,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function ob(r,e,t){const{dateRanges:s,recentlyRemovedDateranges:n}=e,i=ge({},r);n&&n.forEach(l=>{delete i[l]});const a=Object.keys(i).length;return a?(Object.keys(s).forEach(l=>{const u=i[l],c=new kv(s[l].attr,u);c.isValid?(i[l]=c,u||(c.tagOrder+=a)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${me(s[l].attr)}"`)}),i):s}function ab(r,e,t){if(r&&e){let s=0;for(let n=0,i=r.length;n<=i;n++){const o=r[n],a=e[n+s];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):s--}}}function lb(r,e,t){const s=e.skippedSegments,n=Math.max(r.startSN,e.startSN)-e.startSN,i=(r.fragmentHint?1:0)+(s?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,o=e.startSN-r.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let u=n;u<=i;u++){const c=l[o+u];let d=a[u];if(s&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,a);const h=c.relurl,g=d.relurl;if(h&&ub(h,g)){e.playlistParsingError=Rp(`media sequence mismatch ${d.sn}:`,r,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Rp(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,r,e,c,d);return}}}}function Rp(r,e,t,s,n){return new Error(`${r} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function Mv(r,e,t=!0){const s=e.startSN+e.skippedSegments-r.startSN,n=r.fragments,i=s>=0;let o=0;if(i&&s<n.length)o=n[s].start;else if(i&&e.startSN===r.endSN+1)o=r.fragmentEnd;else if(i&&t)o=r.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=r.fragmentStart;else return;nd(e,o)}function nd(r,e){if(e){const t=r.fragments;for(let s=r.skippedSegments;s<t.length;s++)t[s].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Uv(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const s=r.fragments;if(s.length&&t*4>e){const i=s[s.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function $v(r,e,t){if(!r)return null;let s=r.fragments[e-r.startSN];return s||(s=r.fragmentHint,s&&s.sn===e)?s:e<r.startSN&&t&&t.sn===e?t:null}function Ip(r,e,t){return r?Bv(r.partList,e,t):null}function Bv(r,e,t){if(r)for(let s=r.length;s--;){const n=r[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function jv(r){r.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function ub(r,e){return r!==e&&e?bp(r)!==bp(e):!1}function bp(r){return r.replace(/\?[^?]*$/,"")}function wi(r,e){for(let s=0,n=r.length;s<n;s++){var t;if(((t=r[s])==null?void 0:t.cc)===e)return r[s]}return null}function cb(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function Lp(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function Gv(r,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)Lp(t[s],r);e.fragmentHint&&Lp(e.fragmentHint,r),e.alignedSliding=!0}function db(r,e){r&&(Kv(e,r),e.alignedSliding||rl(e,r),!e.alignedSliding&&!e.skippedSegments&&Mv(r,e,!1))}function Kv(r,e){if(!cb(e,r))return;const t=Math.min(e.endCC,r.endCC),s=wi(e.fragments,t),n=wi(r.fragments,t);if(!s||!n)return;he.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=s.start-n.start;Gv(i,r)}function rl(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,i;const o=Math.min(e.endCC,r.endCC);e.startCC<o&&r.startCC<o&&(n=wi(s,o),i=wi(t,o)),(!n||!i)&&(n=s[Math.floor(s.length/2)],i=wi(t,n.cc)||t[Math.floor(t.length/2)]);const a=n.programDateTime,l=i.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(i.start-n.start);Gv(u,r)}function lt(r,e,t){pt(r,e,t),r.addEventListener(e,t)}function pt(r,e,t){r.removeEventListener(e,t)}const hb={toString:function(r){let e="";const t=r.length;for(let s=0;s<t;s++)e+=`[${r.start(s).toFixed(3)}-${r.end(s).toFixed(3)}]`;return e}},D={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class bh extends bv{constructor(e,t,s,n,i){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=D.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:a,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,h=re.bufferInfo(u||l,d,o.maxBufferHole),g=!h.len;if(this.log(`Media seeking to ${G(d)?d.toFixed(3):d}, state: ${c}, ${g?"out of":"in"} buffer`),this.state===D.ENDED)this.resetLoadingState();else if(a){const f=o.maxFragLookUpTolerance,p=a.start-f,m=a.start+a.duration+f;if(g||m<h.start||p>h.end){const y=d>m;(d<p||y)&&(y&&a.loader&&(this.log(`Cancelling fragment load for seek (sn: ${a.sn})`),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const f=this.lastCurrentTime;if(d>f&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(h.end,d),m=this.shouldLoadParts(this.getLevelDetails(),p);m&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=m)}}this.hls.hasEnoughToStart||(this.log(`Setting ${g?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,g&&(this.startPosition=d)),g&&this.state===D.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new BI(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new xh(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===D.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=D.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=re.bufferedInfo(i,e.start,0));const o=e.nextStart;if(o&&o>n&&o<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return re.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;lt(s,"seeking",this.onMediaSeeking),lt(s,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===D.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),pt(n,"seeking",this.onMediaSeeking),pt(n,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=D.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=i=>{const o=i.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(o,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,s,n).then(i=>{if(!i)return;const o=this.state,a=i.frag;if(this.fragContextChanged(a)){(o===D.FRAG_LOADING||!this.fragCurrent&&o===D.PARSING)&&(this.fragmentTracker.removeFragment(a),this.state=D.IDLE);return}"payload"in i&&(this.log(`Loaded ${a.type} sn: ${a.sn} of ${this.playlistLabel()} ${a.level}`),this.hls.trigger(S.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===D.STOPPED||this.state===D.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===je.APPENDING){const i=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,i),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===je.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(S.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s==null?void 0:s.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:i,payload:o}=s,a=i.decryptdata;if(o&&o.byteLength>0&&a!=null&&a.key&&a.iv&&Ln(a.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),a.key.buffer,a.iv.buffer,Rh(a.method)).catch(u=>{throw n.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(u=>{const c=self.performance.now();return n.trigger(S.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:l,tdecrypt:c}}),s.payload=u,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===D.STOPPED||this.state===D.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==D.STOPPED&&(this.state=D.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,n;const i=e.tracks;if(i&&!t.encrypted&&((s=i.audio)!=null&&s.encrypted||(n=i.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,a=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(a.message),!o||o.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_NO_KEYS,fatal:!1,error:a,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?hb.toString(re.getBuffered(s)):"(detached)"})`),Oe(e)){var n;if(e.type!==W.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(a=>!!o[a])){this.state=D.IDLE;return}}const i=(n=this.levels)==null?void 0:n[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=D.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:i}=e,o=!i||i.length===0||i.some(l=>!l),a=new Ah(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var i;this.fragCurrent=e;const o=t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=D.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(h=>{if(!this.fragContextChanged(h.frag))return this.hls.trigger(S.KEY_LOADED,h),this.state===D.KEY_LOADING&&(this.state=D.IDLE),h}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(a=this.keyLoader.loadClear(e,o.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Oe(e)&&(!l||e.sn!==l.sn)){const h=this.shouldLoadParts(t.details,e.end);h!==this.loadingParts&&(this.log(`LL-Part loading ${h?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=h)}if(s=Math.max(e.start,s||0),this.loadingParts&&Oe(e)){const h=o.partList;if(h&&n){s>o.fragmentEnd&&o.fragmentHint&&(e=o.fragmentHint);const g=this.getNextPart(h,e,s);if(g>-1){const f=h[g];e=this.fragCurrent=f.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${f.index} (${g}/${h.length-1}) of ${this.fragInfo(e,!1,f)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=D.FRAG_LOADING;let p;return a?p=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,f,t,n)).catch(m=>this.handleFragLoadError(m)):p=this.doFragPartsLoad(e,f,t,n).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:f,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(h,s))return Promise.resolve(null)}}if(Oe(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=o.partList)==null?void 0:u.filter(h=>h.loaded).map(h=>`[${h.start}-${h.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),G(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=D.FRAG_LOADING;const c=this.config.progressive&&e.type!==W.SUBTITLE;let d;return c&&a?d=a.then(h=>!h||this.fragContextChanged(h.frag)?null:this.fragmentLoader.load(e,n)).catch(h=>this.handleFragLoadError(h)):d=Promise.all([this.fragmentLoader.load(e,c?n:void 0),a]).then(([h])=>(!c&&n&&n(h),h)).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,s,n){return new Promise((i,o)=>{var a;const l=[],u=(a=s.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,n).then(h=>{l[d.index]=h;const g=h.part;this.hls.trigger(S.FRAG_LOADED,h);const f=Ip(s.details,e.sn,d.index+1)||Bv(u,e.sn,d.index+1);if(f)c(f);else return i({frag:e,part:g,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===L.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===q.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(S.ERROR,t)}else this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==D.PARSING){!this.fragCurrent&&this.state!==D.STOPPED&&this.state!==D.ERROR&&(this.state=D.IDLE);return}const{frag:s,part:n,level:i}=t,o=self.performance.now();s.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const a=this.getLevelDetails(),u=a&&s.sn>a.endSN||this.shouldLoadParts(a,s.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(s,n,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const i=e.partList[0];if(i.fragment.type===W.SUBTITLE)return!1;const o=i.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:i,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const a=t[n],l=a.details,u=o>-1?Ip(l,i,o):null,c=u?u.fragment:$v(l,i,s);return c?(s&&s!==c&&(c.stats=s.stats),{frag:c,part:u,level:a}):null}bufferFragmentData(e,t,s,n,i){if(this.state!==D.PARSING)return;const{data1:o,data2:a}=e;let l=o;if(a&&(l=Kt(o,a)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:s,chunkMeta:n,offset:c,parent:t.type,data:l};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!s){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!re.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=re.bufferInfo(t,s,0),i=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),a=Math.max(Math.min(e.start-o,n.end-o),s+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!G(n))return null;const o=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,s,n){const i=re.bufferInfo(e,t,n);if(i.len===0&&i.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,s);if(o&&(i.nextStart<=o.end||o.gap)){const a=Math.max(Math.min(i.nextStart,o.end)-t,n);return re.bufferInfo(e,t,a)}}return i}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),i=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return i>=n?(s.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=W.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:i}=this,o=s[0].start,a=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(n<d)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var u;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const h=this.hls.startPosition,g=this.hls.liveSyncPosition,f=l?(h!==-1&&h>=o?h:g)||l.start:e;this.log(`Setting startPosition to ${f} to match start frag at live edge. mainStart: ${h} liveSyncPosition: ${g} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=f}}else e<=o&&(l=s[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(s[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===je.OK||s===je.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,i){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&s.nextStart)){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(a!==null&&s.len+a.len>=i){const l=o.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(kp(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(kp(this.config)&&e.type!==W.SUBTITLE){const s=this.hls.interstitialsManager,n=s==null?void 0:s.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const i=s==null?void 0:s.playerQueue;if(i)for(let o=i.length;o--;){const a=i[o].interstitial;if(a.appendInPlace&&e.start>=a.startTime&&e.end<=a.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,i=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,n>-1&&s<u.start)break;const c=u.loaded;c?n=-1:(i||(u.independent||o)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${u.start}`),n=a),i=c}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=bI(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=s.sn+1;if(i>=e.startSN&&i<=e.endSN){const o=t[i-e.startSN];s.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Av(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(n=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:i}=this,{fragments:o,endSN:a}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:u}=n,c=s.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(o=o.concat(l),a=l.sn);let h;if(e<t){var g;const p=e<this.lastCurrentTime||e>t-u||(g=this.media)!=null&&g.paused||!this.startFragRequested?0:u;h=Bs(i,o,e,p)}else h=o[o.length-1];if(h){const f=h.sn-s.startSN,p=this.fragmentTracker.getState(h);if((p===je.OK||p===je.PARTIAL&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!d||c[0].fragment.sn>h.sn||!s.live)&&h.level===i.level){const y=o[f+1];h.sn<a&&this.fragmentTracker.getState(y)!==je.OK?h=y:h=null}}return h}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,o=!t,a=e.alignedSliding&&G(i);if(o||!a&&!i){db(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const i=this.startTimeOffset!==null,o=i?this.startTimeOffset:e.startTimeOffset;o!==null&&G(o)?(s=t+o,o<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${i?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Oe(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==D.FRAG_LOADING_WAITING_RETRY)&&(this.state=D.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const o=t.details===L.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(n,!0);const a=t.errorAction;if(!a){this.state=D.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=a,h=!!d,g=h&&l===Qe.RetryRequest,f=h&&!a.resolved&&u===wt.MoveAllAlternatesMatchingHost,p=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!g&&f&&Oe(n)&&!n.endList&&p&&!Iv(t))this.resetFragmentErrors(e),this.treatAsGap(n),a.resolved=!0;else if((g||f)&&c<d.maxNumRetry){var m;const y=ed((m=t.response)==null?void 0:m.code),v=wh(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state=D.FRAG_LOADING_WAITING_RETRY,a.resolved=!0,y){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${v}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!o&&l!==Qe.RemoveAlternatePermanently&&(a.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===Qe.SendAlternateToPenaltyBox?this.state=D.WAITING_LEVEL:this.state=D.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!ed(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=D.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===D.PARSING||this.state===D.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const o=!i;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===W.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==D.STOPPED&&(this.state=D.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=re.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===D.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==D.STOPPED&&(this.state=D.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const i=s.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const h=n?0:Fv(i,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:i,level:s,drift:h,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var a;const l=((a=this.transmuxer)==null?void 0:a.error)===null;if((s.fragmentError===0||l&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=D.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===W.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,i;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((i=t&&!s?e.endPTS:(s||e).end)!=null?i:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function kp(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class Vv{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=fb(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function fb(r,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}var Au={exports:{}},Cp;function gb(){return Cp||(Cp=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var g=new n(c,d||l,h),f=t?t+u:u;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],g]:l._events[f].push(g):(l._events[f]=g,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new s:delete l._events[u]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,g=d.length,f=new Array(g);h<g;h++)f[h]=d[h].fn;return f},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,h,g,f){var p=t?t+u:u;if(!this._events[p])return!1;var m=this._events[p],y=arguments.length,v,E;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,d),!0;case 4:return m.fn.call(m.context,c,d,h),!0;case 5:return m.fn.call(m.context,c,d,h,g),!0;case 6:return m.fn.call(m.context,c,d,h,g,f),!0}for(E=1,v=new Array(y-1);E<y;E++)v[E-1]=arguments[E];m.fn.apply(m.context,v)}else{var T=m.length,_;for(E=0;E<T;E++)switch(m[E].once&&this.removeListener(u,m[E].fn,void 0,!0),y){case 1:m[E].fn.call(m[E].context);break;case 2:m[E].fn.call(m[E].context,c);break;case 3:m[E].fn.call(m[E].context,c,d);break;case 4:m[E].fn.call(m[E].context,c,d,h);break;default:if(!v)for(_=1,v=new Array(y-1);_<y;_++)v[_-1]=arguments[_];m[E].fn.apply(m[E].context,v)}}return!0},a.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,h){var g=t?t+u:u;if(!this._events[g])return this;if(!c)return o(this,g),this;var f=this._events[g];if(f.fn)f.fn===c&&(!h||f.once)&&(!d||f.context===d)&&o(this,g);else{for(var p=0,m=[],y=f.length;p<y;p++)(f[p].fn!==c||h&&!f[p].once||d&&f[p].context!==d)&&m.push(f[p]);m.length?this._events[g]=m.length===1?m[0]:m:o(this,g)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a}(Au)),Au.exports}var pb=gb(),Lh=BR(pb);const Ji="1.6.15",jn={};function mb(){return typeof __HLS_WORKER_BUNDLE__=="function"}function yb(){const r=jn[Ji];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return jn[Ji]=n,n}function vb(r){const e=jn[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return jn[r]=n,n}function Eb(r){const e=jn[r||Ji];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete jn[r||Ji],n&&self.URL.revokeObjectURL(n),s.terminate()}}function Hv(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function kh(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function kl(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Zi(r,e){const t=e;let s=0;for(;kh(r,e);){s+=10;const n=kl(r,e+6);s+=n,Hv(r,e+10)&&(s+=10),e+=s}if(s>0)return r.subarray(t,t+s)}function Sb(r,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],o=i>>2&15;if(o>12){const g=new Error(`invalid ADTS sampling index:${o}`);r.emit(S.ERROR,S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_PARSING_ERROR,fatal:!0,error:g,reason:g.message});return}const a=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,u="mp4a.40."+a,c=n[o];let d=o;(a===5||a===29)&&(d-=3);const h=[a<<3|(d&14)>>1,(d&1)<<7|l<<3];return he.log(`manifest codec:${s}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${a} sampling index:${o})`),{config:h,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:s}}function Wv(r,e){return r[e]===255&&(r[e+1]&246)===240}function zv(r,e){return r[e+1]&1?7:9}function Ch(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function Tb(r,e){return e+5<r.length}function sl(r,e){return e+1<r.length&&Wv(r,e)}function _b(r,e){return Tb(r,e)&&Wv(r,e)&&Ch(r,e)<=r.length-e}function wb(r,e){if(sl(r,e)){const t=zv(r,e);if(e+t>=r.length)return!1;const s=Ch(r,e);if(s<=t)return!1;const n=e+s;return n===r.length||sl(r,n)}return!1}function qv(r,e,t,s,n){if(!r.samplerate){const i=Sb(e,t,s,n);if(!i)return;ge(r,i)}}function Yv(r){return 1024*9e4/r}function xb(r,e){const t=zv(r,e);if(e+t<=r.length){const s=Ch(r,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function Qv(r,e,t,s,n){const i=Yv(r.samplerate),o=s+n*i,a=xb(e,t);let l;if(a){const{frameLength:d,headerLength:h}=a,g=h+d,f=Math.max(0,t+g-e.length);f?(l=new Uint8Array(g-h),l.set(e.subarray(t+h,e.length),0)):l=e.subarray(t+h,t+g);const p={unit:l,pts:o};return f||r.samples.push(p),{sample:p,length:g,missing:f}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}function Ab(r,e){return kh(r,e)&&kl(r,e+6)+10<=r.length-e}function Rb(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Ru(r,e=0,t=1/0){return Ib(r,e,t,Uint8Array)}function Ib(r,e,t,s){const n=bb(r);let i=1;"BYTES_PER_ELEMENT"in s&&(i=s.BYTES_PER_ELEMENT);const o=Lb(r)?r.byteOffset:0,a=(o+r.byteLength)/i,l=(o+e)/i,u=Math.floor(Math.max(0,Math.min(l,a))),c=Math.floor(Math.min(u+Math.max(t,0),a));return new s(n,u,c-u)}function bb(r){return r instanceof ArrayBuffer?r:r.buffer}function Lb(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function kb(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=r.data.subarray(1).indexOf(0);if(s===-1)return;const n=Ct(Ru(r.data,1,s)),i=r.data[2+s],o=r.data.subarray(3+s).indexOf(0);if(o===-1)return;const a=Ct(Ru(r.data,3+s,o));let l;return n==="-->"?l=Ct(Ru(r.data,4+s+o)):l=Rb(r.data.subarray(4+s+o)),e.mimeType=n,e.pictureType=i,e.description=a,e.data=l,e}function Cb(r){if(r.size<2)return;const e=Ct(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function Pb(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const s=Ct(r.data.subarray(t),!0);t+=s.length+1;const n=Ct(r.data.subarray(t));return{key:r.type,info:s,data:n}}const e=Ct(r.data.subarray(1));return{key:r.type,info:"",data:e}}function Db(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const s=Ct(r.data.subarray(t),!0);t+=s.length+1;const n=Ct(r.data.subarray(t));return{key:r.type,info:s,data:n}}const e=Ct(r.data);return{key:r.type,info:"",data:e}}function Ob(r){return r.type==="PRIV"?Cb(r):r.type[0]==="W"?Db(r):r.type==="APIC"?kb(r):Pb(r)}function Nb(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=kl(r,4),s=10;return{type:e,size:t,data:r.subarray(s,s+t)}}const Bo=10,Fb=10;function Xv(r){let e=0;const t=[];for(;kh(r,e);){const s=kl(r,e+6);r[e+5]>>6&1&&(e+=Bo),e+=Bo;const n=e+s;for(;e+Fb<n;){const i=Nb(r.subarray(e)),o=Ob(i);o&&t.push(o),e+=i.size+Bo}Hv(r,e)&&(e+=Bo)}return t}function Jv(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function Mb(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Ph(r){const e=Xv(r);for(let t=0;t<e.length;t++){const s=e[t];if(Jv(s))return Mb(s)}}let Rt=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function fr(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Dh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Kt(this.cachedData,e),this.cachedData=null);let s=Zi(e,0),n=s?s.length:0,i;const o=this._audioTrack,a=this._id3Track,l=s?Ph(s):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&G(l))&&(this.basePTS=Ub(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Rt.audioId3,duration:Number.POSITIVE_INFINITY});n<u;){if(this.canParse(e,n)){const c=this.appendFrame(o,e,n);c?(this.frameIndex++,this.lastPTS=c.sample.pts,n+=c.length,i=n):n=u}else Ab(e,n)?(s=Zi(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Rt.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,i=n):n++;if(n===u&&i!==u){const c=e.slice(i);this.cachedData?this.cachedData=Kt(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:fr(),id3Track:a,textTrack:fr()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:fr(),id3Track:this._id3Track,textTrack:fr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Ub=(r,e,t)=>{if(G(r))return r*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let jo=null;const $b=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Bb=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],jb=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Gb=[0,1,1,4];function Zv(r,e,t,s,n){if(t+24>e.length)return;const i=eE(e,t);if(i&&t+i.frameLength<=e.length){const o=i.samplesPerFrame*9e4/i.sampleRate,a=s+n*o,l={unit:e.subarray(t,t+i.frameLength),pts:a,dts:a};return r.config=[],r.channelCount=i.channelCount,r.samplerate=i.sampleRate,r.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function eE(r,e){const t=r[e+1]>>3&3,s=r[e+1]>>1&3,n=r[e+2]>>4&15,i=r[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&i!==3){const o=r[e+2]>>1&1,a=r[e+3]>>6,l=t===3?3-s:s===3?3:4,u=$b[l*14+n-1]*1e3,d=Bb[(t===3?0:t===2?1:2)*3+i],h=a===3?1:2,g=jb[t][s],f=Gb[s],p=g*8*f,m=Math.floor(g*u/d+o)*f;if(jo===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);jo=E?parseInt(E[1]):0}return!!jo&&jo<=87&&s===2&&u>=224e3&&a===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:h,frameLength:m,samplesPerFrame:p}}}function Oh(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function tE(r,e){return e+1<r.length&&Oh(r,e)}function Kb(r,e){return Oh(r,e)&&4<=r.length-e}function rE(r,e){if(e+1<r.length&&Oh(r,e)){const s=eE(r,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const i=e+n;return i===r.length||tE(r,i)}return!1}class Vb extends Dh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Zi(e,0);let n=(s==null?void 0:s.length)||0;if(rE(e,n))return!1;for(let i=e.length;n<i;n++)if(wb(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return _b(e,t)}appendFrame(e,t,s){qv(e,this.observer,t,s,e.manifestCodec);const n=Qv(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const sE=(r,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),i=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=r[e];const a=Math.min(s,8),l=8-a;i[0]=4278190080>>>24+l<<l,n[0]=(o[0]&i[0])>>l,t=t?t<<a|n[0]:n[0],e+=1,s-=a}return t};class Hb extends Dh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=nE(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=Zi(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Ph(t)!==void 0&&sE(e,s)<16}}function nE(r,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let h=0;d===2?h+=2:(d&1&&d!==1&&(h+=2),d&4&&(h+=2));const g=(e[t+6]<<8|e[t+7])>>12-h&1,p=[2,1,2,3,3,4,4,5][d]+g,m=e[t+5]>>3,y=e[t+5]&7,v=new Uint8Array([i<<6|m<<1|y>>2,(y&3)<<6|d<<3|g<<2|l>>4,l<<4&224]),E=1536/a*9e4,T=s+n*E,_=e.subarray(t,t+c);return r.config=v,r.channelCount=p,r.samplerate=a,r.samples.push({unit:_,pts:T}),c}class Wb extends Dh{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Zi(e,0);let s=(t==null?void 0:t.length)||0;if(t&&e[s]===11&&e[s+1]===119&&Ph(t)!==void 0&&sE(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(rE(e,s))return he.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Kb(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return Zv(e,t,s,this.basePTS,this.frameIndex)}}const zb=/\/emsg[-/]ID3/i;class qb{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const i=this.videoTrack=fr("video",1),o=this.audioTrack=fr("audio",1),a=this.txtTrack=fr("text",1);if(this.id3Track=fr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=gv(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:h}=l.video;i.id=u,i.timescale=a.timescale=c,i.codec=d,i.supplemental=h}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=dv.text,i.sampleDuration=0,i.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return HR(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Kt(this.remainderData,e));const a=JR(s);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=s;const o=this.extractID3Track(n,t);return i.samples=Yg(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=Yg(e,t),{videoTrack:t,audioTrack:fr(),id3Track:n,textTrack:fr()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=oe(e.samples,["emsg"]);n&&n.forEach(i=>{const o=eI(i);if(zb.test(o.schemeIdUri)){const a=Pp(o,t);let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;s.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Rt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const a=Pp(o,t);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:a,pts:a,type:Rt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Pp(r,e){return G(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class Yb{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new xh(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ls.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);n.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)s.set(e.subarray(i,i+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let i=32;i<e.length-16;i+=160,n+=16)e.set(s.subarray(n,n+16),i);return e}decryptAvcSample(e,t,s,n,i){const o=yv(i.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)}).catch(n)}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const i=e[t].units;for(;!(s>=i.length);s++){const o=i[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,s,n,o),!this.decrypter.isSync()))return}}}}class iE{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const i=s.units;n=i[i.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const i=s[n-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let i=e.naluState||0;const o=i,a=[];let l=0,u,c,d,h=-1,g=0;for(i===-1&&(h=0,g=this.getNALuType(t,0),i=0,l=1);l<n;){if(u=t[l++],!i){i=u?0:1;continue}if(i===1){i=u?0:2;continue}if(!u)i=3;else if(u===1){if(c=l-i-1,h>=0){const f={data:t.subarray(h,c),type:g};a.push(f)}else{const f=this.getLastNalUnit(e.samples);f&&(o&&l<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),c>0&&(f.data=Kt(f.data,t.subarray(0,c)),f.state=0))}l<n?(d=this.getNALuType(t,l),h=l,g=d,i=0):i=-1}else i=0}if(h>=0&&i>=0){const f={data:t.subarray(h,n),type:g,state:i};a.push(f)}if(a.length===0){const f=this.getLastNalUnit(e.samples);f&&(f.data=Kt(f.data,t))}return e.naluState=i,a}}class xi{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");n.set(e.subarray(s,s+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&he.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Qb extends iE{parsePES(e,t,s,n){const i=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),i.forEach(u=>{var c,d;switch(u.type){case 1:{let p=!1;a=!0;const m=u.data;if(l&&m.length>4){const y=this.readSliceType(m);(y===2||y===4||y===7||y===9)&&(p=!0)}if(p){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=p;break}case 5:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{a=!0,Sh(u.data,1,s.pts,t.samples);break}case 7:{var g,f;a=!0,l=!0;const p=u.data,m=this.readSPS(p);if(!e.sps||e.width!==m.width||e.height!==m.height||((g=e.pixelRatio)==null?void 0:g[0])!==m.pixelRatio[0]||((f=e.pixelRatio)==null?void 0:f[1])!==m.pixelRatio[1]){e.width=m.width,e.height=m.height,e.pixelRatio=m.pixelRatio,e.sps=[p];const y=p.subarray(1,4);let v="avc1.";for(let E=0;E<3;E++){let T=y[E].toString(16);T.length<2&&(T="0"+T),v+=T}e.codec=v}break}case 8:a=!0,e.pps=[u.data];break;case 9:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:a=!0;break;default:a=!1;break}o&&a&&o.units.push(u)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new xi(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,i;for(let o=0;o<e;o++)n!==0&&(i=t.readEG(),n=(s+i+256)%256),s=n===0?s:n}readSPS(e){const t=new xi(e);let s=0,n=0,i=0,o=0,a,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),h=t.readUEG.bind(t),g=t.readBoolean.bind(t),f=t.skipBits.bind(t),p=t.skipEG.bind(t),m=t.skipUEG.bind(t),y=this.skipScalingList.bind(this);c();const v=c();if(d(5),f(3),c(),m(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const A=h();if(A===3&&f(1),m(),m(),f(1),g())for(l=A!==3?8:12,u=0;u<l;u++)g()&&(u<6?y(16,t):y(64,t))}m();const E=h();if(E===0)h();else if(E===1)for(f(1),p(),p(),a=h(),u=0;u<a;u++)p();m(),f(1);const T=h(),_=h(),x=d(1);x===0&&f(1),f(1),g()&&(s=h(),n=h(),i=h(),o=h());let w=[1,1];if(g()&&g())switch(c()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:{w=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((T+1)*16-s*2-n*2),height:(2-x)*(_+1)*16-(x?2:4)*(i+o),pixelRatio:w}}}class Xb extends iE{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const i=this.parseNALu(e,s.data,n);let o=this.VideoSample,a,l=!1;s.data=null,o&&i.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),i.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:if(a=!0,l){var h;(h=o)!=null&&h.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:a=!0,(c=o)!=null&&c.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:a=!0,Sh(u.data,2,s.pts,t.samples);break;case 32:a=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=ge(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(a=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const g=this.readSPS(u.data);e.width=g.width,e.height=g.height,e.pixelRatio=g.pixelRatio,e.codec=g.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const f in g.params)e.params[f]=g.params[f]}this.pushParameterSet(e.sps,u.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(a=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const g=this.readPPS(u.data);for(const f in g)e.params[f]=g[f]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:a=!0,e.audFound=!0,(d=o)!=null&&d.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:a=!1;break}o&&a&&o.units.push(u)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new xi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new xi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),i=t.readBoolean(),o=t.readBits(5),a=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),g=t.readUByte(),f=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=t.readUByte(),v=[],E=[];for(let ce=0;ce<s;ce++)v.push(t.readBoolean()),E.push(t.readBoolean());if(s>0)for(let ce=s;ce<8;ce++)t.readBits(2);for(let ce=0;ce<s;ce++)v[ce]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),E[ce]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const _=t.readUEG(),x=t.readUEG(),w=t.readBoolean();let A=0,I=0,R=0,P=0;w&&(A+=t.readUEG(),I+=t.readUEG(),R+=t.readUEG(),P+=t.readUEG());const $=t.readUEG(),j=t.readUEG(),K=t.readUEG(),V=t.readBoolean();for(let ce=V?0:s;ce<=s;ce++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let tt=0;tt<4;tt++)for(let Ft=0;Ft<(tt===3?2:6);Ft++)if(!t.readBoolean())t.readUEG();else{const Ht=Math.min(64,1<<4+(tt<<1));tt>1&&t.readEG();for(let Ks=0;Ks<Ht;Ks++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const k=t.readUEG();let N=0;for(let ce=0;ce<k;ce++){let tt=!1;if(ce!==0&&(tt=t.readBoolean()),tt){ce===k&&t.readUEG(),t.readBoolean(),t.readUEG();let Ft=0;for(let fs=0;fs<=N;fs++){const Ht=t.readBoolean();let Ks=!1;Ht||(Ks=t.readBoolean()),(Ht||Ks)&&Ft++}N=Ft}else{const Ft=t.readUEG(),fs=t.readUEG();N=Ft+fs;for(let Ht=0;Ht<Ft;Ht++)t.readUEG(),t.readBoolean();for(let Ht=0;Ht<fs;Ht++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const ce=t.readUEG();for(let tt=0;tt<ce;tt++){for(let Ft=0;Ft<K+4;Ft++)t.readBits(1);t.readBits(1)}}let O=0,F=1,Z=1,se=!0,te=1,ne=0;t.readBoolean(),t.readBoolean();let Pe=!1;if(t.readBoolean()){if(t.readBoolean()){const gs=t.readUByte(),Gh=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],fo=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];gs>0&&gs<16?(F=Gh[gs-1],Z=fo[gs-1]):gs===255&&(F=t.readBits(16),Z=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Pe=t.readBoolean(),Pe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(te=t.readBits(32),ne=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const fo=t.readBoolean(),Kh=t.readBoolean();let qn=!1;(fo||Kh)&&(qn=t.readBoolean(),qn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),qn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Vh=0;Vh<=s;Vh++){se=t.readBoolean();const $E=se||t.readBoolean();let Hh=!1;$E?t.readEG():Hh=t.readBoolean();const Wh=Hh?1:t.readUEG()+1;if(fo)for(let Yn=0;Yn<Wh;Yn++)t.readUEG(),t.readUEG(),qn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Kh)for(let Yn=0;Yn<Wh;Yn++)t.readUEG(),t.readUEG(),qn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),O=t.readUEG())}let Nt=_,or=x;if(w){let ce=1,tt=1;T===1?ce=tt=2:T==2&&(ce=2),Nt=_-ce*I-ce*A,or=x-tt*P-tt*R}const hs=n?["A","B","C"][n]:"",UE=a<<24|l<<16|u<<8|c;let Pl=0;for(let ce=0;ce<32;ce++)Pl=(Pl|(UE>>ce&1)<<31-ce)>>>0;let Dl=Pl.toString(16);return o===1&&Dl==="2"&&(Dl="6"),{codecString:`hvc1.${hs}${o}.${Dl}.${i?"H":"L"}${y}.B0`,params:{general_tier_flag:i,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[a,l,u,c],general_constraint_indicator_flags:[d,h,g,f,p,m],general_level_idc:y,bit_depth:$+8,bit_depth_luma_minus8:$,bit_depth_chroma_minus8:j,min_spatial_segmentation_idc:O,chroma_format_idc:T,frame_rate:{fixed:se,fps:ne/te}},width:Nt,height:or,pixelRatio:[F,Z]}}readPPS(e){const t=new xi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),i=t.readBoolean();let o=1;return i&&n?o=0:i?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Ke=188;class Vr{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=Vr.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(Ke*5,t-Ke)+1,n=0;for(;n<s;){let i=!1,o=-1,a=0;for(let l=n;l<t;l+=Ke)if(e[l]===71&&(t-l===Ke||e[l+Ke]===71)){if(a++,o===-1&&(o=l,o!==0&&(s=Math.min(o+Ke*99,e.length-Ke)+1)),i||(i=id(e,l)===0),i&&a>1&&(o===0&&a>2||l+Ke>s))return o}else{if(a)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:dv[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Vr.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Vr.createTrack("audio",n),this._id3Track=Vr.createTrack("id3"),this._txtTrack=Vr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let i;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,h=a.pid,g=l.pid,f=a.pesData,p=l.pesData,m=null,y=this.pmtParsed,v=this._pmtId,E=e.length;if(this.remainderData&&(e=Kt(this.remainderData,e),E=e.length,this.remainderData=null),E<Ke&&!n)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const T=Math.max(0,Vr.syncOffset(e));E-=(E-T)%Ke,E<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let _=0;for(let w=T;w<E;w+=Ke)if(e[w]===71){const A=!!(e[w+1]&64),I=id(e,w),R=(e[w+3]&48)>>4;let P;if(R>1){if(P=w+5+e[w+4],P===w+Ke)continue}else P=w+4;switch(I){case c:A&&(d&&(i=en(d,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,u,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(P,w+Ke)),d.size+=w+Ke-P);break;case h:if(A){if(f&&(i=en(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,i);break;case"mp3":this.parseMPEGPES(a,i);break;case"ac3":this.parseAC3PES(a,i);break}f={data:[],size:0}}f&&(f.data.push(e.subarray(P,w+Ke)),f.size+=w+Ke-P);break;case g:A&&(p&&(i=en(p,this.logger))&&this.parseID3PES(l,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(P,w+Ke)),p.size+=w+Ke-P);break;case 0:A&&(P+=e[P]+1),v=this._pmtId=Jb(e,P);break;case v:{A&&(P+=e[P]+1);const $=Zb(e,P,this.typeSupported,s,this.observer,this.logger);c=$.videoPid,c>0&&(o.pid=c,o.segmentCodec=$.segmentVideoCodec),h=$.audioPid,h>0&&(a.pid=h,a.segmentCodec=$.segmentAudioCodec),g=$.id3Pid,g>0&&(l.pid=g),m!==null&&!y&&(this.logger.warn(`MPEG-TS PMT found at ${w} after unknown PID '${m}'. Backtracking to sync byte @${T} to parse all TS packets.`),m=null,w=T-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=I;break}}else _++;_>0&&od(this.observer,new Error(`Found ${_} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=d,a.pesData=f,l.pesData=p;const x={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return n&&this.extractRemainingSamples(x),x}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:i}=e,o=s.pesData,a=t.pesData,l=n.pesData;let u;if(o&&(u=en(o,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,i,u,!0),s.pesData=null)):s.pesData=o,a&&(u=en(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=en(l,this.logger))?(this.parseID3PES(n,u),n.pesData=null):n.pesData=l}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),i=this.sampleAes=new Yb(this.observer,this.config,t);return this.decrypt(n,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new Qb:e==="hevc"&&(this.videoParser=new Xb))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{s(e)}):s(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let i=t.data;if(n){this.aacOverFlow=null;const d=n.missing,h=n.sample.unit.byteLength;if(d===-1)i=Kt(n.sample.unit,i);else{const g=h-d;n.sample.unit.set(i.subarray(0,d),g),e.samples.push(n.sample),s=n.missing}}let o,a;for(o=s,a=i.length;o<a-1&&!sl(i,o);o++);if(o!==s){let d;const h=o<a-1;if(h?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",od(this.observer,new Error(d),h,this.logger),!h)return}qv(e,this.observer,i,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(n){const d=Yv(e.samplerate);l=n.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=Qv(e,i,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!sl(i,o);o++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let i=0,o=0;const a=t.pts;if(a===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(tE(s,o)){const l=Zv(e,s,o,a,i);if(l)o+=l.length,i++;else break}else o++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=s.length;let o=0,a=0,l;for(;a<i&&(l=nE(e,s,a,n,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=ge({},t,{type:this._videoTrack?Rt.emsg:Rt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function id(r,e){return((r[e+1]&31)<<8)+r[e+2]}function Jb(r,e){return(r[e+10]&31)<<8|r[e+11]}function Zb(r,e,t,s,n,i){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=(r[e+1]&15)<<8|r[e+2],l=e+3+a-4,u=(r[e+10]&15)<<8|r[e+11];for(e+=12+u;e<l;){const c=id(r,e),d=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!s){Iu("ADTS AAC",i);break}case 15:o.audioPid===-1&&(o.audioPid=c);break;case 21:o.id3Pid===-1&&(o.id3Pid=c);break;case 219:if(!s){Iu("H.264",i);break}case 27:o.videoPid===-1&&(o.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="mp3");break;case 193:if(!s){Iu("AC-3",i);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=c,o.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&d>0){let h=e+5,g=d;for(;g>2;){switch(r[h]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=c,o.segmentAudioCodec="ac3");break}const p=r[h+1]+2;h+=p,g-=p}}break;case 194:case 135:return od(n,new Error("Unsupported EC-3 in M2TS found"),void 0,i),o;case 36:o.videoPid===-1&&(o.videoPid=c,o.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return o}function od(r,e,t,s){s.warn(`parsing error: ${e.message}`),r.emit(S.ERROR,S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Iu(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function en(r,e){let t=0,s,n,i,o,a;const l=r.data;if(!r||r.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Kt(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>r.size-6)return null;const c=s[7];c&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,c&64?(a=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-a>60*9e4&&(e.warn(`${Math.round((o-a)/9e4)}s delta between PTS and DTS, align them`),o=a)):a=o),i=s[8];let d=i+9;if(r.size<=d)return null;r.size-=d;const h=new Uint8Array(r.size);for(let g=0,f=l.length;g<f;g++){s=l[g];let p=s.byteLength;if(d)if(d>p){d-=p;continue}else s=s.subarray(d),p-=d,d=0;h.set(s,t),t+=p}return n&&(n-=i+3),{data:h,pts:o,dts:a,len:n}}return null}class eL{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ur=Math.pow(2,32)-1;class b{static init(){b.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in b.types)b.types.hasOwnProperty(e)&&(b.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);b.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);b.STTS=b.STSC=b.STCO=i,b.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),b.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),b.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),b.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);b.FTYP=b.box(b.types.ftyp,o,l,o,a),b.DINF=b.box(b.types.dinf,b.box(b.types.dref,n))}static box(e,...t){let s=8,n=t.length;const i=n;for(;n--;)s+=t[n].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(e,4),n=0,s=8;n<i;n++)o.set(t[n],s),s+=t[n].byteLength;return o}static hdlr(e){return b.box(b.types.hdlr,b.HDLR_TYPES[e])}static mdat(e){return b.box(b.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Ur+1)),n=Math.floor(t%(Ur+1));return b.box(b.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return b.box(b.types.mdia,b.mdhd(e.timescale||0,e.duration||0),b.hdlr(e.type),b.minf(e))}static mfhd(e){return b.box(b.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?b.box(b.types.minf,b.box(b.types.smhd,b.SMHD),b.DINF,b.stbl(e)):b.box(b.types.minf,b.box(b.types.vmhd,b.VMHD),b.DINF,b.stbl(e))}static moof(e,t,s){return b.box(b.types.moof,b.mfhd(e),b.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=b.trak(e[t]);return b.box.apply(null,[b.types.moov,b.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(b.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=b.trex(e[t]);return b.box.apply(null,[b.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Ur+1)),n=Math.floor(t%(Ur+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return b.box(b.types.mvhd,i)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,s[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return b.box(b.types.sdtp,s)}static stbl(e){return b.box(b.types.stbl,b.stsd(e),b.box(b.types.stts,b.STTS),b.box(b.types.stsc,b.STSC),b.box(b.types.stsz,b.STSZ),b.box(b.types.stco,b.STCO))}static avc1(e){let t=[],s=[],n,i,o;for(n=0;n<e.sps.length;n++)i=e.sps[n],o=i.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)i=e.pps[n],o=i.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(i));const a=b.box(b.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return b.box(b.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return b.box(b.types.mp4a,b.audioStsd(e),b.box(b.types.esds,b.esds(e)))}static mp3(e){return b.box(b.types[".mp3"],b.audioStsd(e))}static ac3(e){return b.box(b.types["ac-3"],b.audioStsd(e),b.box(b.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return b.box(b.types.stsd,b.STSD,b.mp4a(e));if(t==="ac3"&&e.config)return b.box(b.types.stsd,b.STSD,b.ac3(e));if(t==="mp3"&&e.codec==="mp3")return b.box(b.types.stsd,b.STSD,b.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return b.box(b.types.stsd,b.STSD,b.avc1(e));if(t==="hevc"&&e.vps)return b.box(b.types.stsd,b.STSD,b.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,i=e.height||0,o=Math.floor(s/(Ur+1)),a=Math.floor(s%(Ur+1));return b.box(b.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const s=b.sdtp(e),n=e.id,i=Math.floor(t/(Ur+1)),o=Math.floor(t%(Ur+1));return b.box(b.types.traf,b.box(b.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),b.box(b.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,o>>24,o>>16&255,o>>8&255,o&255])),b.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,b.box(b.types.trak,b.tkhd(e),b.mdia(e))}static trex(e){const t=e.id;return b.box(b.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,i=12+16*n,o=new Uint8Array(i);let a,l,u,c,d,h;for(t+=8+i,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<n;a++)l=s[a],u=l.duration,c=l.size,d=l.flags,h=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*a);return b.box(b.types.trun,o)}static initSegment(e){b.types||b.init();const t=b.moov(e);return Kt(b.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let o=i.length;for(let f=0;f<s.length;f+=1){o+=3;for(let p=0;p<s[f].length;p+=1)o+=2+s[f][p].length}const a=new Uint8Array(o);a.set(i,0),o=i.length;const l=s.length-1;for(let f=0;f<s.length;f+=1){a.set(new Uint8Array([32+f|(f===l?128:0),0,s[f].length]),o),o+=3;for(let p=0;p<s[f].length;p+=1)a.set(new Uint8Array([s[f][p].length>>8,s[f][p].length&255]),o),o+=2,a.set(s[f][p],o),o+=s[f][p].length}const u=b.box(b.types.hvcC,a),c=e.width,d=e.height,h=e.pixelRatio[0],g=e.pixelRatio[1];return b.box(b.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,g>>24,g>>16&255,g>>8&255,g&255])))}}b.types=void 0;b.HDLR_TYPES=void 0;b.STTS=void 0;b.STSC=void 0;b.STCO=void 0;b.STSZ=void 0;b.VMHD=void 0;b.SMHD=void 0;b.STSD=void 0;b.FTYP=void 0;b.DINF=void 0;const oE=9e4;function Nh(r,e,t=1,s=!1){const n=r*e*t;return s?Math.round(n):n}function tL(r,e,t=1,s=!1){return Nh(r,e,1/t,s)}function ii(r,e=!1){return Nh(r,1e3,1/oE,e)}function rL(r,e=1){return Nh(r,oE,1/e)}function Dp(r){const{baseTime:e,timescale:t,trackId:s}=r;return`${e/t} (${e}/${t}) trackId: ${s}`}const sL=10*1e3,nL=1024,iL=1152,oL=1536;let tn=null,bu=null;function Op(r,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class pa extends Vt{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,tn===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);tn=o?parseInt(o[1]):0}if(bu===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);bu=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Dp(t)} > ${e&&Dp(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((i,o)=>{let a=o.pts,l=a-i;return l<-4294967296&&(t=!0,a=xt(a,s),l=a-i),l>0?i:a},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,i,o,a,l){let u,c,d,h,g,f,p=i,m=i;const y=e.pid>-1,v=t.pid>-1,E=t.samples.length,T=e.samples.length>0,_=a&&E>0||E>1;if((!y||T)&&(!v||_)||this.ISGenerated||a){if(this.ISGenerated){var w,A,I,R;const K=this.videoTrackConfig;(K&&(t.width!==K.width||t.height!==K.height||((w=t.pixelRatio)==null?void 0:w[0])!==((A=K.pixelRatio)==null?void 0:A[0])||((I=t.pixelRatio)==null?void 0:I[1])!==((R=K.pixelRatio)==null?void 0:R[1]))||!K&&_||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,o));const P=this.isVideoContiguous;let $=-1,j;if(_&&($=aL(t.samples),!P&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,$>0){this.warn(`Dropped ${$} out of ${E} video samples due to a missing keyframe`);const K=this.getVideoStartPts(t.samples);t.samples=t.samples.slice($),t.dropped+=$,m+=(t.samples[0].pts-K)/t.inputTimeScale,j=m}else $===-1&&(this.warn(`No keyframe found out of ${E} video samples`),f=!1);if(this.ISGenerated){if(T&&_){const K=this.getVideoStartPts(t.samples),M=(xt(e.samples[0].pts,K)-K)/t.inputTimeScale;p+=Math.max(0,M),m+=Math.max(0,-M)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,o)),c=this.remuxAudio(e,p,this.isAudioContiguous,o,v||_||l===W.AUDIO?m:void 0),_){const K=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,o)),u=this.remuxVideo(t,m,P,K)}}else _&&(u=this.remuxVideo(t,m,P,0));u&&(u.firstKeyFrame=$,u.independent=$!==-1,u.firstKeyFramePTS=j)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(g=aE(s,i,this._initPTS,this._initDTS)),n.samples.length&&(h=lE(n,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:f,text:h,id3:g}}computeInitPts(e,t,s,n){const i=Math.round(s*t);let o=xt(e,i);if(o<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-o)/t} ${n}`);o<i+t;)o+=8589934592;return o-i}generateIS(e,t,s,n){const i=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||n,d="audio/mp4",h,g,f,p=-1;if(c&&(h=g=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):b.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(p=e.id,f=e.inputTimeScale,!u||f!==u.timescale?h=g=this.computeInitPts(i[0].pts,f,s,"audio"):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:b.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(p=t.id,f=t.inputTimeScale,!u||f!==u.timescale){const m=this.getVideoStartPts(o),y=xt(o[0].dts,m),v=this.computeInitPts(y,f,s,"video"),E=this.computeInitPts(m,f,s,"video");g=Math.min(g,v),h=Math.min(h,E)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${s} ${h/f} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${h/f} (${h}/${f}) trackId: ${p}`),this._initPTS={baseTime:h,timescale:f,trackId:p},this._initDTS={baseTime:g,timescale:f,trackId:p}):h=f=void 0,{tracks:l,initPTS:h,timescale:f,trackId:p}}remuxVideo(e,t,s,n){const i=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS,c=u.baseTime*i/u.timescale;let d=this.nextVideoTs,h=8,g=this.videoSampleDuration,f,p,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,v=!1;if(!s||d===null){const O=c+t*i,F=o[0].pts-xt(o[0].dts,o[0].pts);tn&&d!==null&&Math.abs(O-F-(d+c))<15e3?s=!0:d=O-F-c}const E=d+c;for(let O=0;O<l;O++){const F=o[O];F.pts=xt(F.pts,E),F.dts=xt(F.dts,E),F.dts<o[O>0?O-1:O].dts&&(v=!0)}v&&o.sort(function(O,F){const Z=O.dts-F.dts,se=O.pts-F.pts;return Z||se}),f=o[0].dts,p=o[o.length-1].dts;const T=p-f,_=T?Math.round(T/(l-1)):g||e.inputTimeScale/30;if(s){const O=f-E,F=O>_,Z=O<-1;if((F||Z)&&(F?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ii(O,!0)} ms (${O}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${ii(-O,!0)} ms (${O}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Z||E>=o[0].pts||tn)){f=E;const se=o[0].pts-O;if(F)o[0].dts=f,o[0].pts=se;else{let te=!0;for(let ne=0;ne<o.length&&!(o[ne].dts>se&&te);ne++){const Pe=o[ne].pts;if(o[ne].dts-=O,o[ne].pts-=O,ne<o.length-1){const We=o[ne+1].pts,Nt=o[ne].pts,or=We<=Nt,hs=We<=Pe;te=or==hs}}}this.log(`Video: Initial PTS/DTS adjusted: ${ii(se,!0)}/${ii(f,!0)}, delta: ${ii(O,!0)} ms`)}}f=Math.max(0,f);let x=0,w=0,A=f;for(let O=0;O<l;O++){const F=o[O],Z=F.units,se=Z.length;let te=0;for(let ne=0;ne<se;ne++)te+=Z[ne].data.length;w+=te,x+=se,F.length=te,F.dts<A?(F.dts=A,A+=_/4|0||1):A=F.dts,m=Math.min(F.pts,m),y=Math.max(F.pts,y)}p=o[l-1].dts;const I=w+4*x+8;let R;try{R=new Uint8Array(I)}catch(O){this.observer.emit(S.ERROR,S.ERROR,{type:q.MUX_ERROR,details:L.REMUX_ALLOC_ERROR,fatal:!1,error:O,bytes:I,reason:`fail allocating video mdat ${I}`});return}const P=new DataView(R.buffer);P.setUint32(0,I),R.set(b.types.mdat,4);let $=!1,j=Number.POSITIVE_INFINITY,K=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let O=0;O<l;O++){const F=o[O],Z=F.units;let se=0;for(let Pe=0,We=Z.length;Pe<We;Pe++){const Nt=Z[Pe],or=Nt.data,hs=Nt.data.byteLength;P.setUint32(h,hs),h+=4,R.set(or,h),h+=hs,se+=4+hs}let te;if(O<l-1)g=o[O+1].dts-F.dts,te=o[O+1].pts-F.pts;else{const Pe=this.config,We=O>0?F.dts-o[O-1].dts:_;if(te=O>0?F.pts-o[O-1].pts:_,Pe.stretchShortVideoTrack&&this.nextAudioTs!==null){const Nt=Math.floor(Pe.maxBufferHole*i),or=(n?m+n*i:this.nextAudioTs+c)-F.pts;or>Nt?(g=or-We,g<0?g=We:$=!0,this.log(`It is approximately ${or/90} ms to the next segment; using duration ${g/90} ms for the last video frame.`)):g=We}else g=We}const ne=Math.round(F.pts-F.dts);j=Math.min(j,g),V=Math.max(V,g),K=Math.min(K,te),M=Math.max(M,te),a.push(Op(F.key,g,se,ne))}if(a.length){if(tn){if(tn<70){const O=a[0].flags;O.dependsOn=2,O.isNonSync=0}}else if(bu&&M-K<V-j&&_/V<.025&&a[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let O=f;for(let F=0,Z=a.length;F<Z;F++){const se=O+a[F].duration,te=O+a[F].cts;if(F<Z-1){const ne=se+a[F+1].cts;a[F].duration=ne-te}else a[F].duration=F?a[F-1].duration:_;a[F].cts=0,O=se}}}g=$||!g?_:g;const H=p+g;this.nextVideoTs=d=H-c,this.videoSampleDuration=g,this.isVideoContiguous=!0;const B={data1:b.moof(e.sequenceNumber++,f,ge(e,{samples:a})),data2:R,startPTS:(m-c)/i,endPTS:(y+g-c)/i,startDTS:(f-c)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,B}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return iL;case"ac3":return oL;default:return nL}}remuxAudio(e,t,s,n,i){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,h=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],f=i!==void 0;let p=e.samples,m=h?0:8,y=this.nextAudioTs||-1;const v=d.baseTime*o/d.timescale,E=v+t*o;if(this.isAudioContiguous=s=s||p.length&&y>0&&(n&&Math.abs(E-(y+v))<9e3||Math.abs(xt(p[0].pts,E)-(y+v))<20*c),p.forEach(function(M){M.pts=xt(M.pts,E)}),!s||y<0){const M=p.length;if(p=p.filter(H=>H.pts>=0),M!==p.length&&this.warn(`Removed ${p.length-M} of ${M} samples (initPTS ${v} / ${o})`),!p.length)return;i===0?y=0:n&&!f?y=Math.max(0,E-v):y=p[0].pts-v}if(e.segmentCodec==="aac"){const M=this.config.maxAudioFramesDrift;for(let H=0,k=y+v;H<p.length;H++){const N=p[H],B=N.pts,O=B-k,F=Math.abs(1e3*O/o);if(O<=-M*c&&f)H===0&&(this.warn(`Audio frame @ ${(B/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*O/o)} ms.`),this.nextAudioTs=y=B-v,k=B);else if(O>=M*c&&F<sL&&f){let Z=Math.round(O/c);for(k=B-Z*c;k<0&&Z&&c;)Z--,k+=c;H===0&&(this.nextAudioTs=y=k-v),this.warn(`Injecting ${Z} audio frames @ ${((k-v)/o).toFixed(3)}s due to ${Math.round(1e3*O/o)} ms gap.`);for(let se=0;se<Z;se++){let te=eL.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);te||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),te=N.unit.subarray()),p.splice(H,0,{unit:te,pts:k}),k+=c,H++}}N.pts=k,k+=c}}let T=null,_=null,x,w=0,A=p.length;for(;A--;)w+=p[A].unit.byteLength;for(let M=0,H=p.length;M<H;M++){const k=p[M],N=k.unit;let B=k.pts;if(_!==null){const F=g[M-1];F.duration=Math.round((B-_)/l)}else if(s&&e.segmentCodec==="aac"&&(B=y+v),T=B,w>0){w+=m;try{x=new Uint8Array(w)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:q.MUX_ERROR,details:L.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:w,reason:`fail allocating audio mdat ${w}`});return}h||(new DataView(x.buffer).setUint32(0,w),x.set(b.types.mdat,4))}else return;x.set(N,m);const O=N.byteLength;m+=O,g.push(Op(!0,u,O,0)),_=B}const I=g.length;if(!I)return;const R=g[g.length-1];y=_-v,this.nextAudioTs=y+l*R.duration;const P=h?new Uint8Array(0):b.moof(e.sequenceNumber++,T/l,ge({},e,{samples:g}));e.samples=[];const $=(T-v)/o,j=this.nextAudioTs/o,V={data1:P,data2:x,startPTS:$,endPTS:j,startDTS:$,endDTS:j,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,V}}function xt(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function aL(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function aE(r,e,t,s){const n=r.samples.length;if(!n)return;const i=r.inputTimeScale;for(let a=0;a<n;a++){const l=r.samples[a];l.pts=xt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=xt(l.dts-s.baseTime*i/s.timescale,e*i)/i}const o=r.samples;return r.samples=[],{samples:o}}function lE(r,e,t){const s=r.samples.length;if(!s)return;const n=r.inputTimeScale;for(let o=0;o<s;o++){const a=r.samples[o];a.pts=xt(a.pts-t.baseTime*n/t.timescale,e*n)/n}r.samples.sort((o,a)=>o.pts-a.pts);const i=r.samples;return r.samples=[],{samples:i}}class lL extends Vt{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:o}=this.initData=gv(e);if(t)YR(e,t);else{const l=i||o;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(s=Np(i,pe.AUDIO,this)),o&&(n=Np(o,pe.VIDEO,this));const a={};i&&o?a.audiovideo={container:"video/mp4",codec:s+","+n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:i?a.audio={container:"audio/mp4",codec:s,encrypted:i.encrypted,initSegment:e,id:"audio"}:o?a.video={container:"video/mp4",codec:n,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,s,n,i,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};G(c)||(c=this.lastEndTime=i||0);const h=t.samples;if(!h.length)return d;const g={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if((a=f)!=null&&a.length||(this.generateInitSegment(h),f=this.initData),!((l=f)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);const p=XR(h,f,this),m=f.audio?p[f.audio.id]:null,y=f.video?p[f.video.id]:null,v=Go(y,1/0),E=Go(m,1/0),T=Go(y,0,!0),_=Go(m,0,!0);let x=i,w=0;const A=m&&(!y||!u&&E<v||u&&u.trackId===f.audio.id),I=A?m:y;if(I){const k=I.timescale,N=I.start-i*k,B=A?f.audio.id:f.video.id;x=I.start/k,w=A?_-E:T-v,(o||!u)&&(uL(u,x,i,w)||k!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${i} ${N/k} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${x-i} (${N}/${k}) trackId: ${B}`),u=null,g.initPTS=N,g.timescale=k,g.trackId=B)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);u?(g.initPTS=u.baseTime,g.timescale=u.timescale,g.trackId=u.trackId):((!g.timescale||g.trackId===void 0||g.initPTS===void 0)&&(this.warn("Could not set initPTS"),g.initPTS=x,g.timescale=1,g.trackId=-1),this.initPTS=u={baseTime:g.initPTS,timescale:g.timescale,trackId:g.trackId});const R=x-u.baseTime/u.timescale,P=R+w;w>0?this.lastEndTime=P:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const $=!!f.audio,j=!!f.video;let K="";$&&(K+="audio"),j&&(K+="video");const V=(f.audio?f.audio.encrypted:!1)||(f.video?f.video.encrypted:!1),M={data1:h,startPTS:R,startDTS:R,endPTS:P,endDTS:P,type:K,hasAudio:$,hasVideo:j,nb:1,dropped:0,encrypted:V};d.audio=$&&!j?M:void 0,d.video=j?M:void 0;const H=y==null?void 0:y.sampleCount;if(H){const k=y.keyFrameIndex,N=k!==-1;M.nb=H,M.dropped=k===0||this.isVideoContiguous?0:N?k:H,M.independent=N,M.firstKeyFrame=k,N&&y.keyFrameStart&&(M.firstKeyFramePTS=(y.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=N),this.isVideoContiguous||(this.isVideoContiguous=N),M.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${k}/${H} dropped: ${M.dropped} start: ${M.firstKeyFramePTS||"NA"}`)}return d.initSegment=g,d.id3=aE(s,i,u,u),n.samples.length&&(d.text=lE(n,i,u)),d}}function Go(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function uL(r,e,t,s){if(r===null)return!0;const n=Math.max(s,1),i=e-r.baseTime/r.timescale;return Math.abs(i-t)>n}function Np(r,e,t){const s=r.codec;return s&&s.length>4?s:e===pe.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Ya(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Rr;try{Rr=self.performance.now.bind(self.performance)}catch{Rr=Date.now}const ma=[{demux:qb,remux:lL},{demux:Vr,remux:pa},{demux:Vb,remux:pa},{demux:Wb,remux:pa}];ma.splice(2,0,{demux:Hb,remux:pa});class Fp{constructor(e,t,s,n,i,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=i,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const i=s.transmuxing;i.executeStart=Rr();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;n&&(this.currentTransmuxState=n);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:h,timeOffset:g,initSegmentChange:f}=n||a,{audioCodec:p,videoCodec:m,defaultInitPts:y,duration:v,initSegmentData:E}=l,T=cL(o,t);if(T&&Ln(T.method)){const A=this.getDecrypter(),I=Rh(T.method);if(A.isSync()){let R=A.softwareDecrypt(o,T.key.buffer,T.iv.buffer,I);if(s.part>-1){const $=A.flush();R=$&&$.buffer}if(!R)return i.executeEnd=Rr(),Lu(s);o=new Uint8Array(R)}else return this.asyncResult=!0,this.decryptionPromise=A.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer,I).then(R=>{const P=this.push(R,null,s);return this.decryptionPromise=null,P}),this.decryptionPromise}const _=this.needsProbing(c,d);if(_){const A=this.configureTransmuxer(o);if(A)return this.logger.warn(`[transmuxer] ${A.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_PARSING_ERROR,fatal:!1,error:A,reason:A.message}),i.executeEnd=Rr(),Lu(s)}(c||d||f||_)&&this.resetInitSegment(E,p,m,v,t),(c||f||_)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const x=this.transmux(o,T,g,h,s);this.asyncResult=eo(x);const w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,i.executeEnd=Rr(),x}flush(e){const t=e.transmuxing;t.executeStart=Rr();const{decrypter:s,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const o=[],{timeOffset:a}=n;if(s){const d=s.flush();d&&o.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Rr();const d=[Lu(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(a);return eo(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(o,d,e),o))):(this.flushRemux(o,c,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:i,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===W.MAIN?"level":"track"} ${s.level}`);const c=this.remuxer.remux(n,i,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:s}),s.transmuxing.executeEnd=Rr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,i){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,s,n),a.resetInitSegment(e,t,s,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,i){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,s,n,i):o=this.transmuxUnencrypted(e,s,n,i),o}transmuxUnencrypted(e,t,s,n){const{audioTrack:i,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,o,a,l,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,i){return this.demuxer.demuxSampleAes(e,t,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,n,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let i;for(let d=0,h=ma.length;d<h;d++){var o;if((o=ma[d].demux)!=null&&o.probe(e,this.logger)){i=ma[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=i.remux,c=i.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(s,t,n,this.logger)),(!a||!(a instanceof c))&&(this.demuxer=new c(s,t,n,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new xh(this.config)),e}}function cL(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Lu=r=>({remuxResult:{},chunkMeta:r});function eo(r){return"then"in r&&r.then instanceof Function}class dL{constructor(e,t,s,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=i||null}}class hL{constructor(e,t,s,n,i,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=o}}let Mp=0;class uE{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Mp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const h=(d=this.workerContext)==null?void 0:d.objectURL;h&&self.URL.revokeObjectURL(h);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const o=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===S.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new Lh,this.observer.on(S.FRAG_DECRYPTED,o),this.observer.on(S.ERROR,o);const a=Jg(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||mb()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=vb(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=yb());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:me(i)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Fp(this.observer,a,i,"",t,e.logger)}return}}this.transmuxer=new Fp(this.observer,a,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Mp++;const t=this.hls.config,s=Jg(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:me(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Eb(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,i,o,a,l,u,c){var d,h;u.transmuxing.start=self.performance.now();const{instanceNo:g,transmuxer:f}=this,p=o?o.start:i.start,m=i.decryptdata,y=this.frag,v=!(y&&i.cc===y.cc),E=!(y&&u.level===y.level),T=y?u.sn-y.sn:-1,_=this.part?u.part-this.part.index:-1,x=T===0&&u.id>1&&u.id===(y==null?void 0:y.stats.chunkCount),w=!E&&(T===1||T===0&&(_===1||x&&_<=0)),A=self.performance.now();(E||T||i.stats.parsing.start===0)&&(i.stats.parsing.start=A),o&&(_||!w)&&(o.stats.parsing.start=A);const I=!(y&&((d=i.initSegment)==null?void 0:d.url)===((h=y.initSegment)==null?void 0:h.url)),R=new hL(v,w,l,E,p,I);if(!w||v||I){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===W.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${E}
        contiguous: ${w}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${I}`);const P=new dL(s,n,t,a,c);this.configureTransmuxer(P)}if(this.frag=i,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:g,cmd:"demux",data:e,decryptdata:m,chunkMeta:u,state:R},e instanceof ArrayBuffer?[e]:[]);else if(f){const P=f.push(e,m,u,R);eo(P)?P.then($=>{this.handleTransmuxComplete($)}).catch($=>{this.transmuxerError($,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(P)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);eo(n)?n.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Up=100;class fL extends bh{constructor(e,t,s){super(e,t,s,"audio-stream-controller",W.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:i,trackId:o}){if(s===W.MAIN){const a=t.cc,l=this.fragCurrent;if(this.initPTS[a]={baseTime:n,timescale:i,trackId:o},this.log(`InitPTS for cc: ${a} found from main: ${n/i} (${n}/${i}) trackId: ${o}`),this.mainAnchor=t,this.state===D.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==a)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==a?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===D.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&(n==null?void 0:n.cc)===t.cc)return;const i=(n||e).cc,o=this.getLevelDetails(),a=this.getLoadPosition(),l=Av(o,i,a);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===D.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=D.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Up),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=D.IDLE):this.state=D.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case D.IDLE:this.doTickIdle();break;case D.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e==null?void 0:e[t],n=s==null?void 0:s.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=D.WAITING_INIT_PTS}break}case D.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case D.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:n,complete:i}=e,o=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=D.FRAG_LOADING;const a=n.flush().buffer,l={frag:t,part:s,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else o&&o.cc!==e.frag.cc&&this.syncWithAnchor(o,e.frag)}else this.state=D.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:i}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[i]))return;const a=s[i],l=a.details;if(!l||this.waitForLive(a)||this.waitForCdnTuneIn(l)){this.state=D.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,pe.AUDIO,W.AUDIO));const c=this.getFwdBufferInfo(u,W.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=D.ENDED;return}const d=c.len,h=t.maxBufferLength,g=l.fragments,f=g[0].start,p=this.getLoadPosition(),m=this.flushing?p:c.end;if(this.switchingTrack&&n){const E=p;l.PTSKnown&&E<f&&(c.end>f||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=f+.05)}if(d>=h&&!this.switchingTrack&&m<g[g.length-1].start)return;let y=this.getNextFragment(m,l);if(y&&this.isLoopLoading(y,m)&&(y=this.getNextFragmentLoopLoading(y,l,c,W.MAIN,h)),!y){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&Oe(y)&&!y.endList&&(!l.live||!this.loadingParts&&m<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===je.OK&&(this.mainFragLoading=v=null),v&&Oe(v))){if(y.start>v.end){const T=this.fragmentTracker.getFragAtPos(m,W.MAIN);T&&T.end>v.end&&(v=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(y.start>v.end)return}this.loadFragment(y,a,m)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Xi(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==D.STOPPED&&(this.setInterval(Up),this.state=D.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:i,id:o,groupId:a,track:l}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${l.name}" of "${a}"`);return}const u=this.mainDetails;if(!u||i.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==D.STOPPED&&(this.state=D.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${l.name}" of "${a}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=n[o];let d=0;if(i.live||(s=c.details)!=null&&s.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(c.details){var h;d=this.alignPlaylists(i,c.details,(h=this.levelLastLoaded)==null?void 0:h.details)}i.alignedSliding||(Kv(i,u),i.alignedSliding||rl(i,u),d=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:i,id:o,groupId:t.groupId}),this.state===D.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=D.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:i}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new uE(this.hls,W.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const g=this.initPTS[s.cc],f=(t=s.initSegment)==null?void 0:t.data;if(g!==void 0){const m=n?n.index:-1,y=m!==-1,v=new Ah(s.level,s.sn,s.stats.chunkCount,i.byteLength,m,y);h.push(i,f,d,"",s,n,c.totalduration,!1,v,g)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new Vv,complete:!1};p.push(new Uint8Array(i)),this.state!==D.STOPPED&&(this.state=D.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===W.MAIN&&Oe(t.frag)&&(this.mainFragLoading=t,this.state===D.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==W.AUDIO){!this.audioOnly&&s.type===W.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Oe(s)){this.fragPrevious=s;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,de({},i)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=D.ERROR;return}switch(t.details){case L.FRAG_GAP:case L.FRAG_PARSING_ERROR:case L.FRAG_DECRYPT_ERROR:case L.FRAG_LOAD_ERROR:case L.FRAG_LOAD_TIMEOUT:case L.KEY_LOAD_ERROR:case L.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.AUDIO,t);break;case L.AUDIO_TRACK_LOAD_ERROR:case L.AUDIO_TRACK_LOAD_TIMEOUT:case L.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===D.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===ae.AUDIO_TRACK&&(this.state=D.IDLE);break;case L.BUFFER_ADD_CODEC_ERROR:case L.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case L.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case L.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==pe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==pe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===D.ENDED&&(this.state=D.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,W.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:i,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:h,text:g,id3:f,initSegment:p}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=D.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const m=l.initSegment||l;if(this.unhandledEncryptionError(p,l))return;this._bufferInitSegment(c,p.tracks,m,o),n.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:s,tracks:p.tracks})}if(h){const{startPTS:m,endPTS:y,startDTS:v,endDTS:E}=h;u&&(u.elementaryStreams[pe.AUDIO]={startPTS:m,endPTS:y,startDTS:v,endDTS:E}),l.setElementaryStreamInfo(pe.AUDIO,m,y,v,E),this.bufferFragmentData(h,l,u,o)}if(f!=null&&(t=f.samples)!=null&&t.length){const m=ge({id:s,frag:l,details:d},f);n.trigger(S.FRAG_PARSING_METADATA,m)}if(g){const m=ge({id:s,frag:l,details:d},g);n.trigger(S.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,s,n){if(this.state!==D.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=W.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${o}/${i.codec}]`),o&&o.split(",").length===1&&(i.levelCodec=o),this.hls.trigger(S.BUFFER_CODECS,t);const a=i.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:a};this.hls.trigger(S.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===je.NOT_LOADED||n===je.PARTIAL){var i;if(!Oe(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=D.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&rl(t.details,o)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:i,audioCodec:o,channels:a}=this.bufferedTrack;Ds({name:t,lang:s,assocLang:n,characteristics:i,audioCodec:o,channels:a},e,_s)||(Xa(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(S.AUDIO_TRACK_SWITCHED,de({},e))}}class Fh extends Vt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t==null?void 0:t.renditionReports;if(n){let i=-1;for(let o=0;o<n.length;o++){const a=n[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){i=o;break}else l===e.substring(0,l.length)&&(i=o)}if(i!==-1){const o=n[i],a=parseInt(o["LAST-MSN"])||t.lastPartSn;let l=parseInt(o["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=s&&Zg(s);return new ep(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:i}=t,o=self.performance.now(),a=i.loading.first?Math.max(0,o-i.loading.first):0;n.advancedDateTime=Date.now()-a;const l=this.hls.config.timelineOffset;if(l!==n.appliedTimelineOffset){const c=Math.max(l||0,0);n.appliedTimelineOffset=c,n.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(n.live||s!=null&&s.live){const c="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){ib(s,n,this);const v=n.playlistParsingError;if(v){this.warn(v);const E=this.hls;if(!E.config.ignorePlaylistParsingErrors){var u;const{networkDetails:T}=t;E.trigger(S.ERROR,{type:q.NETWORK_ERROR,details:L.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:v,reason:v.message,level:t.level||void 0,parent:(u=n.fragments[0])==null?void 0:u.type,networkDetails:T,stats:i});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,g=(n.edge-h)*1e3,f=Uv(n,g);if(n.requestScheduled+f<o?n.requestScheduled=o:n.requestScheduled+=f,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let p,m,y;if(n.canBlockReload&&n.endSN&&n.advanced){const v=this.hls.config.lowLatencyMode,E=n.lastPartSn,T=n.endSN,_=n.lastPartIndex,x=_!==-1,w=E===T;x?w?(m=T+1,y=v?0:_):(m=E,y=v?_+1:n.maxPartIndex):m=T+1;const A=n.age,I=A+n.ageHeader;let R=Math.min(I-n.partTarget,n.targetduration*1.5);if(R>0){if(I>n.targetduration*3)this.log(`Playlist last advanced ${A.toFixed(2)}s ago. Omitting segment and part directives.`),m=void 0,y=void 0;else if(s!=null&&s.tuneInGoal&&I-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${R} with playlist age: ${n.age}`),R=0;else{const P=Math.floor(R/n.targetduration);if(m+=P,y!==void 0){const $=Math.round(R%n.targetduration/n.partTarget);y+=$}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${A.toFixed(2)}s goal: ${R} skip sn ${P} to part ${y}`)}n.tuneInGoal=R}if(p=this.getDeliveryDirectives(n,t.deliveryDirectives,m,y),v||!w){n.requestScheduled=o,this.loadingPlaylist(c,p);return}}else(n.canBlockReload||n.canSkipUntil)&&(p=this.getDeliveryDirectives(n,t.deliveryDirectives,m,y));p&&m!==void 0&&n.canBlockReload&&(n.requestScheduled=i.loading.first+Math.max(f-a*2,f/2)),this.scheduleLoading(c,p,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const i=self.performance.now(),o=n.requestScheduled;if(i>=o){this.loadingPlaylist(e,t);return}const a=o-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,s,n){let i=Zg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,i=fa.No),new ep(s,n,i)}checkRetry(e){const t=e.details,s=Ja(e),n=e.errorAction,{action:i,retryCount:o=0,retryConfig:a}=n||{},l=!!n&&!!a&&(i===Qe.RetryRequest||!n.resolved&&i===Qe.SendAlternateToPenaltyBox);if(l){var u;if(o>=a.maxNumRetry)return!1;if(s&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=wh(a,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,n.resolved=!0}return l}}function cE(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!to(r[t].attrs,e[t].attrs))return!1;return!0}function to(r,e,t){const s=r["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>r[n]!==e[n])}function ad(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class gL extends Fh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:i}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(a=>(n==null?void 0:n.indexOf(a))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(h=>!s||s.indexOf(h.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(h=>h.default)&&(this.selectDefaultTrack=!1),a.forEach((h,g)=>{h.id=g});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!i&&l){const h=pr(l,a,_s);if(h>-1)i=a[h];else{const g=pr(l,this.tracks);i=this.tracks[g]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const h=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(h.message),this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:h})}}}onError(e,t){t.fatal||!t.context||t.context.type===ae.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&Ds(e,n,_s))return n;const i=pr(e,this.tracksInGroup,_s);if(i>-1){const o=this.tracksInGroup[i];return this.setAudioTrack(i),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=RI(e,t.levels,s,o,_s);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=pr(e,s);if(o>-1)return s[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(e===this.trackId&&n===s&&i||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,de({},n)),i))return;const o=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Ds(e,n,_s)))return s}if(e){const{name:s,lang:n,assocLang:i,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Ds({name:s,lang:n,assocLang:i,characteristics:o,audioCodec:a,channels:l},c,_s))return u}for(let u=0;u<t.length;u++){const c=t[u];if(to(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(to(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Xa(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:i,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class pL{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(i){var s;if(n.onError(i),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[e])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s==null?void 0:s.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const $p=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,dE="HlsJsTrackRemovedError";class mL extends Error{constructor(e){super(e),this.name=dE}}class yL extends Vt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:i}=this;s&&this.log("Media source opened"),!(!n||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:n,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=$R(as(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const o=this.isQueued();(i||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?ge(s,n.tracks):this.sourceBuffers.forEach(i=>{const[o]=i;o&&(s[o]=ge({},this.tracks[o]),this.removeBuffer(o)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=as(this.appendSource);if(n){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),i)this._objectUrl=s.src,this.attachTransferred();else{const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&o instanceof l,Bp(s),vL(s,a),s.load()}catch{s.src=a}else s.src=a}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,i=n?Object.keys(n):null,o=i?i.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&i&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${me(s,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${me(n,(l,u)=>l==="initSegment"?void 0:u)}}`),!av(n,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,i.forEach(l=>{const u=l,c=n[u];if(c){const d=c.buffer;if(d){const h=this.fragmentTracker,g=c.id;if(h.hasFragments(g)||h.hasParts(g)){const m=re.getBuffered(d);h.detectEvictedFragments(u,m,g,null,!0)}const f=ku(u),p=[u,d];this.sourceBuffers[f]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:i,_objectUrl:o}=this;if(i){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([a])=>{a&&this.removeBuffer(a)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const a=i.readyState==="open";try{const l=i.sourceBuffers;for(let u=l.length;u--;)a&&l[u].abort(),i.removeSourceBuffer(l[u]);a&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&Bp(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[ku(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new pL(this.tracks)}onBufferCodecs(e,t){var s;const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),a=!o&&this.sourceBufferCount&&this.media&&i.some(l=>!n[l]);if(o||a){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var u,c;const d=t[l],{id:h,codec:g,levelCodec:f,container:p,metadata:m,supplemental:y}=d;let v=n[l];const E=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],T=E!=null&&E.buffer?E:v,_=(T==null?void 0:T.pendingCodec)||(T==null?void 0:T.codec),x=T==null?void 0:T.levelCodec;v||(v=n[l]={buffer:void 0,listeners:[],codec:g,supplemental:y,container:p,levelCodec:f,metadata:m,id:h});const w=ha(_,x),A=w==null?void 0:w.replace($p,"$1");let I=ha(g,f);const R=(c=I)==null?void 0:c.replace($p,"$1");I&&w&&A!==R&&(l.slice(0,5)==="audio"&&(I=Ya(I,this.appendSource)),this.log(`switching codec ${_} to ${I}`),I!==(v.pendingCodec||v.codec)&&(v.pendingCodec=I),v.container=p,this.appendChangeType(l,p,I))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,i={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const a=o.buffer;a!=null&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),a.changeType(n),o.codec=s,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,W.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var a;const l=this.tracks.video;(this.lastVideoAppendEnd>n||l!=null&&l.buffer&&re.isBuffered(l.buffer,n)||((a=this.fragmentTracker.getAppendedFrag(n,W.MAIN))==null?void 0:a.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn("Error executing block-audio operation",a)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:i,parent:o,frag:a,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[i],{sn:h,cc:g}=a,f=self.performance.now();d.start=f;const p=a.stats.buffering,m=l?l.stats.buffering:null;p.start===0&&(p.start=f),m&&m.start===0&&(m.start=f);const y=s.audio;let v=!1;i==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const E=s.video,T=E==null?void 0:E.buffer;if(T&&h!=="initSegment"){const w=l||a,A=this.blockedAudioAppend;if(i==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(E.ending||E.ended)){const R=w.start+w.duration*.05,P=T.buffered,$=this.currentOp("video");!P.length&&!$?this.blockAudio(w):!$&&!re.isBuffered(T,R)&&this.lastVideoAppendEnd<R&&this.blockAudio(w)}else if(i==="video"){const I=w.end;if(A){const R=A.frag.start;(I>R||I<this.lastVideoAppendEnd||re.isBuffered(T,R))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}const _=(l||a).start,x={label:`append-${i}`,execute:()=>{var w;d.executeStart=self.performance.now();const A=(w=this.tracks[i])==null?void 0:w.buffer;A&&(v?this.updateTimestampOffset(A,_,.1,i,h,g):c!==void 0&&G(c)&&this.updateTimestampOffset(A,c,1e-6,i,h,g)),this.appendExecutor(n,i)},onStart:()=>{},onComplete:()=>{const w=self.performance.now();d.executeEnd=d.end=w,p.first===0&&(p.first=w),m&&m.first===0&&(m.first=w);const A={};this.sourceBuffers.forEach(([I,R])=>{I&&(A[I]=re.getBuffered(R))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:i,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:A})},onError:w=>{var A;const I={type:q.MEDIA_ERROR,parent:a.type,details:L.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:a,part:l,chunkMeta:u,error:w,err:w,fatal:!1},R=(A=this.media)==null?void 0:A.error;if(w.code===DOMException.QUOTA_EXCEEDED_ERR||w.name=="QuotaExceededError"||"quota"in w)I.details=L.BUFFER_FULL_ERROR;else if(w.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!R)I.errorAction=bn(!0);else if(w.name===dE&&this.sourceBufferCount===0)I.errorAction=bn(!0);else{const P=++this.appendErrors[i];this.warn(`Failed ${P}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${R||"no media error"})`),(P>=this.hls.config.appendErrorMaxRetry||R)&&(I.fatal=!0)}this.hls.trigger(S.ERROR,I)}};this.log(`queuing "${i}" append sn: ${h}${l?" p: "+l.index:""} of ${a.type===W.MAIN?"level":"track"} ${a.level} cc: ${g}`),this.append(x,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:i}=t;s?this.append(this.getFlushOp(s,n,i),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,i),o)})}onFragParsed(e,t){const{frag:s,part:n}=t,i=[],o=n?n.elementaryStreams:s.elementaryStreams;o[pe.AUDIOVIDEO]?i.push("audiovideo"):(o[pe.AUDIO]&&i.push("audio"),o[pe.VIDEO]&&i.push("video"));const a=()=>{const l=self.performance.now();s.stats.buffering.end=l,n&&(n.stats.buffering.end=l);const u=n?n.stats:s.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:s,part:n,stats:u,id:s.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(a,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([o])=>{if(o){const a=this.tracks[o];(!t.type||t.type===o)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var a;return o&&!((a=this.tracks[o])!=null&&a.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===L.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;G(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,i=s.currentTime,o=t.levelTargetDuration,a=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(G(a)&&a>=0){const u=Math.max(a,o),c=Math.floor(i/o)*o-u;this.flushBackBuffer(i,o,c)}const l=n.frontBufferFlushThreshold;if(G(l)&&l>0){const u=Math.max(n.maxBufferLength,l),c=Math.max(u,o),d=Math.floor(i/o)*o+c;this.flushFrontBuffer(i,o,d)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,i])=>{if(i){const a=re.getBuffered(i);if(a.length>0&&s>a.start(0)){var o;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,i])=>{if(i){const o=re.getBuffered(i),a=o.length;if(a<2)return;const l=o.start(a-1),u=o.end(a-1);if(s>l||e>=l&&e<=u)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,n);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return G(i)?{duration:i}:null;const o=this.media.duration,a=G(s.duration)?s.duration:0;return n>a&&n>o||!G(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(G(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${me(s)}`),this.tracksReady){var n;const i=(n=this.transferData)==null?void 0:n.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const o=i,a=e[o];if(this.isPending(a)){const l=this.getTrackCodec(a,o),u=`${a.container};codecs=${l}`;a.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(o)?" Queued":""} ${me(a)}`);try{const c=s.addSourceBuffer(u),d=ku(o),h=[o,c];t[d]=h,a.buffer=c}catch(c){var n;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:o,mimeType:u,parent:a.id});return}this.trackSourceBuffer(o,a)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&Yi(s,"video")&&(n=aI(n,s));const i=ha(n,e.levelCodec);return i?t.slice(0,5)==="audio"?Ya(i,this.appendSource):i:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,o)=>{const a=o.removedRanges;a!=null&&a.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const i=this.currentOp(e);i&&i.onError(n)}updateTimestampOffset(e,t,s,n,i,o){const a=t-e.timestampOffset;Math.abs(a)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${o})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:i}=this,o=this.tracks[e],a=o==null?void 0:o.buffer;if(!n||!i||!a){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=G(n.duration)?n.duration:1/0,u=G(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(s,l,u);d>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),a.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s==null?void 0:s.buffer;if(!n)throw new mL(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const i=n.buffer;if(!i)return;const o=s.bind(this,e);n.listeners.push({event:t,listener:o}),i.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function Bp(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function vL(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function ku(r){return r==="audio"?1:0}class Mh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&G(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,i)=>this.isLevelAllowed(n)&&i<=e);return this.clientRect=null,Mh.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let i=e.length-1;const o=Math.max(t,s);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&n(l,e[a+1])){i=a;break}}return i}}const EL={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},ht=EL,SL={HLS:"h"},TL=SL;class Er{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof Er?s:new Er(s))),this.value=e,this.params=t}}const _L="Dict";function wL(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function xL(r,e,t,s){return new Error(`failed to ${r} "${wL(e)}" as ${t}`,{cause:s})}function Sr(r,e,t){return xL("serialize",r,e,t)}class hE{constructor(e){this.description=e}}const jp="Bare Item",AL="Boolean";function RL(r){if(typeof r!="boolean")throw Sr(r,AL);return r?"?1":"?0"}function IL(r){return btoa(String.fromCharCode(...r))}const bL="Byte Sequence";function LL(r){if(ArrayBuffer.isView(r)===!1)throw Sr(r,bL);return`:${IL(r)}:`}const kL="Integer";function CL(r){return r<-999999999999999||999999999999999<r}function fE(r){if(CL(r))throw Sr(r,kL);return r.toString()}function PL(r){return`@${fE(r.getTime()/1e3)}`}function gE(r,e){if(r<0)return-gE(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const n=Math.floor(r*t);return(n%2===0?n:n+1)/t}else return Math.round(r*t)/t}const DL="Decimal";function OL(r){const e=gE(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Sr(r,DL);const t=e.toString();return t.includes(".")?t:`${t}.0`}const NL="String",FL=/[\x00-\x1f\x7f]+/;function ML(r){if(FL.test(r))throw Sr(r,NL);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function UL(r){return r.description||r.toString().slice(7,-1)}const $L="Token";function Gp(r){const e=UL(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Sr(e,$L);return e}function ld(r){switch(typeof r){case"number":if(!G(r))throw Sr(r,jp);return Number.isInteger(r)?fE(r):OL(r);case"string":return ML(r);case"symbol":return Gp(r);case"boolean":return RL(r);case"object":if(r instanceof Date)return PL(r);if(r instanceof Uint8Array)return LL(r);if(r instanceof hE)return Gp(r);default:throw Sr(r,jp)}}const BL="Key";function ud(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Sr(r,BL);return r}function Uh(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${ud(e)}`:`;${ud(e)}=${ld(t)}`).join("")}function pE(r){return r instanceof Er?`${ld(r.value)}${Uh(r.params)}`:ld(r)}function jL(r){return`(${r.value.map(pE).join(" ")})${Uh(r.params)}`}function GL(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Sr(r,_L);const t=r instanceof Map?r.entries():Object.entries(r),s=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,i])=>{i instanceof Er||(i=new Er(i));let o=ud(n);return i.value===!0?o+=Uh(i.params):(o+="=",Array.isArray(i.value)?o+=jL(i):o+=pE(i)),o}).join(`,${s}`)}function mE(r,e){return GL(r,e)}const cr="CMCD-Object",be="CMCD-Request",ys="CMCD-Session",$r="CMCD-Status",KL={br:cr,ab:cr,d:cr,ot:cr,tb:cr,tpb:cr,lb:cr,tab:cr,lab:cr,url:cr,pb:be,bl:be,tbl:be,dl:be,ltc:be,mtp:be,nor:be,nrr:be,rc:be,sn:be,sta:be,su:be,ttfb:be,ttfbb:be,ttlb:be,cmsdd:be,cmsds:be,smrt:be,df:be,cs:be,ts:be,cid:ys,pr:ys,sf:ys,sid:ys,st:ys,v:ys,msd:ys,bs:$r,bsd:$r,cdn:$r,rtp:$r,bg:$r,pt:$r,ec:$r,e:$r},VL={REQUEST:be};function HL(r){return Object.keys(r).reduce((e,t)=>{var s;return(s=r[t])===null||s===void 0||s.forEach(n=>e[n]=t),e},{})}function WL(r,e){const t={};if(!r)return t;const s=Object.keys(r),n=e?HL(e):{};return s.reduce((i,o)=>{var a;const l=KL[o]||n[o]||VL.REQUEST,u=(a=i[l])!==null&&a!==void 0?a:i[l]={};return u[o]=r[o],i},t)}function zL(r){return["ot","sf","st","e","sta"].includes(r)}function qL(r){return typeof r=="number"?G(r):r!=null&&r!==""&&r!==!1}const yE="event";function YL(r,e){const t=new URL(r),s=new URL(e);if(t.origin!==s.origin)return r;const n=t.pathname.split("/").slice(1),i=s.pathname.split("/").slice(1,-1);for(;n[0]===i[0];)n.shift(),i.shift();for(;i.length;)i.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const ya=r=>Math.round(r),cd=(r,e)=>Array.isArray(r)?r.map(t=>cd(t,e)):r instanceof Er&&typeof r.value=="string"?new Er(cd(r.value,e),r.params):(e.baseUrl&&(r=YL(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),Ko=r=>ya(r/100)*100,QL=(r,e)=>{let t=r;return e.version>=2&&(r instanceof Er&&typeof r.value=="string"?t=new Er([r]):typeof r=="string"&&(t=[r])),cd(t,e)},XL={br:ya,d:ya,bl:Ko,dl:Ko,mtp:Ko,nor:QL,rtp:Ko,tb:ya},vE="request",EE="response",$h=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],JL=["e"],ZL=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Cl(r){return ZL.test(r)}function ek(r){return $h.includes(r)||JL.includes(r)||Cl(r)}const SE=["d","dl","nor","ot","rtp","su"];function tk(r){return $h.includes(r)||SE.includes(r)||Cl(r)}const rk=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function sk(r){return $h.includes(r)||SE.includes(r)||rk.includes(r)||Cl(r)}const nk=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function ik(r){return nk.includes(r)||Cl(r)}const ok={[EE]:sk,[yE]:ek,[vE]:tk};function TE(r,e={}){const t={};if(r==null||typeof r!="object")return t;const s=e.version||r.v||1,n=e.reportingMode||vE,i=s===1?ik:ok[n];let o=Object.keys(r).filter(i);const a=e.filter;typeof a=="function"&&(o=o.filter(a));const l=n===EE||n===yE;l&&!o.includes("ts")&&o.push("ts"),s>1&&!o.includes("v")&&o.push("v");const u=ge({},XL,e.formatters),c={version:s,reportingMode:n,baseUrl:e.baseUrl};return o.sort().forEach(d=>{let h=r[d];const g=u[d];if(typeof g=="function"&&(h=g(h,c)),d==="v"){if(s===1)return;h=s}d=="pr"&&h===1||(l&&d==="ts"&&!G(h)&&(h=Date.now()),qL(h)&&(zL(d)&&typeof h=="string"&&(h=new hE(h)),t[d]=h))}),t}function ak(r,e={}){const t={};if(!r)return t;const s=TE(r,e),n=WL(s,e==null?void 0:e.customHeaderMap);return Object.entries(n).reduce((i,[o,a])=>{const l=mE(a,{whitespace:!1});return l&&(i[o]=l),i},t)}function lk(r,e,t){return ge(r,ak(e,t))}const uk="CMCD";function ck(r,e={}){return r?mE(TE(r,e),{whitespace:!1}):""}function dk(r,e={}){if(!r)return"";const t=ck(r,e);return encodeURIComponent(t)}function hk(r,e={}){if(!r)return"";const t=dk(r,e);return`${uk}=${t}`}const Kp=/CMCD=[^&#]+/;function fk(r,e,t){const s=hk(e,t);if(!s)return r;if(Kp.test(r))return r.replace(Kp,s);const n=r.includes("?")?"&":"?";return`${r}${n}${s}`}class gk{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:ht.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=n=>{try{const{frag:i,part:o}=n,a=this.hls.levels[i.level],l=this.getObjectType(i),u={d:(o||i).duration*1e3,ot:l};(l===ht.VIDEO||l===ht.AUDIO||l==ht.MUXED)&&(u.br=a.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=o?this.getNextPart(o):this.getNextFrag(i);c!=null&&c.url&&c.url!==i.url&&(u.nor=c.url),this.apply(n,u)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:TL.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){ge(t,this.createData());const s=t.ot===ht.INIT||t.ot===ht.VIDEO||t.ot===ht.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,a)=>(n.includes(a)&&(o[a]=t[a]),o),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),lk(e.headers,t,i)):e.url=fk(e.url,t,i)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,i=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:o}=n;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.index===s&&l.fragment.sn===o)return i[a+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return ht.TIMED_TEXT;if(e.sn==="initSegment")return ht.INIT;if(t==="audio")return ht.AUDIO;if(t==="main")return this.hls.audioTracks.length?ht.VIDEO:ht.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===ht.AUDIO)s=n.audioTracks;else{const i=n.maxAutoLevel,o=i>-1?i+1:n.levels.length;s=n.levels.slice(0,o)}return s.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===ht.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:re.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new s(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new s(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,o,a){t(i),this.loader.load(i,o,a)}}}}const pk=3e5;class mk extends Vt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if((s==null?void 0:s.action)===Qe.SendAlternateToPenaltyBox&&s.flags===wt.MoveAllAlternatesMatchingHost){const n=this.levels;let i=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&n?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!i&&n&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==o),t.details===L.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${me(i)} penalized: ${me(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(i=>{n-s[i]>pk&&delete s[i]});for(let i=0;i<e.length;i++){const o=e[i];if(o in s)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,jv(t),this.hls.trigger(S.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let i=0;i<n.length;i++)if(t===ae.AUDIO_TRACK&&n[i].hasAudioGroup(e)||t===ae.SUBTITLE_TRACK&&n[i].hasSubtitleGroup(e))return n[i].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(i=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new _e(c.attrs);d["PATHWAY-ID"]=o;const h=d.AUDIO&&`${d.AUDIO}_clone_${o}`,g=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;h&&(s[d.AUDIO]=h,d.AUDIO=h),g&&(n[d.SUBTITLES]=g,d.SUBTITLES=g);const f=_E(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Xi({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:f,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let m=1;m<c.audioGroups.length;m++)p.addGroupId("audio",`${c.audioGroups[m]}_clone_${o}`);if(c.subtitleGroups)for(let m=1;m<c.subtitleGroups.length;m++)p.addGroupId("text",`${c.subtitleGroups[m]}_clone_${o}`);return p});t.push(...u),Vp(this.audioTracks,s,l,o),Vp(this.subtitleTracks,n,l,o)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,h,g)=>{this.log(`Loaded steering manifest: "${n}"`);const f=c.data;if((f==null?void 0:f.VERSION)!==1){this.log(`Steering VERSION ${f.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=f.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":y}=f;if(p)try{this.uri=new self.URL(p,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||h.url),m&&this.clonePathways(m);const v={steeringManifest:f,url:n.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(c,d,h,g)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let f=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const m=p.getResponseHeader("Retry-After");m&&(f=parseFloat(m)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,f)},onTimeout:(c,d,h)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Vp(r,e,t,s){r&&Object.keys(e).forEach(n=>{const i=r.filter(o=>o.groupId===n).map(o=>{const a=ge({},o);return a.details=void 0,a.attrs=new _e(a.attrs),a.url=a.attrs.URI=_E(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[n],a.attrs["PATHWAY-ID"]=s,a});r.push(...i)})}function _E(r,e,t,s){const{HOST:n,PARAMS:i,[t]:o}=s;let a;e&&(a=o==null?void 0:o[e],a&&(r=a));const l=new self.URL(r);return n&&!a&&(l.host=n),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}class kn extends Vt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=kn.CDMCleanupPromise?[kn.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:n}=t,i=`"${t.type}" event: init data type: "${s}"`;if(this.debug(i),n!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=di(this.config));const a=o.map(_u).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=ga(o);if(s!=="sinf"||a!==Ae.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${a}`);return}let l;try{const g=$e(new Uint8Array(n)),f=Ih(JSON.parse(g).sinf),p=mv(f);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24))}catch(g){this.warn(`${i} Failed to parse sinf: ${g}`);return}const u=Xe(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let h=c[u];for(let g=0;g<d.length;g++){const f=d[g],p=f.decryptdata;if(!p.keyId)continue;const m=Xe(p.keyId);if(el(l,p.keyId)||p.uri.replace(/-/g,"").indexOf(u)!==-1){if(h=c[m],!h)continue;if(p.pssh)break;delete c[m],p.pssh=new Uint8Array(n),p.keyId=l,h=c[u]=h.then(()=>this.generateRequestWithPreferredKeySession(f,s,n,"encrypted-event-key-match")),h.catch(y=>this.handleError(y));break}}h||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t==null?void 0:t[e];if(n)return n.licenseUrl;if(e===Ae.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t==null?void 0:t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(o,a,l)=>!!o&&l.indexOf(o)===a,n=t.map(o=>o.audioCodec).filter(s),i=t.map(o=>o.videoCodec).filter(s);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,n,i).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof _t?a(d):a(new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return Dv===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){var n;const i=QI(e,t,s,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[e],a=(n=o)==null?void 0:n.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${me(i)}`),a=this.requestMediaKeySystemAccess(e,i);const l=o=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),a.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(g=>g?this.setMediaKeysServerCertificate(h,e,g):h)));return d.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),d})}return a.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Xe(e.keyId||[])} keyUri: ${e.uri}`);const n=s.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=Vo(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Xe(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>_u(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const i=_u(n);i?t(i):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=di(this.config),s=e.map(ga).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const n=yk(e,t[s]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,s=Vo(t),n=this.bannedKeyIds[s];if(n||this.getKeyStatus(t)==="internal-error"){const a=Hp(n||"internal-error",t);return this.handleError(a,e.frag),Promise.reject(a)}const i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const o=this.keyIdToKeySessionPromise[s];if(!o){const a=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return a.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[s]=a,a}return o.catch(a=>{if(a instanceof _t){const l=de({},a.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new _t(l,a.message);this.handleError(u,e.frag)}}),o}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof _t){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Xe(s.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Vo(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=ga(e.keyFormat),i=n?[n]:di(this.config);return this.attemptKeySystemAccess(i)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=di(this.config)),e.length===0)throw new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${me({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(o)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>s.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var i;const o=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(o)try{const f=o.call(this.hls,t,s,e);if(!f)throw new Error("Invalid response from configured generateRequest filter");t=f.initDataType,s=f.initData?f.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(f){if(this.warn(f.message),this.hls&&this.hls.config.debug)throw f}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const a=Vo(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${a} URI: ${l} (init data type: ${t} length: ${s.byteLength})`);const u=new Lh,c=e._onmessage=f=>{const p=e.mediaKeysSession;if(!p){u.emit("error",new Error("invalid state"));return}const{messageType:m,message:y}=f;this.log(`"${m}" message event for session "${p.sessionId}" message size: ${y.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,y).catch(v=>{u.eventNames().length?u.emit("error",v):this.handleError(v)}):m==="license-release"?e.keySystem===Ae.FAIRPLAY&&this.updateKeySession(e,rd("acknowledged")).then(()=>this.removeSession(e)).catch(v=>this.handleError(v)):this.warn(`unhandled media key message type "${m}"`)},d=(f,p)=>{p.keyStatus=f;let m;f.startsWith("usable")?u.emit("resolved"):f==="internal-error"||f==="output-restricted"||f==="output-downscaled"?m=Hp(f,p.decryptdata):f==="expired"?m=new Error(`key expired (keyId: ${a})`):f==="released"?m=new Error("key released"):f==="status-pending"||this.warn(`unhandled key status change "${f}" (keyId: ${a})`),m&&(u.eventNames().length?u.emit("error",m):this.handleError(m))},h=e._onkeystatuseschange=f=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const m=this.getKeyStatuses(e);if(!Object.keys(m).some(T=>m[T]!=="status-pending"))return;if(m[a]==="expired"){this.log(`Expired key ${me(m)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let v=m[a];if(v)d(v,e);else{var E;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(E=e.keyStatusTimeouts)[a]||(E[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const _=this.getKeyStatus(e.decryptdata);if(_&&_!=="status-pending")return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${_} from other session.`),d(_,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),v="internal-error",d(v,e)},1e3)),this.log(`No status for keyId ${a} (${me(m)}).`)}};lt(e.mediaKeysSession,"message",c),lt(e.mediaKeysSession,"keystatuseschange",h);const g=new Promise((f,p)=>{u.on("error",p),u.on("resolved",f)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${l}`)}).catch(f=>{throw new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_NO_SESSION,error:f,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${f}`)}).then(()=>g).catch(f=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw f}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,n)=>{if(typeof n=="string"&&typeof s=="object"){const a=n;n=s,s=a}const i="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===Ae.PLAYREADY&&i.length===16){const a=Xe(i);t[a]=s,Cv(i)}const o=Xe(i);s==="internal-error"&&(this.bannedKeyIds[o]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${o} key-session "${e.mediaKeysSession.sessionId}"`),t[o]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,g,f,p)=>{o(h.data)},onError:(h,g,f,p)=>{a(new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:f,response:de({url:l.url,data:void 0},h)},`"${e}" certificate request failed (${i}). Status: ${h.code} (${h.text})`))},onTimeout:(h,g,f)=>{a(new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:f,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(h,g,f)=>{a(new Error("aborted"))}};n.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,i)=>{e.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),n(e)}).catch(o=>{i(new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let d=0,h=i.length;d<h;d++){var o,a;c=i[d];const g=(o=c.querySelector("name"))==null?void 0:o.textContent,f=(a=c.querySelector("value"))==null?void 0:a.textContent;g&&f&&e.setRequestHeader(g,f)}}const l=n.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return rd(atob(u))}setupLicenseXHR(e,t,s,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,s,n)}).catch(o=>{if(!s.decryptdata)throw o;return e.open("POST",t,!0),i.call(this.hls,e,t,s,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,i)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}n(l)}else{const l=s.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)i(new _t({type:q.KEY_SYSTEM_ERROR,details:L.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==Ae.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,lt(s,"encrypted",this.onMediaEncrypted),lt(s,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(pt(e,"encrypted",this.onMediaEncrypted),pt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ns.clearKeyUriToKeyIdMap();const i=n.length;kn.CDMCleanupPromise=Promise.all(n.map(o=>this.removeSession(o)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,i)=>(n.indexOf(i.keyFormat)===-1&&n.push(i.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Xe((n==null?void 0:n.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:o}=e;o&&Object.keys(o).forEach(u=>self.clearTimeout(o[u]));const{drmSystemOptions:a}=this.config;return(JI(a)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}kn.CDMCleanupPromise=void 0;function Vo(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Xe(r.keyId)}function yk(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class _t extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Hp(r,e){const t=r==="output-restricted",s=t?L.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:L.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new _t({type:q.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class vk{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const i=n-this.lastTime,o=s-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/i,u=this.hls;if(u.trigger(S.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:s}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function wE(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function xE(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){he.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,r.addCue(n)}catch(n){he.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(r.mode=t)}function Sn(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let s=r.cues.length;s--;)e&&r.cues[s].removeEventListener("enter",e),r.removeCue(r.cues[s]);t==="disabled"&&(r.mode=t)}function dd(r,e,t,s){const n=r.mode;if(n==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const i=Sk(r.cues,e,t);for(let o=0;o<i.length;o++)(!s||s(i[o]))&&r.removeCue(i[o])}n==="disabled"&&(r.mode=n)}function Ek(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let s=0,n=t,i;for(;s<=n;)if(i=Math.floor((n+s)/2),e<r[i].startTime)n=i-1;else if(e>r[i].startTime&&s<t)s=i+1;else return i;return r[s].startTime-e<e-r[n].startTime?s:n}function Sk(r,e,t){const s=[],n=Ek(r,e);if(n>-1)for(let i=n,o=r.length;i<o;i++){const a=r[i];if(a.startTime>=e&&a.endTime<=t)s.push(a);else if(a.startTime>t)return s}return s}function va(r){const e=[];for(let t=0;t<r.length;t++){const s=r[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(r[t])}return e}class Tk extends Fh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=va(this.media.textTracks);for(let i=0;i<s.length;i++)if(s[i].mode==="hidden")t=s[i];else if(s[i].mode==="showing"){t=s[i];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;va(s.textTracks).forEach(o=>{Sn(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:i}=t,o=this.tracksInGroup[s];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!s||(n==null?void 0:n.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!s||s.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!i&&a){this.selectDefaultTrack=!1;const c=pr(a,o);if(c>-1)i=o[c];else{const d=pr(a,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const i=t[n];if(!(s&&!i.default||!s&&!e)&&(!e||Ds(i,e)))return n}if(e){for(let n=0;n<t.length;n++){const i=t[n];if(to(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const i=t[n];if(to(e.attrs,i.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(ad(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ae.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Ds(e,s))return s;const n=pr(e,this.tracksInGroup);if(n>-1){const i=this.tracksInGroup[n];return this.setSubtitleTrack(n),i}else{if(s)return null;{const i=pr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),o=e.details,a=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:i,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=va(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(i=>ad(s,i))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==n&&(i.mode="disabled")}),n){const i=this.subtitleDisplay?"showing":"hidden";n.mode!==i&&(n.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!G(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&i)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=n;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(n.url,s==null?void 0:s.details,n.details);this.loadPlaylist(d)}}function _k(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?i:i&3|8).toString(16)})}}}function Ai(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const Cn=.025;let nl=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function wk(r,e,t){return`${r.identifier}-${t+1}-${Ai(e)}`}class xk{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Cu(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Cu(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=G(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Cu(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Cn))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?nl.Range:nl.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Ak(this)}}function Cu(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<Cn)?e.start:e.start+e.duration}function AE(r,e,t){const s=new self.URL(r,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Pu(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function Ak(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function on(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Rk{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const o=()=>{this.hasDetails=!0};i.once(S.LEVEL_LOADED,o),i.once(S.AUDIO_TRACK_LOADED,o),i.once(S.SUBTITLE_TRACK_LOADED,o),i.on(S.MEDIA_ATTACHING,(a,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(S.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,i.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=AE(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,i=re.bufferInfo(e,n,0);return this.getAssetTime(i.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=re.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,s){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,s){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${on(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Wp=.033;class Ik extends Vt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(i=n[s])!=null&&i.event;){var i;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let i=s[n];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const i=s[n].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let i=0;i<n;i++){const o=s[i];if(!o.error){const a=o.timelineStart;if(t===a||t>a&&(t<a+(o.duration||0)||i===n-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,i=this.events,o=this.parseDateRanges(n,{url:s.url},t),a=Object.keys(n),l=i?i.filter(u=>!a.includes(u.identifier)):[];o.length&&o.sort((u,c)=>{const d=u.cue.pre,h=u.cue.post,g=c.cue.pre,f=c.cue.post;if(d&&!g)return-1;if(g&&!d||h&&!f)return 1;if(f&&!h)return-1;if(!d&&!g&&!h&&!f){const p=u.startTime,m=c.startTime;if(p!==m)return p-m}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=o,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],s=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const i=this.items,o=this.parseSchedule(n,e);(s||t.length||(i==null?void 0:i.length)!==o.length||o.some((l,u)=>Math.abs(l.playout.start-i[u].playout.start)>.005||Math.abs(l.playout.end-i[u].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,s){const n=[],i=Object.keys(e);for(let o=0;o<i.length;o++){const a=i[o],l=e[a];if(l.isInterstitial){let u=this.eventMap[a];u?u.setDateRange(l):(u=new xk(l,t),this.eventMap[a]=u,s===!1&&(u.appendInPlace=s)),n.push(u)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,i=n.live?1/0:n.edge;let o=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const h=c.cue.pre,g=c.cue.post,f=e[d-1]||null,p=c.appendInPlace,m=g?i:c.startOffset,y=c.duration,v=c.timelineOccupancy===nl.Range?y:0,E=c.resumptionOffset,T=(f==null?void 0:f.startTime)===m,_=m+c.cumulativeDuration;let x=p?_+y:m+E;if(h||!g&&m<=0){const A=u;u+=v,c.timelineStart=_;const I=o;o+=y,s.push({event:c,start:_,end:x,playout:{start:I,end:o},integrated:{start:A,end:u}})}else if(m<=i){if(!T){const R=m-l;if(R>Wp){const P=l,$=u;u+=R;const j=o;o+=R;const K={previousEvent:e[d-1]||null,nextEvent:c,start:P,end:P+R,playout:{start:j,end:o},integrated:{start:$,end:u}};s.push(K)}else R>0&&f&&(f.cumulativeDuration+=R,s[s.length-1].end=m)}g&&(x=_),c.timelineStart=_;const A=u;u+=v;const I=o;o+=y,s.push({event:c,start:_,end:x,playout:{start:I,end:o},integrated:{start:A,end:u}})}else return;const w=c.resumeTime;g||w>i?l=i:l=w}),l<i){var a;const c=l,d=u,h=i-l;u+=h;const g=o;o+=h,s.push({previousEvent:((a=s[s.length-1])==null?void 0:a.event)||null,nextEvent:null,start:l,end:c+h,playout:{start:g,end:o},integrated:{start:d,end:u}})}this.setDurations(i,o,u)}else s.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let i=0,o=-1;e.forEach((a,l)=>{const u=a.cue.pre,c=a.cue.post,d=u?0:c?n:a.startTime;this.updateAssetDurations(a),o===d?a.cumulativeDuration=i:(i=0,o=d),!c&&a.snapOptions.in&&(a.resumeAnchor=Bs(null,s.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)),!a.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Wp&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`));const g=G(a.resumeOffset)?a.resumeOffset:a.duration;i+=g})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>Cn?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(o=>{const a=t[o].details,l=a.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${o} playlist end ${l}`),!1;const u=Bs(null,a.fragments,s);if(!u)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${a.fragStart}-${a.fragmentEnd})`),!0;const c=o==="audio"?.175:0;return Math.abs(u.start-s)<Cn+c||Math.abs(u.end-s)<Cn+c?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,i=!1;for(let o=0;o<e.assetList.length;o++){const a=e.assetList[o],l=t+s;a.startOffset=s,a.timelineStart=l,n||(n=a.duration===null),i||(i=!!a.error);const u=a.error?0:a.duration||0;s+=u}n&&!i?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function zt(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class bk{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=AE(s,this.hls.sessionId,e.baseUrl)}catch(h){const g=this.assignAssetListError(e,L.ASSET_LIST_LOAD_ERROR,h,s);this.hls.trigger(S.ERROR,g);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,o=i.loader,a=new o(i),l={responseType:"json",url:n.href},u=i.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,g,f,p)=>{const m=h.data,y=m==null?void 0:m.ASSETS;if(!Array.isArray(y)){const v=this.assignAssetListError(e,L.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),f.url,g,p);this.hls.trigger(S.ERROR,v);return}e.assetListResponse=m,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:m,networkDetails:p})},onError:(h,g,f,p)=>{const m=this.assignAssetListError(e,L.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${h.code} ${h.text} (${g.url})`),g.url,p,f);this.hls.trigger(S.ERROR,m)},onTimeout:(h,g,f)=>{const p=this.assignAssetListError(e,L.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${g.url})`),g.url,h,f);this.hls.trigger(S.ERROR,p)}};return a.load(l,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,s,n,i,o){return e.error=s,{type:q.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:o,stats:i}}}function zp(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function Ho(r,e){return`[${r}] Advancing timeline position to ${e}`}class Lk extends Vt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const a=this.playingItem;if(!a){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(!0),this.checkBuffer(),o&&s<a.start||s>=a.end){var l;const g=this.findItemIndex(a);let f=this.schedule.findItemIndexAtTime(s);if(f===-1&&(f=g+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${s} (resolving from ${g} to ${f})`)),!this.isInterstitial(a)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!o&&f>g){const p=this.schedule.findJumpRestrictedIndex(g+1,f);if(p>g){this.setSchedulePosition(p);return}}this.setSchedulePosition(f);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(a)){const g=a.event.assetList[0];g&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,g))}return}const c=u.timelineStart,d=u.duration||0;if(o&&s<c||s>=c+d){var h;(h=a.event)!=null&&h.appendInPlace&&(this.clearAssetPlayers(a.event,a),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,u)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const a=this.findItemIndex(n);this.setSchedulePosition(a+1)}const i=this.playingAsset;if(!i)return;const o=i.timelineStart+(i.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,i)},this.onScheduleUpdate=(s,n)=>{const i=this.schedule;if(!i)return;const o=this.playingItem,a=i.events||[],l=i.items||[],u=i.durations,c=s.map(p=>p.identifier),d=!!(a.length||c.length);(d||n)&&this.log(`INTERSTITIALS_UPDATED (${a.length}): ${a}
Schedule: ${l.map(p=>zt(p))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let h=null,g=null;o&&(h=this.updateItem(o,this.timelinePos),this.itemsMatch(o,h)?this.playingItem=h:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const f=this.bufferingItem;if(f&&(g=this.updateItem(f,this.bufferedPos),this.itemsMatch(f,g)?this.bufferingItem=g:f.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(f.event,null))),s.forEach(p=>{p.assetList.forEach(m=>{this.clearAssetPlayer(m.identifier,null)})}),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const m=p.assetItem.timelineStart,y=p.timelineOffset-m;if(y)try{p.timelineOffset=m}catch(v){Math.abs(y)>Cn&&this.warn(`${v} ("${p.assetId}" ${p.timelineOffset}->${m})`)}}}),d||n){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:a.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(o)&&c.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(h,o),f&&g!==h&&this.trimInPlace(g,f),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new bk(e),this.schedule=new Ik(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){pt(e,"play",this.onPlay),pt(e,"pause",this.onPause),pt(e,"seeking",this.onSeeking),pt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;lt(s,"seeking",this.onSeeking),lt(s,"timeupdate",this.onTimeupdate),lt(s,"play",this.onPlay),lt(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const i=this.findItemIndex(s);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=d=>d&&e.getAssetPlayer(d.identifier),n=(d,h,g,f,p)=>{if(d){let m=d[h].start;const y=d.event;if(y){if(h==="playout"||y.timelineOccupancy!==nl.Point){const v=s(g);(v==null?void 0:v.interstitial)===y&&(m+=v.assetItem.startOffset+v[p])}}else{const v=f==="bufferedPos"?o():e[f];m+=v-d.start}return m}return 0},i=(d,h)=>{var g;if(d!==0&&h!=="primary"&&(g=e.schedule)!=null&&g.length){var f;const p=e.schedule.findItemIndexAtTime(d),m=(f=e.schedule.items)==null?void 0:f[p];if(m){const y=m[h].start-m.start;return d+y}}return d},o=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?a("primary"):Math.max(d,0)},a=d=>{var h,g;return(h=e.primaryDetails)!=null&&h.live?e.primaryDetails.edge:((g=e.schedule)==null?void 0:g.durations[d])||0},l=(d,h)=>{var g,f;const p=e.effectivePlayingItem;if(p!=null&&(g=p.event)!=null&&g.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${h}"`);const m=e.effectivePlayingItem,y=e.schedule.findItemIndexAtTime(d,h),v=(f=e.schedule.items)==null?void 0:f[y],E=e.getBufferingPlayer(),T=E==null?void 0:E.interstitial,_=T==null?void 0:T.appendInPlace,x=m&&e.itemsMatch(m,v);if(m&&(_||x)){const w=s(e.playingAsset),A=(w==null?void 0:w.media)||e.primaryMedia;if(A){const I=h==="primary"?A.currentTime:n(m,h,e.playingAsset,"timelinePos","currentTime"),R=d-I,P=(_?I:A.currentTime)+R;if(P>=0&&(!w||_||P<=w.duration)){A.currentTime=P;return}}}if(v){let w=d;if(h!=="primary"){const I=v[h].start,R=d-I;w=v.start+R}const A=!e.isInterstitial(v);if((!e.isInterstitial(m)||m.event.appendInPlace)&&(A||v.event.appendInPlace)){const I=e.media||(_?E==null?void 0:E.media:null);I&&(I.currentTime=w)}else if(m){const I=e.findItemIndex(m);if(y>I){const P=e.schedule.findJumpRestrictedIndex(I+1,y);if(P>I){e.setSchedulePosition(P);return}}let R=0;if(A)e.timelinePos=w,e.checkBuffer();else{const P=v.event.assetList,$=d-(v[h]||v).start;for(let j=P.length;j--;){const K=P[j];if(K.duration&&$>=K.startOffset&&$<K.startOffset+K.duration){R=j;break}}}e.setSchedulePosition(y,R)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const h=t();return e.isInterstitial(h)?h:null},c={get bufferedEnd(){const d=t(),h=e.bufferingItem;if(h&&h===d){var g;return n(h,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-h.playout.start||((g=e.bufferingAsset)==null?void 0:g.startOffset)||0}return 0},get currentTime(){const d=u(),h=e.effectivePlayingItem;return h&&h===d?n(h,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-h.playout.start:0},set currentTime(d){const h=u(),g=e.effectivePlayingItem;g&&g===h&&l(d+g.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const h=(d=u())==null?void 0:d.event.assetList;return h?h.map(g=>e.getAssetPlayer(g.identifier)):[]},get playingIndex(){var d;const h=(d=u())==null?void 0:d.event;return h&&e.effectivePlayingAsset?h.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return o()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return a("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return a("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,h=d==null?void 0:d.event;if(h&&!h.restrictions.skip){const g=e.findItemIndex(d);if(h.appendInPlace){const f=d.playout.start+d.event.duration;l(f+.001,"playout")}else e.advanceAfterAssetEnded(h,g,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const i=(t=n)==null?void 0:t.currentTime;if(!(i===void 0||!G(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${me(i)}`),this.detachedData=i}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let i=null;const o=this.hls,a=e!==o,l=a&&e.interstitial.appendInPlace,u=(s=this.detachedData)==null?void 0:s.mediaSource;let c;if(o.media)l&&(i=o.transferMedia(),this.detachedData=i),c="Primary";else if(u){const f=this.getBufferingPlayer();f?(i=f.transferMedia(),c=`${f}`):c="detached MediaSource"}else c="detached media";if(!i){if(u)i=this.detachedData,this.log(`using detachedData: MediaSource ${me(i)}`);else if(!this.detachedData||o.media===t){const f=this.playerQueue;f.length>1&&f.forEach(p=>{if(a&&p.interstitial.appendInPlace!==l){const m=p.interstitial;this.clearInterstitial(p.interstitial,null),m.appendInPlace=!1,m.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${m}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((n=i.mediaSource)==null?void 0:n.readyState)!=="closed",h=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const g=this.schedule;if(h===i&&g){const f=a&&e.assetId===g.assetIdAtEnd;h.overrides={duration:g.duration,endOfStream:!a||f,cueRemoval:!a}}e.attachMedia(h)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const i=this.hls.startPosition;if(this.log(Ho("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(i>=0||!this.primaryLive){const o=this.timelinePos=i>0?i:0,a=e.findItemIndexAtTime(o);this.setSchedulePosition(a)}}else if(n&&!this.playingItem){const i=e.findItemIndex(n);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),i=Pu(s,n);if(!s.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var o;const a=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(e)+1];a&&this.bufferedToItem(a)}}advanceAfterAssetEnded(e,t,s){const n=Pu(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const i=this.schedule.items;if(i){const o=t+1,a=i.length;if(o>=a){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Ho("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(o)}}}else{if(e.appendInPlace){const i=e.assetList[n];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,i=s.getEvent(n);if(i){const o=s.findEventIndex(n),a=s.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,o,a-1)}}setSchedulePosition(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n||this.playbackDisabled)return;const i=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&zt(i)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(o)){const c=o.event,d=this.playingAsset,h=d==null?void 0:d.identifier,g=h?this.getAssetPlayer(h):null;if(g&&h&&(!this.eventItemsMatch(o,i)||t!==void 0&&h!==c.assetList[t].identifier)){var l;const f=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${f+1}/${c.assetList.length} ${on(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:f,event:c,schedule:n.slice(0),scheduleIndex:e,player:g}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),f);return}this.retreiveMediaSource(h,i),g.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&g.detachMedia()}if(!this.eventItemsMatch(o,i)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${zt(o)}`),c.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:c,schedule:n.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const f=(u=this.schedule)==null?void 0:u.items;if(i&&f){const p=this.findItemIndex(i);this.advanceSchedule(p,f,t,o,a)}return}}this.advanceSchedule(e,n,t,o,a)}advanceSchedule(e,t,s,n,i){const o=this.schedule;if(!o)return;const a=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,h=o.findEventIndex(d.identifier);(h<e||h>e+1)&&this.clearInterstitial(d,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const c=a.event;if(s===void 0){s=o.findAssetIndex(c,this.timelinePos);const f=Pu(c,s-1);if(c.isAssetPastPlayoutLimit(f)||c.appendInPlace&&this.timelinePos===a.end){this.advanceAfterAssetEnded(c,e,s);return}s=f}const d=this.waitingItem;this.assetsBuffered(a,l)||this.setBufferingItem(a);let h=this.preloadAssets(c,s);if(this.eventItemsMatch(a,d||n)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${zt(a)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=a;const g=c.assetList[s];if(!g){this.advanceAfterAssetEnded(c,e,s||0);return}if(h||(h=this.getAssetPlayer(g.identifier)),h===null||h.destroyed){const f=c.assetList.length;this.warn(`asset ${s+1}/${f} player destroyed ${c}`),h=this.createAssetPlayer(c,g,s),h.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(g))return;this.startAssetPlayer(h,s,t,e,l),this.shouldPlay&&zp(h.media)}else a?(this.resumePrimary(a,e,n),this.shouldPlay&&zp(this.hls.media)):i&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${zt(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let a=this.timelinePos;(a<e.start||a>=e.end)&&(a=this.getPrimaryResumption(e,t),this.log(Ho("resumePrimary",a)),this.timelinePos=a),this.attachPrimary(a,e)}if(!s)return;const o=(i=this.schedule)==null?void 0:i.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${zt(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:re.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Ho("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const n=de(de({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=de(de({},this.altSelection),{},{audio:s});return}const i=de(de({},n),{},{audio:s});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=de(de({},this.altSelection),{},{subtitles:s});return}const i=de(de({},n),{},{subtitles:s});this.mediaSelection=i}onAudioTrackSwitching(e,t){const s=rp(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=rp(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const i=t[n];if(i.cue.post){var s;const o=this.schedule.findEventIndex(i.identifier),a=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(a)&&this.eventItemsMatch(a,this.bufferingItem)&&this.bufferedToItem(a,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(e&&n){const i=this.findItemIndex(e,t);return n[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,o)=>{e.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(i.identifier,null)});const s=e.end+.25,n=re.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${zt(e)} (was ${zt(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const n=re.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const o=this.playingItem,a=this.findItemIndex(o);let l=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(i),d=Math.min(c+1,t.length-1),h=t[d];if((l===-1&&i&&e>=i.end||(u=h.event)!=null&&u.appendInPlace&&e+.01>=h.start)&&(l=d),this.isInterstitial(i)){const g=i.event;if(d-a>1&&g.appendInPlace===!1||g.assetList.length===0&&g.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>a)this.bufferedToItem(h);else{const g=this.primaryDetails;this.primaryLive&&g&&e>g.edge-g.targetduration&&h.start<g.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(h)&&this.preloadAssets(h.event,0)}}else s&&o&&!this.itemsMatch(o,i)&&(l===a?this.bufferedToItem(o):l===a+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const i=this.getAssetPlayer(n.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:i}=s;if(!n||!i)return t;const o=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${zt(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const u=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const h=this.getAssetPlayer(c.identifier);h&&(d===u&&h.loadSource(),h.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,i=s.cue.once;if(n||!i){const o=this.preloadAssets(s,t);if(o!=null&&o.interstitial.appendInPlace){const a=this.primaryMedia;a&&this.bufferAssetPlayer(o,a)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,i=n===0&&!e.assetListLoader,o=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var a;const h=this.playingItem;!this.isInterstitial(h)&&(h==null||(a=h.nextEvent)==null?void 0:a.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const h=c-l;h>0&&(u=Math.round(h*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!o&&n){for(let u=t;u<n;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,i,o){const a={parentIdentifier:e.identifier,identifier:wk(e,o,t),duration:i,startOffset:s,timelineStart:n,uri:o};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,s){const n=this.hls,i=n.userConfig;let o=i.videoPreference;const a=n.loadLevelObj||n.levels[n.currentLevel];(o||a)&&(o=ge({},o),a.videoCodec&&(o.videoCodec=a.videoCodec),a.videoRange&&(o.allowedVideoRanges=[a.videoRange]));const l=n.audioTracks[n.audioTrack],u=n.subtitleTracks[n.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const _=t.duration;_&&T<_&&(c=T)}}const d=t.identifier,h=de(de({},i),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:l||i.audioPreference,subtitlePreference:u||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(h.timelineOffset=t.timelineStart));const g=h.cmcd;g!=null&&g.sessionId&&g.contentId&&(h.cmcd=ge({},g,{contentId:Ai(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const f=new Rk(this.HlsPlayerClass,h,e,t);this.playerQueue.push(f),e.assetList[s]=t;let p=!0;const m=T=>{if(T.live){var _;const A=new Error(`Interstitials MUST be VOD assets ${e}`),I={fatal:!0,type:q.OTHER_ERROR,details:L.INTERSTITIAL_ASSET_ITEM_ERROR,error:A},R=((_=this.schedule)==null?void 0:_.findEventIndex(e.identifier))||-1;this.handleAssetItemError(I,e,R,s,A.message);return}const x=T.edge-T.fragmentStart,w=t.duration;(p||w===null||x>w)&&(p=!1,this.log(`Interstitial asset "${d}" duration change ${w} > ${x}`),t.duration=x,this.updateSchedule())};f.on(S.LEVEL_UPDATED,(T,{details:_})=>m(_)),f.on(S.LEVEL_PTS_UPDATED,(T,{details:_})=>m(_)),f.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const y=(T,_)=>{const x=this.getAssetPlayer(d);if(x&&_.tracks){x.off(S.BUFFER_CODECS,y),x.tracks=_.tracks;const w=this.primaryMedia;this.bufferingAsset===x.assetItem&&w&&!x.media&&this.bufferAssetPlayer(x,w)}};f.on(S.BUFFER_CODECS,y);const v=()=>{var T;const _=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${_}`),!_||!this.schedule)return;const x=this.schedule.findEventIndex(e.identifier),w=(T=this.schedule.items)==null?void 0:T[x];this.isInterstitial(w)&&this.advanceAssetBuffering(w,t)};f.on(S.BUFFERED_TO_END,v);const E=T=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const x=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,x,T)};return f.once(S.MEDIA_ENDED,E(s)),f.once(S.PLAYOUT_LIMIT_REACHED,E(1/0)),f.on(S.ERROR,(T,_)=>{if(!this.schedule)return;const x=this.getAssetPlayer(d);if(_.details===L.BUFFER_STALLED_ERROR){if(x!=null&&x.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${_.error} ${e}`)}),f.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const _=new Error(`Asset player destroyed unexpectedly ${d}`),x={fatal:!0,type:q.OTHER_ERROR,details:L.INTERSTITIAL_ASSET_ITEM_ERROR,error:_};this.handleAssetItemError(x,e,this.schedule.findEventIndex(e.identifier),s,_.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${on(t)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const n=this.playerQueue[s];this.log(`clear ${n} toSegment: ${t&&zt(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,i){const{interstitial:o,assetItem:a,assetId:l}=e,u=o.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=a,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,s[n]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${on(a)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:o,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:i,assetItem:o}=e,a=this.schedule.findEventIndex(i.identifier),l=(s=this.schedule.items)==null?void 0:s[a];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=o;const u=this.getBufferingPlayer();if(u===e)return;const c=i.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(c&&o!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!av(d,e.tracks)){const h=new Error(`Asset ${on(o)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),g={fatal:!0,type:q.OTHER_ERROR,details:L.INTERSTITIAL_ASSET_ITEM_ERROR,error:h},f=i.findAssetIndex(o);this.handleAssetItemError(g,i,a,f,h.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,i=t.findAssetIndex(e,n),o=e.assetList[i];if(o){const a=this.getAssetPlayer(o.identifier);if(a){const l=a.currentTime||n-o.timelineStart,u=a.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${a} ${e} (media.currentTime: ${n})`),l&&(u/s.playbackRate<.5||a.bufferedInPlaceToEnd(s))&&a.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,i){if(e.details===L.BUFFER_STALLED_ERROR)return;const o=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&on(o)} ${e.error}`),!this.schedule)return;const a=(o==null?void 0:o.identifier)||"",l=this.getAssetPlayerQueueIndex(a),u=this.playerQueue[l]||null,c=this.schedule.items,d=ge({},e,{fatal:!1,errorAction:bn(!0),asset:o,assetListIndex:n,event:t,schedule:c,scheduleIndex:s,player:u});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const h=this.playingAsset,g=this.bufferingAsset,f=new Error(i);if(o&&(this.clearAssetPlayer(a,null),o.error=f),!t.assetList.some(p=>!p.error))t.error=f;else for(let p=n;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):h&&h.identifier===a?this.advanceAfterAssetEnded(t,s,n):g&&g.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,g)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let n=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${zt(s)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const o=this.updateItem(s,n);this.itemsMatch(s,o)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var s,n;const i=t.event,o=i.identifier,a=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(o)))return;const l=i.timelineStart,u=i.duration;let c=0;a.forEach((p,m)=>{const y=parseFloat(p.DURATION);this.createAsset(i,m,c,l+c,y,p.URI),c+=y}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${i}`);const d=this.waitingItem,h=(d==null?void 0:d.event.identifier)===o;this.updateSchedule();const g=(n=this.bufferingItem)==null?void 0:n.event;if(h){var f;const p=this.schedule.findEventIndex(o),m=(f=this.schedule.items)==null?void 0:f[p];if(m){if(!this.playingItem&&this.timelinePos>m.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(m)}this.setSchedulePosition(p)}else if((g==null?void 0:g.identifier)===o){const p=i.assetList[0];if(p){const m=this.getAssetPlayer(p.identifier);if(g.appendInPlace){const y=this.primaryMedia;m&&y&&this.bufferAssetPlayer(m,y)}else m&&m.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case L.ASSET_LIST_PARSING_ERROR:case L.ASSET_LIST_LOAD_ERROR:case L.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case L.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const qp=500;class kk extends bh{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",W.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=D.IDLE,this.setInterval(qp),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(Oe(s)&&(this.fragPrevious=s),this.state=D.IDLE),!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let o;const a=s.start;for(let u=0;u<i.length;u++)if(a>=i[u].start&&a<=i[u].end){o=i[u];break}const l=s.start+s.duration;o?o.end=l:(o={start:a,end:l},i.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const i=n-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=i){o.shift();continue}else if(o[a].start<i)o[a].start=i;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(s,i,W.SUBTITLE)}}onError(e,t){const s=t.frag;(s==null?void 0:s.type)===W.SUBTITLE&&(t.details===L.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==D.STOPPED&&(this.state=D.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&cE(this.levels,t)){this.levels=t.map(s=>new Xi(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new Xi(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,W.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==D.STOPPED&&this.setInterval(qp)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:i}=this,{details:o,id:a}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=i[a];if(a>=i.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(s=l.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const h=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(rl(o,d),u=o.fragmentStart):h&&(u=h.start,nd(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&h&&(u=h.start,nd(o,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=o,this.levelLastLoaded=l,a===n&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:o,id:a,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===D.IDLE&&(Bs(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&Ln(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,Rh(n.method)).catch(a=>{throw i.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();i.trigger(S.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=D.IDLE})}}doTick(){if(!this.media){this.state=D.IDLE;return}if(this.state===D.IDLE){const{currentTrackId:e,levels:t}=this,s=t==null?void 0:t[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,i=this.getLoadPosition(),o=re.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:a,len:l}=o,u=s.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,h=d.length,g=u.edge;let f=null;const p=this.fragPrevious;if(a<g){const v=n.maxFragLookUpTolerance,E=a>g-v?0:v;f=Bs(p,d,Math.max(d[0].start,a),E),!f&&p&&p.start<d[0].start&&(f=d[0])}else f=d[h-1];if(f=this.filterReplacedPrimary(f,s.details),!f)return;const m=f.sn-u.startSN,y=d[m-1];if(y&&y.cc===f.cc&&this.fragmentTracker.getState(y)===je.NOT_LOADED&&(f=y),this.fragmentTracker.getState(f)===je.NOT_LOADED){const v=this.mapToInitFragWhenRequired(f);v&&this.loadFragment(v,s,a)}}}loadFragment(e,t,s){Oe(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Ck(this.tracksBuffered[this.currentTrackId]||[])}}class Ck{constructor(e){this.buffered=void 0;const t=(s,n,i)=>{if(n=n>>>0,n>i-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${i})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const Pk={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},RE=r=>String.fromCharCode(Pk[r]||r),Yt=15,_r=100,Dk={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ok={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Nk={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Fk={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Mk=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Uk{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;he.log(`${this.time} [${e}] ${s}`)}}}const vs=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class IE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class $k{constructor(){this.uchar=" ",this.penState=new IE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Bk{constructor(e){this.chars=[],this.pos=0,this.currPenState=new IE,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<_r;t++)this.chars.push(new $k);this.logger=e}equals(e){for(let t=0;t<_r;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<_r;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<_r;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>_r&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=_r)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=RE(e);if(this.pos>=_r){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<_r;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<_r;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Du{constructor(e){this.rows=[],this.currRow=Yt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Yt;t++)this.rows.push(new Bk(e));this.logger=e}reset(){for(let e=0;e<Yt;e++)this.rows[e].clear();this.currRow=Yt-1}equals(e){let t=!0;for(let s=0;s<Yt;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Yt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Yt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+me(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Yt;a++)this.rows[a].clear();const i=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[i].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[i+u])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,o=Math.max(i-1,0);s.setCursor(e.indent),e.color=s.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+me(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let i=0;i<Yt;i++){const o=this.rows[i].getTextString();o&&(n=i+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Yp{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Du(s),this.nonDisplayedMemory=new Du(s),this.lastOutputScreen=new Du(s),this.currRollUpRow=this.displayedMemory.rows[Yt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Yt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+me(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qp{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Gk(),this.logger=void 0;const n=this.logger=new Uk;this.channels=[null,new Yp(e,t,n),new Yp(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,i=t[s+1]&127;let o=!1,a=null;if(n===0&&i===0)continue;this.logger.log(3,()=>"["+vs([t[s],t[s+1]])+"] -> ("+vs([n,i])+")");const l=this.cmdHistory;if(n>=16&&n<=31){if(jk(n,i,l)){Wo(null,null,l),this.logger.log(3,()=>"Repeated command ("+vs([n,i])+") is dropped");continue}Wo(n,i,this.cmdHistory),o=this.parseCmd(n,i),o||(o=this.parseMidrow(n,i)),o||(o=this.parsePAC(n,i)),o||(o=this.parseBackgroundAttributes(n,i))}else Wo(null,null,l);if(!o&&(a=this.parseChars(n,i),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+vs([n,i])+" orig: "+vs([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const i=e===20||e===21||e===23?1:2,o=this.channels[i];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+vs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(n||i))return!1;const o=e<=23?1:2;t>=64&&t<=95?s=o===1?Dk[e]:Nk[e]:s=o===1?Ok[e]:Fk[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(s,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,i=null;if(e>=25?(s=2,i=e-8):(s=1,i=e),i>=17&&i<=19){let o;i===17?o=t+80:i===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+RE(o)+"' in channel "+s),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+vs(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let i;const o={};e===16||e===24?(i=Math.floor((t-32)/2),o.background=Mk[i],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Wo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Wo(r,e,t){t.a=r,t.b=e}function jk(r,e,t){return t.a===r&&t.b===e}function Gk(){return{a:null,b:null}}var Bh=function(){if(tl!=null&&tl.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function s(a){return t(r,a)}function n(a){return t(e,a)}function i(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let h="",g=!1,f=a,p=l,m=u,y=null,v="",E=!0,T="auto",_="start",x=50,w="middle",A=50,I="middle";Object.defineProperty(c,"id",i({},d,{get:function(){return h},set:function(R){h=""+R}})),Object.defineProperty(c,"pauseOnExit",i({},d,{get:function(){return g},set:function(R){g=!!R}})),Object.defineProperty(c,"startTime",i({},d,{get:function(){return f},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");f=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},d,{get:function(){return p},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");p=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},d,{get:function(){return m},set:function(R){m=""+R,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},d,{get:function(){return y},set:function(R){y=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},d,{get:function(){return v},set:function(R){const P=s(R);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},d,{get:function(){return E},set:function(R){E=!!R,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},d,{get:function(){return T},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},d,{get:function(){return _},set:function(R){const P=n(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");_=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},d,{get:function(){return x},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");x=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},d,{get:function(){return w},set:function(R){const P=n(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");w=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},d,{get:function(){return A},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");A=R,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},d,{get:function(){return I},set:function(R){const P=n(R);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");I=P,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class Kk{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function bE(r){function e(s,n,i,o){return(s|0)*3600+(n|0)*60+(i|0)+parseFloat(o||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class Vk{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function LE(r,e,t,s){const n=s?r.split(s):[r];for(const i in n){if(typeof n[i]!="string")continue;const o=n[i].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const hd=new Bh(0,0,""),zo=hd.align==="middle"?"middle":"center";function Hk(r,e,t){const s=r;function n(){const a=bE(r);if(a===null)throw new Error("Malformed timestamp: "+s);return r=r.replace(/^[^\sa-zA-Z-]+/,""),a}function i(a,l){const u=new Vk;LE(a,function(h,g){let f;switch(h){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===g){u.set(h,t[p].region);break}break;case"vertical":u.alt(h,g,["rl","lr"]);break;case"line":f=g.split(","),u.integer(h,f[0]),u.percent(h,f[0])&&u.set("snapToLines",!1),u.alt(h,f[0],["auto"]),f.length===2&&u.alt("lineAlign",f[1],["start",zo,"end"]);break;case"position":f=g.split(","),u.percent(h,f[0]),f.length===2&&u.alt("positionAlign",f[1],["start",zo,"end","line-left","line-right","auto"]);break;case"size":u.percent(h,g);break;case"align":u.alt(h,g,["start",zo,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&hd.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",zo);let d=u.get("position","auto");d==="auto"&&hd.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){r=r.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);r=r.slice(3),o(),e.endTime=n(),o(),i(r,e)}function kE(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class Wk{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Kk,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let i=t.buffer,o=0;for(i=kE(i);o<i.length&&i[o]!=="\r"&&i[o]!==`
`;)++o;const a=i.slice(0,o);return i[o]==="\r"&&++o,i[o]===`
`&&++o,t.buffer=i.slice(o),a}function n(i){LE(i,function(o,a){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=s();const a=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=s(),t.state){case"HEADER":/:/.test(i)?n(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Bh(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Hk(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=i.indexOf("-->")!==-1;if(!i||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const zk=/\r\n|\n\r|\n|\r/g,Ou=function(e,t,s=0){return e.slice(s,s+t.length)===t},qk=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!G(t)||!G(s)||!G(n)||!G(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=60*60*1e3*i,t};function jh(r,e,t){return Ai(r.toString())+Ai(e.toString())+Ai(t)}const Yk=function(e,t,s){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=i)!=null&&o.new;){var o;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=s};function Qk(r,e,t,s,n,i,o){const a=new Wk,l=Ct(new Uint8Array(r)).trim().replace(zk,`
`).split(`
`),u=[],c=e?rL(e.baseTime,e.timescale):0;let d="00:00.000",h=0,g=0,f,p=!0;a.oncue=function(m){const y=t[s];let v=t.ccOffset;const E=(h-c)/9e4;if(y!=null&&y.new&&(g!==void 0?v=t.ccOffset=y.start:Yk(t,s,E)),E){if(!e){f=new Error("Missing initPTS for VTT MPEGTS");return}v=E-t.presentationOffset}const T=m.endTime-m.startTime,_=xt((m.startTime+v-g)*9e4,n*9e4)/9e4;m.startTime=Math.max(_,0),m.endTime=Math.max(_+T,0);const x=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(x)),m.id||(m.id=jh(m.startTime,m.endTime,x)),m.endTime>0&&u.push(m)},a.onparsingerror=function(m){f=m},a.onflush=function(){if(f){o(f);return}i(u)},l.forEach(m=>{if(p)if(Ou(m,"X-TIMESTAMP-MAP=")){p=!1,m.slice(16).split(",").forEach(y=>{Ou(y,"LOCAL:")?d=y.slice(6):Ou(y,"MPEGTS:")&&(h=parseInt(y.slice(7)))});try{g=qk(d)/1e3}catch(y){f=y}return}else m===""&&(p=!1);a.parse(m+`
`)}),a.flush()}const Nu="stpp.ttml.im1t",CE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,PE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Xk={left:"start",center:"center",right:"end",start:"start",end:"end"};function Xp(r,e,t,s){const n=oe(new Uint8Array(r),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const i=n.map(a=>Ct(a)),o=tL(e.baseTime,1,e.timescale);try{i.forEach(a=>t(Jk(a,o)))}catch(a){s(a)}}function Jk(r,e){const n=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(i).reduce((d,h)=>(d[h]=n.getAttribute(`ttp:${h}`)||i[h],d),{}),a=n.getAttribute("xml:space")!=="preserve",l=Jp(Fu(n,"styling","style")),u=Jp(Fu(n,"layout","region")),c=Fu(n,"body","[begin]");return[].map.call(c,d=>{const h=DE(d,a);if(!h||!d.hasAttribute("begin"))return null;const g=Uu(d.getAttribute("begin"),o),f=Uu(d.getAttribute("dur"),o);let p=Uu(d.getAttribute("end"),o);if(g===null)throw Zp(d);if(p===null){if(f===null)throw Zp(d);p=g+f}const m=new Bh(g-e,p-e,h);m.id=jh(m.startTime,m.endTime,m.text);const y=u[d.getAttribute("region")],v=l[d.getAttribute("style")],E=Zk(y,v,l),{textAlign:T}=E;if(T){const _=Xk[T];_&&(m.lineAlign=_),m.align=T}return ge(m,E),m}).filter(d=>d!==null)}function Fu(r,e,t){const s=r.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Jp(r){return r.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function DE(r,e){return[].slice.call(r.childNodes).reduce((t,s,n)=>{var i;return s.nodeName==="br"&&n?t+`
`:(i=s.childNodes)!=null&&i.length?DE(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function Zk(r,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),i.reduce((a,l)=>{const u=Mu(e,s,l)||Mu(r,s,l)||Mu(n,s,l);return u&&(a[l]=u),a},{})}function Mu(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function Zp(r){return new Error(`Could not parse ttml timestamp ${r}`)}function Uu(r,e){if(!r)return null;let t=bE(r);return t===null&&(CE.test(r)?t=eC(r,e):PE.test(r)&&(t=tC(r,e))),t}function eC(r,e){const t=CE.exec(r),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function tC(r,e){const t=PE.exec(r),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class qo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class rC{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tm(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new qo(this,"textTrack1"),t=new qo(this,"textTrack2"),s=new qo(this,"textTrack3"),n=new qo(this,"textTrack4");this.cea608Parser1=new Qp(1,e,t),this.cea608Parser2=new Qp(3,s,n)}addCues(e,t,s,n,i){let o=!1;for(let a=i.length;a--;){const l=i[a],u=sC(l[0],l[1],t,s);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),o=!0,u/(s-t)>.5))return}if(o||i.push([t,s]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,s,n)}else{const a=this.Cues.newCue(null,t,s,n);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:i,trackId:o}){const{unparsedVttFrags:a}=this;s===W.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:i,trackId:o}),a.length&&(this.unparsedVttFrags=[],a.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,l):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const i=s.textTracks[n];if(em(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:i,languageCode:o}=t[e],a=this.getExistingTrack(i,o);if(a)s[e]=a,Sn(s[e]),wE(s[e],n);else{const l=this.createTextTrack("captions",i,o);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(i=>{Sn(n[i]),delete n[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tm(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Sn(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(i=>i.textCodec===Nu);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(cE(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,a=o?va(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let h=0;h<a.length;h++)if(a[h]&&em(a[h],l)){d=a[h],a[h]=null;break}d&&(c=d)}if(c)Sn(c);else{const d=OE(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const i=`textTrack${n[1]}`,o=this.captionsProperties[i];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===W.MAIN){var s,n;const{cea608Parser1:i,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;i&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===W.SUBTITLE)if(n.byteLength){const i=s.decryptdata,o="stats"in t;if(i==null||!i.encrypted||o){const a=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),a&&a.textCodec===Nu?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Xp(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:i,unparsedVttFrags:o}=this,a=i.length-1;if(!i[s.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=s.initSegment)!=null&&t.data?Kt(s.initSegment.data,new Uint8Array(n)).buffer:n;Qk(u,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,c=>{this._appendCues(c,s.level),l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(s,n),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&a>s.cc)&&l.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:c})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Xp(t,this.initPTS[e.cc],()=>{s.textCodec=Nu,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(i=>xE(n,i))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;s.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===W.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===W.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let i=0;i<n.length;i++){const o=n[i].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const a=this.extractCea608Data(o);this.cea608Parser1.addData(n[i].pts,a[0]),this.cea608Parser2.addData(n[i].pts,a[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:i}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!i||i==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>dd(a[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>dd(a[l],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let i=0;i<s;i++){const o=e[n++],a=127&e[n++],l=127&e[n++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function OE(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function em(r,e){return!!r&&r.kind===OE(e)&&ad(e,r)}function sC(r,e,t,s){return Math.min(e,s)-Math.max(r,t)}function tm(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const nC=/\s/,iC={newCue(r,e,t,s){const n=[];let i,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<s.rows.length;h++)if(i=s.rows[h],a=!0,l=0,u="",!i.isEmpty()){var d;for(let p=0;p<i.chars.length;p++)nC.test(i.chars[p].uchar)&&a?l++:(u+=i.chars[p].uchar,a=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const g=kE(u.trim()),f=jh(e,t,g);r!=null&&(d=r.cues)!=null&&d.getCueById(f)||(o=new c(e,t,g),o.id=f,o.line=h+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),n.push(o))}return r&&n.length&&(n.sort((h,g)=>h.line==="auto"||g.line==="auto"?0:h.line>8&&g.line>8?g.line-h.line:h.line-g.line),n.forEach(h=>xE(r,h))),n}};function oC(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const aC=/(\d+)-(\d+)\/(\d+)/;class rm{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||dC,this.controller=new self.AbortController,this.stats=new Eh}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=lC(e,this.controller.signal),o=e.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&G(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(eo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var h;this.response=this.loader=d;const g=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},u-(g-n.loading.start)),!d.ok){const{status:p,statusText:m}=d;throw new hC(m||"fetch, bad network response",p,d)}n.loading.first=g,n.total=cC(d.headers)||n.total;const f=(h=this.callbacks)==null?void 0:h.onProgress;return f&&G(t.highWaterMark)?this.loadProgressively(d,n,e,t.highWaterMark,f):o?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var h,g;const f=this.response;if(!f)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const p=d[a];p&&(n.loaded=n.total=p);const m={url:f.url,data:d,code:f.status},y=(h=this.callbacks)==null?void 0:h.onProgress;y&&!G(t.highWaterMark)&&y(n,e,d,f),(g=this.callbacks)==null||g.onSuccess(m,n,e,f)}).catch(d=>{var h;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const g=d&&d.code||0,f=d?d.message:null;(h=this.callbacks)==null||h.onError({code:g,text:f},e,d?d.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,i){const o=new Vv,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&i(t,s,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<n||o.dataLength?(o.push(c),o.dataLength>=n&&i(t,s,o.flush().buffer,e)):i(t,s,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function lC(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(ge({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function uC(r){const e=aC.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function cC(r){const e=r.get("Content-Range");if(e){const s=uC(e);if(G(s))return s}const t=r.get("Content-Length");if(t)return parseInt(t)}function dC(r,e){return new self.Request(r.url,e)}class hC extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const fC=/^age:\s*[\d.]+\s*$/im;class NE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Eh,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return i(s,t.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),i(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(o=>{var a;(a=this.callbacks)==null||a.onError({code:s.status,text:o.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:o}=s.loadPolicy;if(n)for(const a in n)e.setRequestHeader(a,n[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=i&&G(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const f=c??t.response;if(f!=null){var o,a;s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=t.responseType==="arraybuffer"?f.byteLength:f.length;s.loaded=s.total=p,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const m=(o=this.callbacks)==null?void 0:o.onProgress;m&&m(s,e,f,t);const y={url:t.responseURL,data:f,code:u};(a=this.callbacks)==null||a.onSuccess(y,s,e,t);return}}const d=i.loadPolicy.errorRetry,h=s.retry,g={url:e.url,data:void 0,code:u};if(Za(d,h,!1,g))this.retry(d);else{var l;he.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Za(e,t,!0))this.retry(e);else{var s;he.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=wh(e,s.retry),s.retry++,he.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&fC.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const gC={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},pC=de(de({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:NE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:II,bufferController:yL,capLevelController:Mh,errorController:PI,fpsController:vk,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Dv,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:gC},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},mC()),{},{subtitleStreamController:kk,subtitleTrackController:Tk,timelineController:rC,audioStreamController:fL,audioTrackController:gL,emeController:kn,cmcdController:gk,contentSteeringController:mk,interstitialsController:Lk});function mC(){return{cueHandler:iC,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function yC(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=fd(r),n=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const a=`${o==="level"?"playlist":o}LoadPolicy`,l=e[a]===void 0,u=[];i.forEach(c=>{const d=`${o}Loading${c}`,h=e[d];if(h!==void 0&&l){u.push(d);const g=s[a].default;switch(e[a]={default:g},c){case"TimeOut":g.maxLoadTimeMs=h,g.maxTimeToFirstByteMs=h;break;case"MaxRetry":g.errorRetry.maxNumRetry=h,g.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":g.errorRetry.retryDelayMs=h,g.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":g.errorRetry.maxRetryDelayMs=h,g.timeoutRetry.maxRetryDelayMs=h;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${a}": ${me(e[a])}`)}),de(de({},s),e)}function fd(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(fd):Object.keys(r).reduce((e,t)=>(e[t]=fd(r[t]),e),{}):r}function vC(r,e){const t=r.loader;t!==rm&&t!==NE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):oC()&&(r.loader=rm,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ea=2,EC=.1,SC=.05,TC=100;class _C extends bv{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(TC),this.mediaSource=t.mediaSource;const s=this.media=t.media;lt(s,"playing",this.onMediaPlaying),lt(s,"waiting",this.onMediaWaiting),lt(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(pt(s,"playing",this.onMediaPlaying),pt(s,"waiting",this.onMediaWaiting),pt(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const i=(s=this.hls)==null?void 0:s.config;if(!i)return;const o=this.media;if(!o)return;const{seeking:a}=o,l=this.seeking&&!a,u=!this.seeking&&a,c=o.paused&&!a||o.ended||o.playbackRate===0;if(this.seeking=a,e!==t){t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!re.getBuffered(o).length){this.nudgeRetry=0;return}const d=re.bufferInfo(o,e,0),h=d.nextStart||0,g=this.fragmentTracker;if(a&&g&&this.hls){const x=sm(this.hls.inFlightFragments,e),w=d.len>Ea,A=!h||x||h-e>Ea&&!g.getPartialFragment(e);if(w||A)return;this.moved=!1}const f=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&g){if(!(d.len>0)&&!h)return;const w=Math.max(h,d.start||0)-e,I=!!(f!=null&&f.live)?f.targetduration*2:Ea,R=Yo(e,g);if(w>0&&(w<=I||R)){o.paused||this._trySkipBufferHole(R);return}}const p=i.detectStallWithCurrentTimeMs,m=self.performance.now(),y=this.waiting;let v=this.stalled;if(v===null)if(y>0&&m-y<p)v=this.stalled=y;else{this.stalled=m;return}const E=m-v;if(!a&&(E>=p||y)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(f!=null&&f.live)&&Math.abs(e-((f==null?void 0:f.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const _=re.bufferInfo(o,e,i.maxBufferHole);this._tryFixBufferStall(_,E,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const i=re.bufferedInfo(re.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const o=re.timeRangesToArray(n),a=re.bufferedInfo(o,t,0).bufferedIndex;if(a>-1&&a<o.length-1){const l=re.bufferedInfo(o,e,0).bufferedIndex,u=o[a].end,c=o[a+1].start;if((l===-1||l>a)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let h=Yo(e,this.fragmentTracker);h&&"fragment"in h?h=h.fragment:h||(h=void 0);const g=re.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:h,buffer:g.len,bufferInfo:g})}}}}}_tryFixBufferStall(e,t,s){var n,i;const{fragmentTracker:o,media:a}=this,l=(n=this.hls)==null?void 0:n.config;if(!a||!o||!l)return;const u=(i=this.hls)==null?void 0:i.latestLevelDetails,c=Yo(s,o);if((c||u!=null&&u.live&&s<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,h=this.adjacentTraversal(e,s);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||h))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const i=s.getFragAtPos(t,W.MAIN),o=s.getFragAtPos(n,W.MAIN);if(i&&o)return o.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:i}=this;if(!n&&i!==null&&s&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${me(e)})`);this.warn(o.message),t.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,i=(t=this.hls)==null?void 0:t.config;if(!n||!s||!i)return 0;const o=n.currentTime,a=re.bufferInfo(n,o,0),l=o<a.start?a.start:a.nextStart;if(l&&this.hls){const c=a.len<=i.maxBufferHole,d=a.len>0&&a.len<1&&n.readyState<3,h=l-o;if(h>0&&(c||d)){if(h>i.maxBufferHole){let f=!1;if(o===0){const p=s.getAppendedFrag(0,W.MAIN);p&&l<p.end&&(f=!0)}if(!f&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||sm(this.hls.inFlightFragments,l))return 0;let m=!1,y=e.end;for(;y<l;){const v=Yo(y,s);if(v)y+=v.duration;else{m=!0;break}}if(m)return 0}}const g=Math.max(l+SC,o+EC);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${g}`),this.moved=!0,n.currentTime=g,!(e!=null&&e.gap)){const f=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${g}`),p={type:q.MEDIA_ERROR,details:L.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?p.part=e:p.frag=e),this.hls.trigger(S.ERROR,p)}return g}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,i=t==null?void 0:t.config;if(!s||!i)return 0;const o=s.currentTime;if(this.nudgeRetry++,n<i.nudgeMaxRetry){const a=o+(n+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${o} to ${a}`);this.warn(l.message),s.currentTime=a,t.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const a=new Error(`Playhead still not moving while enough data buffered @${o} after ${i.nudgeMaxRetry} nudges`);this.error(a.message),t.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.BUFFER_STALLED_ERROR,error:a,fatal:!0,buffer:e.len,bufferInfo:e})}}}function sm(r,e){const t=nm(r.main);if(t&&t.start<=e)return t;const s=nm(r.audio);return s&&s.start<=e?s:null}function nm(r){if(!r)return null;switch(r.state){case D.IDLE:case D.STOPPED:case D.ENDED:case D.ERROR:return null}return r.frag}function Yo(r,e){return e.getAppendedFrag(r,W.MAIN)||e.getPartialFragment(r)}const wC=.25;function gd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function $u(r,e,t,s,n){let i=new r(e,t,"");try{i.value=s,n&&(i.type=n)}catch{i=new r(e,t,me(n?de({type:n},s):s))}return i}const Qo=(()=>{const r=gd();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class xC{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Sn(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return wE(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=gd();if(o)for(let a=0;a<i.length;a++){const l=i[a].type;if(l===Rt.emsg&&!s||!n)continue;const u=Xv(i[a].data),c=i[a].pts;let d=c+i[a].duration;d>Qo&&(d=Qo),d-c<=0&&(d=c+wC);for(let g=0;g<u.length;g++){const f=u[g];if(!Jv(f)){this.updateId3CueEnds(c,l);const p=$u(o,c,d,f,l);p&&this.id3Track.addCue(p)}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let i=n.length;i--;){const o=n[i];o.type===t&&o.startTime<e&&o.endTime===Qo&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:i,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(i&&(a||l)){let u;n==="audio"?u=c=>c.type===Rt.audioId3&&l:n==="video"?u=c=>c.type===Rt.emsg&&a:u=c=>c.type===Rt.audioId3&&l||c.type===Rt.emsg&&a,dd(i,t,s,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:i,interstitialsController:o}=this.hls.config;if(!i)return;const a=gd();if(s&&n&&!o){const{fragmentStart:p,fragmentEnd:m}=e;let y=this.assetCue;y?(y.startTime=p,y.endTime=m):a&&(y=this.assetCue=$u(a,p,m,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),y&&(y.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(y),y.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var h;if((h=l.cues)!=null&&h.length){const p=Object.keys(d).filter(m=>!c.includes(m));for(let m=p.length;m--;){var g;const y=p[m],v=(g=d[y])==null?void 0:g.cues;delete d[y],v&&Object.keys(v).forEach(E=>{const T=v[E];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const f=e.fragments[e.fragments.length-1];if(!(c.length===0||!G(f==null?void 0:f.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let p=0;p<c.length;p++){const m=c[p],y=u[m],v=y.startTime,E=d[m],T=(E==null?void 0:E.cues)||{};let _=(E==null?void 0:E.durationKnown)||!1,x=Qo;const{duration:w,endDate:A}=y;if(A&&w!==null)x=v+w,_=!0;else if(y.endOnNext&&!_){const R=c.reduce((P,$)=>{if($!==y.id){const j=u[$];if(j.class===y.class&&j.startDate>y.startDate&&(!P||y.startDate<P.startDate))return j}return P},null);R&&(x=R.startTime,_=!0)}const I=Object.keys(y.attr);for(let R=0;R<I.length;R++){const P=I[R];if(!HI(P))continue;const $=T[P];if($)_&&!(E!=null&&E.durationKnown)?$.endTime=x:Math.abs($.startTime-v)>.01&&($.startTime=v,$.endTime=x);else if(a){let j=y.attr[P];WI(P)&&(j=lv(j));const V=$u(a,v,x,{key:P,data:j},Rt.dateRange);V&&(V.id=m,this.id3Track.addCue(V),T[P]=V,o&&(P==="X-ASSET-LIST"||P==="X-ASSET-URL")&&V.addEventListener("enter",this.onEventCueEnter))}}d[m]={cues:T,dateRange:y,durationKnown:_}}}}}class AC{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:o}=this.config;if(!i||o===1||!s.live)return;const a=this.targetLatency;if(a===null)return;const l=n-a,u=Math.min(this.maxLatency,a+s.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,o)),h=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,g=Math.min(d,Math.max(1,h));this.changeMediaPlaybackRate(t,g)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:o*n);const c=n;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,i=e-t-this.edgeStalled,o=n-s.totalduration,a=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,i),a)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===L.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class RC extends Fh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],i={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:h,videoCodec:g}=c;h&&(c.audioCodec=h=Ya(h,s)||void 0),g&&(g=c.videoCodec=lI(g));const{width:f,height:p,unknownCodecs:m}=c,y=(m==null?void 0:m.length)||0;if(a||(a=!!(f&&p)),l||(l=!!g),u||(u=!!h),y||h&&!this.isAudioSupported(h)||g&&!this.isVideoSupported(g)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":E,"HDCP-LEVEL":T,"PATHWAY-ID":_,RESOLUTION:x,"VIDEO-RANGE":w}=d,I=`${`${_||"."}-`}${c.bitrate}-${x}-${E}-${v}-${w}-${T}`;if(i[I])if(i[I].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const R=o[I]+=1;c.attrs["PATHWAY-ID"]=new Array(R+1).join(".");const P=this.createLevel(c);i[I]=P,n.push(P)}else i[I].addGroupId("audio",d.AUDIO),i[I].addGroupId("text",d.SUBTITLES);else{const R=this.createLevel(c);i[I]=R,o[I]=1,n.push(R)}}),this.filterAndSortMediaOptions(n,t,a,l,u)}createLevel(e){const t=new Xi(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=Sv(n,[])}return t}isAudioSupported(e){return Yi(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Yi(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,i){var o;let a=[],l=[],u=e;const c=((o=t.stats)==null?void 0:o.parsing)||{};if((s||n)&&i&&(u=u.filter(({videoCodec:v,videoRange:E,width:T,height:_})=>(!!v||!!(T&&_))&&vI(E))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",E=v;t.levels.length&&(E=`one or more CODECS in variant not supported: ${me(t.levels.map(_=>_.attrs.CODECS).filter((_,x,w)=>w.indexOf(_)===x))}`,this.warn(E),v+=` (${E})`);const T=new Error(v);this.hls.trigger(S.ERROR,{type:q.MEDIA_ERROR,details:L.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:T,reason:E})}}),c.end=performance.now();return}t.audioTracks&&(a=t.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),im(a)),t.subtitles&&(l=t.subtitles,im(l));const d=u.slice(0);u.sort((v,E)=>{if(v.attrs["HDCP-LEVEL"]!==E.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(E.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&v.height!==E.height)return v.height-E.height;if(v.frameRate!==E.frameRate)return v.frameRate-E.frameRate;if(v.videoRange!==E.videoRange)return Qa.indexOf(v.videoRange)-Qa.indexOf(E.videoRange);if(v.videoCodec!==E.videoCodec){const T=Qg(v.videoCodec),_=Qg(E.videoCodec);if(T!==_)return _-T}if(v.uri===E.uri&&v.codecSet!==E.codecSet){const T=qa(v.codecSet),_=qa(E.codecSet);if(T!==_)return _-T}return v.averageBitrate!==E.averageBitrate?v.averageBitrate-E.averageBitrate:0});let h=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let v=0;v<d.length;v++)if(d[v].pathwayId===u[0].pathwayId){h=d[v];break}}this._levels=u;for(let v=0;v<u.length;v++)if(u[v]===h){var g;this._firstLevel=v;const E=h.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${E}`),((g=this.hls.userConfig)==null?void 0:g.abrEwmaDefaultEstimate)===void 0){const _=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);_>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=_)}break}const f=i&&!n,p=this.hls.config,m=!!(p.audioStreamController&&p.audioTrackController),y={levels:u,audioTracks:a,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:m&&!f&&a.some(v=>!!v.url)};c.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,y)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,s===e&&n&&i===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${s}${i?" with Pathway "+i:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,n==null?void 0:n.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===ae.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===W.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(i=>!!s[i]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:i}=t,o=t.levelInfo;if(!o){var a;this.warn(`Invalid level index ${n}`),(a=t.deliveryDirectives)!=null&&a.skip&&(i.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let l=o.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(n,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],o=e.details,a=o==null?void 0:o.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${a&&o.live?" age "+a.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(S.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((i,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));jv(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(S.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function im(r){const e={};r.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function FE(){return self.SourceBuffer||self.WebKitSourceBuffer}function ME(){if(!as())return!1;const e=FE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function IC(){if(!ME())return!1;const r=as();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Qi(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Qi(e,"audio"))))}function bC(){var r;const e=FE();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const LC=100;class kC extends bh{constructor(e,t,s){super(e,t,s,"stream-controller",W.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,i=n?n.currentTime:null;if(i===null||!G(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const o=this.getFwdBufferInfoAtPos(n,i,W.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(LC),this.level=-1,!this.startFragRequested){let i=n.startLevel;i===-1&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.firstAutoLevel),n.nextLoadLevel=i,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=D.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=D.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case D.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e==null?void 0:e[t],n=s==null?void 0:s.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=D.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=D.IDLE;break}break}case D.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===D.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[i]))return;const o=s[i],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(S.BUFFER_EOS,p),this.state=D.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=o.details;if(!u||this.state===D.WAITING_LEVEL||this.waitForLive(o)){this.level=i,this.state=D.WAITING_LEVEL,this.startFragRequested=!1;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let g=this.getNextFragment(h,u);if(this.couldBacktrack&&!this.fragPrevious&&g&&Oe(g)&&this.fragmentTracker.getState(g)!==je.OK){var f;const m=((f=this.backtrackFragment)!=null?f:g).sn-u.startSN,y=u.fragments[m-1];y&&g.cc===y.cc&&(g=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,h)){if(!g.gap){const m=this.audioOnly&&!this.altAudio?pe.AUDIO:pe.VIDEO,y=(m===pe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,m,W.MAIN)}g=this.getNextFragmentLoopLoading(g,u,a,W.MAIN,d)}g&&(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,o,h))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===je.NOT_LOADED||n===je.PARTIAL?Oe(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,W.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<i.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:s=0}else s=0;const o=this.getBufferedFrag(t.currentTime+s);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case D.KEY_LOADING:case D.FRAG_LOADING:case D.FRAG_LOADING_WAITING_RETRY:case D.PARSING:case D.PARSED:this.state=D.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;lt(s,"playing",this.onMediaPlaying),lt(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(pt(s,"playing",this.onMediaPlaying),pt(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;for(let i=0;i<t.levels.length;i++){const o=t.levels[i].audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&n&&!bC(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==D.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=D.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:i}=this,o=t.level,a=t.details,l=a.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===D.FRAG_LOADING||this.state===D.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(a.live||(s=u.details)!=null&&s.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;d=this.alignPlaylists(a,u.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(u.details=a,this.levelLastLoaded=u,i||this.setStartPosition(a,d),this.hls.trigger(S.LEVEL_UPDATED,{details:a,level:o}),this.state===D.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=D.IDLE}i&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,i=this.getLoadPosition(),o=e.fragmentStart,a=e.edge,l=i>=o-t.maxFragLookUpTolerance&&i<=a;if(n!==null&&s.duration>n&&(i<n||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||i<a-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=re.bufferInfo(s,n,0);if(!((u=d.buffered)!=null&&u.length)){s.currentTime=n;return}if(d.start<=i){s.currentTime=n;return}const{nextStart:g}=re.bufferedInfo(d.buffered,i,0);g&&(s.currentTime=g)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:i}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const a=o[s.level];if(!a){this.warn(`Level ${s.level} not found on progress`);return}const l=a.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=s.initSegment)==null?void 0:t.data,h=this._getAudioCodec(a),g=this.transmuxer=this.transmuxer||new uE(this.hls,W.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,p=f!==-1,m=new Ah(s.level,s.sn,s.stats.chunkCount,i.byteLength,f,p),y=this.initPTS[s.cc];g.push(i,d,h,u,s,n,l.totalduration,c,m,y)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio!==0;if(Xa(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,t)}),s.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(S.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Xa(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,i,o=!1;for(const a in s){const l=s[a];if(l.id==="main"){if(i=a,n=l,a==="video"){const u=s[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,i=s.type===W.MAIN;if(i){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===D.PARSED&&(this.state=D.IDLE);return}const a=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),Oe(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const o=this.media;o&&(!this._hasEnoughToStart&&re.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=D.ERROR;return}switch(t.details){case L.FRAG_GAP:case L.FRAG_PARSING_ERROR:case L.FRAG_DECRYPT_ERROR:case L.FRAG_LOAD_ERROR:case L.FRAG_LOAD_TIMEOUT:case L.KEY_LOAD_ERROR:case L.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.MAIN,t);break;case L.LEVEL_LOAD_ERROR:case L.LEVEL_LOAD_TIMEOUT:case L.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===D.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===ae.LEVEL&&(this.state=D.IDLE);break;case L.BUFFER_ADD_CODEC_ERROR:case L.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case L.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case L.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=D.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==pe.AUDIO||!this.altAudio){const s=(t===pe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,W.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const i=this.getLevelDetails(),o=re.getBuffered(e),a=o.length?o.start(0):0,l=a-s,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${a}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,i=s==null?void 0:s.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=D.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=i.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(S.FRAG_LOADED,s),i.bitrateTest=!1}).catch(s=>{this.state===D.STOPPED||this.state===D.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:i}=e,o=this.getCurrentContext(i);if(!o){this.resetWhenMissingContext(i);return}const{frag:a,part:l,level:u}=o,{video:c,text:d,id3:h,initSegment:g}=n,{details:f}=u,p=this.altAudio?void 0:n.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=D.PARSING,g){const m=g.tracks;if(m){const T=a.initSegment||a;if(this.unhandledEncryptionError(g,a))return;this._bufferInitSegment(u,m,T,i),s.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:m})}const y=g.initPTS,v=g.timescale,E=this.initPTS[a.cc];if(G(y)&&(!E||E.baseTime!==y||E.timescale!==v)){const T=g.trackId;this.initPTS[a.cc]={baseTime:y,timescale:v,trackId:T},s.trigger(S.INIT_PTS_FOUND,{frag:a,id:t,initPTS:y,timescale:v,trackId:T})}}if(c&&f){p&&c.type==="audiovideo"&&this.logMuxedErr(a);const m=f.fragments[a.sn-1-f.startSN],y=a.sn===f.startSN,v=!m||a.cc>m.cc;if(n.independent!==!1){const{startPTS:E,endPTS:T,startDTS:_,endDTS:x}=c;if(l)l.elementaryStreams[c.type]={startPTS:E,endPTS:T,startDTS:_,endDTS:x};else if(c.firstKeyFrame&&c.independent&&i.id===1&&!v&&(this.couldBacktrack=!0),c.dropped&&c.independent){const w=this.getMainFwdBufferInfo(),A=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,I=c.firstKeyFramePTS?c.firstKeyFramePTS:E;if(!y&&A<I-this.config.maxBufferHole&&!v){this.backtrack(a);return}else v&&(a.gap=!0);a.setElementaryStreamInfo(c.type,a.start,T,a.start,x,!0)}else y&&E-(f.appliedTimelineOffset||0)>Ea&&(a.gap=!0);a.setElementaryStreamInfo(c.type,E,T,_,x),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,i,y||v)}else if(y||v)a.gap=!0;else{this.backtrack(a);return}}if(p){const{startPTS:m,endPTS:y,startDTS:v,endDTS:E}=p;l&&(l.elementaryStreams[pe.AUDIO]={startPTS:m,endPTS:y,startDTS:v,endDTS:E}),a.setElementaryStreamInfo(pe.AUDIO,m,y,v,E),this.bufferFragmentData(p,a,l,i)}if(f&&h!=null&&h.samples.length){const m={id:t,frag:a,details:f,samples:h.samples};s.trigger(S.FRAG_PARSING_METADATA,m)}if(f&&d){const m={id:t,frag:a,details:f,samples:d.samples};s.trigger(S.FRAG_PARSING_USERDATA,m)}}logMuxedErr(e){this.warn(`${Oe(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==D.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:i,video:o,audiovideo:a}=t;if(i){const u=e.audioCodec;let c=ha(i.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const h=i.metadata;h&&"channelCount"in h&&(h.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),i.levelCodec=c,i.id=W.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${i.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=W.MAIN;const u=o.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${o.codec!==u?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(S.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:u,data:d,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,W.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e==null?void 0:e[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=D.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(re.isBuffered(e,s)?t=this.getAppendedFrag(s):re.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,i=t.level;(!n||t.sn!==n.sn||n.level!==i)&&(this.fragPlaying=t,this.hls.trigger(S.FRAG_CHANGED,{frag:t}),(!n||n.level!==i)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return G(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(G(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?Bs(null,s.fragments,t):null);if(n){const i=n.programDateTime;if(i!==null){const o=i+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class CC extends Vt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=L.KEY_LOAD_ERROR,s,n,i){return new Ar({type:q.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,i=t.length;n<i;n++){const o=t[n];if(e.cc<=o.cc&&(!Oe(e)||!Oe(o)||e.sn<o.sn)||!s&&n==i-1)return this.emeController.selectKeySystemFormat(o).then(a=>{if(!this.emeController)return;o.setKeyFormat(a);const l=ga(a);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const n=di(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,L.KEY_LOAD_ERROR,u))}const o=i.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,L.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const a=Bu(i);let l=this.keyIdToKeyInfo[a];if((s=l)!=null&&s.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(n=l)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${i.keyId?" keyId: "+Xe(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[a]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,L.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const o=QR(t.initSegment.data);if(o.length){let a=o[0];a.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Xe(a)}`),ns.setKeyIdForUri(e.decryptdata.uri,a)):(a=ns.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Xe(a)}`)),e.decryptdata.keyId=a}}if(!e.decryptdata.keyId&&!Oe(t))return Promise.resolve(s);const i=this.emeController.loadKey(s);return(e.keyLoadPromise=i.then(o=>(e.mediaKeySessionContext=o,s))).catch(o=>{throw e.keyLoadPromise=null,"data"in o&&(o.data.frag=t),o})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,i=new n(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=s.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(h,g,f,p)=>{const{frag:m,keyInfo:y}=f,v=Bu(y.decryptdata);if(!m.decryptdata||y!==this.keyIdToKeyInfo[v])return a(this.createKeyLoadError(m,L.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));y.decryptdata.key=m.decryptdata.key=new Uint8Array(h.data),m.keyLoader=null,y.loader=null,o({frag:m,keyInfo:y})},onError:(h,g,f,p)=>{this.resetLoader(g),a(this.createKeyLoadError(t,L.KEY_LOAD_ERROR,new Error(`HTTP Error ${h.code} loading key ${h.text}`),f,de({url:l.url,data:void 0},h)))},onTimeout:(h,g,f)=>{this.resetLoader(g),a(this.createKeyLoadError(t,L.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),f))},onAbort:(h,g,f)=>{this.resetLoader(g),a(this.createKeyLoadError(t,L.INTERNAL_ABORTED,new Error("key loading aborted"),f))}};i.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,i=s.loader;t.keyLoader===i&&(t.keyLoader=null,s.loader=null);const o=Bu(s.decryptdata)||n;delete this.keyIdToKeyInfo[o],i&&i.destroy()}}function Bu(r){if(r.keyFormat!==Je.FAIRPLAY){const e=r.keyId;if(e)return Xe(e)}return r.uri}function om(r){const{type:e}=r;switch(e){case ae.AUDIO_TRACK:return W.AUDIO;case ae.SUBTITLE_TRACK:return W.SUBTITLE;default:return W.MAIN}}function ju(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class PC{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,i=s||n,o=new i(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ae.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:i,url:o,deliveryDirectives:a,levelInfo:l}=t;this.load({id:s,level:n,pathwayId:i,responseType:"text",type:ae.LEVEL,url:o,deliveryDirectives:a,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:i,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:ae.AUDIO_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:i,deliveryDirectives:o,track:a}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:ae.SUBTITLE_TRACK,url:i,deliveryDirectives:o,levelOrTrack:a})}onLevelsUpdated(e,t){const s=this.loaders[ae.LEVEL];if(s){const n=s.context;n&&!t.levels.some(i=>i===n.levelOrTrack)&&(s.abort(),delete this.loaders[ae.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const u=this.hls.logger,c=n.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let i;if(e.type===ae.MANIFEST?i=s.manifestLoadPolicy.default:i=ge({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),G((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ae.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ae.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ae.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const h=Math.max(c*3,d*.8)*1e3;i=ge({},i,{maxTimeToFirstByteMs:Math.min(h,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,i.maxTimeToFirstByteMs)})}}}const o=i.errorRetry||i.timeoutRetry||{},a={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,h)=>{const g=this.getInternalLoader(d);this.resetInternalLoader(d.type);const f=u.data;c.parsing.start=performance.now(),mr.isMediaPlaylist(f)||d.type!==ae.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,h||null,g):this.handleMasterPlaylist(u,c,d,h)},onError:(u,c,d,h)=>{this.handleNetworkError(c,d,!1,u,h)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};n.load(e,a,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const i=this.hls,o=e.data,a=ju(e,s),l=mr.parseMasterPlaylist(o,a);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,l.playlistParsingError,n,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:h,startTimeOffset:g,variableList:f}=l;this.variableList=f,c.forEach(v=>{const{unknownCodecs:E}=v;if(E){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:_,videoCodec:x}=v;for(let w=E.length;w--;){const A=E[w];Yi(A,"audio",T)?(v.audioCodec=_=_?`${_},${A}`:A,Bn.audio[_.substring(0,4)]=2,E.splice(w,1)):Yi(A,"video",T)&&(v.videoCodec=x=x?`${x},${A}`:A,Bn.video[x.substring(0,4)]=2,E.splice(w,1))}}});const{AUDIO:p=[],SUBTITLES:m,"CLOSED-CAPTIONS":y}=mr.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new _e({}),bitrate:0,url:""})),i.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:m,captions:y,contentSteering:u,url:a,stats:t,networkDetails:n,sessionData:d,sessionKeys:h,startTimeOffset:g,variableList:f})}handleTrackOrLevelPlaylist(e,t,s,n,i){const o=this.hls,{id:a,level:l,type:u}=s,c=ju(e,s),d=G(l)?l:G(a)?a:0,h=om(s),g=mr.parseLevelPlaylist(e.data,c,d,h,0,this.variableList);if(u===ae.MANIFEST){const f={attrs:new _e({}),bitrate:0,details:g,name:"",url:c};g.requestScheduled=t.loading.start+Uv(g,0),o.trigger(S.MANIFEST_LOADED,{levels:[f],audioTracks:[],url:c,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=g,this.handlePlaylistLoaded(g,e,t,s,n,i)}handleManifestParsingError(e,t,s,n,i){this.hls.trigger(S.ERROR,{type:q.NETWORK_ERROR,details:L.MANIFEST_PARSING_ERROR,fatal:t.type===ae.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,s=!1,n,i){let o=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===ae.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ae.AUDIO_TRACK||e.type===ae.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let l=L.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ae.MANIFEST:l=s?L.MANIFEST_LOAD_TIMEOUT:L.MANIFEST_LOAD_ERROR,u=!0;break;case ae.LEVEL:l=s?L.LEVEL_LOAD_TIMEOUT:L.LEVEL_LOAD_ERROR,u=!1;break;case ae.AUDIO_TRACK:l=s?L.AUDIO_TRACK_LOAD_TIMEOUT:L.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ae.SUBTITLE_TRACK:l=s?L.SUBTITLE_TRACK_LOAD_TIMEOUT:L.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:q.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:i};if(n){const h=(t==null?void 0:t.url)||e.url;d.response=de({url:h,data:void 0},n)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,t,s,n,i,o){const a=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:h,deliveryDirectives:g}=n,f=ju(t,n),p=om(n);let m=typeof n.level=="number"&&p===W.MAIN?u:void 0;const y=e.playlistParsingError;if(y){if(this.hls.logger.warn(`${y} ${e.url}`),!a.config.ignorePlaylistParsingErrors){a.trigger(S.ERROR,{type:q.NETWORK_ERROR,details:L.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:y,reason:y.message,response:t,context:n,level:m,parent:p,networkDetails:i,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");a.trigger(S.ERROR,{type:q.NETWORK_ERROR,details:L.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:v,reason:v.message,response:t,context:n,level:m,parent:p,networkDetails:i,stats:s});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ae.MANIFEST:case ae.LEVEL:if(m){if(!c)m=0;else if(c!==a.levels[m]){const v=a.levels.indexOf(c);v>-1&&(m=v)}}a.trigger(S.LEVEL_LOADED,{details:e,levelInfo:c||a.levels[0],level:m||0,id:d||0,stats:s,networkDetails:i,deliveryDirectives:g,withoutMultiVariant:l===ae.MANIFEST});break;case ae.AUDIO_TRACK:a.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:s,networkDetails:i,deliveryDirectives:g});break;case ae.SUBTITLE_TRACK:a.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:h||"",stats:s,networkDetails:i,deliveryDirectives:g});break}}}class tr{static get version(){return Ji}static isMSESupported(){return ME()}static isSupported(){return IC()}static getMediaSource(){return as()}static get Events(){return S}static get MetadataSchema(){return Rt}static get ErrorTypes(){return q}static get ErrorDetails(){return L}static get DefaultConfig(){return tr.defaultConfig?tr.defaultConfig:pC}static set DefaultConfig(e){tr.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Lh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=UR(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=yC(tr.DefaultConfig,e,t);this.userConfig=e,s.progressive&&vC(s,t);const{abrController:n,bufferController:i,capLevelController:o,errorController:a,fpsController:l}=s,u=new a(this),c=this.abrController=new n(this),d=new DI(this),h=s.interstitialsController,g=h?this.interstitialsController=new h(this,tr):null,f=this.bufferController=new i(this,d),p=this.capLevelController=new o(this),m=new l(this),y=new PC(this),v=s.contentSteeringController,E=v?new v(this):null,T=this.levelController=new RC(this,E),_=new xC(this),x=new CC(this.config,this.logger),w=this.streamController=new kC(this,d,x),A=this.gapController=new _C(this,d);p.setStreamController(w),m.setStreamController(w);const I=[y,T,w];g&&I.splice(1,0,g),E&&I.splice(1,0,E),this.networkControllers=I;const R=[c,f,A,p,m,_,d];this.audioTrackController=this.createController(s.audioTrackController,I);const P=s.audioStreamController;P&&I.push(this.audioStreamController=new P(this,d,x)),this.subtitleTrackController=this.createController(s.subtitleTrackController,I);const $=s.subtitleStreamController;$&&I.push(this.subtititleStreamController=new $(this,d,x)),this.createController(s.timelineController,R),x.emeController=this.emeController=this.createController(s.emeController,R),this.cmcdController=this.createController(s.cmcdController,R),this.latencyController=this.createController(AC,R),this.coreComponents=R,I.push(u);const j=u.onErrorOut;typeof j=="function"&&this.on(S.ERROR,j,u),this.on(S.MANIFEST_LOADED,y.onManifestLoaded,y)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===S.ERROR;this.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:q.OTHER_ERROR,details:L.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(S.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=vh.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[W.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[W.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[W.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=_k()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){yI(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let i=n;i--;){const o=e[i].attrs["HDCP-LEVEL"];if(o&&o<=s)return i}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=wv(t);return Tv(e,s,navigator.mediaCapabilities)}}tr.defaultConfig=void 0;const DC=({url:r,type:e,title:t})=>{const[s,n]=Ce.useState(!0),[i,o]=Ce.useState(null),a=Ce.useRef(null),l=Ce.useRef(null),[u,c]=Ce.useState({top:"10%",left:"10%"});return Ce.useEffect(()=>{let d=!0;n(!0),o(null);const h=r.includes(".m3u8");if(e==="video"&&h)if(tr.isSupported()){const g=new tr({xhrSetup:(f,p)=>{}});l.current&&(g.loadSource(r),g.attachMedia(l.current),g.on(tr.Events.MANIFEST_PARSED,()=>{d&&n(!1)}),g.on(tr.Events.ERROR,(f,p)=>{console.error("HLS Error:",p),p.fatal&&d&&o("Stream loading failed")}))}else l.current&&l.current.canPlayType("application/vnd.apple.mpegurl")?(l.current.src=r,l.current.addEventListener("loadedmetadata",()=>{d&&n(!1)})):(o("HLS not supported in this browser"),n(!1));else n(!1);return()=>{d=!1}},[r,e]),Ce.useEffect(()=>{const d=setInterval(()=>{const h=Math.floor(Math.random()*80)+10,g=Math.floor(Math.random()*80)+10;c({top:`${h}%`,left:`${g}%`})},4e3);return()=>clearInterval(d)},[]),Ce.useEffect(()=>{const d=()=>{if(document.hidden&&a.current){const h=a.current.querySelector("video, audio");h&&h.pause()}};return document.addEventListener("visibilitychange",d),()=>document.removeEventListener("visibilitychange",d)},[]),Q.jsxs("div",{ref:a,style:{position:"relative",width:"100%",background:"#000",borderRadius:"8px",overflow:"hidden",userSelect:"none",WebkitUserSelect:"none"},onContextMenu:d=>d.preventDefault(),children:[s&&Q.jsx("div",{style:{padding:"2rem",display:"flex",justifyContent:"center",color:"#666"},children:Q.jsx(Yw,{className:"animate-spin"})}),!s&&Q.jsxs(Q.Fragment,{children:[e==="video"?Q.jsx("video",{ref:l,src:r.includes(".m3u8")?void 0:r,controls:!0,controlsList:"nodownload noremoteplayback",disablePictureInPicture:!0,style:{width:"100%",display:"block"}}):Q.jsx("audio",{src:r,controls:!0,controlsList:"nodownload",style:{width:"100%",display:"block",padding:"10px"}}),e==="video"&&Q.jsxs("div",{style:{position:"absolute",top:u.top,left:u.left,color:"rgba(255, 255, 255, 0.3)",fontSize:"14px",fontWeight:"bold",pointerEvents:"none",zIndex:10,transition:"all 2s ease-in-out",textShadow:"0px 0px 4px rgba(0,0,0,0.8)",whiteSpace:"nowrap"},children:["Do Not Record - ",t.substring(0,15),"..."]}),Q.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:5,pointerEvents:"none"}})]}),i&&Q.jsxs("div",{style:{padding:"2rem",color:"#ff6b6b",textAlign:"center"},children:[Q.jsx(Ww,{size:20})," ",Q.jsx("br",{}),i]})]})},am="https://darkgoldenrod-lyrebird-210481.hostingersite.com/api.php";function OC(){const[r,e]=Ce.useState(null),[t,s]=Ce.useState(!1),[n,i]=Ce.useState(0),[o,a]=Ce.useState(null),[l,u]=Ce.useState([]),[c,d]=Ce.useState(!0),h=Ce.useRef(null);Ce.useEffect(()=>{g()},[]);const g=async()=>{try{const{data:m,error:y}=await Kg.from("videos").select("*").order("created_at",{ascending:!1});if(y)throw y;u(m||[])}catch(m){console.error("Error fetching videos:",m.message)}finally{d(!1)}},f=m=>{m.target.files&&m.target.files[0]&&(e(m.target.files[0]),a(null),i(0))},p=async()=>{if(!r)return;s(!0),a(null),i(0);const m=new FormData;m.append("file",r);try{const y=await Ne.post(am,m,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:v=>{if(v.total){const E=Math.round(v.loaded*100/v.total);i(E)}}});if(y.data.success){const v=`${am}?filename=${y.data.filename}`,{error:E}=await Kg.from("videos").insert([{title:r.name,description:`Size: ${(r.size/(1024*1024)).toFixed(2)} MB`,encrypted_path:v,access_level:"public",duration:0}]);if(E)throw E;e(null),g()}else a(y.data.message||"Upload failed")}catch(y){console.error(y),a(y.message||"Failed to upload file")}finally{s(!1)}};return Q.jsxs("div",{style:{maxWidth:"1000px",margin:"0 auto",textAlign:"left",paddingBottom:"3rem"},children:[Q.jsxs("header",{style:{marginBottom:"2rem",textAlign:"center"},children:[Q.jsxs("h1",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[Q.jsx(Eg,{size:32})," Hostinger + Supabase DB"]}),Q.jsx("p",{style:{color:"#888"},children:"Uploads go to Hostinger  Records go to Supabase"})]}),Q.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem"},children:[Q.jsx("div",{children:Q.jsxs("div",{style:{background:"#333",padding:"2rem",borderRadius:"16px",border:"1px solid #444",position:"sticky",top:"2rem"},children:[Q.jsx("h2",{style:{marginTop:0,fontSize:"1.2rem",marginBottom:"1rem"},children:"Upload New Media"}),Q.jsxs("div",{style:{border:"2px dashed #555",borderRadius:"12px",padding:"2rem",textAlign:"center",cursor:"pointer",marginBottom:"1.5rem",transition:"all 0.3s ease"},onClick:()=>{var m;return(m=h.current)==null?void 0:m.click()},children:[Q.jsx("input",{type:"file",ref:h,onChange:f,accept:"video/*,audio/*",style:{display:"none"}}),r?Q.jsxs("div",{children:[r.type.startsWith("video")?Q.jsx(qw,{size:48,color:"#646cff"}):Q.jsx(zw,{size:48,color:"#646cff"}),Q.jsx("h3",{style:{margin:"10px 0",wordBreak:"break-all"},children:r.name}),Q.jsxs("p",{style:{color:"#aaa",fontSize:"0.9rem"},children:[(r.size/(1024*1024)).toFixed(2)," MB"]})]}):Q.jsxs("div",{children:[Q.jsx(Eg,{size:48,color:"#888"}),Q.jsx("h3",{children:"Click to Select File"})]})]}),Q.jsx("button",{onClick:p,disabled:!r||t,style:{width:"100%",padding:"0.8rem"},children:t?"Uploading...":"Upload & Save to DB"}),t&&Q.jsxs("div",{style:{marginTop:"1rem"},children:[Q.jsx("div",{style:{height:"6px",background:"#444",borderRadius:"3px",overflow:"hidden"},children:Q.jsx("div",{style:{height:"100%",background:"#646cff",width:`${n}%`,transition:"width 0.2s"}})}),Q.jsxs("p",{style:{textAlign:"right",fontSize:"0.8rem",marginTop:"5px"},children:[n,"%"]})]}),o&&Q.jsxs("div",{style:{marginTop:"1rem",color:"#ff6b6b",display:"flex",gap:"8px",alignItems:"center",background:"rgba(255,0,0,0.1)",padding:"0.8rem",borderRadius:"8px"},children:[Q.jsx(Hw,{size:18})," ",o]})]})}),Q.jsxs("div",{children:[Q.jsxs("h2",{style:{marginTop:0,fontSize:"1.2rem",marginBottom:"1rem",display:"flex",justifyContent:"space-between"},children:[Q.jsx("span",{children:"Database Records"}),Q.jsxs("span",{style:{fontSize:"0.9rem",color:"#888",fontWeight:"normal"},children:[l.length," items"]})]}),c?Q.jsx("p",{style:{color:"#888"},children:"Loading from Supabase..."}):l.length===0?Q.jsx("div",{style:{textAlign:"center",padding:"3rem",background:"#333",borderRadius:"12px",color:"#888"},children:Q.jsx("p",{children:"No videos found in database."})}):Q.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:l.map(m=>Q.jsxs("div",{style:{background:"#2a2a2a",borderRadius:"12px",overflow:"hidden",border:"1px solid #333"},children:[Q.jsx("div",{style:{background:"#000",borderRadius:"8px",overflow:"hidden"},children:Q.jsx(DC,{url:m.encrypted_path,type:m.title.match(/\.(mp3|wav|ogg|m4a)$/i)?"audio":"video",title:m.title})}),Q.jsxs("div",{style:{padding:"1rem"},children:[Q.jsx("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem",wordBreak:"break-word"},children:m.title}),Q.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.8rem",color:"#888"},children:Q.jsx("span",{children:new Date(m.created_at).toLocaleDateString()})})]})]},m.id))})]})]})]})}Gu.createRoot(document.getElementById("root")).render(Q.jsx(rS.StrictMode,{children:Q.jsx(OC,{})}));
